(window.webpackJsonp=window.webpackJsonp||[]).push([[4],[,,,,,,,,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(7);e.PIXI=s;var a=i(54);e.TWEEN=a.default;var r=i(22);e.Global=r,e.createParticleEmitter=r.createParticleEmitter,n.__exportStar(i(55),e),n.__exportStar(i(16),e);var o=i(43);e.TextureLoader=o.TextureLoader;var u=i(26);e.AnimatedSprite=u.AnimatedSprite;var l=i(27);e.AnimationSequence=l.AnimationSequence;var c=i(101);e.SpriteButton=c.SpriteButton;var h=i(102);e.Parallax=h.Parallax;var p=i(56);e.Dictionary=p.Dictionary;var d=i(103);e.KeyboardMapper=d.KeyboardMapper},function(t,e,i){"use strict";i.r(e),i.d(e,"__extends",(function(){return s})),i.d(e,"__assign",(function(){return a})),i.d(e,"__rest",(function(){return r})),i.d(e,"__decorate",(function(){return o})),i.d(e,"__param",(function(){return u})),i.d(e,"__metadata",(function(){return l})),i.d(e,"__awaiter",(function(){return c})),i.d(e,"__generator",(function(){return h})),i.d(e,"__exportStar",(function(){return p})),i.d(e,"__values",(function(){return d})),i.d(e,"__read",(function(){return f})),i.d(e,"__spread",(function(){return m})),i.d(e,"__spreadArrays",(function(){return y})),i.d(e,"__await",(function(){return v})),i.d(e,"__asyncGenerator",(function(){return g})),i.d(e,"__asyncDelegator",(function(){return S})),i.d(e,"__asyncValues",(function(){return x})),i.d(e,"__makeTemplateObject",(function(){return w})),i.d(e,"__importStar",(function(){return _})),i.d(e,"__importDefault",(function(){return b})),i.d(e,"__classPrivateFieldGet",(function(){return T})),i.d(e,"__classPrivateFieldSet",(function(){return P}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function s(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var a=function(){return(a=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var s in e=arguments[i])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)};function r(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(t);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(t,n[s])&&(i[n[s]]=t[n[s]])}return i}function o(t,e,i,n){var s,a=arguments.length,r=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,n);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(r=(a<3?s(r):a>3?s(e,i,r):s(e,i))||r);return a>3&&r&&Object.defineProperty(e,i,r),r}function u(t,e){return function(i,n){e(i,n,t)}}function l(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function c(t,e,i,n){return new(i||(i=Promise))((function(s,a){function r(t){try{u(n.next(t))}catch(t){a(t)}}function o(t){try{u(n.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,o)}u((n=n.apply(t,e||[])).next())}))}function h(t,e){var i,n,s,a,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=2&a[0]?n.return:a[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,a[1])).done)return s;switch(n=0,s&&(a=[2&a[0],s.value]),a[0]){case 0:case 1:s=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,n=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(s=r.trys,(s=s.length>0&&s[s.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!s||a[1]>s[0]&&a[1]<s[3])){r.label=a[1];break}if(6===a[0]&&r.label<s[1]){r.label=s[1],s=a;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(a);break}s[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(t){a=[6,t],n=0}finally{i=s=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}}function p(t,e){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}function d(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function f(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,s,a=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=a.next()).done;)r.push(n.value)}catch(t){s={error:t}}finally{try{n&&!n.done&&(i=a.return)&&i.call(a)}finally{if(s)throw s.error}}return r}function m(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(f(arguments[e]));return t}function y(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),s=0;for(e=0;e<i;e++)for(var a=arguments[e],r=0,o=a.length;r<o;r++,s++)n[s]=a[r];return n}function v(t){return this instanceof v?(this.v=t,this):new v(t)}function g(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,s=i.apply(t,e||[]),a=[];return n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n;function r(t){s[t]&&(n[t]=function(e){return new Promise((function(i,n){a.push([t,e,i,n])>1||o(t,e)}))})}function o(t,e){try{(i=s[t](e)).value instanceof v?Promise.resolve(i.value.v).then(u,l):c(a[0][2],i)}catch(t){c(a[0][3],t)}var i}function u(t){o("next",t)}function l(t){o("throw",t)}function c(t,e){t(e),a.shift(),a.length&&o(a[0][0],a[0][1])}}function S(t){var e,i;return e={},n("next"),n("throw",(function(t){throw t})),n("return"),e[Symbol.iterator]=function(){return this},e;function n(n,s){e[n]=t[n]?function(e){return(i=!i)?{value:v(t[n](e)),done:"return"===n}:s?s(e):e}:s}}function x(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,i=t[Symbol.asyncIterator];return i?i.call(t):(t=d(t),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(i){e[i]=t[i]&&function(e){return new Promise((function(n,s){(function(t,e,i,n){Promise.resolve(n).then((function(e){t({value:e,done:i})}),e)})(n,s,(e=t[i](e)).done,e.value)}))}}}function w(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function _(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function b(t){return t&&t.__esModule?t:{default:t}}function T(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function P(t,e,i){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,i),i}},,,,,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SCENE_WIDTH=1920,e.SCENE_HEIGHT=1080,e.SCENE_HALF_WIDTH=e.SCENE_WIDTH/2,e.SCENE_HALF_HEIGHT=e.SCENE_HEIGHT/2,e.BTN_WIDTH=120,e.BTN_HEIGHT=60,e.GUI_FONT="Orbitron",e.SCENE_BACKCOLOR=1122867,e.ANIMATION_FPS_NORMAL=14,e.ANIMATION_FPS_SLOW=4,e.BTN_STYLE={align:"center",padding:0,fontSize:28,fontFamily:e.GUI_FONT,fill:4652029,strokeThickness:1,stroke:0},e.TEXT_STYLE={align:"left",font:{name:"Orbitron",size:21},tint:15066395},e.MSG_COIN_STYLE={align:"left",font:{name:"Orbitron",size:22},tint:16711492},e.MSG_HP_STYLE={align:"center",font:{name:"Orbitron",size:24},tint:16716049},e.MSG_EXP_STYLE={align:"center",font:{name:"Orbitron",size:24},tint:8700418},e.MSG_WARN_STYLE={align:"center",font:{name:"Orbitron",size:27},tint:16711697},e.QUEST_ITEM_STYLE={align:"center",font:{name:"Orbitron",size:28},tint:8700658},e.QUEST_STYLE={align:"left",font:{name:"Orbitron",size:24},tint:16711628}},,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.MaxHP=0]="MaxHP",t[t.MaxDust=1]="MaxDust",t[t.RegenHP=2]="RegenHP",t[t.RegenDust=3]="RegenDust"}(e.BaseStatType||(e.BaseStatType={})),function(t){t[t.MaxHP=0]="MaxHP",t[t.HP=1]="HP",t[t.MaxDust=2]="MaxDust",t[t.Dust=3]="Dust",t[t.RegenHP=4]="RegenHP",t[t.RegenDust=5]="RegenDust",t[t.Coins=6]="Coins",t[t.Gold=7]="Gold",t[t.LevelExp=8]="LevelExp",t[t.LevelMaxExp=9]="LevelMaxExp",t[t.TotalExp=10]="TotalExp",t[t.AttributePoints=11]="AttributePoints",t[t.CharacterLevel=12]="CharacterLevel"}(e.StatType||(e.StatType={})),function(t){t[t.LavaBorder=1e3]="LavaBorder",t[t.Lava=1001]="Lava",t[t.Poison=1002]="Poison"}(e.DamageType||(e.DamageType={})),function(t){t[t.HP=0]="HP",t[t.Atk=1]="Atk",t[t.AtkCD=2]="AtkCD",t[t.Def=3]="Def"}(e.AtrType||(e.AtrType={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right"}(e.DirectionH||(e.DirectionH={}))},,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(22),s=i(28),a=i(33),r=i(19),o=function(){function t(){var e=this;this.baseStats=[],this.attributeStats=[],this.stats=[],this.accumulator=0,this.dpsDecreaseAmount=0,this.hasJumpAttack=!1,this.hasMagicAttack=!1,this.characterLevel=0,this.currentGameLevel=0,this.expForNextLevel=0,this.isBurningBuff=!1,this.buffs=[],this.onUpdate=function(t){for(var i=performance.now()/1e3,n=1e3,a=e.buffs.length;n<a;n++)if(e.buffs[n]&&e.buffs[n]>i){var o=0;switch(n){case r.DamageType.LavaBorder:o=5;break;case r.DamageType.Lava:o=15;break;case r.DamageType.Poison:o=10}var u=.001*t*o;e.dpsDecreaseAmount+=u}if(e.accumulator+=t,e.accumulator>500){if(e.accumulator-=500,e.stats[r.StatType.Dust]<e.stats[r.StatType.MaxDust]){var l=.5*e.stats[r.StatType.RegenDust];e.increaseStat(r.StatType.Dust,l)}if(e.stats[r.StatType.HP]<e.stats[r.StatType.MaxHP]){l=.5*e.stats[r.StatType.RegenHP];e.increaseStat(r.StatType.HP,l)}if(e.dpsDecreaseAmount>=1){var c=Math.floor(e.dpsDecreaseAmount),h={OldValue:e.stats[r.StatType.HP],Amount:-c};s.eventEmitter.emit(s.DAMAGE_TOPIC,h),e.increaseStat(r.StatType.HP,-c),e.dpsDecreaseAmount-=c}}var p=e.isBurningBuff;e.isBurningBuff=e.buffs[r.DamageType.LavaBorder]>i||e.buffs[r.DamageType.Lava]>i,p!==e.isBurning&&s.eventEmitter.emit(s.BURN_TOPIC,{wasBurning:p,isBurning:e.isBurningBuff})},this.scevent={Type:r.StatType.Coins,OldValue:0,NewValue:0,Stats:[]},this.id=0,this.attributeStats[r.BaseStatType.RegenHP]=0,this.attributeStats[r.BaseStatType.RegenDust]=0,this.attributeStats[r.BaseStatType.MaxHP]=0,this.attributeStats[r.BaseStatType.MaxDust]=0,this.stats[r.StatType.Coins]=0,this.stats[r.StatType.Dust]=600,this.stats[r.StatType.TotalExp]=0,this.stats[r.StatType.AttributePoints]=0,this.stats[r.StatType.HP]=120;t.expForLevel[0]=0;for(var i=1;i<1e4;i++)t.expForLevel[i]=t.expForLevel[i-1]+1e3*i;this.rebuildStats()}return Object.defineProperty(t.prototype,"LevelLoader",{get:function(){return this.levelLoader||(this.levelLoader=new a.LevelLoader(n.LevelDefinitions)),this.levelLoader},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBurning",{get:function(){return this.isBurningBuff},enumerable:!0,configurable:!0}),t.prototype.loadLevel=function(){this.loadUserState(),this.currentLevel=this.LevelLoader.buildLevel(this.currentGameLevel)},t.prototype.saveUserState=function(t){t&&(this.currentGameLevel+=1);this.id,this.stats[r.StatType.Coins],this.stats[r.StatType.Gold],Math.floor(this.stats[r.StatType.Dust]),this.stats[r.StatType.TotalExp],this.stats[r.StatType.AttributePoints],this.stats[r.StatType.HP],this.currentGameLevel},t.prototype.loadUserState=function(){this.id;var t={HP:this.getStat(r.StatType.MaxHP),Exp:this.getStat(r.StatType.TotalExp),Coins:this.getStat(r.StatType.Coins),Dust:this.getStat(r.StatType.MaxDust),Gold:0,AtrPts:0,LastLevel:this.currentGameLevel};console.log("loadUserState() response",t),e.stats.currentGameLevel=t.LastLevel,t.HP<=0&&(t.HP=this.stats[r.StatType.MaxHP]),this.setStat(r.StatType.HP,t.HP),this.setStat(r.StatType.Coins,t.Coins),this.setStat(r.StatType.Gold,t.Gold),this.setStat(r.StatType.Dust,t.Dust),this.setStat(r.StatType.AttributePoints,t.AtrPts),this.setStat(r.StatType.TotalExp,t.Exp),this.rebuildStats()},Object.defineProperty(t.prototype,"HasJumpAtack",{get:function(){return this.hasJumpAttack},set:function(t){this.hasJumpAttack=t},enumerable:!0,configurable:!0}),t.prototype.setStat=function(e,i){this.stats[e]=i,e===r.StatType.TotalExp&&(this.characterLevel=t.findExpLevel(i),this.stats[r.StatType.LevelMaxExp]=t.expForLevel[this.characterLevel+1]-t.expForLevel[this.characterLevel],this.stats[r.StatType.LevelExp]=this.stats[r.StatType.TotalExp]-t.expForLevel[this.characterLevel],this.expForNextLevel=t.expForLevel[this.characterLevel+1]),this.updateEvent(e,i),s.eventEmitter.emit(s.STATCHANGE_TOPIC,this.scevent)},t.prototype.getStat=function(t){return this.stats[t]},t.prototype.increaseStat=function(e,i,n){var a=this.stats[e]+i;n&&a>n&&(a=n),a<0&&(a=0),this.updateEvent(e,a),this.stats[e]=a,e===r.StatType.TotalExp&&(this.stats[r.StatType.LevelExp]=a-t.expForLevel[this.characterLevel],a>=this.expForNextLevel&&(this.characterLevel=t.findExpLevel(a),this.expForNextLevel=t.expForLevel[this.characterLevel+1],this.stats[r.StatType.LevelMaxExp]=this.expForNextLevel-t.expForLevel[this.characterLevel],this.stats[r.StatType.LevelExp]=a-t.expForLevel[this.characterLevel],this.scevent.Type=r.StatType.CharacterLevel,this.scevent.OldValue=this.characterLevel-1,this.scevent.NewValue=this.characterLevel,this.scevent.Stats=this.stats,s.eventEmitter.emit(s.STATCHANGE_TOPIC,this.scevent),a=this.stats[r.StatType.AttributePoints]+5,this.scevent.Type=r.StatType.AttributePoints,this.scevent.OldValue=this.getStat(r.StatType.AttributePoints),this.scevent.NewValue=a,this.setStat(r.StatType.AttributePoints,a),this.scevent.Stats=this.stats,s.eventEmitter.emit(s.STATCHANGE_TOPIC,this.scevent),this.setStat(r.StatType.Dust,this.stats[r.StatType.MaxDust]),this.setStat(r.StatType.HP,this.stats[r.StatType.MaxHP]),this.scevent.Type=e,this.scevent.OldValue=0,this.scevent.NewValue=this.stats[r.StatType.LevelExp],this.scevent.Stats=this.stats)),s.eventEmitter.emit(s.STATCHANGE_TOPIC,this.scevent)},t.findExpLevel=function(e){for(var i=0,n=t.expForLevel.length;i<n;i++)if(e<t.expForLevel[i])return i-1},t.prototype.rebuildStats=function(){this.baseStats[r.BaseStatType.MaxHP]=150+10*this.characterLevel,this.baseStats[r.BaseStatType.MaxDust]=600+50*this.characterLevel,this.baseStats[r.BaseStatType.RegenDust]=2+this.characterLevel/2,this.baseStats[r.BaseStatType.RegenHP]=1+this.characterLevel/2,this.stats[r.StatType.MaxHP]=this.baseStats[r.BaseStatType.MaxHP]*(1+this.attributeStats[r.BaseStatType.MaxHP]/10),this.stats[r.StatType.MaxDust]=this.baseStats[r.BaseStatType.MaxDust]*(1+this.attributeStats[r.BaseStatType.MaxDust]/10),this.stats[r.StatType.RegenHP]=this.baseStats[r.BaseStatType.RegenHP]*(1+this.attributeStats[r.BaseStatType.RegenHP]/10),this.stats[r.StatType.RegenDust]=this.baseStats[r.BaseStatType.RegenDust]*(1+this.attributeStats[r.BaseStatType.RegenDust]/10)},t.prototype.updateEvent=function(t,e){this.scevent.Type=t,this.scevent.OldValue=this.stats[t],this.scevent.NewValue=e,this.scevent.Stats=this.stats},t.expForLevel=[],t}();e.stats=new o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,s=i(10),a=i(7),r=i(100),o=i(55),u=i(16);a.settings.ROUND_PIXELS=!0,e.getScm=function(){if(!n){var t=document.getElementById("stage"),e={width:u.SCENE_WIDTH,height:u.SCENE_HEIGHT,view:t,backgroundColor:0,antialias:!1,transparent:!1,resolution:window.devicePixelRatio};n=new o.SceneManager(e)}return n},e.deleteScm=function(){n&&n.Renderer.destroy(),n=void 0},e.position=new a.Point,e.createParticleEmitter=function(t,e,i){var n={alpha:{start:.8,end:.03},color:{start:"#dcff09",end:"#9f1f1f"},scale:{start:.1,end:.4,minimumScaleMultiplier:1},speed:{start:50,end:3,minimumSpeedMultiplier:1},acceleration:new a.Point,startRotation:{min:0,max:360},rotationSpeed:{min:5,max:20},lifetime:{min:.4,max:1},blendMode:"add",frequency:.01,emitterLifetime:-1,maxParticles:200,pos:new a.Point(0,-24),addAtBack:!1,spawnType:"circle",spawnCircle:{x:0,y:0,r:10}};i&&(n=s.__assign(s.__assign({},n),i));var o=new r.Emitter(t,e,n);return o.emit=!1,o},e.LevelDefinitions={templates:void 0,levels:void 0,quests:void 0}},,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(29),s=i(9),a=i(9),r=i(50),o=function(t,e){this.BodyA=t,this.BodyB=e};e.ContactPair=o;var u=function(){function t(){var t=this;this.contactPairs=[],this.contactWatch=[],this.playerBodyContacts=[],this.fixedTimeStep=1/60,this.beginContact=function(e){var i=null,n=null;if(e.bodyA.shapes[0].collisionGroup===r.COL_GRP_BULLET?(i=e.bodyA,n=e.bodyB):e.bodyB.shapes[0].collisionGroup===r.COL_GRP_BULLET&&(i=e.bodyB,n=e.bodyA),i)t.world.emit({type:"bulletContact",playerHit:n===t.playerBody,bulletBody:i,otherBody:n});else{if(t.playerBody===e.bodyA)return t.playerBodyContacts.push(e.bodyB),void t.world.emit({type:"playerContact",velocity:t.playerBody.velocity,body:e.bodyB});if(t.playerBody===e.bodyB)return t.playerBodyContacts.push(e.bodyA),void t.world.emit({type:"playerContact",velocity:t.playerBody.velocity,body:e.bodyA});var s=t.contactWatch.filter((function(t){return t===e.bodyA.id||t===e.bodyB.id}));if(s&&s.length>0){var a=new o(e.bodyA,e.bodyB);t.contactPairs.push(a)}}},this.endContact=function(e){if(!(e.bodyA.shapes[0].collisionGroup===r.COL_GRP_BULLET||e.bodyB.shapes[0].collisionGroup===r.COL_GRP_BULLET)){if(t.playerBody===e.bodyA){var i=t.playerBodyContacts.indexOf(e.bodyB);return t.playerBodyContacts.splice(i,1),void t.world.emit({type:"playerContactEnd",velocity:t.playerBody.velocity,body:e.bodyB})}if(t.playerBody===e.bodyB){i=t.playerBodyContacts.indexOf(e.bodyB);return t.playerBodyContacts.splice(i,1),void t.world.emit({type:"playerContactEnd",velocity:t.playerBody.velocity,body:e.bodyA})}for(var n=-1,s=0;s<t.contactPairs.length;s++){var a=t.contactPairs[s];if(a.BodyA===e.bodyA&&a.BodyB===e.bodyB||a.BodyA===e.bodyB&&a.BodyB===e.bodyA){n=s;break}}n>=0&&t.contactPairs.splice(n,1)}},this.world=new n.World({gravity:[0,-1500]}),this.setupMaterials(),this.ground=new n.Body({mass:0});var e=new n.Plane;e.material=this.materials.get("ground_default"),e.collisionGroup=r.COL_GRP_GROUND,e.collisionMask=r.COL_GRP_SCENE|r.COL_GRP_NPC|r.COL_GRP_PLAYER|r.COL_GRP_BULLET,this.ground.addShape(e),this.world.addBody(this.ground),this.playerBody=new n.Body({mass:42,fixedRotation:!0}),this.playerBody.damping=.001,(e=new n.Circle({radius:24})).collisionGroup=r.COL_GRP_PLAYER,e.collisionMask=r.COL_GRP_GROUND|r.COL_GRP_SCENE|r.COL_GRP_NPC|r.COL_GRP_BULLET,e.material=this.materials.get("player"),this.playerBody.addShape(e),this.world.addBody(this.playerBody),this.world.sleepMode=n.World.BODY_SLEEPING,this.world.on("beginContact",this.beginContact,this),this.world.on("endContact",this.endContact,this)}return t.prototype.clearLevel=function(){for(var t=this.world.bodies,e=t.length-1;e>=0;e--){var i=t[e];i!==this.playerBody&&i!==this.ground&&this.world.removeBody(i)}},Object.defineProperty(t.prototype,"bodies",{get:function(){return this.world.bodies},enumerable:!0,configurable:!0}),t.prototype.on=function(t,e,i){i=i||this,this.world.on(t,e,i)},t.prototype.update=function(t){this.world.step(this.fixedTimeStep,t/1e3),s.Global.position.x=this.playerBody.interpolatedPosition[0],s.Global.position.y=this.playerBody.interpolatedPosition[1]},t.prototype.removeBody=function(t){this.world.removeBody(t)},t.prototype.addBody=function(t){if(t.shapes&&t.shapes.length>0)for(var e=0,i=t.shapes.length;e<i;e++){var n=t.shapes[e];n.materialName&&!n.material&&(n.material=this.materials.get(n.materialName))}this.world.addBody(t)},t.prototype.clearContactsForBody=function(t){if(t!==this.playerBody)for(var e=0;e>-1;){e=-1;for(var i=0;i<this.contactPairs.length;i++){var n=this.contactPairs[i];if(n.BodyA===t||n.BodyB===t){e=i;break}}e>=0&&this.contactPairs.splice(e,1)}else this.playerBodyContacts=[]},t.prototype.getContactsForBody=function(t){for(var e=[],i=0,n=this.contactPairs.length;i<n;i++){var s=this.contactPairs[i];s.BodyA!==t&&s.BodyB!==t||e.push(s)}return e},t.prototype.addContactWatch=function(t){this.contactWatch.push(t.id)},Object.defineProperty(t.prototype,"playerContacts",{get:function(){return this.playerBodyContacts},enumerable:!0,configurable:!0}),t.prototype.setupMaterials=function(){this.materials=new a.Dictionary,this.materials.set("player",new n.Material(n.Material.idCounter++)),this.materials.set("ground_default",new n.Material(n.Material.idCounter++)),this.materials.set("box_default",new n.Material(n.Material.idCounter++)),this.materials.set("box_highfriction",new n.Material(n.Material.idCounter++)),this.materials.set("mob_default",new n.Material(n.Material.idCounter++)),this.materials.set("bumper",new n.Material(n.Material.idCounter++));var t=new n.ContactMaterial(this.materials.get("player"),this.materials.get("ground_default"),{friction:.85,restitution:.1,stiffness:n.Equation.DEFAULT_STIFFNESS,relaxation:n.Equation.DEFAULT_RELAXATION,frictionStiffness:n.Equation.DEFAULT_STIFFNESS,frictionRelaxation:n.Equation.DEFAULT_RELAXATION,surfaceVelocity:0});this.world.addContactMaterial(t);var e=new n.ContactMaterial(this.materials.get("player"),this.materials.get("mob_default"),{friction:.1,restitution:.4,stiffness:n.Equation.DEFAULT_STIFFNESS,relaxation:n.Equation.DEFAULT_RELAXATION,frictionStiffness:n.Equation.DEFAULT_STIFFNESS,frictionRelaxation:n.Equation.DEFAULT_RELAXATION,surfaceVelocity:0});this.world.addContactMaterial(e);var i=new n.ContactMaterial(this.materials.get("player"),this.materials.get("box_default"),{friction:.2,restitution:.25,stiffness:n.Equation.DEFAULT_STIFFNESS,relaxation:n.Equation.DEFAULT_RELAXATION,frictionStiffness:n.Equation.DEFAULT_STIFFNESS,frictionRelaxation:n.Equation.DEFAULT_RELAXATION,surfaceVelocity:0});this.world.addContactMaterial(i);var s=new n.ContactMaterial(this.materials.get("player"),this.materials.get("box_highfriction"),{friction:.7,restitution:.2,stiffness:n.Equation.DEFAULT_STIFFNESS,relaxation:n.Equation.DEFAULT_RELAXATION,frictionStiffness:n.Equation.DEFAULT_STIFFNESS,frictionRelaxation:n.Equation.DEFAULT_RELAXATION,surfaceVelocity:0});this.world.addContactMaterial(s);var r=new n.ContactMaterial(this.materials.get("player"),this.materials.get("bumper"),{friction:.35,restitution:.75,stiffness:Number.MAX_VALUE,relaxation:n.Equation.DEFAULT_RELAXATION,frictionStiffness:Number.MAX_VALUE,frictionRelaxation:n.Equation.DEFAULT_RELAXATION,surfaceVelocity:0});this.world.addContactMaterial(r);var o=new n.ContactMaterial(this.materials.get("box_default"),this.materials.get("ground_default"),{friction:.8,restitution:.3,stiffness:n.Equation.DEFAULT_STIFFNESS,relaxation:n.Equation.DEFAULT_RELAXATION,frictionStiffness:n.Equation.DEFAULT_STIFFNESS,frictionRelaxation:n.Equation.DEFAULT_RELAXATION,surfaceVelocity:0});this.world.addContactMaterial(o)},t}();e.WorldP2=u,e.wp2=new u},,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(9),a=i(56),r=function(t){function e(){var e=t.call(this)||this;return e.currentSequence=null,e.accumulator=0,e.isPlaying=!1,e.isLooping=!1,e.frameIndex=0,e.currentFps=8,e.animations=new a.Dictionary,e.play=function(t,i,n){void 0===n&&(n=!0),e.currentSequence&&e.currentSequence.sequenceName===t||(e.resetAnimation(),e.currentSequence=e.animations.get(t),e.texture=e.currentSequence.spriteSheet,e.texture.frame=e.currentSequence.frames[0],e.isPlaying=!0),e.fps=i||e.fps,e.isLooping=n},e.pivot.set(.5),e.anchor.set(.5),e}return n.__extends(e,t),e.prototype.addAnimations=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];e.forEach((function(e,i){t.animations.set(e.sequenceName,e),t.texture.valid||0!==i||(t.texture=e.spriteSheet,t.texture.frame=e.frames[0])}))},e.prototype.clearAnimations=function(){this.stop(),this.currentSequence=null,this.animations.clear()},e.prototype.onUpdate=function(t){if(this.isPlaying&&this.texture.valid&&this.currentSequence){this.accumulator+=t;var e=1e3/this.fps;this.accumulator>e&&(this.accumulator-=e,this.texture.frame=this.currentSequence.frames[++this.frameIndex],this.frameIndex===this.currentSequence.frames.length-1&&(this.frameIndex=0,this.isLooping||(this.isPlaying=!1,this.onCompleteCallBack&&this.onCompleteCallBack(this.currentSequence))))}},Object.defineProperty(e.prototype,"onComplete",{get:function(){return this.onCompleteCallBack},set:function(t){this.onCompleteCallBack=t},enumerable:!0,configurable:!0}),e.prototype.stop=function(){this.isPlaying=!1},Object.defineProperty(e.prototype,"fps",{get:function(){return this.currentFps},set:function(t){this.currentFps=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loop",{get:function(){return this.isLooping},set:function(t){this.isLooping=t},enumerable:!0,configurable:!0}),e.prototype.resetAnimation=function(){this.stop(),this.currentSequence=null,this.accumulator=0,this.frameIndex=-1},e}(s.PIXI.Sprite);e.AnimatedSprite=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(9),s=function(){function t(t,e,i,s,a){var r=this;void 0===i&&(i=[]),this.sequenceName=t,this.frames=[];var o=n.TextureLoader.Get(e),u=n.TextureLoader.IsAtlas(o);this.spriteSheet=new n.PIXI.Texture(o.baseTexture);var l=u?Math.floor(o.frame.width/s):Math.floor(this.spriteSheet.width/s);i.forEach((function(t){var e,i=Math.floor(t/l),c=t%l;e=u?new n.PIXI.Rectangle(o.frame.x+c*s,o.frame.y+i*a,s,a):new n.PIXI.Rectangle(c*s,i*a,s,a),r.frames.push(e)}))}return Object.defineProperty(t.prototype,"frameCount",{get:function(){return this.frames.length},enumerable:!0,configurable:!0}),t}();e.AnimationSequence=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(9);e.eventEmitter=new n.PIXI.utils.EventEmitter,e.MOVE_TOPIC="MOVE",e.BURN_TOPIC="BURN",e.STATCHANGE_TOPIC="STATCHANGE",e.DAMAGE_TOPIC="DAMAGE",e.GROUND_SHAKE="SHAKE"},,,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(87),s=function(){function t(){this.musicTrackNames=["assets/audio/Two-Finger-Johnny.mp3","assets/audio/Bumbling-Burglars_Looping.mp3","assets/audio/Bama-Country.mp3","assets/audio/Beachfront-Celebration.mp3","assets/audio/Easy-Jam.mp3","assets/audio/Whiskey-on-the-Mississippi.mp3","assets/audio/ZigZag.mp3","assets/audio/Carrousel.mp3","assets/audio/Disco-Break.mp3"],this.musicTracks=[],this.currentTrack=0,this.previousMusicVolume=.6,this.previousFxVolume=1,this.musicVolume=.6,this.fxVolume=1;for(var t=0,e=this.musicTrackNames.length;t<e;t++){var i=this.musicTrackNames[t];this.musicTracks.push(new n.Howl({preload:!1,src:[i],autoplay:!1,loop:!0,volume:.6}))}this.walkSnd=new n.Howl({src:["assets/audio/effects/step.mp3"],preload:!0,autoplay:!1,loop:!0,volume:1}),this.jumpSnd1=new n.Howl({src:["assets/audio/effects/jump1.mp3"],preload:!0,autoplay:!1,loop:!1,volume:1}),this.jumpSnd2=new n.Howl({src:["assets/audio/effects/jump2.mp3"],preload:!0,autoplay:!1,loop:!1,volume:1}),this.burnSnd=new n.Howl({src:["assets/audio/effects/burn.mp3"],preload:!0,autoplay:!1,loop:!0,volume:1}),this.hurtSnd=new n.Howl({src:["assets/audio/effects/hurt.mp3"],preload:!0,autoplay:!1,loop:!1,volume:1}),this.coinSnd=new n.Howl({src:["assets/audio/effects/coin.mp3"],preload:!0,autoplay:!1,loop:!1,volume:1}),this.gemSnd=new n.Howl({src:["assets/audio/effects/gem.mp3"],preload:!0,autoplay:!1,loop:!1,volume:1}),this.questItemSnd=new n.Howl({src:["assets/audio/effects/quest-item.mp3"],autoplay:!1,loop:!1,volume:1}),this.winSnd=new n.Howl({src:["assets/audio/effects/win.mp3"],autoplay:!1,loop:!1,volume:1}),this.atkMag1=new n.Howl({src:["assets/audio/effects/atk-mag01.mp3"],autoplay:!1,loop:!1,volume:1}),this.hitMag1=new n.Howl({src:["assets/audio/effects/hit-mag01.mp3"],autoplay:!1,loop:!1,volume:1}),this.jumpAtk=new n.Howl({src:["assets/audio/effects/jump-atk01.mp3"],autoplay:!1,loop:!1,volume:1}),this.pain=new n.Howl({src:["assets/audio/effects/pain01.mp3"],autoplay:!1,loop:!1,volume:1}),this.jmpContact=new n.Howl({src:["assets/audio/effects/jmp-contact.mp3"],autoplay:!1,loop:!1,volume:1}),this.woosh=new n.Howl({src:["assets/audio/effects/woosh.mp3"],autoplay:!1,loop:!1,volume:1}),this.squish=new n.Howl({src:["assets/audio/effects/mob-squish.mp3"],autoplay:!1,loop:!1,volume:1}),this.fxDemoSnd=new n.Howl({src:["assets/audio/effects/fx-demo.mp3"],autoplay:!1,loop:!1,volume:1})}return Object.defineProperty(t.prototype,"MusicVolume",{get:function(){return this.musicVolume},set:function(t){this.musicVolume=t,this.backgroundSnd&&this.backgroundSnd.playing()&&this.backgroundSnd.volume(this.musicVolume)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"FxVolume",{get:function(){return this.fxVolume},set:function(t){this.fxVolume=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsFxOn",{get:function(){return this.fxVolume>0},set:function(t){t?this.FxVolume=this.previousFxVolume:(this.previousFxVolume=this.fxVolume,this.FxVolume=0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsMusicOn",{get:function(){return this.musicVolume>0},set:function(t){t?this.MusicVolume=this.previousMusicVolume:(this.previousMusicVolume=this.musicVolume,this.MusicVolume=0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CurrentTrackId",{get:function(){return this.currentTrack},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fxDemo",{get:function(){return this.fxDemoSnd},enumerable:!0,configurable:!0}),t.prototype.jumpAttack=function(){this.walkSnd.pause(),this.jumpAtk.loop(!1),this.jumpAtk.play(),this.jumpAtk.volume(this.fxVolume)},t.prototype.jump=function(){this.walkSnd.pause(),this.jumpSnd1.play(),this.jumpSnd1.volume(this.fxVolume)},t.prototype.idle=function(){this.walkSnd.pause()},t.prototype.walk=function(t){this.walkSnd.rate(t?2:1.2),this.walkSnd.playing()||(this.walkSnd.volume(this.fxVolume),this.walkSnd.play())},t.prototype.atkMagic1=function(){this.atkMag1.volume(this.fxVolume),this.atkMag1.play()},t.prototype.hitMagic1=function(){this.hitMag1.volume(this.fxVolume),this.hitMag1.play()},t.prototype.hitPain=function(){this.pain.volume(this.fxVolume),this.pain.play()},t.prototype.mobSquish=function(){this.squish.volume(this.fxVolume),this.squish.play()},t.prototype.bulletHitWall=function(){this.woosh.volume(this.fxVolume),this.woosh.play()},t.prototype.coin=function(){this.coinSnd.volume(this.fxVolume),this.coinSnd.play()},t.prototype.gem=function(){this.gemSnd.volume(this.fxVolume),this.gemSnd.play()},t.prototype.hurt=function(){this.hurtSnd.volume(this.fxVolume),this.hurtSnd.play()},t.prototype.jumpContact=function(){this.jmpContact.volume(this.fxVolume),this.jmpContact.play()},t.prototype.questItem=function(){this.questItemSnd.volume(this.fxVolume),this.questItemSnd.play()},t.prototype.win=function(){this.backgroundSnd&&this.backgroundSnd.playing()&&this.backgroundSnd.fade(1,0,500),this.hurtSnd.stop(),this.walkSnd.stop(),this.jumpSnd1.stop(),this.jumpSnd2.stop(),this.burnSnd.stop(),this.winSnd.volume(this.fxVolume),this.winSnd.play()},t.prototype.burn=function(){this.burnSnd.playing()||(this.burnSnd.volume(this.fxVolume),this.burnSnd.play()),this.hurt()},t.prototype.burnStop=function(){var t=this;this.burnSnd.fade(1,0,200),setTimeout((function(){return t.burnSnd.stop()}),200)},t.prototype.getTrack=function(t){for(var e=0,i=this.musicTrackNames.length;e<i;e++)if(this.musicTrackNames[e].indexOf(t)>=0)return e;return-1},t.prototype.stopTrack=function(){void 0!==this.backgroundSnd&&this.backgroundSnd.stop()},t.prototype.playTrack=function(t){var e=this;void 0===this.backgroundSnd&&(this.backgroundSnd=this.musicTracks[t],console.log("playTrack "+t,this.backgroundSnd)),this.backgroundSnd===this.musicTracks[t]&&this.backgroundSnd.playing()||(this.backgroundSnd.stop(),this.backgroundSnd=this.musicTracks[t],this.backgroundSnd.volume(this.musicVolume),this.backgroundSnd.play(),"unloaded"===this.backgroundSnd.state()&&(this.backgroundSnd.load(),this.backgroundSnd.once("load",(function(){e.backgroundSnd.play()})))),this.currentTrack=t},t}();e.SoundMan=s,e.snd=new s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(22),a=i(29),r=i(9),o=i(50),u=i(118),l=i(85),c=i(57),h=i(16),p=function(){function t(t){this.gameLevels=t}return t.registerFactory=function(t,e){this.factoryList.set(t,e)},t.prototype.buildLevel=function(t){for(var e,i=void 0,n=0;n<this.gameLevels.levels.length;n++)if(this.gameLevels.levels[n].id===t){i=this.gameLevels.levels[n];break}return i&&(e=this.createLevel(i)),e},t.prototype.createLevel=function(e){var i={parallax:[],entities:[],start:[],audioTrack:e.audioTrack,templates:[],spawnPoints:[]},n=new r.PIXI.Point(h.SCENE_WIDTH,h.SCENE_HEIGHT);e.parallax.forEach((function(t){var e=new r.Parallax(n,t.parallaxFactor,t.textures,t.scale);e.y=t.y,i.parallax.push(e)}));var a=s.LevelDefinitions.templates.concat(e.map.templates);return i.templates=a,e.map.entities.forEach((function(e,n,s){var r=t.createEntity(a,e);i.entities.push(r)})),e.map.NPC=e.map.NPC||[],e.map.NPC.forEach((function(e,n,s){if(e.type&&"spawn_point"===e.type){var r=e,o=r.entity;i.spawnPoints.push(new u.SpawnPoint(r.name,r.xy[0],r.xy[1],r.area,r.maxMobCount,r.respawnSeconds,o))}else{var l=t.createMob(a,e);i.entities.push(l)}})),i.start=e.map.start,i},t.createEntity=function(e,i){var n,s=c.getEntityDefinition(e,i),r=t.buildDisplayObject(s.doDef);return r.name=i.name||i.template,r.templateName=s.templateName,s.bdDef?((n=t.buildPhysicsObject(s.bdDef,r)).shapes.every((function(t){return"ground"===s.bdDef.collisionType?(t.collisionGroup=o.COL_GRP_GROUND,t.collisionMask=o.COL_GRP_PLAYER|o.COL_GRP_NPC|o.COL_GRP_SCENE|o.COL_GRP_BULLET):(t.collisionGroup=o.COL_GRP_SCENE,t.collisionMask=o.COL_GRP_PLAYER|o.COL_GRP_NPC|o.COL_GRP_SCENE|o.COL_GRP_GROUND),!0})),n.DisplayObject=r,s.trigger&&(n.Trigger=s.trigger)):(n=new a.Body).DisplayObject=r,n},t.createMob=function(e,i){var n=c.getEntityDefinition(e,i),s=t.buildDisplayObject(n.doDef);s.name=i.name||i.template,s.templateName=n.templateName,s.attributes=i.attributes||n.doDef.attributes||[],s.createAI(i.ai||"basic_static"),s.atkTexture=i.attack||n.doDef.attack,n.bdDef.material=n.bdDef.material||"mob_default";var a=t.buildPhysicsObject(n.bdDef,s);return a.shapes.every((function(t){return t.collisionGroup=o.COL_GRP_NPC,t.collisionMask=o.COL_GRP_PLAYER|o.COL_GRP_GROUND|o.COL_GRP_SCENE,!0})),a.DisplayObject=s,n.trigger&&(a.Trigger=n.trigger),a},t.buildDisplayObject=function(t){var e;switch((t=n.__assign({anchor:.5,pivot:.5,scale:[1,1]},t)).typeName){case"Mob":var i=new l.Mob(t.texture);t.sequences&&(i.clearAnimations(),t.sequences.forEach((function(e){var n=e.texture||t.texture,s=new r.AnimationSequence(e.name,n,e.frames,e.framesize[0],e.framesize[1]);i.addAnimations(s)})),i.play(t.sequences[0].name)),t.fps&&(i.fps=t.fps),i.typeName="Mob",e=i;break;case"Sensor":(e=new r.PIXI.DisplayObject).typeName="Sensor";break;case"AnimatedSprite":var s=new r.AnimatedSprite;t.sequences.forEach((function(t,e,i){var n=new r.AnimationSequence(t.name,t.texture,t.frames,t.framesize[0],t.framesize[1]);s.addAnimations(n)})),s.play(t.sequences[0].name,t.fps),s.typeName="AnimatedSprite",e=s;break;case"Sprite":var a=r.TextureLoader.Get(t.texture),o=new r.PIXI.Sprite(a);o.typeName="Sprite",e=o;break;default:var u=this.factoryList.get(t.typeName);if(!u)throw"Factory not found for typeName: "+t.typeName;e=u(t)}return e.scale.set(t.scale[0],-1*t.scale[1]),e.anchor&&e.anchor.set(t.anchor),e.pivot.set(t.pivot),void 0!==t.visible&&(e.visible=t.visible),e.rotation=t.rotation||0,t.xy&&e.position.set(t.xy[0],t.xy[1]),t.interactionType&&(e.interactionType=t.interactionType),t.drop&&(e.drop=t.drop),t.tint&&(e.tint=parseInt(t.tint,16)),e},t.buildPhysicsObject=function(t,e,i){var n;void 0===i&&(i=!1);var s=0,r=0;if(t){var o={mass:t.mass,position:t.xy?t.xy:[e.x,e.y],angle:t.angle||e.rotation,fixedRotation:t.fixedRotation||!1,angularDamping:t.angularDamping||.1,damping:t.damping||.1};(n=new a.Body(o)).type=t.type||a.Body.KINEMATIC;var u,l=e;switch(t.shape){case"Circle":var c=32;c=t.size?t.size.constructor===Array?t.size[0]:t.size:l.width,u=new a.Circle({radius:c});break;case"Platform":t.size?(s=t.size[0],r=t.size[1]):(s=Math.abs(l.width),r=Math.abs(l.height)),u=new a.Box({width:s,height:r}),n.position[0]=n.position[0]+s/2,n.position[1]=n.position[1]-r/2;break;case"Box":t.size?(s=t.size[0],r=t.size[1]):l.width?(s=Math.abs(l.width),r=Math.abs(l.height)):(s=e.scale.x*e.getLocalBounds().width,r=e.scale.y*e.getLocalBounds().height),u=new a.Box({width:s,height:r})}t.material&&(u.materialName=t.material),!i&&e.interactionType?(u.sensor=!0,n.type=a.Body.STATIC,n.collisionResponse=!1,n.setDensity(0),console.log("created collectible sensor",u)):"Sensor"===e.typeName&&(u.sensor=!0,n.type=a.Body.STATIC,n.collisionResponse=!1,n.setDensity(0)),n.addShape(u)}return n},t.factoryList=new r.Dictionary,t}();e.LevelLoader=p},,,,,,,,,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(9),s=function(){function t(){}return t.IsAtlas=function(t){return t.frame.width!==t.baseTexture.width||t.frame.height!==t.baseTexture.height},t.Get=function(e,i,s){void 0===i&&(i=!1),void 0===s&&(s=n.PIXI.SCALE_MODES.LINEAR);var a=e.indexOf(".json@"),r=a>0?e.substr(a+6):e,o=a>0?e.substr(0,a+5):e,u=t.resourceCache[o];if(!u){t.resourceCache[o]=n.PIXI.Loader.shared.resources[o];var l=1===(u=t.resourceCache[o]).loadType?u.spritesheet.baseTexture:u.texture.baseTexture;l.mipmap=i,l.scaleMode=s}if(u){switch(u.loadType){case 1:return u.textures[r];case 2:return u.texture}console.error("Resource:'"+e+"' unknown load type!",u)}else console.error("Resource:'"+e+"' not found!")},t.resourceCache={},t}();e.TextureLoader=s},,,,,,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.COL_GRP_PLAYER=1,e.COL_GRP_NPC=2,e.COL_GRP_SCENE=4,e.COL_GRP_BULLET=8,e.COL_GRP_GROUND=16},,,,,function(t,e,i){"use strict";i.r(e),i.d(e,"DefaultScreenSizeCalculator",(function(){return s})),i.d(e,"Scene",(function(){return u})),i.d(e,"SceneManager",(function(){return r})),i.d(e,"VERSION",(function(){return a}));var n=i(7),s=function(){function t(t,e){this.designedWidth=t,this.designedHeight=e}return t.prototype.GetAvailableSize=function(){return{x:window.innerWidth,y:window.innerHeight}},t.prototype.GetAspectRatio=function(){return this.designedWidth/this.designedHeight},t.prototype.CalculateSize=function(t,e){var i=Math.floor(e*t.y),n=Math.floor(window.innerHeight);return{x:Math.min(i,t.x),y:Math.min(n,t.y)}},t.prototype.CalculateScale=function(t){return{x:t.x/this.designedWidth,y:t.x/this.designedWidth}},t}(),a="1.6.3",r=function(){function t(e,i){var a=this;this.currentScene=null,this.scenes=[],this.controllers=[],this.animationFrameHandle=-1,this.Destroy=function(){cancelAnimationFrame(a.animationFrameHandle),a.currentScene&&a.currentScene.pause(),a.scenes.forEach((function(t){a.RemoveScene(t)})),a.app.destroy(!0,{children:!0,texture:!0,baseTexture:!0})},this.resizeHandler=function(){a.onResize(a.screenSizeCalculator)},this.onRender=function(t){a.startTime||(a.startTime=Date.now()),a.timeStamp=Date.now();var e=a.timeStamp-a.startTime;e>50&&(e=50),a.controllers.forEach((function(t){(!t.scope||a.currentScene&&a.currentScene.name===t.scope)&&t.update(e,a.currentScene)})),a.currentScene&&!a.currentScene.isPaused()&&(a.currentScene.onUpdate(e,a.timeStamp),a.startTime=a.timeStamp)},t.logVersion(),this.masterContainer=new n.Container,this.app=new n.Application(e),this.app.ticker.add(this.onRender,this),this.app.stage=this.masterContainer,this.designWidth=e.width||window.innerWidth,this.designHeight=e.height||window.innerHeight,this.screenSizeCalculator=i||new s(this.designWidth,this.designHeight),window.removeEventListener("resize",this.resizeHandler),window.addEventListener("resize",this.resizeHandler,!0)}return t.logVersion=function(){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var t="color:#fa1;background:#ff66a5;padding:5px 0;",e=[" %c  %c pixi-scenegraph: "+a+" ✰  %c  %c https://github.com/enriko-riba/pixi-scenegraph#readme ❤❤❤\t",t,"color:#fa1;background:#000;padding:5px 0;",t,"color:#f55;background:#ffc3dc;padding:5px 0;"];console.info.apply(console,e)}else window.console&&console.info("pixi-scenegraph: "+a+" ✰ https://github.com/enriko-riba/pixi-scenegraph#readme  ❤❤❤")},Object.defineProperty(t.prototype,"Renderer",{get:function(){return this.app.renderer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Application",{get:function(){return this.app},enumerable:!0,configurable:!0}),t.prototype.AddController=function(t){this.controllers.push(t)},t.prototype.RemoveController=function(t){var e="string"!=typeof t?t.id:t;this.controllers=this.controllers.filter((function(t){return t.id!==e}))},Object.defineProperty(t.prototype,"CurrentScene",{get:function(){return this.currentScene},enumerable:!0,configurable:!0}),t.prototype.AddScene=function(t){this.scenes.push(t)},t.prototype.RemoveAllScenes=function(){this.scenes.forEach((function(t){t.onDestroy(),t.destroy({children:!0,texture:!0,baseTexture:!0})})),this.scenes=[],this.currentScene=null},t.prototype.RemoveScene=function(t){this.scenes=this.scenes.filter((function(e,i,n){return e!==t})),t.onDestroy(),t.destroy({children:!0,texture:!0,baseTexture:!0})},t.prototype.HasScene=function(t){var e=this.scenes.filter((function(e){return e.Name===t}));return e&&e.length>0},t.prototype.GetScene=function(t){var e=this.scenes.filter((function(e){return e.Name===t}));if(!e||0===e.length)throw Error("Scene: '"+t+"' not found");if(e.length>1)throw Error("Multiple scenes: '"+t+"' found");return e[0]},t.prototype.ActivateScene=function(t){var e;if("string"==typeof t){var i=this.scenes.filter((function(e){return e.Name===t}));if(!i||0===i.length)throw Error("Scene: '"+t+"' not found");if(i.length>1)throw Error("Multiple scenes: '"+t+"' found");e=i[0]}else e=t;this.currentScene&&this.currentScene!==e&&(console.log("DeactivateScene "+this.currentScene.Name),this.currentScene.onDeactivate()),console.log("ActivateScene "+e.Name),this.startTime=0,this.lastScene=this.currentScene!==e?this.currentScene:this.lastScene,this.currentScene=e,this.app.renderer.backgroundColor=e.BackGroundColor,this.resizeHandler(),e.onActivate(),this.masterContainer.removeChildren(),this.masterContainer.addChild(this.currentScene),this.masterHudOverlay&&this.masterContainer.addChild(this.masterHudOverlay),n.settings.RESOLUTION=window.devicePixelRatio},t.prototype.ActivatePreviousScene=function(){this.ActivateScene(this.lastScene)},Object.defineProperty(t.prototype,"MasterHudOverlay",{get:function(){return this.masterHudOverlay},set:function(t){this.masterHudOverlay=t,t&&(this.masterContainer.removeChildren(),this.masterContainer.addChild(this.currentScene),this.masterHudOverlay&&this.masterContainer.addChild(this.masterHudOverlay),this.resizeHandler())},enumerable:!0,configurable:!0}),t.prototype.CaptureScene=function(){console.log("Capturing scene, width: "+this.app.renderer.width+", height: "+this.app.renderer.height);var t=n.RenderTexture.create({width:this.app.renderer.width,height:this.app.renderer.height});return this.app.renderer.render(this.currentScene,t),t},t.prototype.onResize=function(t){var e=this.screenSizeCalculator.GetAvailableSize(),i=this.screenSizeCalculator.GetAspectRatio(),n=this.screenSizeCalculator.CalculateSize(e,i);this.app.renderer.resize(n.x,n.y);var s=this.screenSizeCalculator.CalculateScale(n);this.currentScene&&(this.currentScene.scale.set(s.x,s.y),this.currentScene.onResize()),this.masterHudOverlay&&this.masterHudOverlay.scale.set(s.x,s.y)},t}(),o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};var u=function(t){function e(e){var i=t.call(this)||this;return i.paused=!1,i.hudScene=null,i.clearValue=!0,i.backgroundColor=0,i.Name=e,i}return function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),e.prototype.onActivate=function(){},e.prototype.onDeactivate=function(){},e.prototype.onResize=function(){},e.prototype.onUpdate=function(t,e){},e.prototype.onDestroy=function(){},Object.defineProperty(e.prototype,"BackGroundColor",{get:function(){return this.backgroundColor},set:function(t){this.backgroundColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"HudOverlay",{get:function(){return this.hudScene},set:function(t){if(this.hudScene&&this.removeChild(this.hudScene),this.hudScene=t,this.hudScene){var e=this.children.length;this.addChildAt(this.hudScene,e)}},enumerable:!0,configurable:!0}),e.prototype.addChild=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=t.prototype.addChild.apply(this,e);if(this.hudScene){var s=this.children.length-1;this.setChildIndex(this.hudScene,s)}return n},e.prototype.addChildAt=function(e,i){var n=t.prototype.addChildAt.call(this,e,i);if(this.hudScene){var s=this.children.length-1;this.setChildIndex(this.hudScene,s)}return n},e.prototype.pause=function(){this.paused=!0},e.prototype.resume=function(){this.paused=!1},e.prototype.isPaused=function(){return this.paused},Object.defineProperty(e.prototype,"clear",{get:function(){return this.clearValue},set:function(t){this.clearValue=t},enumerable:!0,configurable:!0}),e}(n.Container)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.dictValues={},this.dictKeys=[]}return t.prototype.get=function(t){return this.dictValues[t]},t.prototype.contains=function(t){return t in this.dictValues},t.prototype.remove=function(t){var e=this.dictKeys.indexOf(t,0);this.dictKeys.splice(e,1),delete this.dictValues[t]},t.prototype.set=function(t,e){t in this.dictValues||this.dictKeys.push(t),this.dictValues[t]=e},Object.defineProperty(t.prototype,"keys",{get:function(){return this.dictKeys},enumerable:!0,configurable:!0}),t.prototype.getAll=function(){return this.dictValues},t.prototype.getSet=function(t,e){return this.contains(t)||this.set(t,"function"==typeof e?e():e),this.get(t)},t.prototype.clear=function(){this.dictKeys=[],this.dictValues={}},t}();e.Dictionary=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10);function s(t,e){var i=null,s=null,a={name:null,displayObject:{typeName:"Sprite"},body:null,trigger:null,drop:null},r=t.filter((function(t){return t.name===e.template}));r&&r.length>0&&(a=r[0]),i=n.__assign(n.__assign({},a.displayObject),e),a.drop&&(i=n.__assign(n.__assign({},i),{drop:a.drop})),a.body&&(s=a.body);var o=void 0;return(a.trigger||i.trigger)&&(o=n.__assign(n.__assign({},a.trigger),i.trigger)),{templateName:a.name,doDef:i,bdDef:s,trigger:o}}function a(t){for(var e={},i=[],n=0;n<t.length;n++)e[t[n]]||(e[t[n]]=!0,i.push(t[n]));return i}e.GetLevelAssets=function(t,e){for(var i=[],r=void 0,o=0;o<t.levels.length;o++)if(t.levels[o].id===e){r=t.levels[o];break}if(r){r.parallax.forEach((function(t){i=i.concat(t.textures)})),r.assets&&r.assets.length>0&&(i=i.concat(r.assets));var u=t.templates.concat(r.map.templates);r.map.templates.forEach((function(t){if(!t.type||"spawn_point"!==t.type){var e=t.displayObject;e.texture&&("string"==typeof e.texture?i.push(e.texture):i=i.concat(e.texture)),e.sequences&&e.sequences.forEach((function(t){i.push(t.texture)}))}})),r.map.entities.forEach((function(t){var e=s(u,t);e.doDef.texture&&("string"==typeof e.doDef.texture?i.push(e.doDef.texture):i=i.concat(e.doDef.texture)),e.doDef.sequences&&e.doDef.sequences.forEach((function(t){i.push(t.texture)}))})),r.map.NPC=r.map.NPC||[],r.map.NPC.forEach((function(t){if(t.type&&"spawn_point"===t.type);else{var e=t;e.attack&&(i=i.concat(e.attack));var s=u.filter((function(t){return t.name===e.template}));if(s&&s.length>0){var a=s[0],r=n.__assign(n.__assign({},a.displayObject),e);r.texture&&("string"==typeof r.texture?i.push(r.texture):i=i.concat(r.texture)),r.attack&&(i=i.concat(r.attack)),r.sequences&&r.sequences.forEach((function(t){t.texture&&i.push(t.texture)}))}}}))}return i=a(i=i.map((function(t){var e=t.indexOf(".json@");return e>0?t.substr(0,e+5):t})))},e.getEntityDefinition=s,e.getUniqueItems=a},,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(86),a=i(32),r=i(119),o=i(24),u=i(19),l=i(27),c=i(26),h=function(t){function e(e){var i=t.call(this)||this;return i.textureName=e,i._isDead=!1,i.isLoading=!1,i.attack=function(){var t=i.currentSequence,e=i.fps;a.snd.atkMagic1(),i._direction==u.DirectionH.Left?i.play("latk",e,!1):i.play("ratk",e,!1),i.onComplete=function(n){i.onComplete=null,i.fireBullet(),i.play(t.sequenceName,e)}},i.addAnimations(new l.AnimationSequence("left",i.textureName,[0,1,2],48,48)),i.addAnimations(new l.AnimationSequence("right",i.textureName,[3,4,5],48,48)),i.addAnimations(new l.AnimationSequence("latk",i.textureName,[6,7,8],48,48)),i.addAnimations(new l.AnimationSequence("ratk",i.textureName,[9,10,11],48,48)),i.addAnimations(new l.AnimationSequence("lsquish",i.textureName,[12,13,14,15,16,17],48,48)),i.addAnimations(new l.AnimationSequence("rsquish",i.textureName,[18,19,20,21,22,23],48,48)),i.play("left"),i._direction=u.DirectionH.Left,i}return n.__extends(e,t),Object.defineProperty(e.prototype,"isDead",{get:function(){return this._isDead},set:function(t){t!=this._isDead&&(this._isDead=t,this._isDead&&this.onDeathCallBack&&this.onDeathCallBack())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onDeath",{get:function(){return this.onDeathCallBack},set:function(t){this.onDeathCallBack=t},enumerable:!0,configurable:!0}),e.prototype.squish=function(t){this.isDead=!0;var e=this._direction==u.DirectionH.Left?"lsquish":"rsquish";this.onComplete=t,this.play(e,12,!1),a.snd.mobSquish()},Object.defineProperty(e.prototype,"direction",{get:function(){return this._direction},set:function(t){this._direction!=t&&(this._direction=t,t===u.DirectionH.Left?this.play("left"):this.play("right"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attributes",{get:function(){return this._attributes},set:function(t){this._attributes=t},enumerable:!0,configurable:!0}),e.prototype.fireBullet=function(){this.atkTexture.constructor===Array||s.Bullet.emitBullet(this.atkTexture,this.position,o.wp2.playerBody.position,this._attributes[u.AtrType.Atk])},e.prototype.createAI=function(t){switch(t.toLowerCase()){case"basic_static":this._ai=new r.BasicStaticAI(this)}},e.prototype.onUpdate=function(e){t.prototype.onUpdate.call(this,e),this.isDead||this.isLoading||this._ai.onUpdate(e)},e}(c.AnimatedSprite);e.Mob=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(29),a=i(50),r=i(24),o=i(9),u=i(43),l=function(t){function e(e,i,n,s){var a=t.call(this,e)||this;return a.velocity=i,a.damage=s,a.direction=new o.PIXI.Point,a.interactionType=666,a.onUpdate=function(){if(!a.isDead){var t=performance.now()/1e3-a.startTime;a.IsDead=a.ttl<t}},a.ttl=n,a.IsDead=!1,a}return n.__extends(e,t),Object.defineProperty(e.prototype,"Direction",{get:function(){return this.direction},set:function(t){var e=t.x*t.x+t.y*t.y;e=1/Math.sqrt(e),this.direction.set(t.x*e,t.y*e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IsDead",{get:function(){return this.isDead},set:function(t){t!=this.isDead&&(this.isDead=t,this.isDead?this.body&&(this.body.velocity=[0,0]):(this.startTime=performance.now()/1e3,this.body&&(this.body.position=[this.position.x,this.position.y])),this.isDead&&this.onDeath&&this.onDeath(),this.visible=!this.isDead)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"OnDeath",{get:function(){return this.onDeath},set:function(t){this.onDeath=t},enumerable:!0,configurable:!0}),e.reset=function(){e.bullets=[]},e.bullets=[],e.emitBullet=function(t,i,n,l){var c=e.findDeadBullet();if(!c){(c=new e(u.TextureLoader.Get(t),200,5,l)).anchor.set(.5),c.scale.set(.5,-.5),e.bullets.push(c),o.Global.worldContainer.addChild(c);var h=new s.Circle({radius:c.width/2});h.collisionGroup=a.COL_GRP_BULLET,h.collisionMask=a.COL_GRP_PLAYER|a.COL_GRP_SCENE|a.COL_GRP_GROUND,h.sensor=!0;var p={mass:0,position:[i.x,i.y],angle:0,fixedRotation:!1,angularDamping:0,damping:0},d=new s.Body(p);d.addShape(h),d.setDensity(0),d.gravityScale=0,d.angularVelocity=2,d.collisionResponse=!1,d.type=s.Body.DYNAMIC,d.DisplayObject=c,c.body=d,r.wp2.addBody(d)}c.position=i;var f=n instanceof Float32Array?new o.PIXI.Point(n[0]-i.x,n[1]-i.y):new o.PIXI.Point(n.x-i.x,n.y-i.y);return c.Direction=f,c.damage=l,c.IsDead=!1,c.body.velocity[0]=c.Direction.x*c.velocity,c.body.velocity[1]=c.Direction.y*c.velocity,c},e.findDeadBullet=function(){for(var t=0,i=e.bullets.length;t<i;t++){var n=e.bullets[t];if(n.IsDead)return n}return null},e}(o.PIXI.Sprite);e.Bullet=l},,,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(9),s=i(104),a=["Permanent Marker","Orbitron"];console.log("initializing google webfont loader ...",a);try{var r={google:{families:a},active:function(){console.log("fonts preload finished!");var t=n.Global.getScm(),e=new s.BootScene(t);t.AddScene(e),t.ActivateScene(e)}};window.WebFontConfig=r}catch(t){console.log(t)}var o=("https:"===document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",u=document.createElement("script");u.src=o,u.type="text/javascript",u.async=!0;var l=document.getElementsByTagName("script")[0];l.parentNode&&l.parentNode.insertBefore(u,l)},,,,,,,,,,function(t,e,i){"use strict";i.r(e),i.d(e,"GetTextureFromString",(function(){return u})),i.d(e,"ParticleUtils",(function(){return s})),i.d(e,"Particle",(function(){return S})),i.d(e,"Emitter",(function(){return b})),i.d(e,"PathParticle",(function(){return E})),i.d(e,"AnimatedParticle",(function(){return L})),i.d(e,"PolygonalChain",(function(){return x})),i.d(e,"PropertyList",(function(){return h})),i.d(e,"PropertyNode",(function(){return r}));var n,s,a=i(7),r=function(){function t(t,e,i){this.value=t,this.time=e,this.next=null,this.isStepped=!1,this.ease=i?"function"==typeof i?i:s.generateEase(i):null}return t.createList=function(e){if("list"in e){var i=e.list,n=void 0,a=void 0,r=i[0],o=r.value,u=r.time;if(a=n=new t("string"==typeof o?s.hexToRGB(o):o,u,e.ease),i.length>2||2===i.length&&i[1].value!==o)for(var l=1;l<i.length;++l){var c=i[l],h=c.value,p=c.time;n.next=new t("string"==typeof h?s.hexToRGB(h):h,p),n=n.next}return a.isStepped=!!e.isStepped,a}var d=new t("string"==typeof e.start?s.hexToRGB(e.start):e.start,0);return e.end!==e.start&&(d.next=new t("string"==typeof e.end?s.hexToRGB(e.end):e.end,1)),d},t}(),o=a;
/*!
 * pixi-particles - v4.2.0
 * Compiled Sat, 26 Oct 2019 14:40:23 UTC
 *
 * pixi-particles is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */function u(t){return n(t)}n=parseInt(/^(\d+)\./.exec(a.VERSION)[1])<5?o.Texture.fromImage:o.Texture.from,function(t){t.verbose=!1,t.DEG_TO_RADS=Math.PI/180,t.rotatePoint=function(e,i){if(e){e*=t.DEG_TO_RADS;var n=Math.sin(e),s=Math.cos(e),a=i.x*s-i.y*n,r=i.x*n+i.y*s;i.x=a,i.y=r}},t.combineRGBComponents=function(t,e,i){return t<<16|e<<8|i},t.normalize=function(e){var i=1/t.length(e);e.x*=i,e.y*=i},t.scaleBy=function(t,e){t.x*=e,t.y*=e},t.length=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},t.hexToRGB=function(t,e){var i;return e||(e={}),"#"==t.charAt(0)?t=t.substr(1):0===t.indexOf("0x")&&(t=t.substr(2)),8==t.length&&(i=t.substr(0,2),t=t.substr(2)),e.r=parseInt(t.substr(0,2),16),e.g=parseInt(t.substr(2,2),16),e.b=parseInt(t.substr(4,2),16),i&&(e.a=parseInt(i,16)),e},t.generateEase=function(t){var e=t.length,i=1/e;return function(n){var s,a,r=e*n|0;return s=(n-r*i)*e,(a=t[r]||t[e-1]).s+s*(2*(1-s)*(a.cp-a.s)+s*(a.e-a.s))}},t.getBlendMode=function(t){if(!t)return a.BLEND_MODES.NORMAL;for(t=t.toUpperCase();t.indexOf(" ")>=0;)t=t.replace(" ","_");return a.BLEND_MODES[t]||a.BLEND_MODES.NORMAL},t.createSteppedGradient=function(e,i){void 0===i&&(i=10),("number"!=typeof i||i<=0)&&(i=10);var n=new r(t.hexToRGB(e[0].value),e[0].time);n.isStepped=!0;for(var s=n,a=e[0],o=1,u=e[o],l=1;l<i;++l){for(var c=l/i;c>u.time;)a=u,u=e[++o];c=(c-a.time)/(u.time-a.time);var h=t.hexToRGB(a.value),p=t.hexToRGB(u.value),d={r:(p.r-h.r)*c+h.r,g:(p.g-h.g)*c+h.g,b:(p.b-h.b)*c+h.b};s.next=new r(d,l/i),s=s.next}return n}}(s||(s={}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var l=function(t,e){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function c(t,e){function i(){this.constructor=t}l(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var h=function(){function t(t){void 0===t&&(t=!1),this.current=null,this.next=null,this.isColor=!!t,this.interpolate=null,this.ease=null}return t.prototype.reset=function(t){this.current=t,this.next=t.next,this.next&&this.next.time>=1?this.interpolate=this.isColor?d:p:t.isStepped?this.interpolate=this.isColor?v:y:this.interpolate=this.isColor?m:f,this.ease=this.current.ease},t}();function p(t){return this.ease&&(t=this.ease(t)),(this.next.value-this.current.value)*t+this.current.value}function d(t){this.ease&&(t=this.ease(t));var e=this.current.value,i=this.next.value,n=(i.r-e.r)*t+e.r,a=(i.g-e.g)*t+e.g,r=(i.b-e.b)*t+e.b;return s.combineRGBComponents(n,a,r)}function f(t){for(this.ease&&(t=this.ease(t));t>this.next.time;)this.current=this.next,this.next=this.next.next;return t=(t-this.current.time)/(this.next.time-this.current.time),(this.next.value-this.current.value)*t+this.current.value}function m(t){for(this.ease&&(t=this.ease(t));t>this.next.time;)this.current=this.next,this.next=this.next.next;t=(t-this.current.time)/(this.next.time-this.current.time);var e=this.current.value,i=this.next.value,n=(i.r-e.r)*t+e.r,a=(i.g-e.g)*t+e.g,r=(i.b-e.b)*t+e.b;return s.combineRGBComponents(n,a,r)}function y(t){for(this.ease&&(t=this.ease(t));this.next&&t>this.next.time;)this.current=this.next,this.next=this.next.next;return this.current.value}function v(t){for(this.ease&&(t=this.ease(t));this.next&&t>this.next.time;)this.current=this.next,this.next=this.next.next;var e=this.current.value;return s.combineRGBComponents(e.r,e.g,e.b)}var g,S=function(t){function e(i){var n=t.call(this)||this;return n.emitter=i,n.anchor.x=n.anchor.y=.5,n.velocity=new a.Point,n.rotationSpeed=0,n.rotationAcceleration=0,n.maxLife=0,n.age=0,n.ease=null,n.extraData=null,n.alphaList=new h,n.speedList=new h,n.speedMultiplier=1,n.acceleration=new a.Point,n.maxSpeed=NaN,n.scaleList=new h,n.scaleMultiplier=1,n.colorList=new h(!0),n._doAlpha=!1,n._doScale=!1,n._doSpeed=!1,n._doAcceleration=!1,n._doColor=!1,n._doNormalMovement=!1,n._oneOverLife=0,n.next=null,n.prev=null,n.init=n.init,n.Particle_init=e.prototype.init,n.update=n.update,n.Particle_update=e.prototype.update,n.Sprite_destroy=t.prototype.destroy,n.Particle_destroy=e.prototype.destroy,n.applyArt=n.applyArt,n.kill=n.kill,n}return c(e,t),e.prototype.init=function(){this.age=0,this.velocity.x=this.speedList.current.value*this.speedMultiplier,this.velocity.y=0,s.rotatePoint(this.rotation,this.velocity),this.noRotation?this.rotation=0:this.rotation*=s.DEG_TO_RADS,this.rotationSpeed*=s.DEG_TO_RADS,this.rotationAcceleration*=s.DEG_TO_RADS,this.alpha=this.alphaList.current.value,this.scale.x=this.scale.y=this.scaleList.current.value,this._doAlpha=!!this.alphaList.current.next,this._doSpeed=!!this.speedList.current.next,this._doScale=!!this.scaleList.current.next,this._doColor=!!this.colorList.current.next,this._doAcceleration=0!==this.acceleration.x||0!==this.acceleration.y,this._doNormalMovement=this._doSpeed||0!==this.speedList.current.value||this._doAcceleration,this._oneOverLife=1/this.maxLife;var t=this.colorList.current.value;this.tint=s.combineRGBComponents(t.r,t.g,t.b),this.visible=!0},e.prototype.applyArt=function(t){this.texture=t||a.Texture.EMPTY},e.prototype.update=function(t){if(this.age+=t,this.age>=this.maxLife||this.age<0)return this.kill(),-1;var e=this.age*this._oneOverLife;if(this.ease&&(e=4==this.ease.length?this.ease(e,0,1,1):this.ease(e)),this._doAlpha&&(this.alpha=this.alphaList.interpolate(e)),this._doScale){var i=this.scaleList.interpolate(e)*this.scaleMultiplier;this.scale.x=this.scale.y=i}if(this._doNormalMovement){var n=void 0,a=void 0;if(this._doSpeed){var r=this.speedList.interpolate(e)*this.speedMultiplier;s.normalize(this.velocity),s.scaleBy(this.velocity,r),n=this.velocity.x*t,a=this.velocity.y*t}else if(this._doAcceleration){var o=this.velocity.x,u=this.velocity.y;if(this.velocity.x+=this.acceleration.x*t,this.velocity.y+=this.acceleration.y*t,this.maxSpeed){var l=s.length(this.velocity);l>this.maxSpeed&&s.scaleBy(this.velocity,this.maxSpeed/l)}n=(o+this.velocity.x)/2*t,a=(u+this.velocity.y)/2*t}else n=this.velocity.x*t,a=this.velocity.y*t;this.position.x+=n,this.position.y+=a}if(this._doColor&&(this.tint=this.colorList.interpolate(e)),0!==this.rotationAcceleration){var c=this.rotationSpeed+this.rotationAcceleration*t;this.rotation+=(this.rotationSpeed+c)/2*t,this.rotationSpeed=c}else 0!==this.rotationSpeed?this.rotation+=this.rotationSpeed*t:this.acceleration&&!this.noRotation&&(this.rotation=Math.atan2(this.velocity.y,this.velocity.x));return e},e.prototype.kill=function(){this.emitter.recycle(this)},e.prototype.destroy=function(){this.parent&&this.parent.removeChild(this),this.Sprite_destroy(),this.emitter=this.velocity=this.colorList=this.scaleList=this.alphaList=this.speedList=this.ease=this.next=this.prev=null},e.parseArt=function(t){var e;for(e=t.length;e>=0;--e)"string"==typeof t[e]&&(t[e]=u(t[e]));if(s.verbose)for(e=t.length-1;e>0;--e)if(t[e].baseTexture!=t[e-1].baseTexture){window.console&&console.warn("PixiParticles: using particle textures from different images may hinder performance in WebGL");break}return t},e.parseData=function(t){return t},e}(a.Sprite),x=function(){function t(t){this.segments=[],this.countingLengths=[],this.totalLength=0,this.init(t)}return t.prototype.init=function(t){if(t&&t.length)if(Array.isArray(t[0]))for(var e=0;e<t.length;++e)for(var i=t[e],n=i[0],s=1;s<i.length;++s){var a=i[s];this.segments.push({p1:n,p2:a,l:0}),n=a}else for(n=t[0],e=1;e<t.length;++e){a=t[e];this.segments.push({p1:n,p2:a,l:0}),n=a}else this.segments.push({p1:{x:0,y:0},p2:{x:0,y:0},l:0});for(e=0;e<this.segments.length;++e){var r=this.segments[e],o=r.p1,u=r.p2,l=Math.sqrt((u.x-o.x)*(u.x-o.x)+(u.y-o.y)*(u.y-o.y));this.segments[e].l=l,this.totalLength+=l,this.countingLengths.push(this.totalLength)}},t.prototype.getRandomPoint=function(t){var e,i,n=Math.random()*this.totalLength;if(1===this.segments.length)e=this.segments[0],i=n;else for(var s=0;s<this.countingLengths.length;++s)if(n<this.countingLengths[s]){e=this.segments[s],i=0===s?n:n-this.countingLengths[s-1];break}i/=e.l||1;var a=e.p1,r=e.p2;t.x=a.x+i*(r.x-a.x),t.y=a.y+i*(r.y-a.y)},t}(),w=a;g=parseInt(/^(\d+)\./.exec(a.VERSION)[1])<5?w.ticker.shared:w.Ticker.shared;var _=new a.Point,b=function(){function t(t,e,i){this._currentImageIndex=-1,this._particleConstructor=S,this.particleImages=null,this.startAlpha=null,this.startSpeed=null,this.minimumSpeedMultiplier=1,this.acceleration=null,this.maxSpeed=NaN,this.startScale=null,this.minimumScaleMultiplier=1,this.startColor=null,this.minLifetime=0,this.maxLifetime=0,this.minStartRotation=0,this.maxStartRotation=0,this.noRotation=!1,this.minRotationSpeed=0,this.maxRotationSpeed=0,this.particleBlendMode=0,this.customEase=null,this.extraData=null,this._frequency=1,this.spawnChance=1,this.maxParticles=1e3,this.emitterLifetime=-1,this.spawnPos=null,this.spawnType=null,this._spawnFunc=null,this.spawnRect=null,this.spawnCircle=null,this.spawnPolygonalChain=null,this.particlesPerWave=1,this.particleSpacing=0,this.angleStart=0,this.rotation=0,this.ownerPos=null,this._prevEmitterPos=null,this._prevPosIsValid=!1,this._posChanged=!1,this._parent=null,this.addAtBack=!1,this.particleCount=0,this._emit=!1,this._spawnTimer=0,this._emitterLife=-1,this._activeParticlesFirst=null,this._activeParticlesLast=null,this._poolFirst=null,this._origConfig=null,this._origArt=null,this._autoUpdate=!1,this._currentImageIndex=-1,this._destroyWhenComplete=!1,this._completeCallback=null,this.parent=t,e&&i&&this.init(e,i),this.recycle=this.recycle,this.update=this.update,this.rotate=this.rotate,this.updateSpawnPos=this.updateSpawnPos,this.updateOwnerPos=this.updateOwnerPos}return Object.defineProperty(t.prototype,"orderedArt",{get:function(){return-1!==this._currentImageIndex},set:function(t){this._currentImageIndex=t?0:-1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frequency",{get:function(){return this._frequency},set:function(t){this._frequency="number"==typeof t&&t>0?t:1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"particleConstructor",{get:function(){return this._particleConstructor},set:function(t){if(t!=this._particleConstructor){this._particleConstructor=t,this.cleanup();for(var e=this._poolFirst;e;e=e.next)e.destroy();this._poolFirst=null,this._origConfig&&this._origArt&&this.init(this._origArt,this._origConfig)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},set:function(t){this.cleanup(),this._parent=t},enumerable:!0,configurable:!0}),t.prototype.init=function(t,e){if(t&&e){this.cleanup(),this._origConfig=e,this._origArt=t,t=Array.isArray(t)?t.slice():[t];var i=this._particleConstructor;this.particleImages=i.parseArt?i.parseArt(t):t,e.alpha?this.startAlpha=r.createList(e.alpha):this.startAlpha=new r(1,0),e.speed?(this.startSpeed=r.createList(e.speed),this.minimumSpeedMultiplier=("minimumSpeedMultiplier"in e?e.minimumSpeedMultiplier:e.speed.minimumSpeedMultiplier)||1):(this.minimumSpeedMultiplier=1,this.startSpeed=new r(0,0));var n=e.acceleration;n&&(n.x||n.y)?(this.startSpeed.next=null,this.acceleration=new a.Point(n.x,n.y),this.maxSpeed=e.maxSpeed||NaN):this.acceleration=new a.Point,e.scale?(this.startScale=r.createList(e.scale),this.minimumScaleMultiplier=("minimumScaleMultiplier"in e?e.minimumScaleMultiplier:e.scale.minimumScaleMultiplier)||1):(this.startScale=new r(1,0),this.minimumScaleMultiplier=1),e.color?this.startColor=r.createList(e.color):this.startColor=new r({r:255,g:255,b:255},0),e.startRotation?(this.minStartRotation=e.startRotation.min,this.maxStartRotation=e.startRotation.max):this.minStartRotation=this.maxStartRotation=0,e.noRotation&&(this.minStartRotation||this.maxStartRotation)?this.noRotation=!!e.noRotation:this.noRotation=!1,e.rotationSpeed?(this.minRotationSpeed=e.rotationSpeed.min,this.maxRotationSpeed=e.rotationSpeed.max):this.minRotationSpeed=this.maxRotationSpeed=0,this.rotationAcceleration=e.rotationAcceleration||0,this.minLifetime=e.lifetime.min,this.maxLifetime=e.lifetime.max,this.particleBlendMode=s.getBlendMode(e.blendMode),e.ease?this.customEase="function"==typeof e.ease?e.ease:s.generateEase(e.ease):this.customEase=null,i.parseData?this.extraData=i.parseData(e.extraData):this.extraData=e.extraData||null,this.spawnRect=this.spawnCircle=null,this.particlesPerWave=1,e.particlesPerWave&&e.particlesPerWave>1&&(this.particlesPerWave=e.particlesPerWave),this.particleSpacing=0,this.angleStart=0,this.parseSpawnType(e),this.frequency=e.frequency,this.spawnChance="number"==typeof e.spawnChance&&e.spawnChance>0?e.spawnChance:1,this.emitterLifetime=e.emitterLifetime||-1,this.maxParticles=e.maxParticles>0?e.maxParticles:1e3,this.addAtBack=!!e.addAtBack,this.rotation=0,this.ownerPos=new a.Point,this.spawnPos=new a.Point(e.pos.x,e.pos.y),this.initAdditional(t,e),this._prevEmitterPos=this.spawnPos.clone(),this._prevPosIsValid=!1,this._spawnTimer=0,this.emit=void 0===e.emit||!!e.emit,this.autoUpdate=!!e.autoUpdate,this.orderedArt=!!e.orderedArt}},t.prototype.initAdditional=function(t,e){},t.prototype.parseSpawnType=function(t){var e;switch(t.spawnType){case"rect":this.spawnType="rect",this._spawnFunc=this._spawnRect;var i=t.spawnRect;this.spawnRect=new a.Rectangle(i.x,i.y,i.w,i.h);break;case"circle":this.spawnType="circle",this._spawnFunc=this._spawnCircle,e=t.spawnCircle,this.spawnCircle=new a.Circle(e.x,e.y,e.r);break;case"ring":this.spawnType="ring",this._spawnFunc=this._spawnRing,e=t.spawnCircle,this.spawnCircle=new a.Circle(e.x,e.y,e.r),this.spawnCircle.minRadius=e.minR;break;case"burst":this.spawnType="burst",this._spawnFunc=this._spawnBurst,this.particleSpacing=t.particleSpacing,this.angleStart=t.angleStart?t.angleStart:0;break;case"point":this.spawnType="point",this._spawnFunc=this._spawnPoint;break;case"polygonalChain":this.spawnType="polygonalChain",this._spawnFunc=this._spawnPolygonalChain,this.spawnPolygonalChain=new x(t.spawnPolygon);break;default:this.spawnType="point",this._spawnFunc=this._spawnPoint}},t.prototype.recycle=function(t){t.next&&(t.next.prev=t.prev),t.prev&&(t.prev.next=t.next),t==this._activeParticlesLast&&(this._activeParticlesLast=t.prev),t==this._activeParticlesFirst&&(this._activeParticlesFirst=t.next),t.prev=null,t.next=this._poolFirst,this._poolFirst=t,t.parent&&t.parent.removeChild(t),--this.particleCount},t.prototype.rotate=function(t){if(this.rotation!=t){var e=t-this.rotation;this.rotation=t,s.rotatePoint(e,this.spawnPos),this._posChanged=!0}},t.prototype.updateSpawnPos=function(t,e){this._posChanged=!0,this.spawnPos.x=t,this.spawnPos.y=e},t.prototype.updateOwnerPos=function(t,e){this._posChanged=!0,this.ownerPos.x=t,this.ownerPos.y=e},t.prototype.resetPositionTracking=function(){this._prevPosIsValid=!1},Object.defineProperty(t.prototype,"emit",{get:function(){return this._emit},set:function(t){this._emit=!!t,this._emitterLife=this.emitterLifetime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){this._autoUpdate&&!t?g.remove(this.update,this):!this._autoUpdate&&t&&g.add(this.update,this),this._autoUpdate=!!t},enumerable:!0,configurable:!0}),t.prototype.playOnceAndDestroy=function(t){this.autoUpdate=!0,this.emit=!0,this._destroyWhenComplete=!0,this._completeCallback=t},t.prototype.playOnce=function(t){this.emit=!0,this._completeCallback=t},t.prototype.update=function(t){if(this._autoUpdate&&(t=t/a.settings.TARGET_FPMS/1e3),this._parent){var e,i,n,s,r;for(i=this._activeParticlesFirst;i;i=n)n=i.next,i.update(t);this._prevPosIsValid&&(s=this._prevEmitterPos.x,r=this._prevEmitterPos.y);var o=this.ownerPos.x+this.spawnPos.x,u=this.ownerPos.y+this.spawnPos.y;if(this._emit)for(this._spawnTimer-=t<0?0:t;this._spawnTimer<=0;){if(this._emitterLife>0&&(this._emitterLife-=this._frequency,this._emitterLife<=0)){this._spawnTimer=0,this._emitterLife=0,this.emit=!1;break}if(this.particleCount>=this.maxParticles)this._spawnTimer+=this._frequency;else{var l=void 0;if(l=this.minLifetime==this.maxLifetime?this.minLifetime:Math.random()*(this.maxLifetime-this.minLifetime)+this.minLifetime,-this._spawnTimer<l){var c=void 0,h=void 0;if(this._prevPosIsValid&&this._posChanged){var p=1+this._spawnTimer/t;c=(o-s)*p+s,h=(u-r)*p+r}else c=o,h=u;e=0;for(var d=Math.min(this.particlesPerWave,this.maxParticles-this.particleCount);e<d;++e)if(!(this.spawnChance<1&&Math.random()>=this.spawnChance)){var f=void 0;if(this._poolFirst?(f=this._poolFirst,this._poolFirst=this._poolFirst.next,f.next=null):f=new this.particleConstructor(this),this.particleImages.length>1?-1!==this._currentImageIndex?(f.applyArt(this.particleImages[this._currentImageIndex++]),(this._currentImageIndex<0||this._currentImageIndex>=this.particleImages.length)&&(this._currentImageIndex=0)):f.applyArt(this.particleImages[Math.floor(Math.random()*this.particleImages.length)]):f.applyArt(this.particleImages[0]),f.alphaList.reset(this.startAlpha),1!=this.minimumSpeedMultiplier&&(f.speedMultiplier=Math.random()*(1-this.minimumSpeedMultiplier)+this.minimumSpeedMultiplier),f.speedList.reset(this.startSpeed),f.acceleration.x=this.acceleration.x,f.acceleration.y=this.acceleration.y,f.maxSpeed=this.maxSpeed,1!=this.minimumScaleMultiplier&&(f.scaleMultiplier=Math.random()*(1-this.minimumScaleMultiplier)+this.minimumScaleMultiplier),f.scaleList.reset(this.startScale),f.colorList.reset(this.startColor),this.minRotationSpeed==this.maxRotationSpeed?f.rotationSpeed=this.minRotationSpeed:f.rotationSpeed=Math.random()*(this.maxRotationSpeed-this.minRotationSpeed)+this.minRotationSpeed,f.rotationAcceleration=this.rotationAcceleration,f.noRotation=this.noRotation,f.maxLife=l,f.blendMode=this.particleBlendMode,f.ease=this.customEase,f.extraData=this.extraData,this.applyAdditionalProperties(f),this._spawnFunc(f,c,h,e),f.init(),f.update(-this._spawnTimer),f.parent){var m=this._parent.children;if(m[0]==f)m.shift();else if(m[m.length-1]==f)m.pop();else{var y=m.indexOf(f);m.splice(y,1)}this.addAtBack?m.unshift(f):m.push(f)}else this.addAtBack?this._parent.addChildAt(f,0):this._parent.addChild(f);this._activeParticlesLast?(this._activeParticlesLast.next=f,f.prev=this._activeParticlesLast,this._activeParticlesLast=f):this._activeParticlesLast=this._activeParticlesFirst=f,++this.particleCount}}this._spawnTimer+=this._frequency}}if(this._posChanged&&(this._prevEmitterPos.x=o,this._prevEmitterPos.y=u,this._prevPosIsValid=!0,this._posChanged=!1),!this._emit&&!this._activeParticlesFirst){if(this._completeCallback){var v=this._completeCallback;this._completeCallback=null,v()}this._destroyWhenComplete&&this.destroy()}}},t.prototype.applyAdditionalProperties=function(t){},t.prototype._spawnPoint=function(t,e,i){this.minStartRotation==this.maxStartRotation?t.rotation=this.minStartRotation+this.rotation:t.rotation=Math.random()*(this.maxStartRotation-this.minStartRotation)+this.minStartRotation+this.rotation,t.position.x=e,t.position.y=i},t.prototype._spawnRect=function(t,e,i){this.minStartRotation==this.maxStartRotation?t.rotation=this.minStartRotation+this.rotation:t.rotation=Math.random()*(this.maxStartRotation-this.minStartRotation)+this.minStartRotation+this.rotation,_.x=Math.random()*this.spawnRect.width+this.spawnRect.x,_.y=Math.random()*this.spawnRect.height+this.spawnRect.y,0!==this.rotation&&s.rotatePoint(this.rotation,_),t.position.x=e+_.x,t.position.y=i+_.y},t.prototype._spawnCircle=function(t,e,i){this.minStartRotation==this.maxStartRotation?t.rotation=this.minStartRotation+this.rotation:t.rotation=Math.random()*(this.maxStartRotation-this.minStartRotation)+this.minStartRotation+this.rotation,_.x=Math.random()*this.spawnCircle.radius,_.y=0,s.rotatePoint(360*Math.random(),_),_.x+=this.spawnCircle.x,_.y+=this.spawnCircle.y,0!==this.rotation&&s.rotatePoint(this.rotation,_),t.position.x=e+_.x,t.position.y=i+_.y},t.prototype._spawnRing=function(t,e,i){var n=this.spawnCircle;this.minStartRotation==this.maxStartRotation?t.rotation=this.minStartRotation+this.rotation:t.rotation=Math.random()*(this.maxStartRotation-this.minStartRotation)+this.minStartRotation+this.rotation,n.minRadius!==n.radius?_.x=Math.random()*(n.radius-n.minRadius)+n.minRadius:_.x=n.radius,_.y=0;var a=360*Math.random();t.rotation+=a,s.rotatePoint(a,_),_.x+=this.spawnCircle.x,_.y+=this.spawnCircle.y,0!==this.rotation&&s.rotatePoint(this.rotation,_),t.position.x=e+_.x,t.position.y=i+_.y},t.prototype._spawnPolygonalChain=function(t,e,i){this.minStartRotation==this.maxStartRotation?t.rotation=this.minStartRotation+this.rotation:t.rotation=Math.random()*(this.maxStartRotation-this.minStartRotation)+this.minStartRotation+this.rotation,this.spawnPolygonalChain.getRandomPoint(_),0!==this.rotation&&s.rotatePoint(this.rotation,_),t.position.x=e+_.x,t.position.y=i+_.y},t.prototype._spawnBurst=function(t,e,i,n){0===this.particleSpacing?t.rotation=360*Math.random():t.rotation=this.angleStart+this.particleSpacing*n+this.rotation,t.position.x=e,t.position.y=i},t.prototype.cleanup=function(){var t,e;for(t=this._activeParticlesFirst;t;t=e)e=t.next,this.recycle(t),t.parent&&t.parent.removeChild(t);this._activeParticlesFirst=this._activeParticlesLast=null,this.particleCount=0},t.prototype.destroy=function(){var t;this.autoUpdate=!1,this.cleanup();for(var e=this._poolFirst;e;e=t)t=e.next,e.destroy();this._poolFirst=this._parent=this.particleImages=this.spawnPos=this.ownerPos=this.startColor=this.startScale=this.startAlpha=this.startSpeed=this.customEase=this._completeCallback=null},t}(),T=new a.Point,P=["pow","sqrt","abs","floor","round","ceil","E","PI","sin","cos","tan","asin","acos","atan","atan2","log"],C=new RegExp(["[01234567890\\.\\*\\-\\+\\/\\(\\)x ,]"].concat(P).join("|"),"g"),E=function(t){function e(e){var i=t.call(this,e)||this;return i.path=null,i.initialRotation=0,i.initialPosition=new a.Point,i.movement=0,i}return c(e,t),e.prototype.init=function(){this.initialRotation=this.rotation,this.Particle_init(),this.path=this.extraData.path,this._doNormalMovement=!this.path,this.movement=0,this.initialPosition.x=this.position.x,this.initialPosition.y=this.position.y},e.prototype.update=function(t){var e=this.Particle_update(t);if(e>=0&&this.path){var i=this.speedList.interpolate(e)*this.speedMultiplier;this.movement+=i*t,T.x=this.movement,T.y=this.path(this.movement),s.rotatePoint(this.initialRotation,T),this.position.x=this.initialPosition.x+T.x,this.position.y=this.initialPosition.y+T.y}return e},e.prototype.destroy=function(){this.Particle_destroy(),this.path=this.initialPosition=null},e.parseArt=function(t){return S.parseArt(t)},e.parseData=function(t){var e={};if(t&&t.path)try{e.path=function(t){for(var e=t.match(C),i=e.length-1;i>=0;--i)P.indexOf(e[i])>=0&&(e[i]="Math."+e[i]);return t=e.join(""),new Function("x","return "+t+";")}(t.path)}catch(t){s.verbose&&console.error("PathParticle: error in parsing path expression"),e.path=null}else s.verbose&&console.error("PathParticle requires a path string in extraData!"),e.path=null;return e},e}(S),L=function(t){function e(e){var i=t.call(this,e)||this;return i.textures=null,i.duration=0,i.framerate=0,i.elapsed=0,i.loop=!1,i}return c(e,t),e.prototype.init=function(){this.Particle_init(),this.elapsed=0,this.framerate<0&&(this.duration=this.maxLife,this.framerate=this.textures.length/this.duration)},e.prototype.applyArt=function(t){this.textures=t.textures,this.framerate=t.framerate,this.duration=t.duration,this.loop=t.loop},e.prototype.update=function(t){var e=this.Particle_update(t);if(e>=0){this.elapsed+=t,this.elapsed>this.duration&&(this.loop?this.elapsed=this.elapsed%this.duration:this.elapsed=this.duration-1e-6);var i=this.elapsed*this.framerate+1e-7|0;this.texture=this.textures[i]||a.Texture.EMPTY}return e},e.prototype.destroy=function(){this.Particle_destroy(),this.textures=null},e.parseArt=function(t){for(var e,i,n,s,r,o=[],l=0;l<t.length;++l){e=t[l],o[l]=i={},i.textures=r=[],n=e.textures;for(var c=0;c<n.length;++c)if("string"==typeof(s=n[c]))r.push(u(s));else if(s instanceof a.Texture)r.push(s);else{var h=s.count||1;for(s="string"==typeof s.texture?u(s.texture):s.texture;h>0;--h)r.push(s)}"matchLife"==e.framerate?(i.framerate=-1,i.duration=0,i.loop=!1):(i.loop=!!e.loop,i.framerate=e.framerate>0?e.framerate:60,i.duration=r.length/i.framerate)}return o},e}(S)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(9),a=function(t){function e(e,i,n,s,a){void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=128),void 0===a&&(a=32);var r=t.call(this)||this;return r.isHighlightedValue=!1,r.isPressedValue=!1,r.isDisabledValue=!1,r.isClickStartedValue=!1,r.requestedWidth=0,r.requestedHeight=0,r.onButtonDown=function(){r.isDisabledValue||(r.isClickStartedValue=!0,r.texture=r.textureDown)},r.onButtonUp=function(t){r.isDisabledValue||(r.isClickStartedValue&&(r.isClickStartedValue=!1,r.onClickHandler(t)),r.applyTexture())},r.onButtonUpOutside=function(){r.isDisabledValue||(r.applyTexture(),r.isClickStartedValue=!1)},r.onButtonOver=function(t){r.isDisabledValue||(r.texture=r.textureHighlight,r.mouseover&&r.mouseover(t))},r.onButtonOut=function(t){r.isDisabledValue||(r.isClickStartedValue=!1,r.applyTexture(),r.mouseout&&r.mouseout(t))},r.position.set(i||0,n||0),r.requestedHeight=a,r.requestedWidth=s,r.setTexture(e),r.buttonMode=!1,r.interactive=!0,r.cursor="hover",r.on("pointerdown",r.onButtonDown),r.on("pointerup",r.onButtonUp),r.on("pointerupoutside",r.onButtonUpOutside),r.on("pointerover",r.onButtonOver),r.on("pointerout",r.onButtonOut),r.isPressed=!1,r}return n.__extends(e,t),Object.defineProperty(e.prototype,"disabled",{get:function(){return this.isDisabledValue},set:function(t){this.isDisabledValue=t,this.cursor=t?"":"hover",this.applyTexture()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPressed",{get:function(){return this.isPressedValue},set:function(t){this.isPressedValue=t,this.applyTexture()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isHighlighted",{get:function(){return this.isHighlightedValue},set:function(t){this.isHighlightedValue=t,this.applyTexture()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this.textValue},set:function(t){if(this.textValue&&this.removeChild(this.textValue),this.textValue=t,this.textValue){this.textValue.anchor.set(.5,.5);var e=this.width/this.scale.x/2,i=this.height/this.scale.y/2;this.textValue.position.set(e,i),this.addChild(this.textValue)}},enumerable:!0,configurable:!0}),e.prototype.performClick=function(t){this.onClickHandler(t)},e.prototype.setTexture=function(t){var e=s.TextureLoader.Get(t,!0,s.PIXI.SCALE_MODES.NEAREST);e.baseTexture.scaleMode=s.PIXI.SCALE_MODES.NEAREST;var i=e.height/3,n=e.width;this.textureUp=new s.PIXI.Texture(e.baseTexture,new s.PIXI.Rectangle(e.frame.x,e.frame.y,n,i)),this.textureHighlight=new s.PIXI.Texture(e.baseTexture,new s.PIXI.Rectangle(e.frame.x,e.frame.y+1*i,n,i)),this.textureDown=new s.PIXI.Texture(e.baseTexture,new s.PIXI.Rectangle(e.frame.x,e.frame.y+2*i,n,i));var a=(this.requestedWidth||n)/n,r=(this.requestedHeight||i)/i;this.scale.set(a,r),this.applyTexture()},e.prototype.onClickHandler=function(t){this.onClick?this.onClick(t):console.warn("onClick() empty, did you forget to attach a handler?")},e.prototype.applyTexture=function(){this.isDisabledValue?(this.texture=this.textureUp,this.tint=6316128):this.isHighlightedValue?(this.texture=this.textureHighlight,this.tint=6710886):(this.texture=this.isPressedValue?this.textureDown:this.textureUp,this.tint=16777215)},e}(s.PIXI.Sprite);e.SpriteButton=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(9),a=function(t){function e(e,i,n,a){var r=t.call(this)||this;return r.textureScale=a,r.spriteBuffer=[],r.spriteOrderList=[],r.totalWidth=0,r.recalculatePosition=function(t){var e=r.spriteOrderList[0],i=r.spriteBuffer[e],n=r.spriteOrderList[r.spriteOrderList.length-1],s=r.spriteBuffer[n],a=(r.worldPosition-t)*r.parallaxFactor;r.updatePositions(a),t>r.worldPosition?i.x+i.width<0&&(r.spriteOrderList.push(r.spriteOrderList.shift()),i.x=s.x+s.width):s.x>r.viewPortSize.x&&(r.spriteOrderList.unshift(r.spriteOrderList.pop()),s.x=i.x-s.width),r.worldPosition=t},r.viewPortSize=e||new s.PIXI.Point(100,100),r.parallaxFactor=i||1,r.textureScale=r.textureScale||1,r.setTextures(n),r.worldPosition=0,r.SetViewPortX(1),r}return n.__extends(e,t),Object.defineProperty(e.prototype,"WorldPosition",{get:function(){return this.worldPosition},enumerable:!0,configurable:!0}),e.prototype.SetViewPortX=function(t){this.worldPosition!==t&&this.recalculatePosition(t)},Object.defineProperty(e.prototype,"ViewPortSize",{get:function(){return this.viewPortSize},set:function(t){this.viewPortSize=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ParallaxFactor",{get:function(){return this.parallaxFactor},set:function(t){this.parallaxFactor=t},enumerable:!0,configurable:!0}),e.prototype.setTextures=function(t){for(var e,i=0,n=this.getTexture(t,0),a=n.width*this.textureScale;this.spriteBuffer.length<3||this.spriteBuffer.length<t.length||this.totalWidth<=this.viewPortSize.x+a;){e=i%t.length,(n=this.getTexture(t,e)).rotate=8;var r=new s.PIXI.Sprite(n);r.x=this.totalWidth,r.scale.set(this.textureScale,this.textureScale),r.anchor.set(0,0),this.spriteBuffer.push(r),this.spriteOrderList.push(this.spriteBuffer.length-1),this.addChild(r),this.totalWidth+=r.width,i++}},e.prototype.getTexture=function(t,e){return"string"==typeof t[e]?s.TextureLoader.Get(t[e]):t[e]},e.prototype.updatePositions=function(t){for(var e=0,i=this.spriteBuffer;e<i.length;e++){i[e].position.x+=t}},e}(s.PIXI.Container);e.Parallax=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,s=function(){function t(){var t=this;this.ALT_KEY=18,this.SHIFT_KEY=16,this.CTRL_KEY=17,this.addKeyboardActionHandler=function(e,i){t.stateActions[i]||(t.stateActions[i]=[]),t.stateActions[i].push(e)},this.stateActions={},this.keyboard=[];for(var e=0;e<256;e++)this.keyboard[e]=!1;document.addEventListener("keydown",this.keydown.bind(this),!1),document.addEventListener("keyup",this.keyup.bind(this),!1)}return t.prototype.update=function(t){var e=this.stateActions[t];this.findHandlerAndInvoke(e),e=this.stateActions[n.GLOBAL],this.findHandlerAndInvoke(e)},t.prototype.isKeyDown=function(t){return this.keyboard[t]},t.prototype.findHandlerAndInvoke=function(t){if(t)for(var e=t.length,i=0;i<e;i++){var n=t[i];n&&n.isAssigned()&&n.handler&&this.keyboard[n.key]&&this.keyboard[this.ALT_KEY]===n.altKey&&this.keyboard[this.SHIFT_KEY]===n.shiftKey&&this.keyboard[this.CTRL_KEY]===n.ctrlKey&&(n.handler(),n.releaseKeyAfterInvoke&&(this.keyboard[n.key]=!1))}},t.prototype.keydown=function(t){this.keyboard[t.which]=!0},t.prototype.keyup=function(t){this.keyboard[t.which]=!1},t}();e.KeyboardMapper=s,function(t){t[t.GLOBAL=0]="GLOBAL",t[t.MENU=1]="MENU",t[t.IN_GAME=2]="IN_GAME",t[t.CUSTOM1=3]="CUSTOM1",t[t.CUSTOM2=4]="CUSTOM2",t[t.CUSTOM3=5]="CUSTOM3",t[t.CUSTOM4=6]="CUSTOM4",t[t.CUSTOM5=7]="CUSTOM5"}(n=e.State||(e.State={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(9),a=i(105),r=["assets/cur_default.png","assets/cur_hover.png","assets/cur_target.png","assets/levels.json","assets/quests.json"],o=function(t){function e(e){var i=t.call(this,"Boot")||this;return i.sceneManager=e,i.onUpdate=function(t){i.spinner&&(i.spinner.rotation+=.05)},i.onActivate=function(){i.loadingMessage=new s.PIXI.Text("booting ...",{fontSize:"36px",fontFamily:"Permanent Marker",fill:65280,dropShadow:!0,stroke:4521796,strokeThickness:1}),i.loadingMessage.anchor.set(.5,.5),i.loadingMessage.position.set(s.SCENE_HALF_WIDTH,s.SCENE_HALF_HEIGHT-80),i.addChild(i.loadingMessage),s.PIXI.Loader.shared.reset().add("assets/loading.png").load(i.startPreloading)},i.startPreloading=function(){return n.__awaiter(i,void 0,void 0,(function(){var t;return n.__generator(this,(function(e){return t=s.PIXI.Texture.from("assets/loading.png"),this.spinner=new s.PIXI.Sprite(t),this.spinner.position.set(s.SCENE_HALF_WIDTH,s.SCENE_HALF_HEIGHT),this.spinner.anchor.set(.5,.5),this.spinner.scale.set(.5),this.addChild(this.spinner),console.log("initializing common assets preloading ...",r),s.PIXI.Loader.shared.add(r).load(this.onPreloadFinished),[2]}))}))},i.onPreloadFinished=function(){return n.__awaiter(i,void 0,void 0,(function(){var t,e,i;return n.__generator(this,(function(n){return t="url('assets/cur_default.png'),auto","url('assets/cur_hover.png'),auto","url('assets/cur_target.png') 24 24, auto",this.sceneManager.Renderer.plugins.interaction.cursorStyles.default=t,this.sceneManager.Renderer.plugins.interaction.cursorStyles.hover="url('assets/cur_hover.png'),auto",this.sceneManager.Renderer.plugins.interaction.cursorStyles.target="url('assets/cur_target.png') 24 24, auto",document.body.style.cursor=t,s.Global.LevelDefinitions=s.PIXI.Loader.shared.resources["assets/levels.json"].data,e=s.PIXI.Loader.shared.resources["assets/quests.json"].data,s.Global.LevelDefinitions.quests=e.quests,s.Global.LevelDefinitions.quests.forEach((function(t){t.itemId=t.itemId||0,t.itemsNeeded=t.itemsNeeded||0,t.itemsCollected=0,t.rewardCoins=t.rewardCoins||0,t.rewardExp=t.rewardExp||0})),i=new a.LoaderScene(this.sceneManager),this.sceneManager.AddScene(i),this.sceneManager.ActivateScene(i),[2]}))}))},i.BackGroundColor=0,i}return n.__extends(e,t),e}(s.Scene);e.BootScene=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(9),a=i(57),r=i(21),o=i(16),u=i(121),l=i(122),c=i(131),h=i(132),p=function(t){function e(e){var i=t.call(this,"Loader")||this;i.sceneManager=e,i.preloadAssets=["assets/gui-atlas.json","assets/objects-atlas.json","assets/entities-atlas.json","assets/background-atlas.json"],i.onUpdate=function(t){i.spinner&&(i.spinner.rotation+=.05)},i.onActivate=function(){console.log("downloading level "+r.stats.currentGameLevel+"...");var t=a.GetLevelAssets(s.Global.LevelDefinitions,r.stats.currentGameLevel);t=t.concat(i.preloadAssets,"assets/font/orbitron.fnt","assets/font/orbitron_outline.fnt","assets/font/bauhaus.fnt"),t=a.getUniqueItems(t),s.PIXI.Loader.shared.reset().add(t).load(i.handleLevelLoading).on("progress",i.onProgress)},i.handleLevelLoading=function(){i.sceneManager.HasScene("Main")||(console.log("adding scenes..."),i.sceneManager.AddScene(new l.MainScene(i.sceneManager)),i.sceneManager.AddScene(new c.OptionsScene(i.sceneManager)),i.sceneManager.AddScene(new h.CutScene(i.sceneManager)),i.sceneManager.MasterHudOverlay=new u.MasterHud(i.sceneManager));try{var t=i.sceneManager.GetScene("Main");setTimeout((function(){t.startLevel()}),200)}catch(t){console.log("exception: ",t)}},i.onProgress=function(t,e){var n=t.progress;console.log("progress: "+n.toFixed(0)+"%, asset: "+e.name),i.loadingMessage.text="Loading "+n.toFixed(0)+" %"},i.BackGroundColor=0,i.loadingMessage=new s.PIXI.Text("loading ...",{fontSize:36,fontFamily:"Permanent Marker",fill:65280,dropShadow:!0,align:"center",stroke:4521796,strokeThickness:1}),i.loadingMessage.anchor.set(.5,.5),i.loadingMessage.position.set(o.SCENE_HALF_WIDTH,o.SCENE_HALF_HEIGHT-80),i.addChild(i.loadingMessage);var n=s.PIXI.Texture.from("assets/loading.png");return i.spinner=new s.PIXI.Sprite(n),i.spinner.position.set(o.SCENE_HALF_WIDTH,o.SCENE_HALF_HEIGHT),i.spinner.anchor.set(.5,.5),i.spinner.scale.set(.5),i.addChild(i.spinner),i}return n.__extends(e,t),e}(s.Scene);e.LoaderScene=p},,,,,,,,,,,,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(33),s=i(24),a=i(21),r=i(9),o=i(26),u=i(27),l=function(){function t(t,e,i,n,s,a,r,o){void 0===o&&(o=!0),this.name=t,this.x=e,this.y=i,this.area=n,this.maxMobCount=s,this.respawnSeconds=a,this.entity=r,this.active=o,this.mobCount=0,this.nextSpawn=0,this.nextSpawn=performance.now()/1e3}return Object.defineProperty(t.prototype,"IsActive",{get:function(){return this.active},set:function(t){this.active=t},enumerable:!0,configurable:!0}),t.prototype.onUpdate=function(t){var e=this;if(this.active&&this.mobCount<this.maxMobCount){var i=performance.now()/1e3;if(this.nextSpawn<=i){this.worldContainer||(this.worldContainer=r.Global.getScm().GetScene("Main").worldContainer);var l=n.LevelLoader.createMob(a.stats.currentLevel.templates,this.entity),c=l.DisplayObject,h=this.x+Math.random()*this.area-this.area/2,p=this.y;l.position=[h,p],s.wp2.addBody(l),c.position.set(h,p),c.visible=!1,c.isLoading=!0,this.worldContainer.addChild(c);var d=new o.AnimatedSprite;d.addAnimations(new u.AnimationSequence("load","assets/entities-atlas.json@load.png",[0,1,2,3],64,64)),d.anchor.set(.5),d.position.set(h,p+10),d.play("load",4,!0),d.scale.set(1,-1),this.worldContainer.addChild(d),setTimeout((function(){e.worldContainer.removeChild(d),c.isLoading=!1,c.visible=!0}),3e3),c.onDeath=function(){console.log("mob died"),e.mobCount--},this.mobCount++,this.nextSpawn=performance.now()/1e3+this.respawnSeconds}}},t}();e.SpawnPoint=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=function(t){function e(e){return t.call(this,e)||this}return n.__extends(e,t),e.prototype.canFire=function(){var t=performance.now(),e=2e3*Math.random(),i=this.lastFire+this.attackCD+e<=t;if(i){var n=Math.random();i=i&&n>.3,this.lastFire=performance.now()}return i},e}(i(120).AI);e.BasicStaticAI=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(22),s=i(19),a=function(){function t(t){var e=this;this.mobEntity=t,this.lastFire=0,this.onUpdate=function(t){e.calcDistance(),e.targetDistance<1050&&e.turnTowardsTarget(),e.targetDistance<800?(e.hasTarget=!0,e.canFire()&&(e.mobEntity.attack(),e.lastFire=performance.now())):e.hasTarget=!1},this.attackCD=t.attributes[s.AtrType.AtkCD]}return t.prototype.calcDistance=function(){var t=n.position.x-this.mobEntity.x,e=n.position.y-this.mobEntity.y;this.targetDistance=Math.sqrt(t*t+e*e)},t.prototype.turnTowardsTarget=function(){var t=n.position.x-this.mobEntity.x;t<0&&this.mobEntity.direction!=s.DirectionH.Left?this.mobEntity.direction=s.DirectionH.Left:t>0&&this.mobEntity.direction!=s.DirectionH.Right&&(this.mobEntity.direction=s.DirectionH.Right)},t.prototype.canFire=function(){var t=performance.now();return this.lastFire+this.attackCD<=t},t}();e.AI=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(9),a=s.SCENE_WIDTH-48,r=function(t){function e(e){var i=t.call(this)||this;i.sceneManager=e,["","webkit","moz","ms"].forEach((function(t){return document.addEventListener(t+"fullscreenchange",(function(t){i.isFullScreen?n.setTexture("assets/gui-atlas.json@gui_fs_exit.png"):n.setTexture("assets/gui-atlas.json@gui_fs_enter.png"),n.scale.set(1)}),!1)}));var n=new s.SpriteButton("assets/gui-atlas.json@gui_fs_enter.png",a,4);n.onClick=function(){return i.toggleFullScreen()},n.scale.set(1),i.addChild(n);var r=new s.SpriteButton("assets/gui-atlas.json@gui_options.png",a-48,4);return r.onClick=function(){return i.sceneManager.ActivateScene("Options")},r.name="BTN_OPTIONS",r.scale.set(1),i.addChild(r),i}return n.__extends(e,t),Object.defineProperty(e.prototype,"isFullScreen",{get:function(){var t=document;return!!(t.fullscreenElement||t.mozFullScreenElement||t.webkitFullscreenElement||t.msFullscreenElement)},enumerable:!0,configurable:!0}),e.prototype.toggleFullScreen=function(){var t=document,e=document.documentElement,i=e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullScreen||e.msRequestFullscreen,n=t.exitFullscreen||t.mozCancelFullScreen||t.webkitExitFullscreen||t.msExitFullscreen;this.isFullScreen?n.call(t):i.call(e)},e}(s.PIXI.Container);e.MasterHud=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(29),a=i(9),r=i(24),o=i(123),u=i(125),l=i(21),c=i(86),h=i(28),p=i(16),d=i(126),f=i(33),m=i(127),y=i(128),v=i(32),g=i(129),S=i(19),x=function(t){function e(e){var i=t.call(this,"Main")||this;return i.sceneManager=e,i.shakeDuration=0,i.shakeEnd=0,i.nextShake=0,i.magnitude=0,i.SHAKE_COUNT=15,i.startGroundShake=function(t){i.shakeEnd=performance.now()+t.milliSeconds,i.magnitude=t.magnitudeInPixels,i.shakeDuration=t.milliSeconds/i.SHAKE_COUNT},i.BackGroundColor=p.SCENE_BACKCOLOR,i.setup(),i}return n.__extends(e,t),e.prototype.onUpdate=function(t,e){r.wp2.update(t),this.worldContainer.x=p.SCENE_HALF_WIDTH-this.hero.x,this.worldContainer.y=p.SCENE_HEIGHT-70,a.TWEEN.update(),l.stats.currentLevel.parallax.forEach((function(t){t.SetViewPortX(a.Global.position.x),t.position.x=a.Global.position.x-p.SCENE_HALF_WIDTH}));for(var i=r.wp2.bodies,n=0,o=i.length;n<o;n++){var u=(f=i[n]).DisplayObject;if(u&&u.visible&&f.type!==s.Body.STATIC&&(u.position.set(Math.floor(f.interpolatedPosition[0]),Math.floor(f.interpolatedPosition[1])),u.rotation=f.interpolatedAngle),f.Trigger&&"distance"===f.Trigger.type&&this.questMngr.canActivateTrigger(f.Trigger)){var c=this.hero.position.x-f.position[0],h=this.hero.position.y-f.position[1],d=Math.sqrt(c*c+h*h);f.Trigger.distance>=d&&this.questMngr.handleTriggerEvent(f)}}for(n=0,o=r.wp2.playerContacts.length;n<o;n++){var f;(f=r.wp2.playerContacts[n]).DisplayObject&&f.DisplayObject.interactionType&&this.handleInteractiveCollision(f),f.Trigger&&"collision"===f.Trigger.type&&this.questMngr.handleTriggerEvent(f)}for(n=0,o=this.worldContainer.children.length;n<o;n++){var m=this.worldContainer.children[n];m&&m.onUpdate&&m.onUpdate(t)}for(n=0,o=l.stats.currentLevel.spawnPoints.length;n<o;n++)l.stats.currentLevel.spawnPoints[n].onUpdate(t);this.hud.onUpdate(t),l.stats.onUpdate(t);var y=performance.now();if(l.stats.getStat(S.StatType.HP)<=0){this.IsHeroInteractive=!1,this.hero.visible=!1;var v=this.sceneManager.GetScene("CutScene"),g=this.sceneManager.CaptureScene();v.SetBackGround(g,this.scale),v.DeathScene=!0,this.sceneManager.ActivateScene(v)}else if(this.shakeEnd>=y){if(this.nextShake<=y){c=p.SCENE_HALF_WIDTH-this.hero.x,h=p.SCENE_HEIGHT-70;this.shakeX=c+this.randomRange(-this.magnitude/2,this.magnitude/2),this.shakeY=h+this.randomRange(-this.magnitude,this.magnitude),this.magnitude-=this.magnitude/this.SHAKE_COUNT,this.nextShake=y+this.shakeDuration}this.worldContainer.x=this.shakeX,this.worldContainer.y=this.shakeY}},e.prototype.setup=function(){this.worldContainer=new a.PIXI.Container,this.worldContainer.scale.y=-1,this.addChild(this.worldContainer),a.Global.worldContainer=this.worldContainer,this.hero=new o.HeroCharacter(this.worldContainer),this.hero.name="hero",this.hero.x=p.SCENE_HALF_WIDTH,this.worldContainer.addChild(this.hero),this.hero.play("idle",p.ANIMATION_FPS_SLOW),this.hud=new u.StatsHud,this.HudOverlay=this.hud,f.LevelLoader.registerFactory("Lava",(function(t){return new d.Lava(t.texture)})),f.LevelLoader.registerFactory("Platform",(function(t){return"string"==typeof t.texture?new m.Platform(t.tilesX||1,1,[t.texture]):new m.Platform(t.tilesX||1,t.tilesY||1,t.texture)})),f.LevelLoader.registerFactory("Bumper",(function(t){return new y.Bumper})),this.questMngr=new g.QuestManager(this),h.eventEmitter.on(h.BURN_TOPIC,(function(t){return t.isBurning?v.snd.burn():v.snd.burnStop()})),h.eventEmitter.on(h.GROUND_SHAKE,this.startGroundShake)},e.prototype.startLevel=function(){var t=this;this.clearLevel(),l.stats.loadLevel(),v.snd.playTrack(l.stats.currentLevel.audioTrack||0),l.stats.currentLevel.parallax.forEach((function(e,i){t.worldContainer.addChildAt(e,i),e.SetViewPortX(l.stats.currentLevel.start[0])})),l.stats.currentLevel.entities.forEach((function(e){t.worldContainer.addChild(e.DisplayObject),e.shapes&&e.shapes.length>0&&r.wp2.addBody(e)})),r.wp2.playerBody.position[0]=l.stats.currentLevel.start[0],r.wp2.playerBody.position[1]=l.stats.currentLevel.start[1],this.questMngr.reset(),this.hero.visible=!0,this.IsHeroInteractive=!0,this.hud.visible=!0,this.sceneManager.ActivateScene(this)},Object.defineProperty(e.prototype,"IsHeroInteractive",{set:function(t){this.hero.IsInteractive!==t&&(this.hero.IsInteractive=t,this.hero.IsInteractive||(this.hero.play("idle",p.ANIMATION_FPS_SLOW),v.snd.idle()))},enumerable:!0,configurable:!0}),e.prototype.collectObject=function(t){var e=this,i=t.DisplayObject,n=i.scale.x,s=i.position.x+45,r=i.position.y+160,o=i.position.x-p.SCENE_HALF_WIDTH,u=p.SCENE_HEIGHT,l=new a.TWEEN.Tween(i.position).to({x:s,y:r},150),c=new a.TWEEN.Tween(i.scale).to({x:n+.5,y:n+.5},500).easing(a.TWEEN.Easing.Linear.None),h=new a.TWEEN.Tween(i.position).to({x:o,y:u},2e3).easing(a.TWEEN.Easing.Back.In).onComplete((function(){return e.worldContainer.removeChild(i)}));l.chain(c,h).start(),this.removeEntity(t)},e.prototype.handleInteractiveCollision=function(t){var e=t.DisplayObject;switch(t.DisplayObject.interactionType){case 1:l.stats.increaseStat(S.StatType.Coins,1),this.collectObject(t),this.hud.addInfoMessage(e.position,"+1 coin",p.MSG_COIN_STYLE,-100),v.snd.coin();break;case 2:l.stats.increaseStat(S.StatType.Coins,10),this.collectObject(t),this.hud.addInfoMessage(e.position,"+10 coins",p.MSG_COIN_STYLE,-100),v.snd.coin();break;case 3:l.stats.increaseStat(S.StatType.Coins,100),this.collectObject(t),this.hud.addInfoMessage(e.position,"+100 coins",p.MSG_COIN_STYLE,-100),v.snd.gem();break;case 201:this.hud.addInfoMessage(e.position,"Kendo knowledge acquired!",p.MSG_COIN_STYLE),this.collectObject(t),v.snd.questItem(),this.questMngr.acquireItem(201);break;case 202:this.hud.addInfoMessage(e.position,"1 Ki acquired!",p.MSG_COIN_STYLE),this.collectObject(t),v.snd.questItem(),this.questMngr.acquireItem(202);break;case S.DamageType.LavaBorder:var i=performance.now()/1e3;(!l.stats.buffs[S.DamageType.LavaBorder]||l.stats.buffs[S.DamageType.LavaBorder]<i)&&this.hud.addInfoMessage(e.position,"Burning",p.MSG_WARN_STYLE,100),l.stats.buffs[S.DamageType.LavaBorder]=this.secondsFromNow(1);break;case S.DamageType.Lava:i=performance.now()/1e3;(!l.stats.buffs[S.DamageType.Lava]||l.stats.buffs[S.DamageType.Lava]<i)&&this.hud.addInfoMessage(e.position,"Burning",p.MSG_WARN_STYLE,100),l.stats.buffs[S.DamageType.Lava]=this.secondsFromNow(4)}},e.prototype.secondsFromNow=function(t){var e=performance.now()/1e3;return e+=t},e.prototype.removeEntity=function(t,e){void 0===e&&(e=!1),r.wp2.removeBody(t),e&&this.worldContainer.removeChild(t.DisplayObject),t.DisplayObject=null},e.prototype.clearLevel=function(){var t=this;l.stats.currentLevel&&(l.stats.currentLevel.parallax.forEach((function(e,i){t.worldContainer.removeChild(e)})),l.stats.currentLevel.entities.forEach((function(e){e!==r.wp2.playerBody&&(t.worldContainer.removeChild(e.DisplayObject),r.wp2.removeBody(e),e.DisplayObject=null)})),this.worldContainer.children.filter((function(t){return"hero"!==t.name})).forEach((function(e){t.worldContainer.removeChild(e)})),r.wp2.clearLevel(),c.Bullet.reset())},e.prototype.randomRange=function(t,e){return t+Math.random()*(e-t)},e}(a.Scene);e.MainScene=x},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(22),a=i(9),r=i(28),o=i(124),u=i(24),l=i(21),c=i(85),h=i(33),p=i(32),d=i(19),f=i(26),m=i(43),y=i(27),v=function(t){function e(e){var i=t.call(this)||this;i.container=e,i.onUpdate=function(e){switch(i.position.x=a.Global.position.x,i.position.y=a.Global.position.y,i.IsInteractive&&i.movementCtrl.update(e),i.movementCtrl.MovementState){case o.MovementState.Idle:i.emitterPixies.emit=!1;break;case o.MovementState.Left:case o.MovementState.JumpLeft:i.emitterPixies.emit=i.movementCtrl.IsRunning,i.emitterPixies.minStartRotation=-25,i.emitterPixies.maxStartRotation=25;break;case o.MovementState.Right:case o.MovementState.JumpRight:i.emitterPixies.emit=i.movementCtrl.IsRunning,i.emitterPixies.minStartRotation=155,i.emitterPixies.maxStartRotation=205;break;case o.MovementState.JumpUp:i.emitterPixies.emit=i.movementCtrl.IsRunning,i.emitterPixies.minStartRotation=245,i.emitterPixies.maxStartRotation=295}if(i.emitterPixies.update(.001*e),i.emitterPixies.updateOwnerPos(i.position.x,i.position.y),i.emitterBurn.update(.001*e),i.movementCtrl.IsRunning&&i.movementCtrl.MovementState!==o.MovementState.Idle){l.stats.increaseStat(d.StatType.Dust,.005*-e);var n=8*Math.PI/180;i.rotation=i.movementCtrl.MovementState===o.MovementState.Left?n:-n}else i.rotation=0;i.emitterBurn.emit=l.stats.isBurning,t.prototype.onUpdate.call(i,e)},i.onPlayerMove=function(t){var e=t.newState,n=t.isRunning?1.6*a.ANIMATION_FPS_NORMAL:a.ANIMATION_FPS_NORMAL;switch(e){case o.MovementState.Idle:i.idleAnimationTimeoutHandle&&clearTimeout(i.idleAnimationTimeoutHandle),i.idleAnimationTimeoutHandle=setTimeout((function(){i.play("idle",a.ANIMATION_FPS_SLOW),p.snd.idle()}),300);break;case o.MovementState.Left:clearTimeout(i.idleAnimationTimeoutHandle),i.play("left",n),p.snd.walk(t.isRunning);break;case o.MovementState.Right:clearTimeout(i.idleAnimationTimeoutHandle),i.play("right",n),p.snd.walk(t.isRunning);break;case o.MovementState.JumpLeft:clearTimeout(i.idleAnimationTimeoutHandle),i.play("jumpleft",n),p.snd.jump();break;case o.MovementState.JumpRight:clearTimeout(i.idleAnimationTimeoutHandle),i.play("jumpright",n),p.snd.jump();break;case o.MovementState.JumpUp:clearTimeout(i.idleAnimationTimeoutHandle),i.play("jumpup",n),p.snd.jump();break;case o.MovementState.JumpDownLeft:clearTimeout(i.idleAnimationTimeoutHandle),i.play("jumpdownleft",n,!1),p.snd.jumpAttack();break;case o.MovementState.JumpDownRight:clearTimeout(i.idleAnimationTimeoutHandle),i.play("jumpdownright",n,!1),p.snd.jumpAttack();break;case o.MovementState.JumpDown:clearTimeout(i.idleAnimationTimeoutHandle),i.play("jumpdown",n,!1),p.snd.jumpAttack()}},i.movementCtrl=new o.MovementController(u.wp2),u.wp2.on("playerContact",i.onPlayerContact,i),u.wp2.on("bulletContact",i.onBulletContact,i);var n={alpha:{start:.7,end:0},blendMode:"normal",frequency:.01,startRotation:{min:265,max:275},color:{start:"#ffffff",end:"#ff5050"},speed:{start:1,end:.5,minimumSpeedMultiplier:1},scale:{start:.2,end:.6},maxParticles:20,lifetime:{min:.25,max:.75},spawnType:"circle",spawnCircle:{x:0,y:39,r:25}};i.emitterBurn=s.createParticleEmitter(i,[m.TextureLoader.Get("assets/entities-atlas.json@flame.png")],n),i.emitterPixies=s.createParticleEmitter(e,[m.TextureLoader.Get("assets/objects-atlas.json@star.png")]);var c="assets/objects-atlas.json@hero.png";return i.addAnimations(new y.AnimationSequence("right",c,[18,19,20,21,22,23],64,64)),i.addAnimations(new y.AnimationSequence("left",c,[12,13,14,15,16,17],64,64)),i.addAnimations(new y.AnimationSequence("jumpleft",c,[24,25,26,27,28,29],64,64)),i.addAnimations(new y.AnimationSequence("jumpright",c,[30,31,32,33,34,35],64,64)),i.addAnimations(new y.AnimationSequence("jumpup",c,[1,3,4,6],64,64)),i.addAnimations(new y.AnimationSequence("idle",c,[1,1,0,1,2,3,,4,5,13,12,6,7,11,18,19,0],64,64)),i.addAnimations(new y.AnimationSequence("jumpdownleft",c,[36,37,38],64,64)),i.addAnimations(new y.AnimationSequence("jumpdownright",c,[39,40,41],64,64)),i.addAnimations(new y.AnimationSequence("jumpdown",c,[42,43,44],64,64)),i.anchor.set(.5,.58),i.scale.y*=-1,r.eventEmitter.on(r.MOVE_TOPIC,i.onPlayerMove),i}return n.__extends(e,t),Object.defineProperty(e.prototype,"IsInteractive",{get:function(){return this.movementCtrl.isInteractive},set:function(t){this.movementCtrl.isInteractive=t},enumerable:!0,configurable:!0}),e.prototype.onPlayerContact=function(t){var e=this,i=t.body,n=t.body.DisplayObject,s=Math.abs(t.velocity[1]);if(s>505){n instanceof c.Mob&&(n.isLoading||this.handleMobInteraction(n,i));var a=this.movementCtrl.MovementState;if(a===o.MovementState.JumpDown||a===o.MovementState.JumpDownLeft||a===o.MovementState.JumpDownRight)return p.snd.jumpContact(),void r.eventEmitter.emit(r.GROUND_SHAKE,{milliSeconds:600,magnitudeInPixels:9})}if(s>450){console.log("Vert velocity: "+s);var u=new f.AnimatedSprite;u.addAnimations(new y.AnimationSequence("smoke","assets/entities-atlas.json@jump_smoke.png",[0,1,2,3,4,5],64,64)),u.anchor.set(.5),u.pivot.set(.5),u.x=this.x,u.y=this.y-25,u.alpha=.7,u.rotation=Math.random()*Math.PI,this.container.addChild(u),u.onComplete=function(){return e.container.removeChild(u)},u.play("smoke",6,!1)}s>400&&(p.snd.jumpContact(),console.log("velocity: "+t.velocity))},e.prototype.onBulletContact=function(t){var e=this,i=t.bulletBody.DisplayObject;if(!i.IsDead){if(t.playerHit)p.snd.hitPain(),l.stats.increaseStat(d.StatType.HP,-i.damage);else{var n=new f.AnimatedSprite;n.addAnimations(new y.AnimationSequence("exp","assets/entities-atlas.json@slime_atk_exp.png",[0,1,2,3,4,5],32,32)),n.anchor.set(.5),n.pivot.set(.5),n.x=i.x,n.y=i.y,n.alpha=.7,n.rotation=Math.random()*Math.PI,this.container.addChild(n),n.onComplete=function(){return e.container.removeChild(n)},n.play("exp",10,!1),p.snd.bulletHitWall()}i.IsDead=!0}},e.prototype.handleMobInteraction=function(t,e){var i=this,n=e.DisplayObject,s=n;if(s.drop&&Math.random()<=s.drop.chance){var a=h.LevelLoader.createEntity(l.stats.currentLevel.templates,s.drop.entity);this.addDropItem(t,a)}this.removeEntity(e),t.squish((function(){return i.container.removeChild(n)}));var r=t.attributes[d.AtrType.HP]/2;l.stats.increaseStat(d.StatType.TotalExp,r)},e.prototype.addDropItem=function(t,e){var i=e.DisplayObject;i.x=t.x,i.y=t.y+40,this.container.addChild(i);var n=i.position.x+75,s=i.position.y+200,r=new a.TWEEN.Tween(i.position).to({x:n,y:s},400).onComplete((function(){e.position=[i.position.x,i.position.y],u.wp2.addBody(e)})),o=i.scale.x,l=i.scale.y,c=new a.TWEEN.Tween(i.scale).to({x:o+.3,y:o+.3},350).easing(a.TWEEN.Easing.Linear.None),h=this.x,p=this.y+8,d=new a.TWEEN.Tween(i.position).to({x:h,y:p},350).easing(a.TWEEN.Easing.Back.In).onUpdate((function(t){e.position=[i.position.x,i.position.y]})).onComplete((function(){return i.scale.set(o,l)}));r.chain(c,d).start()},e.prototype.removeEntity=function(t,e){void 0===e&&(e=!1),u.wp2.removeBody(t),e&&this.container.removeChild(t.DisplayObject),t.DisplayObject=null},e}(f.AnimatedSprite);e.HeroCharacter=v},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,s=i(9),a=i(21),r=i(28),o=i(19),u=function(){function t(t){this.VELOCITY=150,this.JUMP_FORCE=17e3,this.JUMP_ATTACK_FORCE=-17e3,this.JUMP_COOLDOWN=500,this.JUMP_ATTACK_COOLDOWN=1e3,this.JUMP_ATTACK_FREEZE=800,this.nextJumpAllowed=0,this.nextJumpDownAllowed=0,this.movementState=-1,this.kbd=new s.KeyboardMapper,this.isRunning=!1,this.isJumping=!1,this.newState=n.Idle,this._isInteractive=!0,this.world=t}return Object.defineProperty(t.prototype,"isInteractive",{get:function(){return this._isInteractive},set:function(t){this._isInteractive=t,this._isInteractive||(this.isRunning=!1,this.movementState=n.Idle)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsJumping",{get:function(){return this.isJumping},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CanJump",{get:function(){return!this.isJumping&&this.nextJumpAllowed<performance.now()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsRunning",{get:function(){return this.isRunning},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MovementState",{get:function(){return this.movementState},enumerable:!0,configurable:!0}),t.prototype.StartJump=function(t){var e;t===n.JumpUp?e=[0,this.JUMP_FORCE]:t===n.JumpLeft?e=[.1*-this.JUMP_FORCE,this.JUMP_FORCE]:t===n.JumpRight&&(e=[.1*this.JUMP_FORCE,this.JUMP_FORCE]),this.world.playerBody.applyImpulse(e),this.world.clearContactsForBody(this.world.playerBody),this.nextJumpAllowed=performance.now()+this.JUMP_COOLDOWN},t.prototype.StartJumpDown=function(){var t=this;switch(this.movementState){case n.Left:case n.JumpLeft:this.newState=n.JumpDownLeft;break;case n.Right:case n.JumpRight:this.newState=n.JumpDownRight;break;default:this.newState=n.JumpDown}console.log("state change: "+n[this.movementState]+" -> "+n[this.newState]);var e=[0,this.JUMP_ATTACK_FORCE];this.world.playerBody.setZeroForce(),this.world.playerBody.applyImpulse(e),this.nextJumpDownAllowed=performance.now()+this.JUMP_ATTACK_COOLDOWN,this.isInteractive=!1,setTimeout((function(){return t.isInteractive=!0}),this.JUMP_ATTACK_FREEZE),r.eventEmitter.emit(r.MOVE_TOPIC,{newState:this.newState,oldState:this.movementState,isJumping:!0,isRunning:!1}),this.movementState=this.newState},t.prototype.update=function(t){if(this.newState=n.Idle,Math.abs(this.world.playerBody.velocity[1])>.01){var e=this.world.playerContacts.every((function(t){return t.shapes[0].sensor}));this.isJumping=e}else this.isJumping=!1;var i=this.calcMovementVelocity();if(this.isJumping&&this._isInteractive)return(this.kbd.isKeyDown(83)||this.kbd.isKeyDown(40))&&a.stats.HasJumpAtack&&this.nextJumpDownAllowed<performance.now()&&this.StartJumpDown(),void(this.world.playerBody.velocity[0]+=i);this.world.playerBody.velocity[0]=i;var s=a.stats.getStat(o.StatType.Dust)>1,u=this.kbd.isKeyDown(16)&&s&&this._isInteractive;if(this.kbd.isKeyDown(65)||this.kbd.isKeyDown(37)?this.newState=n.Left:(this.kbd.isKeyDown(68)||this.kbd.isKeyDown(39))&&(this.newState=n.Right),(this.kbd.isKeyDown(87)||this.kbd.isKeyDown(38)||this.kbd.isKeyDown(32))&&this.CanJump&&(this.movementState===n.Left?this.newState=n.JumpLeft:this.movementState===n.Right?this.newState=n.JumpRight:this.movementState===n.Idle&&(this.newState=n.JumpUp,u=!1)),this.newState!==this.movementState||u!==this.IsRunning){var l=!1;switch(this.newState){case n.JumpLeft:this.StartJump(n.JumpLeft),l=!0;break;case n.JumpRight:this.StartJump(n.JumpRight),l=!0;break;case n.JumpUp:this.StartJump(n.JumpUp),l=!0}r.eventEmitter.emit(r.MOVE_TOPIC,{newState:this.newState,oldState:this.movementState,isJumping:l,isRunning:u})}this.movementState=this.newState,this.isRunning=u},t.prototype.calcMovementVelocity=function(){var t=0;return this.movementState===n.Left||this.movementState===n.JumpLeft?t=-1:this.movementState!==n.Right&&this.movementState!==n.JumpRight||(t=1),this.IsJumping?.2*t:t*this.VELOCITY*(this.IsRunning?2:1)},t}();e.MovementController=u,function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Idle=2]="Idle",t[t.JumpLeft=3]="JumpLeft",t[t.JumpRight=4]="JumpRight",t[t.JumpUp=5]="JumpUp",t[t.JumpDownLeft=6]="JumpDownLeft",t[t.JumpDownRight=7]="JumpDownRight",t[t.JumpDown=8]="JumpDown"}(n=e.MovementState||(e.MovementState={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(9),a=i(21),r=i(28),o=i(16),u=i(19),l=function(t){function e(){var e=t.call(this)||this;return e.questMsgEndTime=0,e.handleDpsChange=function(t){e.addInfoMessage(s.Global.position,t.Amount+" HP",o.MSG_HP_STYLE,50)},e.handleStatChange=function(t){switch(t.Type){case u.StatType.Coins:e.txtCoins.text=t.NewValue.toString();break;case u.StatType.Dust:e.txtDust.text=t.NewValue.toFixed(0)+" / "+t.Stats[u.StatType.MaxDust].toFixed(0);break;case u.StatType.MaxDust:e.txtDust.text=Math.floor(t.Stats[u.StatType.Dust])+" / "+t.NewValue.toFixed(0);break;case u.StatType.HP:e.txtHP.text=Math.round(t.NewValue)+" / "+t.Stats[u.StatType.MaxHP];break;case u.StatType.MaxHP:e.txtHP.text=Math.round(t.Stats[u.StatType.HP])+" / "+t.NewValue;break;case u.StatType.TotalExp:var i=t.NewValue-t.OldValue;0!=i&&e.addInfoMessage({x:0,y:90},"+"+i+" exp",o.MSG_EXP_STYLE,-50),e.renderExp(t);break;case u.StatType.CharacterLevel:e.handleLevelUp(t)}},e.handleLevelUp=function(t){e.txtExp.text=Math.round(t.Stats[u.StatType.LevelExp])+" / "+t.Stats[u.StatType.LevelMaxExp],e.expFiller.width=1,e.addLvlUpMessage("Level "+t.NewValue),e.txtLevel.text="Level "+a.stats.characterLevel},e.setup(),e}return n.__extends(e,t),e.prototype.setup=function(){this.txtPlayerPosition=new s.PIXI.BitmapText("0",o.QUEST_STYLE),this.txtPlayerPosition.position=new s.PIXI.Point(o.SCENE_WIDTH,o.SCENE_HEIGHT),this.txtPlayerPosition.anchor.set(1,1),this.addChild(this.txtPlayerPosition),this.statContainer=new s.PIXI.Sprite(s.TextureLoader.Get("assets/gui-atlas.json@panel_stats.png",!0)),this.statContainer.position.set(4),this.statContainer.name="TriggerMessage",this.statContainer.anchor.set(0),this.addChild(this.statContainer),this.questPanel=new s.PIXI.Sprite(s.TextureLoader.Get("assets/gui-atlas.json@panel.png")),this.questPanel.anchor.set(0),this.questPanel.position.set(4,88),this.addChild(this.questPanel),this.txtQuestMessage=new s.PIXI.BitmapText("",o.QUEST_STYLE),this.txtQuestMessage.position.set(14),this.txtQuestMessage.anchor.set(0),this.questPanel.addChild(this.txtQuestMessage);var t,e={font:{name:"Orbitron",size:26},tint:16711424};this.statContainer.height;this.txtHP=new s.PIXI.BitmapText("0",e),this.txtHP.anchor.set(0,.5),this.txtHP.position=new s.PIXI.Point(84,this.statContainer.height/2),this.statContainer.addChild(this.txtHP),(t=new s.PIXI.Sprite(s.TextureLoader.Get("assets/gui-atlas.json@heart.png"))).anchor.set(.5),t.position.set(45,this.statContainer.height/2),this.statContainer.addChild(t),this.txtDust=new s.PIXI.BitmapText("0",e),this.txtDust.anchor.set(0,.5),this.txtDust.position=new s.PIXI.Point(334,this.statContainer.height/2),this.statContainer.addChild(this.txtDust),this.emitter=s.createParticleEmitter(this.statContainer,[s.TextureLoader.Get("assets/objects-atlas.json@star.png")]),this.emitter.updateOwnerPos(292,64),this.emitter.maxLifetime=.6,this.emitter.maxParticles=50,this.emitter.emit=!0,this.txtCoins=new s.PIXI.BitmapText("0",e),this.txtCoins.anchor.set(0,.5),this.txtCoins.position=new s.PIXI.Point(586,this.statContainer.height/2),this.statContainer.addChild(this.txtCoins),(t=new s.PIXI.Sprite(s.TextureLoader.Get("assets/gui-atlas.json@coin.png"))).anchor.set(.5),t.position.set(544,this.statContainer.height/2),this.statContainer.addChild(t);var i=new s.PIXI.Sprite(s.TextureLoader.Get("assets/gui-atlas.json@exp_panel.png"));i.position.set(0,o.SCENE_HEIGHT-i.height),this.addChild(i),this.expPreFiller=new s.PIXI.Sprite(s.TextureLoader.Get("assets/gui-atlas.json@exp_prefill.png")),this.expPreFiller.position.set(3,3),i.addChild(this.expPreFiller),this.expFiller=new s.PIXI.Sprite(s.TextureLoader.Get("assets/gui-atlas.json@exp_fill.png")),this.expFiller.position.set(3,3),i.addChild(this.expFiller),this.fillLen=i.width-6;var n={font:{name:"Bauhaus",size:18}};this.txtExp=new s.PIXI.BitmapText("0 / 1000",n),this.txtExp.pivot.set(.5),this.txtExp.anchor.set(.5),this.txtExp.position=new s.PIXI.Point(i.width/2,i.height/2),this.txtExp.tint=16711492,i.addChild(this.txtExp),this.txtLevel=new s.PIXI.BitmapText("Level "+a.stats.characterLevel,n),this.txtLevel.position.set(i.x+i.width+4,i.y),this.txtLevel.tint=16711492,this.addChild(this.txtLevel),r.eventEmitter.on(r.STATCHANGE_TOPIC,this.handleStatChange),r.eventEmitter.on(r.DAMAGE_TOPIC,this.handleDpsChange)},e.prototype.onUpdate=function(t){this.emitter.update(.001*t),this.questPanel.visible&&this.questMsgEndTime<performance.now()&&(this.questPanel.visible=!1,this.onCompleteCB&&this.onCompleteCB()),this.txtPlayerPosition.text=s.Global.position.x.toFixed(0)+", "+s.Global.position.y.toFixed(0)},e.prototype.addInfoMessage=function(t,e,i,a){var r=this,u=n.__assign({font:"Orbitron",size:24,tint:16777215},i),l=new s.PIXI.BitmapText(e,u);a=a||0,l.position.set(o.SCENE_HALF_WIDTH+a,o.SCENE_HEIGHT-t.y-70),l.scale.set(1,1),this.addChild(l);var c=t.y>o.SCENE_HALF_HEIGHT?250:-250,h=o.SCENE_HEIGHT-t.y+c;new s.TWEEN.Tween(l.position).to({y:h},2e3).start();var p=new s.TWEEN.Tween(l.scale).to({x:1.6,y:1.6},2200).easing(s.TWEEN.Easing.Linear.None),d=new s.TWEEN.Tween(l).to({alpha:0},3e3).onComplete((function(){return r.removeChild(l)}));p.chain(d).start()},e.prototype.addQuestItemMessage=function(t){var e=this,i=new s.PIXI.BitmapText(t,o.QUEST_ITEM_STYLE);i.anchor.set(.5),i.position.set(o.SCENE_HALF_WIDTH,150),this.addChild(i);var n=new s.TWEEN.Tween(i.scale).to({x:1.8,y:1.8},2200).easing(s.TWEEN.Easing.Linear.None),a=new s.TWEEN.Tween(i).to({alpha:0},3e3).onComplete((function(){return e.removeChild(i)}));n.chain(a).start()},e.prototype.setQuestMessage=function(t,e,i){void 0===e&&(e=8e3),void 0===i&&(i=null),this.txtQuestMessage.text=t,this.questPanel.visible=!0,this.questMsgEndTime=performance.now()+e,this.onCompleteCB=i},e.prototype.addLvlUpMessage=function(t){var e=this,i={align:"center",padding:0,fontSize:"64px",fontFamily:o.GUI_FONT,fill:3364147,strokeThickness:6,stroke:13421823},n=new s.PIXI.Text(t,i);n.scale.set(1),n.anchor.set(.5),n.position.set(o.SCENE_HALF_WIDTH,o.SCENE_HEIGHT-s.Global.position.y-70),this.addChild(n);var a=s.Global.position.y>o.SCENE_HALF_HEIGHT?450:-450,r=o.SCENE_HEIGHT-s.Global.position.y+a;new s.TWEEN.Tween(n.position).to({y:r},2e3).start();var u=new s.TWEEN.Tween(n.scale).to({x:1.6,y:1.6},1500).easing(s.TWEEN.Easing.Linear.None),l=new s.TWEEN.Tween(n).to({alpha:.4},6e3).onComplete((function(){return e.removeChild(n)}));u.chain(l).start()},e.prototype.renderExp=function(t){this.txtExp.text=Math.round(t.Stats[u.StatType.LevelExp])+" / "+t.Stats[u.StatType.LevelMaxExp],this.txtLevel.text="Level "+a.stats.characterLevel;var e=Math.min(t.Stats[u.StatType.LevelExp]/t.Stats[u.StatType.LevelMaxExp],1);if(0===e)return this.expFiller.width=1,void(this.expPreFiller.position.x=1+this.expFiller.x);this.expPreFiller.position.x=this.expFiller.width+this.expFiller.x;var i=this.fillLen*e|0,n=i-this.expFiller.width;this.expPreFiller.width=1;var r=new s.TWEEN.Tween(this.expPreFiller).to({width:n},1500).easing(s.TWEEN.Easing.Linear.None),o=new s.TWEEN.Tween(this.expFiller).to({width:i},2e3).easing(s.TWEEN.Easing.Bounce.Out);r.chain(o).start()},e}(s.PIXI.Container);e.StatsHud=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(26),a=i(27),r=function(t){function e(e){var i=t.call(this)||this;return i.FRAME_SIZE_X=64,i.FRAME_SIZE_Y=128,i.addAnimations(new a.AnimationSequence("lava",e,[0,1,2,3],i.FRAME_SIZE_X,i.FRAME_SIZE_Y)),i.play("lava",3),i}return n.__extends(e,t),e}(s.AnimatedSprite);e.Lava=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(9),a=function(t){function e(e,i,n){void 0===e&&(e=1),void 0===i&&(i=1);var a,r,o,u,l,c=t.call(this)||this;c.scale.y*=-1;var h,p=n[0];(e>1||n.length>1)&&(a=n[1],r=n[2]),i>1&&(o=n[3],u=n[4],l=n[5]);var d=0;a&&(f=s.TextureLoader.Get(a),(h=new s.PIXI.Sprite(f)).position.set(d+1,0),d+=f.width,c.addChild(h));var f=s.TextureLoader.Get(p);if(e>1){var m=f.width*e,y=f.height;(h=new s.PIXI.TilingSprite(f,m,y)).position.set(d,0),d+=m}else(h=new s.PIXI.Sprite(f)).position.set(d,0),d+=h.width;c.addChild(h),r&&(f=s.TextureLoader.Get(r),(h=new s.PIXI.Sprite(f)).position.set(d-1,0),d+=h.width,c.addChild(h));var v=e+2;if(i>1)for(d=0;d<v;d++){var g;g=0===d?u:d===v-1?l:o;for(var S=1;S<i;S++)f=s.TextureLoader.Get(g),(h=new s.PIXI.Sprite(f)).position.set(d*h.width,S*h.height),c.addChild(h)}return c}return n.__extends(e,t),e}(s.PIXI.Container);e.Platform=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(9),a=Math.PI/8,r=function(t){function e(){var e=t.call(this,s.TextureLoader.Get("assets/objects-atlas.json@bumper_01.png"))||this;return e.onUpdate=function(t){var i=e.rotor.rotation-a*t/1e3;e.rotor.rotation=i%Math.PI},e.rotor=new s.PIXI.Sprite(s.TextureLoader.Get("assets/objects-atlas.json@bumper_rotor_01.png")),e.rotor.anchor.set(.5),e.rotor.pivot.set(.5),e.addChild(e.rotor),e.anchor.set(.5),e}return n.__extends(e,t),e}(s.PIXI.Sprite);e.Bumper=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(22),s=i(130),a=i(21),r=i(24),o=i(32),u=i(19),l=function(){function t(t){this.gameScene=t,this.questState=[],this.hud=this.gameScene.HudOverlay}return t.prototype.reset=function(){var t=this;this.questState.forEach((function(e,i){e!=s.QuestState.None&&(t.findQuest(i).itemsCollected=0)})),this.questState=[]},t.prototype.acquireItem=function(t){var e=this.findQuestWithItem(t);e&&(e.itemsCollected++,this.hud.addQuestItemMessage("collected "+e.itemsCollected+" / "+e.itemsNeeded),e.itemsCollected>=e.itemsNeeded&&(this.setQuestState(e.id,s.QuestState.Completed),e.completedMsg&&this.hud.setQuestMessage(e.completedMsg)))},t.prototype.canActivateTrigger=function(t){if(!t||!t.questId)return!1;if(Array.isArray(t.dependsOn))for(var e=0;e<t.dependsOn.length;e++){var i=t.dependsOn[e],n=this.questState[i];if(!n||n!=s.QuestState.Rewarded)return!1}return(t.lastActive||-1e4)+1e4<performance.now()},t.prototype.handleTriggerEvent=function(t){var e=this,i=n.getScm(),r=t.Trigger,u=Math.max(this.getQuestState(r.questId),r.state||0);if(this.canActivateTrigger(r)){r.lastActive=performance.now();var l=this.findQuest(r.questId);switch(r.questId){case 1:u===s.QuestState.None&&(this.setQuestState(r.questId,s.QuestState.Completed),this.gameScene.IsHeroInteractive=!1,this.hud.setQuestMessage(l.welcomeMsg,2e3,(function(){e.hud.setQuestMessage(l.completedMsg,2e3,(function(){e.gameScene.IsHeroInteractive=!0,e.setQuestState(r.questId,s.QuestState.Finished),e.giveRewards(l),e.setQuestState(r.questId+1,s.QuestState.InProgress),l=e.findQuest(r.questId+1),e.hud.setQuestMessage(l.welcomeMsg,4e3)}))})));break;case 2:this.getQuestState(1)>s.QuestState.Finished&&(u===s.QuestState.InProgress?(this.setQuestState(r.questId,s.QuestState.Completed),this.hud.setQuestMessage(l.completedMsg,4e3,(function(){e.gameScene.IsHeroInteractive=!0,e.setQuestState(r.questId,s.QuestState.Finished),e.giveRewards(l),l=e.findQuest(r.questId+1),e.setQuestState(r.questId+1,s.QuestState.InProgress),e.hud.setQuestMessage(l.welcomeMsg)}))):u>=s.QuestState.Finished&&(l=this.findQuest(r.questId+1),this.hud.setQuestMessage(l.welcomeMsg,4e3)));break;case 3:u===s.QuestState.InProgress&&(this.setQuestState(r.questId,s.QuestState.Finished),this.giveRewards(l),this.gameScene.IsHeroInteractive=!1,this.hud.setQuestMessage(l.completedMsg,4e3,(function(){n.getScm().ActivateScene("Loader")})),a.stats.saveUserState(!0),o.snd.win());break;case 201:this.genericQuestHandler(l,u,t,[function(){n.worldContainer.getChildByName("quest_item_201").visible=!0;var t=e.findBodyByName("lock");e.gameScene.removeEntity(t,!0)},function(){},function(){e.setQuestState(r.questId,s.QuestState.Finished),e.giveRewards(l),e.gameScene.IsHeroInteractive=!1,a.stats.saveUserState(!0),o.snd.win(),e.hud.visible=!1;var t=i.GetScene("CutScene");t.SetText(l.finishedMsg);var n=i.CaptureScene();t.SetBackGround(n,e.gameScene.scale),i.ActivateScene(t)}]);break;case 203:this.genericQuestHandler(l,u,t,[function(){a.stats.HasJumpAtack=!0},function(){},function(){},function(){}]);break;default:this.genericQuestHandler(l,u,t)}}},t.prototype.genericQuestHandler=function(t,e,i,n){var a=i.Trigger;switch(e){case s.QuestState.None:this.setQuestState(t.id,s.QuestState.InProgress),this.hud.setQuestMessage(t.welcomeMsg);break;case s.QuestState.InProgress:this.hud.setQuestMessage(t.objectiveMsg);break;case s.QuestState.Completed:t.itemId&&t.itemsCollected>=t.itemsNeeded?(this.setQuestState(t.id,s.QuestState.Finished),a.lastActive=0):this.hud.setQuestMessage(t.completedMsg);break;case s.QuestState.Finished:this.hud.setQuestMessage(t.finishedMsg),this.giveRewards(t),this.gameScene.removeEntity(i,!0)}n&&n[e]&&n[e]()},t.prototype.giveRewards=function(t){o.snd.questItem(),t.rewardExp&&a.stats.increaseStat(u.StatType.TotalExp,t.rewardExp),t.rewardCoins&&a.stats.increaseStat(u.StatType.Coins,t.rewardCoins),this.setQuestState(t.id,s.QuestState.Rewarded)},t.prototype.findQuest=function(t){return n.LevelDefinitions.quests.filter((function(e){return e.id===t}))[0]},t.prototype.findQuestWithItem=function(t){var e=this,i=n.LevelDefinitions.quests.filter((function(i){if(i.itemId===t){var n=e.getQuestState(i.id);return n<s.QuestState.Completed&&n>s.QuestState.None}return!1}));return i.length>0?i[0]:null},t.prototype.setQuestState=function(t,e){this.questState[t]=e},t.prototype.getQuestState=function(t){return this.questState[t]||s.QuestState.None},t.prototype.findBodyByName=function(t){var e=void 0;return r.wp2.bodies.forEach((function(i){var n=i.DisplayObject;n&&n.name===t&&(e=i)})),e},t}();e.QuestManager=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.None=0]="None",t[t.InProgress=1]="InProgress",t[t.Completed=2]="Completed",t[t.Finished=3]="Finished",t[t.Rewarded=4]="Rewarded"}(e.QuestState||(e.QuestState={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(9),a=i(16),r=function(t){function e(e){var i=t.call(this,"Options")||this;return i.sceneManager=e,i.currentMusicTrack=0,i.onActivate=function(){i.sceneManager.MasterHudOverlay.children.find((function(t){return"BTN_OPTIONS"==t.name})).visible=!1},i.onDeactivate=function(){i.sceneManager.MasterHudOverlay.children.find((function(t){return"BTN_OPTIONS"==t.name})).visible=!0},i.setup=function(){var t=new s.PIXI.BitmapText("Options",a.TEXT_STYLE);i.addChild(t),t.anchor.set(.5),t.x=a.SCENE_HALF_WIDTH,t.y=20;var e=a.BTN_WIDTH/3,n=a.SCENE_HEIGHT-a.BTN_HEIGHT-e,r=new s.SpriteButton("assets/gui-atlas.json@gui_button1.png",e,n,a.BTN_WIDTH,a.BTN_HEIGHT);r.text=new s.PIXI.Text("Back to game",a.BTN_STYLE),r.onClick=function(){i.sceneManager.ActivatePreviousScene()},i.addChild(r)},i.BackGroundColor=a.SCENE_BACKCOLOR,i.setup(),i}return n.__extends(e,t),e}(s.Scene);e.OptionsScene=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(9),a=i(32),r=i(16),o=function(t){function e(e){var i=t.call(this,"CutScene")||this;return i.sceneManager=e,i.deathScene=!1,i.onActivate=function(){if(i.btnContinue.visible=!i.deathScene,i.callout.visible=!i.deathScene,i.corpse.visible=i.deathScene,i.corpse.scale.set(.1),i.btnContinue.text.text=i.deathScene?"Retry":"Continue",i.deathScene){var t=a.snd.getTrack("Carrousel");a.snd.playTrack(t)}},i.deathMessages=["Life sucks and you just died!","You decided to check the afterlife.\nGuess what? You are dead!","Owned!\nMore luck next time.","You have died!\nRest in peace.","Your quest has failed.\nMay you find more peace in\nthat world than you found in this one.","Here's a picture of your corpse.\nNot pretty!","Yep, you're dead.\nMaybe you should consider\nplaying a Barbie game!","Died..."],i.BackGroundColor=1087931,i.corpse=new s.PIXI.Sprite(s.TextureLoader.Get("assets/objects-atlas.json@hero-dead.png")),i.corpse.anchor.set(.5),i.corpse.pivot.set(.5),i.corpse.position.set(s.SCENE_HALF_WIDTH,s.SCENE_HALF_HEIGHT),i.addChild(i.corpse),i.corpseBlurFilter=new s.PIXI.filters.BlurFilter,i.corpse.filters=[i.corpseBlurFilter],i.callout=new s.PIXI.Sprite(s.TextureLoader.Get("assets/gui-atlas.json@rect.png")),i.callout.anchor.set(.5),i.callout.position.set(s.SCENE_HALF_WIDTH,s.SCENE_HEIGHT/5),i.addChild(i.callout),i.textMessage=new s.PIXI.BitmapText("",r.QUEST_STYLE),i.textMessage.anchor.set(.5),i.textMessage.position.set(0,0),i.callout.addChild(i.textMessage),i.btnContinue=new s.SpriteButton("assets/gui-atlas.json@gui_button1.png",(s.SCENE_WIDTH-s.BTN_WIDTH)/2,i.callout.height+s.BTN_HEIGHT,s.BTN_WIDTH,s.BTN_HEIGHT),i.btnContinue.text=new s.PIXI.Text("Continue",s.BTN_STYLE),i.btnContinue.onClick=function(){i.sceneManager.ActivateScene("Loader")},i.addChild(i.btnContinue),i}return n.__extends(e,t),e.prototype.onUpdate=function(t){if(this.deathScene)if(this.corpse.scale.x<2.5){this.corpse.rotation+=.03;var e=this.corpse.scale.x+.01;this.corpse.scale.set(e)}else this.deathScene=!1,this.textMessage.text=this.deathMessages[0|Math.random()*this.deathMessages.length],this.callout.visible=!0,this.btnContinue.visible=!0;else this.corpse.rotation+=.005;var i=Math.max(5,this.corpseBlurFilter.blur+4e-5);this.corpseBlurFilter.blur=i},Object.defineProperty(e.prototype,"DeathScene",{get:function(){return this.deathScene},set:function(t){if(this.deathScene=t,this.deathScene){this.corpseBlurFilter.blur=0;var e=new s.PIXI.filters.ColorMatrixFilter;e.sepia(!1),this.backSprite.filters=[e]}else this.backSprite.filters=null},enumerable:!0,configurable:!0}),e.prototype.SetBackGround=function(t,e){this.backSprite?this.backSprite.texture=t:(this.backSprite=new s.PIXI.Sprite(t),this.addChildAt(this.backSprite,0)),this.backSprite.scale.set(1/e.x,1/e.y)},e.prototype.SetText=function(t){this.textMessage.text=t},e}(s.Scene);e.CutScene=o}],[[90,0,2,1]]]);
//# sourceMappingURL=main.bundle.js.map