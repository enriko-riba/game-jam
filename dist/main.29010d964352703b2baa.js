(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{126:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(7);function s(t,e){var i=null,s=null,a={name:null,displayObject:{typeName:"Sprite"},body:null,trigger:null,drop:null},o=t.filter(function(t){return t.name===e.template});o&&o.length>0&&(a=o[0]),i=n.__assign({},a.displayObject,e),a.drop&&(i=n.__assign({},i,{drop:a.drop})),a.body&&(s=a.body);var r=void 0;return(a.trigger||i.trigger)&&(r=n.__assign({},a.trigger,i.trigger)),{templateName:a.name,doDef:i,bdDef:s,trigger:r}}function a(t){for(var e={},i=[],n=0;n<t.length;n++)e[t[n]]||(e[t[n]]=!0,i.push(t[n]));return i}e.GetLevelAssets=function(t,e){for(var i=[],o=void 0,r=0;r<t.levels.length;r++)if(t.levels[r].id===e){o=t.levels[r];break}if(o){o.parallax.forEach(function(t){i=i.concat(t.textures)}),o.assets&&o.assets.length>0&&(i=i.concat(o.assets));var l=t.templates.concat(o.map.templates);o.map.templates.forEach(function(t){if(!t.type||"spawn_point"!==t.type){var e=t.displayObject;e.texture&&("string"==typeof e.texture?i.push(e.texture):i=i.concat(e.texture)),e.sequences&&e.sequences.forEach(function(t){i.push(t.texture)})}}),o.map.entities.forEach(function(t){var e=s(l,t);e.doDef.texture&&("string"==typeof e.doDef.texture?i.push(e.doDef.texture):i=i.concat(e.doDef.texture)),e.doDef.sequences&&e.doDef.sequences.forEach(function(t){i.push(t.texture)})}),o.map.NPC=o.map.NPC||[],o.map.NPC.forEach(function(t){if(t.type&&"spawn_point"===t.type)   ;else{var e=t;e.attack&&(i=i.concat(e.attack));var s=l.filter(function(t){return t.name===e.template});if(s&&s.length>0){var a=s[0],o=n.__assign({},a.displayObject,e);o.texture&&("string"==typeof o.texture?i.push(o.texture):i=i.concat(o.texture)),o.attack&&(i=i.concat(o.attack)),o.sequences&&o.sequences.forEach(function(t){t.texture&&i.push(t.texture)})}}})}return i=a(i=i.map(function(t){var e=t.indexOf(".json@");return e>0?t.substr(0,e+5):t}))},e.getEntityDefinition=s,e.getUniqueItems=a},15:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SCENE_WIDTH=1920,e.SCENE_HEIGHT=1080,e.SCENE_HALF_WIDTH=e.SCENE_WIDTH/2,e.SCENE_HALF_HEIGHT=e.SCENE_HEIGHT/2,e.BTN_WIDTH=120,e.BTN_HEIGHT=60,e.GUI_FONT="Orbitron",e.SCENE_BACKCOLOR=1122867,e.ANIMATION_FPS_NORMAL=14,e.ANIMATION_FPS_SLOW=4,e.BTN_STYLE={align:"center",padding:0,fontSize:28,fontFamily:e.GUI_FONT,fill:4652029,strokeThickness:1,stroke:0},e.TEXT_STYLE={align:"left",font:"21px Orbitron",tint:15066395},e.MSG_COIN_STYLE={align:"left",font:"22px Orbitron",tint:16711492},e.MSG_HP_STYLE={align:"center",font:"24px Orbitron",tint:16716049},e.MSG_EXP_STYLE={align:"center",font:"24px Orbitron",tint:8700418},e.MSG_WARN_STYLE={align:"center",font:"27px Orbitron",tint:16711697},e.QUEST_ITEM_STYLE={align:"center",font:"28px Orbitron",tint:8700658},e.QUEST_STYLE={align:"left",font:"24px Orbitron",tint:16711628}},154:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(7),s=i(5),a=i(155),o=i(34),r=i(275),l=i(24),u=i(18),c=48,p=function(t){function e(e){var i=t.call(this)||this;return i.textureName=e,i._isDead=!1,i.isLoading=!1,i.attack=function(){var t=i.currentSequence,e=i.fps;o.snd.atkMagic1(),i._direction==u.DirectionH.Left?i.play("latk",e,!1):i.play("ratk",e,!1),i.onComplete=function(n){i.onComplete=null,i.fireBullet(),i.play(t.sequenceName,e)}},i.addAnimations(new s.AnimationSequence("left",i.textureName,[0,1,2],c,c)),i.addAnimations(new s.AnimationSequence("right",i.textureName,[3,4,5],c,c)),i.addAnimations(new s.AnimationSequence("latk",i.textureName,[6,7,8],c,c)),i.addAnimations(new s.AnimationSequence("ratk",i.textureName,[9,10,11],c,c)),i.addAnimations(new s.AnimationSequence("lsquish",i.textureName,[12,13,14,15,16,17],c,c)),i.addAnimations(new s.AnimationSequence("rsquish",i.textureName,[18,19,20,21,22,23],c,c)),i.play("left"),i._direction=u.DirectionH.Left,i}return n.__extends(e,t),Object.defineProperty(e.prototype,"isDead",{get:function(){return this._isDead},set:function(t){t!=this._isDead&&(this._isDead=t,this._isDead&&this.onDeathCallBack&&this.onDeathCallBack())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onDeath",{get:function(){return this.onDeathCallBack},set:function(t){this.onDeathCallBack=t},enumerable:!0,configurable:!0}),e.prototype.squish=function(t){this.isDead=!0;var e=this._direction==u.DirectionH.Left?"lsquish":"rsquish";this.onComplete=t,this.play(e,12,!1),o.snd.mobSquish()},Object.defineProperty(e.prototype,"direction",{get:function(){return this._direction},set:function(t){this._direction!=t&&(this._direction=t,t===u.DirectionH.Left?this.play("left"):this.play("right"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attributes",{get:function(){return this._attributes},set:function(t){this._attributes=t},enumerable:!0,configurable:!0}),e.prototype.fireBullet=function(){this.atkTexture.constructor===Array||a.Bullet.emitBullet(this.atkTexture,this.position,l.wp2.playerBody.position,this._attributes[u.AtrType.Atk])},e.prototype.createAI=function(t){switch(t.toLowerCase()){case"basic_static":this._ai=new r.BasicStaticAI(this)}},e.prototype.onUpdate=function(e){t.prototype.onUpdate.call(this,e),this.isDead||this.isLoading||this._ai.onUpdate(e)},e}(s.AnimatedSprite);e.Mob=p},155:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(7),s=i(41),a=i(72),o=i(24),r=i(5),l=i(5),u=function(t){function e(e,i,n,s){var a=t.call(this,e)||this;return a.velocity=i,a.damage=s,a.direction=new PIXI.Point,a.interactionType=666,a.onUpdate=function(){if(!a.isDead){var t=performance.now()/1e3-a.startTime;a.IsDead=a.ttl<t}},a.ttl=n,a.IsDead=!1,a}return n.__extends(e,t),Object.defineProperty(e.prototype,"Direction",{get:function(){return this.direction},set:function(t){var e=t.x*t.x+t.y*t.y;e=1/Math.sqrt(e),this.direction.set(t.x*e,t.y*e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IsDead",{get:function(){return this.isDead},set:function(t){t!=this.isDead&&(this.isDead=t,this.isDead?this.body&&(this.body.velocity=[0,0]):(this.startTime=performance.now()/1e3,this.body&&(this.body.position=[this.position.x,this.position.y])),this.isDead&&this.onDeath&&this.onDeath(),this.visible=!this.isDead)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"OnDeath",{get:function(){return this.onDeath},set:function(t){this.onDeath=t},enumerable:!0,configurable:!0}),e.reset=function(){e.bullets=[]},e.bullets=[],e.emitBullet=function(t,i,n,u){var c=e.findDeadBullet();if(!c){(c=new e(l.TextureLoader.Get(t),200,5,u)).anchor.set(.5),c.scale.set(.5,-.5),e.bullets.push(c),r.Global.worldContainer.addChild(c);var p=new s.Circle({radius:c.width/2});p.collisionGroup=a.COL_GRP_BULLET,p.collisionMask=a.COL_GRP_PLAYER|a.COL_GRP_SCENE|a.COL_GRP_GROUND,p.sensor=!0;var d={mass:0,position:[i.x,i.y],angle:0,fixedRotation:!1,angularDamping:0,damping:0},h=new s.Body(d);h.addShape(p),h.setDensity(0),h.gravityScale=0,h.angularVelocity=2,h.collisionResponse=!1,h.type=s.Body.DYNAMIC,h.DisplayObject=c,c.body=h,o.wp2.addBody(h)}c.position=i;var m=n instanceof Float32Array?new PIXI.Point(n[0]-i.x,n[1]-i.y):new PIXI.Point(n.x-i.x,n.y-i.y);return c.Direction=m,c.damage=u,c.IsDead=!1,c.body.velocity[0]=c.Direction.x*c.velocity,c.body.velocity[1]=c.Direction.y*c.velocity,c},e.findDeadBullet=function(){for(var t=0,i=e.bullets.length;t<i;t++){var n=e.bullets[t];if(n.IsDead)return n}return null},e}(PIXI.Sprite);e.Bullet=u},156:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(5),s=i(259),a=["Permanent Marker","Orbitron"];console.log("initializing google webfont loader ...",a);try{var o={google:{families:a},active:function(){console.log("fonts preload finished!");var t=n.Global.getScm(),e=new s.BootScene(t);t.AddScene(e),t.ActivateScene(e)}};window.WebFontConfig=o}catch(t){console.log(t)}var r=("https:"===document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",l=document.createElement("script");l.src=r,l.type="text/javascript",l.async=!0;var u=document.getElementsByTagName("script")[0];u.parentNode&&u.parentNode.insertBefore(l,u)},18:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.MaxHP=0]="MaxHP",t[t.MaxDust=1]="MaxDust",t[t.RegenHP=2]="RegenHP",t[t.RegenDust=3]="RegenDust"}(e.BaseStatType||(e.BaseStatType={})),function(t){t[t.MaxHP=0]="MaxHP",t[t.HP=1]="HP",t[t.MaxDust=2]="MaxDust",t[t.Dust=3]="Dust",t[t.RegenHP=4]="RegenHP",t[t.RegenDust=5]="RegenDust",t[t.Coins=6]="Coins",t[t.Gold=7]="Gold",t[t.LevelExp=8]="LevelExp",t[t.LevelMaxExp=9]="LevelMaxExp",t[t.TotalExp=10]="TotalExp",t[t.AttributePoints=11]="AttributePoints",t[t.CharacterLevel=12]="CharacterLevel"}(e.StatType||(e.StatType={})),function(t){t[t.LavaBorder=1e3]="LavaBorder",t[t.Lava=1001]="Lava",t[t.Poison=1002]="Poison"}(e.DamageType||(e.DamageType={})),function(t){t[t.HP=0]="HP",t[t.Atk=1]="Atk",t[t.AtkCD=2]="AtkCD",t[t.Def=3]="Def"}(e.AtrType||(e.AtrType={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right"}(e.DirectionH||(e.DirectionH={}))},20:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,s=i(7),a=i(0),o=i(258),r=i(125),l=i(15);e.getScm=function(){if(!n){var t={view:document.getElementById("stage"),backgroundColor:0,antialias:!1,transparent:!1,roundPixels:!1,resolution:window.devicePixelRatio};n=new r.SceneManager(l.SCENE_WIDTH,l.SCENE_HEIGHT,t)}return n},e.deleteScm=function(){n&&n.Renderer.destroy(),n=void 0},e.position=new a.Point,e.createParticleEmitter=function(t,e,i){var n={alpha:{start:.8,end:.03},color:{start:"#dcff09",end:"#9f1f1f"},scale:{start:.1,end:.4,minimumScaleMultiplier:1},speed:{start:50,end:3,minimumSpeedMultiplier:1},acceleration:new a.Point,startRotation:{min:0,max:360},rotationSpeed:{min:5,max:20},lifetime:{min:.4,max:1},blendMode:"add",frequency:.01,emitterLifetime:-1,maxParticles:200,pos:new a.Point(0,-24),addAtBack:!1,spawnType:"circle",spawnCircle:{x:0,y:0,r:10}};i&&(n=s.__assign({},n,i));var r=new o.Emitter(t,e,n);return r.emit=!1,r},e.LevelDefinitions={templates:void 0,levels:void 0,quests:void 0}},21:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(20),s=i(31),a=i(40),o=i(18),r=function(){function t(){var e=this;this.baseStats=[],this.attributeStats=[],this.stats=[],this.accumulator=0,this.dpsDecreaseAmount=0,this.hasJumpAttack=!1,this.hasMagicAttack=!1,this.characterLevel=0,this.currentGameLevel=0,this.expForNextLevel=0,this.isBurningBuff=!1,this.buffs=[],this.onUpdate=function(t){for(var i=performance.now()/1e3,n=1e3,a=e.buffs.length;n<a;n++)if(e.buffs[n]&&e.buffs[n]>i){var r=0;switch(n){case o.DamageType.LavaBorder:r=5;break;case o.DamageType.Lava:r=15;break;case o.DamageType.Poison:r=10}var l=.001*t*r;e.dpsDecreaseAmount+=l}if(e.accumulator+=t,e.accumulator>500){if(e.accumulator-=500,e.stats[o.StatType.Dust]<e.stats[o.StatType.MaxDust]){var u=.5*e.stats[o.StatType.RegenDust];e.increaseStat(o.StatType.Dust,u)}if(e.stats[o.StatType.HP]<e.stats[o.StatType.MaxHP]){u=.5*e.stats[o.StatType.RegenHP];e.increaseStat(o.StatType.HP,u)}if(e.dpsDecreaseAmount>=1){var c=Math.floor(e.dpsDecreaseAmount),p={OldValue:e.stats[o.StatType.HP],Amount:-c};s.eventEmitter.emit(s.DAMAGE_TOPIC,p),e.increaseStat(o.StatType.HP,-c),e.dpsDecreaseAmount-=c}}var d=e.isBurningBuff;e.isBurningBuff=e.buffs[o.DamageType.LavaBorder]>i||e.buffs[o.DamageType.Lava]>i,d!==e.isBurning&&s.eventEmitter.emit(s.BURN_TOPIC,{wasBurning:d,isBurning:e.isBurningBuff})},this.scevent={Type:o.StatType.Coins,OldValue:0,NewValue:0,Stats:[]},this.id=0,this.attributeStats[o.BaseStatType.RegenHP]=0,this.attributeStats[o.BaseStatType.RegenDust]=0,this.attributeStats[o.BaseStatType.MaxHP]=0,this.attributeStats[o.BaseStatType.MaxDust]=0,this.stats[o.StatType.Coins]=0,this.stats[o.StatType.Dust]=600,this.stats[o.StatType.TotalExp]=0,this.stats[o.StatType.AttributePoints]=0,this.stats[o.StatType.HP]=120;t.expForLevel[0]=0;for(var i=1;i<1e4;i++)t.expForLevel[i]=t.expForLevel[i-1]+1e3*i;this.rebuildStats()}return Object.defineProperty(t.prototype,"LevelLoader",{get:function(){return this.levelLoader||(this.levelLoader=new a.LevelLoader(n.LevelDefinitions)),this.levelLoader},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBurning",{get:function(){return this.isBurningBuff},enumerable:!0,configurable:!0}),t.prototype.loadLevel=function(){this.loadUserState(),this.currentLevel=this.LevelLoader.buildLevel(this.currentGameLevel)},t.prototype.saveUserState=function(t){t&&(this.currentGameLevel+=1);this.id,this.stats[o.StatType.Coins],this.stats[o.StatType.Gold],Math.floor(this.stats[o.StatType.Dust]),this.stats[o.StatType.TotalExp],this.stats[o.StatType.AttributePoints],this.stats[o.StatType.HP],this.currentGameLevel},t.prototype.loadUserState=function(){this.id;var t={HP:this.getStat(o.StatType.MaxHP),Exp:this.getStat(o.StatType.TotalExp),Coins:this.getStat(o.StatType.Coins),Dust:this.getStat(o.StatType.MaxDust),Gold:0,AtrPts:0,LastLevel:this.currentGameLevel};console.log("loadUserState() response",t),e.stats.currentGameLevel=t.LastLevel,t.HP<=0&&(t.HP=this.stats[o.StatType.MaxHP]),this.setStat(o.StatType.HP,t.HP),this.setStat(o.StatType.Coins,t.Coins),this.setStat(o.StatType.Gold,t.Gold),this.setStat(o.StatType.Dust,t.Dust),this.setStat(o.StatType.AttributePoints,t.AtrPts),this.setStat(o.StatType.TotalExp,t.Exp),this.rebuildStats()},Object.defineProperty(t.prototype,"HasJumpAtack",{get:function(){return this.hasJumpAttack},set:function(t){this.hasJumpAttack=t},enumerable:!0,configurable:!0}),t.prototype.setStat=function(e,i){this.stats[e]=i,e===o.StatType.TotalExp&&(this.characterLevel=t.findExpLevel(i),this.stats[o.StatType.LevelMaxExp]=t.expForLevel[this.characterLevel+1]-t.expForLevel[this.characterLevel],this.stats[o.StatType.LevelExp]=this.stats[o.StatType.TotalExp]-t.expForLevel[this.characterLevel],this.expForNextLevel=t.expForLevel[this.characterLevel+1]),this.updateEvent(e,i),s.eventEmitter.emit(s.STATCHANGE_TOPIC,this.scevent)},t.prototype.getStat=function(t){return this.stats[t]},t.prototype.increaseStat=function(e,i,n){var a=this.stats[e]+i;n&&a>n&&(a=n),a<0&&(a=0),this.updateEvent(e,a),this.stats[e]=a,e===o.StatType.TotalExp&&(this.stats[o.StatType.LevelExp]=a-t.expForLevel[this.characterLevel],a>=this.expForNextLevel&&(this.characterLevel=t.findExpLevel(a),this.expForNextLevel=t.expForLevel[this.characterLevel+1],this.stats[o.StatType.LevelMaxExp]=this.expForNextLevel-t.expForLevel[this.characterLevel],this.stats[o.StatType.LevelExp]=a-t.expForLevel[this.characterLevel],this.scevent.Type=o.StatType.CharacterLevel,this.scevent.OldValue=this.characterLevel-1,this.scevent.NewValue=this.characterLevel,this.scevent.Stats=this.stats,s.eventEmitter.emit(s.STATCHANGE_TOPIC,this.scevent),a=this.stats[o.StatType.AttributePoints]+5,this.scevent.Type=o.StatType.AttributePoints,this.scevent.OldValue=this.getStat(o.StatType.AttributePoints),this.scevent.NewValue=a,this.setStat(o.StatType.AttributePoints,a),this.scevent.Stats=this.stats,s.eventEmitter.emit(s.STATCHANGE_TOPIC,this.scevent),this.setStat(o.StatType.Dust,this.stats[o.StatType.MaxDust]),this.setStat(o.StatType.HP,this.stats[o.StatType.MaxHP]),this.scevent.Type=e,this.scevent.OldValue=0,this.scevent.NewValue=this.stats[o.StatType.LevelExp],this.scevent.Stats=this.stats)),s.eventEmitter.emit(s.STATCHANGE_TOPIC,this.scevent)},t.findExpLevel=function(e){for(var i=0,n=t.expForLevel.length;i<n;i++)if(e<t.expForLevel[i])return i-1},t.prototype.rebuildStats=function(){this.baseStats[o.BaseStatType.MaxHP]=150+10*this.characterLevel,this.baseStats[o.BaseStatType.MaxDust]=600+50*this.characterLevel,this.baseStats[o.BaseStatType.RegenDust]=2+this.characterLevel/2,this.baseStats[o.BaseStatType.RegenHP]=1+this.characterLevel/2,this.stats[o.StatType.MaxHP]=this.baseStats[o.BaseStatType.MaxHP]*(1+this.attributeStats[o.BaseStatType.MaxHP]/10),this.stats[o.StatType.MaxDust]=this.baseStats[o.BaseStatType.MaxDust]*(1+this.attributeStats[o.BaseStatType.MaxDust]/10),this.stats[o.StatType.RegenHP]=this.baseStats[o.BaseStatType.RegenHP]*(1+this.attributeStats[o.BaseStatType.RegenHP]/10),this.stats[o.StatType.RegenDust]=this.baseStats[o.BaseStatType.RegenDust]*(1+this.attributeStats[o.BaseStatType.RegenDust]/10)},t.prototype.updateEvent=function(t,e){this.scevent.Type=t,this.scevent.OldValue=this.stats[t],this.scevent.NewValue=e,this.scevent.Stats=this.stats},t.expForLevel=[],t}();e.stats=new r},24:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(41),s=i(5),a=i(5),o=i(72),r=function(){return function(t,e){this.BodyA=t,this.BodyB=e}}();e.ContactPair=r;var l=function(){function t(){var t=this;this.contactPairs=[],this.contactWatch=[],this.playerBodyContacts=[],this.fixedTimeStep=1/60,this.beginContact=function(e){var i=null,n=null;if(e.bodyA.shapes[0].collisionGroup===o.COL_GRP_BULLET?(i=e.bodyA,n=e.bodyB):e.bodyB.shapes[0].collisionGroup===o.COL_GRP_BULLET&&(i=e.bodyB,n=e.bodyA),i)t.world.emit({type:"bulletContact",playerHit:n===t.playerBody,bulletBody:i,otherBody:n});else{if(t.playerBody===e.bodyA)return t.playerBodyContacts.push(e.bodyB),void t.world.emit({type:"playerContact",velocity:t.playerBody.velocity,body:e.bodyB});if(t.playerBody===e.bodyB)return t.playerBodyContacts.push(e.bodyA),void t.world.emit({type:"playerContact",velocity:t.playerBody.velocity,body:e.bodyA});var s=t.contactWatch.filter(function(t){return t===e.bodyA.id||t===e.bodyB.id});if(s&&s.length>0){var a=new r(e.bodyA,e.bodyB);t.contactPairs.push(a)}}},this.endContact=function(e){if(!(e.bodyA.shapes[0].collisionGroup===o.COL_GRP_BULLET||e.bodyB.shapes[0].collisionGroup===o.COL_GRP_BULLET)){if(t.playerBody===e.bodyA){var i=t.playerBodyContacts.indexOf(e.bodyB);return t.playerBodyContacts.splice(i,1),void t.world.emit({type:"playerContactEnd",velocity:t.playerBody.velocity,body:e.bodyB})}if(t.playerBody===e.bodyB){i=t.playerBodyContacts.indexOf(e.bodyB);return t.playerBodyContacts.splice(i,1),void t.world.emit({type:"playerContactEnd",velocity:t.playerBody.velocity,body:e.bodyA})}for(var n=-1,s=0;s<t.contactPairs.length;s++){var a=t.contactPairs[s];if(a.BodyA===e.bodyA&&a.BodyB===e.bodyB||a.BodyA===e.bodyB&&a.BodyB===e.bodyA){n=s;break}}n>=0&&t.contactPairs.splice(n,1)}},this.world=new n.World({gravity:[0,-1500]}),this.setupMaterials(),this.ground=new n.Body({mass:0});var e=new n.Plane;e.material=this.materials.get("ground_default"),e.collisionGroup=o.COL_GRP_GROUND,e.collisionMask=o.COL_GRP_SCENE|o.COL_GRP_NPC|o.COL_GRP_PLAYER|o.COL_GRP_BULLET,this.ground.addShape(e),this.world.addBody(this.ground),this.playerBody=new n.Body({mass:42,fixedRotation:!0}),this.playerBody.damping=.001,(e=new n.Circle({radius:24})).collisionGroup=o.COL_GRP_PLAYER,e.collisionMask=o.COL_GRP_GROUND|o.COL_GRP_SCENE|o.COL_GRP_NPC|o.COL_GRP_BULLET,e.material=this.materials.get("player"),this.playerBody.addShape(e),this.world.addBody(this.playerBody),this.world.sleepMode=n.World.BODY_SLEEPING,this.world.on("beginContact",this.beginContact,this),this.world.on("endContact",this.endContact,this)}return t.prototype.clearLevel=function(){for(var t=this.world.bodies,e=t.length-1;e>=0;e--){var i=t[e];i!==this.playerBody&&i!==this.ground&&this.world.removeBody(i)}},Object.defineProperty(t.prototype,"bodies",{get:function(){return this.world.bodies},enumerable:!0,configurable:!0}),t.prototype.on=function(t,e,i){i=i||this,this.world.on(t,e,i)},t.prototype.update=function(t){this.world.step(this.fixedTimeStep,t/1e3),s.Global.position.x=this.playerBody.interpolatedPosition[0],s.Global.position.y=this.playerBody.interpolatedPosition[1]},t.prototype.removeBody=function(t){this.world.removeBody(t)},t.prototype.addBody=function(t){if(t.shapes&&t.shapes.length>0)for(var e=0,i=t.shapes.length;e<i;e++){var n=t.shapes[e];n.materialName&&!n.material&&(n.material=this.materials.get(n.materialName))}this.world.addBody(t)},t.prototype.clearContactsForBody=function(t){if(t!==this.playerBody)for(var e=0;e>-1;){e=-1;for(var i=0;i<this.contactPairs.length;i++){var n=this.contactPairs[i];if(n.BodyA===t||n.BodyB===t){e=i;break}}e>=0&&this.contactPairs.splice(e,1)}else this.playerBodyContacts=[]},t.prototype.getContactsForBody=function(t){for(var e=[],i=0,n=this.contactPairs.length;i<n;i++){var s=this.contactPairs[i];s.BodyA!==t&&s.BodyB!==t||e.push(s)}return e},t.prototype.addContactWatch=function(t){this.contactWatch.push(t.id)},Object.defineProperty(t.prototype,"playerContacts",{get:function(){return this.playerBodyContacts},enumerable:!0,configurable:!0}),t.prototype.setupMaterials=function(){this.materials=new a.Dictionary,this.materials.set("player",new n.Material(n.Material.idCounter++)),this.materials.set("ground_default",new n.Material(n.Material.idCounter++)),this.materials.set("box_default",new n.Material(n.Material.idCounter++)),this.materials.set("box_highfriction",new n.Material(n.Material.idCounter++)),this.materials.set("mob_default",new n.Material(n.Material.idCounter++)),this.materials.set("bumper",new n.Material(n.Material.idCounter++));var t=new n.ContactMaterial(this.materials.get("player"),this.materials.get("ground_default"),{friction:.85,restitution:.1,stiffness:n.Equation.DEFAULT_STIFFNESS,relaxation:n.Equation.DEFAULT_RELAXATION,frictionStiffness:n.Equation.DEFAULT_STIFFNESS,frictionRelaxation:n.Equation.DEFAULT_RELAXATION,surfaceVelocity:0});this.world.addContactMaterial(t);var e=new n.ContactMaterial(this.materials.get("player"),this.materials.get("mob_default"),{friction:.1,restitution:.4,stiffness:n.Equation.DEFAULT_STIFFNESS,relaxation:n.Equation.DEFAULT_RELAXATION,frictionStiffness:n.Equation.DEFAULT_STIFFNESS,frictionRelaxation:n.Equation.DEFAULT_RELAXATION,surfaceVelocity:0});this.world.addContactMaterial(e);var i=new n.ContactMaterial(this.materials.get("player"),this.materials.get("box_default"),{friction:.2,restitution:.25,stiffness:n.Equation.DEFAULT_STIFFNESS,relaxation:n.Equation.DEFAULT_RELAXATION,frictionStiffness:n.Equation.DEFAULT_STIFFNESS,frictionRelaxation:n.Equation.DEFAULT_RELAXATION,surfaceVelocity:0});this.world.addContactMaterial(i);var s=new n.ContactMaterial(this.materials.get("player"),this.materials.get("box_highfriction"),{friction:.7,restitution:.2,stiffness:n.Equation.DEFAULT_STIFFNESS,relaxation:n.Equation.DEFAULT_RELAXATION,frictionStiffness:n.Equation.DEFAULT_STIFFNESS,frictionRelaxation:n.Equation.DEFAULT_RELAXATION,surfaceVelocity:0});this.world.addContactMaterial(s);var o=new n.ContactMaterial(this.materials.get("player"),this.materials.get("bumper"),{friction:.35,restitution:.75,stiffness:Number.MAX_VALUE,relaxation:n.Equation.DEFAULT_RELAXATION,frictionStiffness:Number.MAX_VALUE,frictionRelaxation:n.Equation.DEFAULT_RELAXATION,surfaceVelocity:0});this.world.addContactMaterial(o);var r=new n.ContactMaterial(this.materials.get("box_default"),this.materials.get("ground_default"),{friction:.8,restitution:.3,stiffness:n.Equation.DEFAULT_STIFFNESS,relaxation:n.Equation.DEFAULT_RELAXATION,frictionStiffness:n.Equation.DEFAULT_STIFFNESS,frictionRelaxation:n.Equation.DEFAULT_RELAXATION,surfaceVelocity:0});this.world.addContactMaterial(r)},t}();e.WorldP2=l,e.wp2=new l},259:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(7),s=i(5),a=i(260),o=i(5),r=["assets/cur_default.png","assets/cur_hover.png","assets/cur_target.png","assets/levels.json","assets/quests.json"],l=function(t){function e(e){var i=t.call(this,e,"Boot")||this;return i.onUpdate=function(t){i.spinner&&(i.spinner.rotation+=.05)},i.onActivate=function(){i.loadingMessage=new s.PIXI.Text("booting ...",{fontSize:"36px",fontFamily:"Permanent Marker",fill:65280,dropShadow:!0,stroke:4521796,strokeThickness:1}),i.loadingMessage.anchor.set(.5,.5),i.loadingMessage.position.set(o.SCENE_HALF_WIDTH,o.SCENE_HALF_HEIGHT-80),i.addChild(i.loadingMessage),s.PIXI.loader.reset().add("assets/loading.png").load(i.startPreloading)},i.startPreloading=function(){return n.__awaiter(i,void 0,void 0,function(){var t;return n.__generator(this,function(e){return t=s.PIXI.Texture.fromImage("assets/loading.png"),this.spinner=new s.PIXI.Sprite(t),this.spinner.position.set(o.SCENE_HALF_WIDTH,o.SCENE_HALF_HEIGHT),this.spinner.anchor.set(.5,.5),this.spinner.scale.set(.5),this.addChild(this.spinner),console.log("initializing common assets preloading ...",r),s.PIXI.loader.add(r).load(this.onPreloadFinished),[2]})})},i.onPreloadFinished=function(){return n.__awaiter(i,void 0,void 0,function(){var t,e,i;return n.__generator(this,function(n){return t="url('assets/cur_default.png'),auto","url('assets/cur_hover.png'),auto","url('assets/cur_target.png') 24 24, auto",this.sceneManager.Renderer.plugins.interaction.cursorStyles.default=t,this.sceneManager.Renderer.plugins.interaction.cursorStyles.hover="url('assets/cur_hover.png'),auto",this.sceneManager.Renderer.plugins.interaction.cursorStyles.target="url('assets/cur_target.png') 24 24, auto",document.body.style.cursor=t,s.Global.LevelDefinitions=s.PIXI.loader.resources["assets/levels.json"].data,e=s.PIXI.loader.resources["assets/quests.json"].data,s.Global.LevelDefinitions.quests=e.quests,s.Global.LevelDefinitions.quests.forEach(function(t){t.itemId=t.itemId||0,t.itemsNeeded=t.itemsNeeded||0,t.itemsCollected=0,t.rewardCoins=t.rewardCoins||0,t.rewardExp=t.rewardExp||0}),i=new a.LoaderScene(this.sceneManager),this.sceneManager.AddScene(i),this.sceneManager.ActivateScene(i),[2]})})},i.BackGroundColor=0,i}return n.__extends(e,t),e}(s.Scene);e.BootScene=l},260:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(7),s=i(5),a=i(126),o=i(21),r=i(15),l=i(277),u=i(278),c=i(287),p=i(288),d=function(t){function e(e){var i=t.call(this,e,"Loader")||this;i.preloadAssets=["assets/gui-atlas.json","assets/objects-atlas.json","assets/entities-atlas.json","assets/background-atlas.json"],i.onUpdate=function(t){i.spinner&&(i.spinner.rotation+=.05)},i.onActivate=function(){console.log("downloading level "+o.stats.currentGameLevel+"...");var t=a.GetLevelAssets(s.Global.LevelDefinitions,o.stats.currentGameLevel);t=t.concat(i.preloadAssets,"assets/font/orbitron.fnt","assets/font/orbitron_outline.fnt","assets/font/bauhaus.fnt"),t=a.getUniqueItems(t),s.PIXI.loader.reset().add(t).load(i.handleLevelLoading).on("progress",i.onProgress)},i.handleLevelLoading=function(){i.sceneManager.HasScene("Main")||(console.log("adding scenes..."),i.sceneManager.AddScene(new u.MainScene(i.sceneManager)),i.sceneManager.AddScene(new c.OptionsScene(i.sceneManager)),i.sceneManager.AddScene(new p.CutScene(i.sceneManager)),i.sceneManager.MasterHudOverlay=new l.MasterHud(i.sceneManager));try{var t=i.sceneManager.GetScene("Main");setTimeout(function(){t.startLevel()},200)}catch(t){console.log("exception: ",t)}},i.onProgress=function(t,e){var n=t.progress;console.log("progress: "+n.toFixed(0)+"%, asset: "+e.name),i.loadingMessage.text="Loading "+n.toFixed(0)+" %"},i.BackGroundColor=0,i.loadingMessage=new s.PIXI.Text("loading ...",{fontSize:36,fontFamily:"Permanent Marker",fill:65280,dropShadow:!0,align:"center",stroke:4521796,strokeThickness:1}),i.loadingMessage.anchor.set(.5,.5),i.loadingMessage.position.set(r.SCENE_HALF_WIDTH,r.SCENE_HALF_HEIGHT-80),i.addChild(i.loadingMessage);var n=s.PIXI.Texture.fromImage("assets/loading.png");return i.spinner=new s.PIXI.Sprite(n),i.spinner.position.set(r.SCENE_HALF_WIDTH,r.SCENE_HALF_HEIGHT),i.spinner.anchor.set(.5,.5),i.spinner.scale.set(.5),i.addChild(i.spinner),i}return n.__extends(e,t),e}(s.Scene);e.LoaderScene=d},273:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(40),s=i(24),a=i(5),o=i(21),r=i(5),l=function(){function t(t,e,i,n,s,a,o,r){void 0===r&&(r=!0),this.name=t,this.x=e,this.y=i,this.area=n,this.maxMobCount=s,this.respawnSeconds=a,this.entity=o,this.active=r,this.mobCount=0,this.nextSpawn=0,this.nextSpawn=performance.now()/1e3}return Object.defineProperty(t.prototype,"IsActive",{get:function(){return this.active},set:function(t){this.active=t},enumerable:!0,configurable:!0}),t.prototype.onUpdate=function(t){var e=this;if(this.active&&this.mobCount<this.maxMobCount){var i=performance.now()/1e3;if(this.nextSpawn<=i){this.worldContainer||(this.worldContainer=r.Global.getScm().GetScene("Main").worldContainer);var l=n.LevelLoader.createMob(o.stats.currentLevel.templates,this.entity),u=l.DisplayObject,c=this.x+Math.random()*this.area-this.area/2,p=this.y;l.position=[c,p],s.wp2.addBody(l),u.position.set(c,p),u.visible=!1,u.isLoading=!0,this.worldContainer.addChild(u);var d=new a.AnimatedSprite;d.addAnimations(new a.AnimationSequence("load","assets/entities-atlas.json@load.png",[0,1,2,3],64,64)),d.anchor.set(.5),d.position.set(c,p+10),d.play("load",4,!0),d.scale.set(1,-1),this.worldContainer.addChild(d),setTimeout(function(){e.worldContainer.removeChild(d),u.isLoading=!1,u.visible=!0},3e3),u.onDeath=function(){console.log("mob died"),e.mobCount--},this.mobCount++,this.nextSpawn=performance.now()/1e3+this.respawnSeconds}}},t}();e.SpawnPoint=l},275:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(7),s=function(t){function e(e){return t.call(this,e)||this}return n.__extends(e,t),e.prototype.canFire=function(){var t=performance.now(),e=2e3*Math.random(),i=this.lastFire+this.attackCD+e<=t;if(i){var n=Math.random();i=i&&n>.3,this.lastFire=performance.now()}return i},e}(i(276).AI);e.BasicStaticAI=s},276:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(20),s=i(18),a=800,o=1050,r=function(){function t(t){var e=this;this.mobEntity=t,this.lastFire=0,this.onUpdate=function(t){e.calcDistance(),e.targetDistance<o&&e.turnTowardsTarget(),e.targetDistance<a?(e.hasTarget=!0,e.canFire()&&(e.mobEntity.attack(),e.lastFire=performance.now())):e.hasTarget=!1},this.attackCD=t.attributes[s.AtrType.AtkCD]}return t.prototype.calcDistance=function(){var t=n.position.x-this.mobEntity.x,e=n.position.y-this.mobEntity.y;this.targetDistance=Math.sqrt(t*t+e*e)},t.prototype.turnTowardsTarget=function(){var t=n.position.x-this.mobEntity.x;t<0&&this.mobEntity.direction!=s.DirectionH.Left?this.mobEntity.direction=s.DirectionH.Left:t>0&&this.mobEntity.direction!=s.DirectionH.Right&&(this.mobEntity.direction=s.DirectionH.Right)},t.prototype.canFire=function(){var t=performance.now();return this.lastFire+this.attackCD<=t},t}();e.AI=r},277:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(7),s=i(5),a=s.SCENE_WIDTH-48,o=4,r=1,l=function(t){function e(e){var i=t.call(this)||this;i.sceneManager=e,["","webkit","moz","ms"].forEach(function(t){return document.addEventListener(t+"fullscreenchange",function(t){i.isFullScreen?n.setTexture("assets/gui-atlas.json@gui_fs_exit.png"):n.setTexture("assets/gui-atlas.json@gui_fs_enter.png"),n.scale.set(r)},!1)});var n=new s.Button("assets/gui-atlas.json@gui_fs_enter.png",a,o);n.onClick=function(){return i.toggleFullScreen()},n.scale.set(r),i.addChild(n);var l=new s.Button("assets/gui-atlas.json@gui_options.png",a-48,o);return l.onClick=function(){return i.sceneManager.ActivateScene("Options")},l.name="BTN_OPTIONS",l.scale.set(r),i.addChild(l),i}return n.__extends(e,t),Object.defineProperty(e.prototype,"isFullScreen",{get:function(){var t=document;return!!(t.fullscreenElement||t.mozFullScreenElement||t.webkitFullscreenElement||t.msFullscreenElement)},enumerable:!0,configurable:!0}),e.prototype.toggleFullScreen=function(){var t=document,e=document.documentElement,i=e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullScreen||e.msRequestFullscreen,n=t.exitFullscreen||t.mozCancelFullScreen||t.webkitExitFullscreen||t.msExitFullscreen;this.isFullScreen?n.call(t):i.call(e)},e}(PIXI.Container);e.MasterHud=l},278:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(7),s=i(41),a=i(48),o=i(5),r=i(24),l=i(279),u=i(281),c=i(21),p=i(155),d=i(31),h=i(15),m=i(282),f=i(40),y=i(283),v=i(284),g=i(34),S=i(285),T=i(18),b=function(t){function e(e){var i=t.call(this,e,"Main")||this;return i.shakeDuration=0,i.shakeEnd=0,i.nextShake=0,i.magnitude=0,i.SHAKE_COUNT=15,i.startGroundShake=function(t){i.shakeEnd=performance.now()+t.milliSeconds,i.magnitude=t.magnitudeInPixels,i.shakeDuration=t.milliSeconds/i.SHAKE_COUNT},i.BackGroundColor=h.SCENE_BACKCOLOR,i.setup(),i}return n.__extends(e,t),e.prototype.onUpdate=function(t,e){r.wp2.update(t),this.worldContainer.x=h.SCENE_HALF_WIDTH-this.hero.x,this.worldContainer.y=h.SCENE_HEIGHT-70,a.update(e),c.stats.currentLevel.parallax.forEach(function(t){t.SetViewPortX(o.Global.position.x),t.position.x=o.Global.position.x-h.SCENE_HALF_WIDTH});for(var i=r.wp2.bodies,n=0,l=i.length;n<l;n++){var u=(f=i[n]).DisplayObject;if(u&&u.visible&&f.type!==s.Body.STATIC&&(u.position.set(Math.floor(f.interpolatedPosition[0]),Math.floor(f.interpolatedPosition[1])),u.rotation=f.interpolatedAngle),f.Trigger&&"distance"===f.Trigger.type&&this.questMngr.canActivateTrigger(f.Trigger)){var p=this.hero.position.x-f.position[0],d=this.hero.position.y-f.position[1],m=Math.sqrt(p*p+d*d);f.Trigger.distance>=m&&this.questMngr.handleTriggerEvent(f)}}for(n=0,l=r.wp2.playerContacts.length;n<l;n++){var f;(f=r.wp2.playerContacts[n]).DisplayObject&&f.DisplayObject.interactionType&&this.handleInteractiveCollision(f),f.Trigger&&"collision"===f.Trigger.type&&this.questMngr.handleTriggerEvent(f)}for(n=0,l=this.worldContainer.children.length;n<l;n++){var y=this.worldContainer.children[n];y&&y.onUpdate&&y.onUpdate(t)}for(n=0,l=c.stats.currentLevel.spawnPoints.length;n<l;n++)c.stats.currentLevel.spawnPoints[n].onUpdate(t);this.hud.onUpdate(t),c.stats.onUpdate(t);var v=performance.now();if(c.stats.getStat(T.StatType.HP)<=0){this.IsHeroInteractive=!1,this.hero.visible=!1;var g=this.sceneManager.GetScene("CutScene"),S=this.sceneManager.CaptureScene();g.SetBackGround(S,this.scale),g.DeathScene=!0,this.sceneManager.ActivateScene(g)}else if(this.shakeEnd>=v){if(this.nextShake<=v){p=h.SCENE_HALF_WIDTH-this.hero.x,d=h.SCENE_HEIGHT-70;this.shakeX=p+this.randomRange(-this.magnitude/2,this.magnitude/2),this.shakeY=d+this.randomRange(-this.magnitude,this.magnitude),this.magnitude-=this.magnitude/this.SHAKE_COUNT,this.nextShake=v+this.shakeDuration}this.worldContainer.x=this.shakeX,this.worldContainer.y=this.shakeY}},e.prototype.setup=function(){this.worldContainer=new o.PIXI.Container,this.worldContainer.scale.y=-1,this.addChild(this.worldContainer),o.Global.worldContainer=this.worldContainer,this.hero=new l.HeroCharacter(this.worldContainer),this.hero.name="hero",this.hero.x=h.SCENE_HALF_WIDTH,this.worldContainer.addChild(this.hero),this.hero.play("idle",h.ANIMATION_FPS_SLOW),this.hud=new u.StatsHud,this.HudOverlay=this.hud,f.LevelLoader.registerFactory("Lava",function(t){return new m.Lava(t.texture)}),f.LevelLoader.registerFactory("Platform",function(t){return"string"==typeof t.texture?new y.Platform(t.tilesX||1,1,[t.texture]):new y.Platform(t.tilesX||1,t.tilesY||1,t.texture)}),f.LevelLoader.registerFactory("Bumper",function(t){return new v.Bumper}),this.questMngr=new S.QuestManager(this),d.eventEmitter.on(d.BURN_TOPIC,function(t){return t.isBurning?g.snd.burn():g.snd.burnStop()}),d.eventEmitter.on(d.GROUND_SHAKE,this.startGroundShake)},e.prototype.startLevel=function(){var t=this;this.clearLevel(),c.stats.loadLevel(),g.snd.playTrack(c.stats.currentLevel.audioTrack||0),c.stats.currentLevel.parallax.forEach(function(e,i){t.worldContainer.addChildAt(e,i),e.SetViewPortX(c.stats.currentLevel.start[0])}),c.stats.currentLevel.entities.forEach(function(e){t.worldContainer.addChild(e.DisplayObject),e.shapes&&e.shapes.length>0&&r.wp2.addBody(e)}),r.wp2.playerBody.position[0]=c.stats.currentLevel.start[0],r.wp2.playerBody.position[1]=c.stats.currentLevel.start[1],this.questMngr.reset(),this.hero.visible=!0,this.IsHeroInteractive=!0,this.hud.visible=!0,this.sceneManager.ActivateScene(this)},Object.defineProperty(e.prototype,"IsHeroInteractive",{set:function(t){this.hero.IsInteractive!==t&&(this.hero.IsInteractive=t,this.hero.IsInteractive||(this.hero.play("idle",h.ANIMATION_FPS_SLOW),g.snd.idle()))},enumerable:!0,configurable:!0}),e.prototype.collectObject=function(t){var e=this,i=t.DisplayObject,n=i.scale.x,s=i.position.x+45,o=i.position.y+160,r=i.position.x-h.SCENE_HALF_WIDTH,l=h.SCENE_HEIGHT,u=new a.Tween(i.position).to({x:s,y:o},150),c=new a.Tween(i.scale).to({x:n+.5,y:n+.5},500).easing(a.Easing.Linear.None),p=new a.Tween(i.position).to({x:r,y:l},2e3).easing(a.Easing.Back.In).onComplete(function(){return e.worldContainer.removeChild(i)});u.chain(c,p).start(),this.removeEntity(t)},e.prototype.handleInteractiveCollision=function(t){var e=t.DisplayObject;switch(t.DisplayObject.interactionType){case 1:c.stats.increaseStat(T.StatType.Coins,1),this.collectObject(t),this.hud.addInfoMessage(e.position,"+1 coin",h.MSG_COIN_STYLE,-100),g.snd.coin();break;case 2:c.stats.increaseStat(T.StatType.Coins,10),this.collectObject(t),this.hud.addInfoMessage(e.position,"+10 coins",h.MSG_COIN_STYLE,-100),g.snd.coin();break;case 3:c.stats.increaseStat(T.StatType.Coins,100),this.collectObject(t),this.hud.addInfoMessage(e.position,"+100 coins",h.MSG_COIN_STYLE,-100),g.snd.gem();break;case 201:this.hud.addInfoMessage(e.position,"Kendo knowledge acquired!",h.MSG_COIN_STYLE),this.collectObject(t),g.snd.questItem(),this.questMngr.acquireItem(201);break;case 202:this.hud.addInfoMessage(e.position,"1 Ki acquired!",h.MSG_COIN_STYLE),this.collectObject(t),g.snd.questItem(),this.questMngr.acquireItem(202);break;case T.DamageType.LavaBorder:var i=performance.now()/1e3;(!c.stats.buffs[T.DamageType.LavaBorder]||c.stats.buffs[T.DamageType.LavaBorder]<i)&&this.hud.addInfoMessage(e.position,"Burning",h.MSG_WARN_STYLE,100),c.stats.buffs[T.DamageType.LavaBorder]=this.secondsFromNow(1);break;case T.DamageType.Lava:i=performance.now()/1e3;(!c.stats.buffs[T.DamageType.Lava]||c.stats.buffs[T.DamageType.Lava]<i)&&this.hud.addInfoMessage(e.position,"Burning",h.MSG_WARN_STYLE,100),c.stats.buffs[T.DamageType.Lava]=this.secondsFromNow(4)}},e.prototype.secondsFromNow=function(t){var e=performance.now()/1e3;return e+=t},e.prototype.removeEntity=function(t,e){void 0===e&&(e=!1),r.wp2.removeBody(t),e&&this.worldContainer.removeChild(t.DisplayObject),t.DisplayObject=null},e.prototype.clearLevel=function(){var t=this;c.stats.currentLevel&&(c.stats.currentLevel.parallax.forEach(function(e,i){t.worldContainer.removeChild(e)}),c.stats.currentLevel.entities.forEach(function(e){e!==r.wp2.playerBody&&(t.worldContainer.removeChild(e.DisplayObject),r.wp2.removeBody(e),e.DisplayObject=null)}),this.worldContainer.children.filter(function(t){return"hero"!==t.name}).forEach(function(e){t.worldContainer.removeChild(e)}),r.wp2.clearLevel(),p.Bullet.reset())},e.prototype.randomRange=function(t,e){return t+Math.random()*(e-t)},e}(o.Scene);e.MainScene=b},279:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(7),s=i(48),a=i(20),o=i(5),r=i(31),l=i(5),u=i(280),c=i(24),p=i(21),d=i(154),h=i(40),m=i(34),f=i(18),y=64,v=function(t){function e(e){var i=t.call(this)||this;i.container=e,i.onUpdate=function(e){switch(i.position.x=l.Global.position.x,i.position.y=l.Global.position.y,i.IsInteractive&&i.movementCtrl.update(e),i.movementCtrl.MovementState){case u.MovementState.Idle:i.emitterPixies.emit=!1;break;case u.MovementState.Left:case u.MovementState.JumpLeft:i.emitterPixies.emit=i.movementCtrl.IsRunning,i.emitterPixies.minStartRotation=-25,i.emitterPixies.maxStartRotation=25;break;case u.MovementState.Right:case u.MovementState.JumpRight:i.emitterPixies.emit=i.movementCtrl.IsRunning,i.emitterPixies.minStartRotation=155,i.emitterPixies.maxStartRotation=205;break;case u.MovementState.JumpUp:i.emitterPixies.emit=i.movementCtrl.IsRunning,i.emitterPixies.minStartRotation=245,i.emitterPixies.maxStartRotation=295}if(i.emitterPixies.update(.001*e),i.emitterPixies.updateOwnerPos(i.position.x,i.position.y),i.emitterBurn.update(.001*e),i.movementCtrl.IsRunning&&i.movementCtrl.MovementState!==u.MovementState.Idle){p.stats.increaseStat(f.StatType.Dust,.005*-e);var n=8*Math.PI/180;i.rotation=i.movementCtrl.MovementState===u.MovementState.Left?n:-n}else i.rotation=0;i.emitterBurn.emit=p.stats.isBurning,t.prototype.onUpdate.call(i,e)},i.onPlayerMove=function(t){var e=t.newState,n=t.isRunning?1.6*o.ANIMATION_FPS_NORMAL:o.ANIMATION_FPS_NORMAL;switch(e){case u.MovementState.Idle:i.idleAnimationTimeoutHandle&&clearTimeout(i.idleAnimationTimeoutHandle),i.idleAnimationTimeoutHandle=setTimeout(function(){i.play("idle",o.ANIMATION_FPS_SLOW),m.snd.idle()},300);break;case u.MovementState.Left:clearTimeout(i.idleAnimationTimeoutHandle),i.play("left",n),m.snd.walk(t.isRunning);break;case u.MovementState.Right:clearTimeout(i.idleAnimationTimeoutHandle),i.play("right",n),m.snd.walk(t.isRunning);break;case u.MovementState.JumpLeft:clearTimeout(i.idleAnimationTimeoutHandle),i.play("jumpleft",n),m.snd.jump();break;case u.MovementState.JumpRight:clearTimeout(i.idleAnimationTimeoutHandle),i.play("jumpright",n),m.snd.jump();break;case u.MovementState.JumpUp:clearTimeout(i.idleAnimationTimeoutHandle),i.play("jumpup",n),m.snd.jump();break;case u.MovementState.JumpDownLeft:clearTimeout(i.idleAnimationTimeoutHandle),i.play("jumpdownleft",n,!1),m.snd.jumpAttack();break;case u.MovementState.JumpDownRight:clearTimeout(i.idleAnimationTimeoutHandle),i.play("jumpdownright",n,!1),m.snd.jumpAttack();break;case u.MovementState.JumpDown:clearTimeout(i.idleAnimationTimeoutHandle),i.play("jumpdown",n,!1),m.snd.jumpAttack()}},i.movementCtrl=new u.MovementController(c.wp2),c.wp2.on("playerContact",i.onPlayerContact,i),c.wp2.on("bulletContact",i.onBulletContact,i);var n={alpha:{start:.7,end:0},blendMode:"normal",frequency:.01,startRotation:{min:265,max:275},color:{start:"#ffffff",end:"#ff5050"},speed:{start:1,end:.5,minimumSpeedMultiplier:1},scale:{start:.2,end:.6},maxParticles:20,lifetime:{min:.25,max:.75},spawnType:"circle",spawnCircle:{x:0,y:y-25,r:25}};i.emitterBurn=a.createParticleEmitter(i,[o.TextureLoader.Get("assets/entities-atlas.json@flame.png")],n),i.emitterPixies=a.createParticleEmitter(e,[o.TextureLoader.Get("assets/objects-atlas.json@star.png")]);var s="assets/objects-atlas.json@hero.png";return i.addAnimations(new l.AnimationSequence("right",s,[18,19,20,21,22,23],y,y)),i.addAnimations(new l.AnimationSequence("left",s,[12,13,14,15,16,17],y,y)),i.addAnimations(new l.AnimationSequence("jumpleft",s,[24,25,26,27,28,29],y,y)),i.addAnimations(new l.AnimationSequence("jumpright",s,[30,31,32,33,34,35],y,y)),i.addAnimations(new l.AnimationSequence("jumpup",s,[1,3,4,6],y,y)),i.addAnimations(new l.AnimationSequence("idle",s,[1,1,0,1,2,3,,4,5,13,12,6,7,11,18,19,0],y,y)),i.addAnimations(new l.AnimationSequence("jumpdownleft",s,[36,37,38],y,y)),i.addAnimations(new l.AnimationSequence("jumpdownright",s,[39,40,41],y,y)),i.addAnimations(new l.AnimationSequence("jumpdown",s,[42,43,44],y,y)),i.anchor.set(.5,.58),i.scale.y*=-1,r.eventEmitter.on(r.MOVE_TOPIC,i.onPlayerMove),i}return n.__extends(e,t),Object.defineProperty(e.prototype,"IsInteractive",{get:function(){return this.movementCtrl.isInteractive},set:function(t){this.movementCtrl.isInteractive=t},enumerable:!0,configurable:!0}),e.prototype.onPlayerContact=function(t){var e=this,i=t.body,n=t.body.DisplayObject,s=Math.abs(t.velocity[1]);if(s>505){n instanceof d.Mob&&(n.isLoading||this.handleMobInteraction(n,i));var a=this.movementCtrl.MovementState;if(a===u.MovementState.JumpDown||a===u.MovementState.JumpDownLeft||a===u.MovementState.JumpDownRight)return m.snd.jumpContact(),void r.eventEmitter.emit(r.GROUND_SHAKE,{milliSeconds:600,magnitudeInPixels:9})}if(s>450){console.log("Vert velocity: "+s);var o=new l.AnimatedSprite;o.addAnimations(new l.AnimationSequence("smoke","assets/entities-atlas.json@jump_smoke.png",[0,1,2,3,4,5],y,y)),o.anchor.set(.5),o.pivot.set(.5),o.x=this.x,o.y=this.y-25,o.alpha=.7,o.rotation=Math.random()*Math.PI,this.container.addChild(o),o.onComplete=function(){return e.container.removeChild(o)},o.play("smoke",6,!1)}s>400&&(m.snd.jumpContact(),console.log("velocity: "+t.velocity))},e.prototype.onBulletContact=function(t){var e=this,i=t.bulletBody.DisplayObject;if(!i.IsDead){if(t.playerHit)m.snd.hitPain(),p.stats.increaseStat(f.StatType.HP,-i.damage);else{var n=new l.AnimatedSprite;n.addAnimations(new l.AnimationSequence("exp","assets/entities-atlas.json@slime_atk_exp.png",[0,1,2,3,4,5],32,32)),n.anchor.set(.5),n.pivot.set(.5),n.x=i.x,n.y=i.y,n.alpha=.7,n.rotation=Math.random()*Math.PI,this.container.addChild(n),n.onComplete=function(){return e.container.removeChild(n)},n.play("exp",10,!1),m.snd.bulletHitWall()}i.IsDead=!0}},e.prototype.handleMobInteraction=function(t,e){var i=this,n=e.DisplayObject,s=n;if(s.drop&&Math.random()<=s.drop.chance){var a=h.LevelLoader.createEntity(p.stats.currentLevel.templates,s.drop.entity);this.addDropItem(t,a)}this.removeEntity(e),t.squish(function(){return i.container.removeChild(n)});var o=t.attributes[f.AtrType.HP]/2;p.stats.increaseStat(f.StatType.TotalExp,o)},e.prototype.addDropItem=function(t,e){var i=e.DisplayObject;i.x=t.x,i.y=t.y+40,this.container.addChild(i);var n=i.position.x+75,a=i.position.y+200,o=new s.Tween(i.position).to({x:n,y:a},400).onComplete(function(){e.position=[i.position.x,i.position.y],c.wp2.addBody(e)}),r=i.scale.x,l=i.scale.y,u=new s.Tween(i.scale).to({x:r+.3,y:r+.3},350).easing(s.Easing.Linear.None),p=this.x,d=this.y+8,h=new s.Tween(i.position).to({x:p,y:d},350).easing(s.Easing.Back.In).onUpdate(function(t){e.position=[i.position.x,i.position.y]}).onComplete(function(){return i.scale.set(r,l)});o.chain(u,h).start()},e.prototype.removeEntity=function(t,e){void 0===e&&(e=!1),c.wp2.removeBody(t),e&&this.container.removeChild(t.DisplayObject),t.DisplayObject=null},e}(l.AnimatedSprite);e.HeroCharacter=v},280:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,s=i(5),a=i(21),o=i(31),r=i(18),l=function(){function t(t){this.VELOCITY=150,this.JUMP_FORCE=17e3,this.JUMP_ATTACK_FORCE=-17e3,this.JUMP_COOLDOWN=500,this.JUMP_ATTACK_COOLDOWN=1e3,this.JUMP_ATTACK_FREEZE=800,this.nextJumpAllowed=0,this.nextJumpDownAllowed=0,this.movementState=-1,this.kbd=new s.KeyboardMapper,this.isRunning=!1,this.isJumping=!1,this.newState=n.Idle,this._isInteractive=!0,this.world=t}return Object.defineProperty(t.prototype,"isInteractive",{get:function(){return this._isInteractive},set:function(t){this._isInteractive=t,this._isInteractive||(this.isRunning=!1,this.movementState=n.Idle)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsJumping",{get:function(){return this.isJumping},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CanJump",{get:function(){return!this.isJumping&&this.nextJumpAllowed<performance.now()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsRunning",{get:function(){return this.isRunning},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MovementState",{get:function(){return this.movementState},enumerable:!0,configurable:!0}),t.prototype.StartJump=function(t){var e;t===n.JumpUp?e=[0,this.JUMP_FORCE]:t===n.JumpLeft?e=[.1*-this.JUMP_FORCE,this.JUMP_FORCE]:t===n.JumpRight&&(e=[.1*this.JUMP_FORCE,this.JUMP_FORCE]),this.world.playerBody.applyImpulse(e),this.world.clearContactsForBody(this.world.playerBody),this.nextJumpAllowed=performance.now()+this.JUMP_COOLDOWN},t.prototype.StartJumpDown=function(){var t=this;switch(this.movementState){case n.Left:case n.JumpLeft:this.newState=n.JumpDownLeft;break;case n.Right:case n.JumpRight:this.newState=n.JumpDownRight;break;default:this.newState=n.JumpDown}console.log("state change: "+n[this.movementState]+" -> "+n[this.newState]);var e=[0,this.JUMP_ATTACK_FORCE];this.world.playerBody.setZeroForce(),this.world.playerBody.applyImpulse(e),this.nextJumpDownAllowed=performance.now()+this.JUMP_ATTACK_COOLDOWN,this.isInteractive=!1,setTimeout(function(){return t.isInteractive=!0},this.JUMP_ATTACK_FREEZE),o.eventEmitter.emit(o.MOVE_TOPIC,{newState:this.newState,oldState:this.movementState,isJumping:!0,isRunning:!1}),this.movementState=this.newState},t.prototype.update=function(t){if(this.newState=n.Idle,Math.abs(this.world.playerBody.velocity[1])>.01){var e=this.world.playerContacts.every(function(t){return t.shapes[0].sensor});this.isJumping=e}else this.isJumping=!1;var i=this.calcMovementVelocity();if(this.isJumping&&this._isInteractive)return(this.kbd.isKeyDown(83)||this.kbd.isKeyDown(40))&&a.stats.HasJumpAtack&&this.nextJumpDownAllowed<performance.now()&&this.StartJumpDown(),void(this.world.playerBody.velocity[0]+=i);this.world.playerBody.velocity[0]=i;var s=a.stats.getStat(r.StatType.Dust)>1,l=this.kbd.isKeyDown(16)&&s&&this._isInteractive;if(this.kbd.isKeyDown(65)||this.kbd.isKeyDown(37)?this.newState=n.Left:(this.kbd.isKeyDown(68)||this.kbd.isKeyDown(39))&&(this.newState=n.Right),(this.kbd.isKeyDown(87)||this.kbd.isKeyDown(38)||this.kbd.isKeyDown(32))&&this.CanJump&&(this.movementState===n.Left?this.newState=n.JumpLeft:this.movementState===n.Right?this.newState=n.JumpRight:this.movementState===n.Idle&&(this.newState=n.JumpUp,l=!1)),this.newState!==this.movementState||l!==this.IsRunning){var u=!1;switch(this.newState){case n.JumpLeft:this.StartJump(n.JumpLeft),u=!0;break;case n.JumpRight:this.StartJump(n.JumpRight),u=!0;break;case n.JumpUp:this.StartJump(n.JumpUp),u=!0}o.eventEmitter.emit(o.MOVE_TOPIC,{newState:this.newState,oldState:this.movementState,isJumping:u,isRunning:l})}this.movementState=this.newState,this.isRunning=l},t.prototype.calcMovementVelocity=function(){var t=0;return this.movementState===n.Left||this.movementState===n.JumpLeft?t=-1:this.movementState!==n.Right&&this.movementState!==n.JumpRight||(t=1),this.IsJumping?.2*t:t*this.VELOCITY*(this.IsRunning?2:1)},t}();e.MovementController=l,function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Idle=2]="Idle",t[t.JumpLeft=3]="JumpLeft",t[t.JumpRight=4]="JumpRight",t[t.JumpUp=5]="JumpUp",t[t.JumpDownLeft=6]="JumpDownLeft",t[t.JumpDownRight=7]="JumpDownRight",t[t.JumpDown=8]="JumpDown"}(n=e.MovementState||(e.MovementState={}))},281:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(7),s=i(48),a=i(5),o=i(20),r=i(21),l=i(31),u=i(15),c=i(18),p=function(t){function e(){var e=t.call(this)||this;return e.questMsgEndTime=0,e.handleDpsChange=function(t){e.addInfoMessage(a.Global.position,t.Amount+" HP",u.MSG_HP_STYLE,50)},e.handleStatChange=function(t){switch(t.Type){case c.StatType.Coins:e.txtCoins.text=t.NewValue.toString();break;case c.StatType.Dust:e.txtDust.text=t.NewValue.toFixed(0)+" / "+t.Stats[c.StatType.MaxDust].toFixed(0);break;case c.StatType.MaxDust:e.txtDust.text=Math.floor(t.Stats[c.StatType.Dust])+" / "+t.NewValue.toFixed(0);break;case c.StatType.HP:e.txtHP.text=Math.round(t.NewValue)+" / "+t.Stats[c.StatType.MaxHP];break;case c.StatType.MaxHP:e.txtHP.text=Math.round(t.Stats[c.StatType.HP])+" / "+t.NewValue;break;case c.StatType.TotalExp:var i=t.NewValue-t.OldValue;0!=i&&e.addInfoMessage({x:0,y:90},"+"+i+" exp",u.MSG_EXP_STYLE,-50),e.renderExp(t);break;case c.StatType.CharacterLevel:e.handleLevelUp(t)}},e.handleLevelUp=function(t){e.txtExp.text=Math.round(t.Stats[c.StatType.LevelExp])+" / "+t.Stats[c.StatType.LevelMaxExp],e.expFiller.width=1,e.addLvlUpMessage("Level "+t.NewValue),e.txtLevel.text="Level "+r.stats.characterLevel},e.setup(),e}return n.__extends(e,t),e.prototype.setup=function(){this.txtPlayerPosition=new PIXI.extras.BitmapText("",u.QUEST_STYLE),this.txtPlayerPosition.position=new PIXI.Point(u.SCENE_WIDTH,u.SCENE_HEIGHT),this.txtPlayerPosition.anchor.set(1,1),this.addChild(this.txtPlayerPosition),this.statContainer=new PIXI.Sprite(a.TextureLoader.Get("assets/gui-atlas.json@panel_stats.png",!0)),this.statContainer.position.set(4),this.statContainer.name="TriggerMessage",this.statContainer.anchor.set(0),this.addChild(this.statContainer),this.questPanel=new PIXI.Sprite(a.TextureLoader.Get("assets/gui-atlas.json@panel.png")),this.questPanel.anchor.set(0),this.questPanel.position.set(4,88),this.addChild(this.questPanel),this.txtQuestMessage=new PIXI.extras.BitmapText("",u.QUEST_STYLE),this.txtQuestMessage.position.set(14),this.txtQuestMessage.anchor.set(0),this.questPanel.addChild(this.txtQuestMessage);var t,e={font:"26px Orbitron",tint:16711424};this.statContainer.height;this.txtHP=new PIXI.extras.BitmapText("0",e),this.txtHP.anchor.set(0,.5),this.txtHP.position=new PIXI.Point(84,this.statContainer.height/2),this.statContainer.addChild(this.txtHP),(t=new PIXI.Sprite(a.TextureLoader.Get("assets/gui-atlas.json@heart.png"))).anchor.set(.5),t.position.set(45,this.statContainer.height/2),this.statContainer.addChild(t),this.txtDust=new PIXI.extras.BitmapText("0",e),this.txtDust.anchor.set(0,.5),this.txtDust.position=new PIXI.Point(334,this.statContainer.height/2),this.statContainer.addChild(this.txtDust),this.emitter=o.createParticleEmitter(this.statContainer,[a.TextureLoader.Get("assets/objects-atlas.json@star.png")]),this.emitter.updateOwnerPos(292,64),this.emitter.maxLifetime=.6,this.emitter.maxParticles=50,this.emitter.emit=!0,this.txtCoins=new PIXI.extras.BitmapText("0",e),this.txtCoins.anchor.set(0,.5),this.txtCoins.position=new PIXI.Point(586,this.statContainer.height/2),this.statContainer.addChild(this.txtCoins),(t=new PIXI.Sprite(a.TextureLoader.Get("assets/gui-atlas.json@coin.png"))).anchor.set(.5),t.position.set(544,this.statContainer.height/2),this.statContainer.addChild(t);var i=new PIXI.Sprite(a.TextureLoader.Get("assets/gui-atlas.json@exp_panel.png"));i.position.set(0,u.SCENE_HEIGHT-i.height),this.addChild(i),this.expPreFiller=new PIXI.Sprite(a.TextureLoader.Get("assets/gui-atlas.json@exp_prefill.png")),this.expPreFiller.position.set(3,3),i.addChild(this.expPreFiller),this.expFiller=new PIXI.Sprite(a.TextureLoader.Get("assets/gui-atlas.json@exp_fill.png")),this.expFiller.position.set(3,3),i.addChild(this.expFiller),this.fillLen=i.width-6;var n={font:"18px Bauhaus"};this.txtExp=new PIXI.extras.BitmapText("0 / 1000",n),this.txtExp.pivot.set(.5),this.txtExp.anchor.set(.5),this.txtExp.position=new PIXI.Point(i.width/2,i.height/2),this.txtExp.tint=16711492,i.addChild(this.txtExp),this.txtLevel=new PIXI.extras.BitmapText("Level "+r.stats.characterLevel,n),this.txtLevel.position.set(i.x+i.width+4,i.y),this.txtLevel.tint=16711492,this.addChild(this.txtLevel),l.eventEmitter.on(l.STATCHANGE_TOPIC,this.handleStatChange),l.eventEmitter.on(l.DAMAGE_TOPIC,this.handleDpsChange)},e.prototype.onUpdate=function(t){this.emitter.update(.001*t),this.questPanel.visible&&this.questMsgEndTime<performance.now()&&(this.questPanel.visible=!1,this.onCompleteCB&&this.onCompleteCB()),this.txtPlayerPosition.text=a.Global.position.x.toFixed(0)+", "+a.Global.position.y.toFixed(0)},e.prototype.addInfoMessage=function(t,e,i,a){var o=this,r=n.__assign({font:"24px Orbitron",tint:16777215},i),l=new PIXI.extras.BitmapText(e,r);a=a||0,l.position.set(u.SCENE_HALF_WIDTH+a,u.SCENE_HEIGHT-t.y-70),l.scale.set(1,1),this.addChild(l);var c=t.y>u.SCENE_HALF_HEIGHT?250:-250,p=u.SCENE_HEIGHT-t.y+c;new s.Tween(l.position).to({y:p},2e3).start();var d=new s.Tween(l.scale).to({x:1.6,y:1.6},2200).easing(s.Easing.Linear.None),h=new s.Tween(l).to({alpha:0},3e3).onComplete(function(){return o.removeChild(l)});d.chain(h).start()},e.prototype.addQuestItemMessage=function(t){var e=this,i=new PIXI.extras.BitmapText(t,u.QUEST_ITEM_STYLE);i.anchor.set(.5),i.position.set(u.SCENE_HALF_WIDTH,150),this.addChild(i);var n=new s.Tween(i.scale).to({x:1.8,y:1.8},2200).easing(s.Easing.Linear.None),a=new s.Tween(i).to({alpha:0},3e3).onComplete(function(){return e.removeChild(i)});n.chain(a).start()},e.prototype.setQuestMessage=function(t,e,i){void 0===e&&(e=8e3),void 0===i&&(i=null),this.txtQuestMessage.text=t,this.questPanel.visible=!0,this.questMsgEndTime=performance.now()+e,this.onCompleteCB=i},e.prototype.addLvlUpMessage=function(t){var e=this,i={align:"center",padding:0,fontSize:"64px",fontFamily:u.GUI_FONT,fill:3364147,strokeThickness:6,stroke:13421823},n=new PIXI.Text(t,i);n.scale.set(1),n.anchor.set(.5),n.position.set(u.SCENE_HALF_WIDTH,u.SCENE_HEIGHT-a.Global.position.y-70),this.addChild(n);var o=a.Global.position.y>u.SCENE_HALF_HEIGHT?450:-450,r=u.SCENE_HEIGHT-a.Global.position.y+o;new s.Tween(n.position).to({y:r},2e3).start();var l=new s.Tween(n.scale).to({x:1.6,y:1.6},1500).easing(s.Easing.Linear.None),c=new s.Tween(n).to({alpha:.4},6e3).onComplete(function(){return e.removeChild(n)});l.chain(c).start()},e.prototype.renderExp=function(t){this.txtExp.text=Math.round(t.Stats[c.StatType.LevelExp])+" / "+t.Stats[c.StatType.LevelMaxExp],this.txtLevel.text="Level "+r.stats.characterLevel;var e=Math.min(t.Stats[c.StatType.LevelExp]/t.Stats[c.StatType.LevelMaxExp],1);if(0===e)return this.expFiller.width=1,void(this.expPreFiller.position.x=1+this.expFiller.x);this.expPreFiller.position.x=this.expFiller.width+this.expFiller.x;var i=this.fillLen*e|0,n=i-this.expFiller.width;this.expPreFiller.width=1;var a=new s.Tween(this.expPreFiller).to({width:n},1500).easing(s.Easing.Linear.None),o=new s.Tween(this.expFiller).to({width:i},2e3).easing(s.Easing.Bounce.Out);a.chain(o).start()},e}(PIXI.Container);e.StatsHud=p},282:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(7),s=i(5),a=function(t){function e(e){var i=t.call(this)||this;return i.FRAME_SIZE_X=64,i.FRAME_SIZE_Y=128,i.addAnimations(new s.AnimationSequence("lava",e,[0,1,2,3],i.FRAME_SIZE_X,i.FRAME_SIZE_Y)),i.play("lava",3),i}return n.__extends(e,t),e}(s.AnimatedSprite);e.Lava=a},283:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(7),s=i(5),a=function(t){function e(e,i,n){void 0===e&&(e=1),void 0===i&&(i=1);var a,o,r,l,u,c=t.call(this)||this;c.scale.y*=-1;var p,d=n[0];(e>1||n.length>1)&&(a=n[1],o=n[2]),i>1&&(r=n[3],l=n[4],u=n[5]);var h=0;a&&(m=s.TextureLoader.Get(a),(p=new PIXI.Sprite(m)).position.set(h+1,0),h+=m.width,c.addChild(p));var m=s.TextureLoader.Get(d);if(e>1){var f=m.width*e,y=m.height;(p=new PIXI.extras.TilingSprite(m,f,y)).position.set(h,0),h+=f}else(p=new PIXI.Sprite(m)).position.set(h,0),h+=p.width;c.addChild(p),o&&(m=s.TextureLoader.Get(o),(p=new PIXI.Sprite(m)).position.set(h-1,0),h+=p.width,c.addChild(p));var v=e+2;if(i>1)for(h=0;h<v;h++){var g;g=0===h?l:h===v-1?u:r;for(var S=1;S<i;S++)m=s.TextureLoader.Get(g),(p=new PIXI.Sprite(m)).position.set(h*p.width,S*p.height),c.addChild(p)}return c}return n.__extends(e,t),e}(PIXI.Container);e.Platform=a},284:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(7),s=i(5),a="assets/objects-atlas.json@bumper_01.png",o="assets/objects-atlas.json@bumper_rotor_01.png",r=Math.PI/8,l=function(t){function e(){var e=t.call(this,s.TextureLoader.Get(a))||this;return e.onUpdate=function(t){var i=e.rotor.rotation-r*t/1e3;e.rotor.rotation=i%Math.PI},e.rotor=new PIXI.Sprite(s.TextureLoader.Get(o)),e.rotor.anchor.set(.5),e.rotor.pivot.set(.5),e.addChild(e.rotor),e.anchor.set(.5),e}return n.__extends(e,t),e}(PIXI.Sprite);e.Bumper=l},285:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(20),s=i(286),a=i(21),o=i(24),r=i(34),l=i(18),u=function(){function t(t){this.gameScene=t,this.questState=[],this.hud=this.gameScene.HudOverlay}return t.prototype.reset=function(){var t=this;this.questState.forEach(function(e,i){e!=s.QuestState.None&&(t.findQuest(i).itemsCollected=0)}),this.questState=[]},t.prototype.acquireItem=function(t){var e=this.findQuestWithItem(t);e&&(e.itemsCollected++,this.hud.addQuestItemMessage("collected "+e.itemsCollected+" / "+e.itemsNeeded),e.itemsCollected>=e.itemsNeeded&&(this.setQuestState(e.id,s.QuestState.Completed),e.completedMsg&&this.hud.setQuestMessage(e.completedMsg)))},t.prototype.canActivateTrigger=function(t){if(!t||!t.questId)return!1;if(Array.isArray(t.dependsOn))for(var e=0;e<t.dependsOn.length;e++){var i=t.dependsOn[e],n=this.questState[i];if(!n||n!=s.QuestState.Rewarded)return!1}return(t.lastActive||-1e4)+1e4<performance.now()},t.prototype.handleTriggerEvent=function(t){var e=this,i=n.getScm(),o=t.Trigger,l=Math.max(this.getQuestState(o.questId),o.state||0);if(this.canActivateTrigger(o)){o.lastActive=performance.now();var u=this.findQuest(o.questId);switch(o.questId){case 1:l===s.QuestState.None&&(this.setQuestState(o.questId,s.QuestState.Completed),this.gameScene.IsHeroInteractive=!1,this.hud.setQuestMessage(u.welcomeMsg,2e3,function(){e.hud.setQuestMessage(u.completedMsg,2e3,function(){e.gameScene.IsHeroInteractive=!0,e.setQuestState(o.questId,s.QuestState.Finished),e.giveRewards(u),e.setQuestState(o.questId+1,s.QuestState.InProgress),u=e.findQuest(o.questId+1),e.hud.setQuestMessage(u.welcomeMsg,4e3)})}));break;case 2:this.getQuestState(1)>s.QuestState.Finished&&(l===s.QuestState.InProgress?(this.setQuestState(o.questId,s.QuestState.Completed),this.hud.setQuestMessage(u.completedMsg,4e3,function(){e.gameScene.IsHeroInteractive=!0,e.setQuestState(o.questId,s.QuestState.Finished),e.giveRewards(u),u=e.findQuest(o.questId+1),e.setQuestState(o.questId+1,s.QuestState.InProgress),e.hud.setQuestMessage(u.welcomeMsg)})):l>=s.QuestState.Finished&&(u=this.findQuest(o.questId+1),this.hud.setQuestMessage(u.welcomeMsg,4e3)));break;case 3:l===s.QuestState.InProgress&&(this.setQuestState(o.questId,s.QuestState.Finished),this.giveRewards(u),this.gameScene.IsHeroInteractive=!1,this.hud.setQuestMessage(u.completedMsg,4e3,function(){n.getScm().ActivateScene("Loader")}),a.stats.saveUserState(!0),r.snd.win());break;case 201:this.genericQuestHandler(u,l,t,[function(){n.worldContainer.getChildByName("quest_item_201").visible=!0;var t=e.findBodyByName("lock");e.gameScene.removeEntity(t,!0)},function(){},function(){e.setQuestState(o.questId,s.QuestState.Finished),e.giveRewards(u),e.gameScene.IsHeroInteractive=!1,a.stats.saveUserState(!0),r.snd.win(),e.hud.visible=!1;var t=i.GetScene("CutScene");t.SetText(u.finishedMsg);var n=i.CaptureScene();t.SetBackGround(n,e.gameScene.scale),i.ActivateScene(t)}]);break;case 203:this.genericQuestHandler(u,l,t,[function(){a.stats.HasJumpAtack=!0},function(){},function(){},function(){}]);break;default:this.genericQuestHandler(u,l,t)}}},t.prototype.genericQuestHandler=function(t,e,i,n){var a=i.Trigger;switch(e){case s.QuestState.None:this.setQuestState(t.id,s.QuestState.InProgress),this.hud.setQuestMessage(t.welcomeMsg);break;case s.QuestState.InProgress:this.hud.setQuestMessage(t.objectiveMsg);break;case s.QuestState.Completed:t.itemId&&t.itemsCollected>=t.itemsNeeded?(this.setQuestState(t.id,s.QuestState.Finished),a.lastActive=0):this.hud.setQuestMessage(t.completedMsg);break;case s.QuestState.Finished:this.hud.setQuestMessage(t.finishedMsg),this.giveRewards(t),this.gameScene.removeEntity(i,!0)}n&&n[e]&&n[e]()},t.prototype.giveRewards=function(t){r.snd.questItem(),t.rewardExp&&a.stats.increaseStat(l.StatType.TotalExp,t.rewardExp),t.rewardCoins&&a.stats.increaseStat(l.StatType.Coins,t.rewardCoins),this.setQuestState(t.id,s.QuestState.Rewarded)},t.prototype.findQuest=function(t){return n.LevelDefinitions.quests.filter(function(e){return e.id===t})[0]},t.prototype.findQuestWithItem=function(t){var e=this,i=n.LevelDefinitions.quests.filter(function(i){if(i.itemId===t){var n=e.getQuestState(i.id);return n<s.QuestState.Completed&&n>s.QuestState.None}return!1});return i.length>0?i[0]:null},t.prototype.setQuestState=function(t,e){this.questState[t]=e},t.prototype.getQuestState=function(t){return this.questState[t]||s.QuestState.None},t.prototype.findBodyByName=function(t){var e=void 0;return o.wp2.bodies.forEach(function(i){var n=i.DisplayObject;n&&n.name===t&&(e=i)}),e},t}();e.QuestManager=u},286:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.None=0]="None",t[t.InProgress=1]="InProgress",t[t.Completed=2]="Completed",t[t.Finished=3]="Finished",t[t.Rewarded=4]="Rewarded"}(e.QuestState||(e.QuestState={}))},287:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(7),s=i(5),a=i(15),o=function(t){function e(e){var i=t.call(this,e,"Options")||this;return i.currentMusicTrack=0,i.onActivate=function(){i.sceneManager.MasterHudOverlay.children.find(function(t,e){return"BTN_OPTIONS"==t.name}).visible=!1},i.onDeactivate=function(){i.sceneManager.MasterHudOverlay.children.find(function(t,e){return"BTN_OPTIONS"==t.name}).visible=!0},i.setup=function(){var t=new s.PIXI.extras.BitmapText("Options",a.TEXT_STYLE);i.addChild(t),t.anchor.set(.5),t.x=a.SCENE_HALF_WIDTH,t.y=20;var e=a.BTN_WIDTH/3,n=a.SCENE_HEIGHT-a.BTN_HEIGHT-e,o=new s.Button("assets/gui-atlas.json@gui_button1.png",e,n,a.BTN_WIDTH,a.BTN_HEIGHT);o.text=new s.PIXI.Text("Back to game",a.BTN_STYLE),o.onClick=function(){i.sceneManager.ActivatePreviousScene()},i.addChild(o)},i.BackGroundColor=a.SCENE_BACKCOLOR,i.setup(),i}return n.__extends(e,t),e}(s.Scene);e.OptionsScene=o},288:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(7),s=i(5),a=i(34),o=i(5),r=i(15),l=function(t){function e(e){var i=t.call(this,e,"CutScene")||this;return i.deathScene=!1,i.onActivate=function(){if(i.btnContinue.visible=!i.deathScene,i.callout.visible=!i.deathScene,i.corpse.visible=i.deathScene,i.corpse.scale.set(.1),i.btnContinue.text.text=i.deathScene?"Retry":"Continue",i.deathScene){var t=a.snd.getTrack("Carrousel");a.snd.playTrack(t)}},i.deathMessages=["Life sucks and you just died!","You decided to check the afterlife.\nGuess what? You are dead!","Owned!\nMore luck next time.","You have died!\nRest in peace.","Your quest has failed.\nMay you find more peace in\nthat world than you found in this one.","Here's a picture of your corpse.\nNot pretty!","Yep, you're dead.\nMaybe you should consider\nplaying a Barbie game!","Died..."],i.BackGroundColor=1087931,i.corpse=new PIXI.Sprite(o.TextureLoader.Get("assets/objects-atlas.json@hero-dead.png")),i.corpse.anchor.set(.5),i.corpse.pivot.set(.5),i.corpse.position.set(o.SCENE_HALF_WIDTH,o.SCENE_HALF_HEIGHT),i.addChild(i.corpse),i.corpseBlurFilter=new PIXI.filters.BlurFilter,i.corpse.filters=[i.corpseBlurFilter],i.callout=new PIXI.Sprite(o.TextureLoader.Get("assets/gui-atlas.json@rect.png")),i.callout.anchor.set(.5),i.callout.position.set(o.SCENE_HALF_WIDTH,o.SCENE_HEIGHT/5),i.addChild(i.callout),i.textMessage=new PIXI.extras.BitmapText("",r.QUEST_STYLE),i.textMessage.anchor.set(.5),i.textMessage.position.set(0,0),i.callout.addChild(i.textMessage),i.btnContinue=new s.Button("assets/gui-atlas.json@gui_button1.png",(o.SCENE_WIDTH-o.BTN_WIDTH)/2,i.callout.height+o.BTN_HEIGHT,o.BTN_WIDTH,o.BTN_HEIGHT),i.btnContinue.text=new PIXI.Text("Continue",o.BTN_STYLE),i.btnContinue.onClick=function(){i.sceneManager.ActivateScene("Loader")},i.addChild(i.btnContinue),i}return n.__extends(e,t),e.prototype.onUpdate=function(t){if(this.deathScene)if(this.corpse.scale.x<2.5){this.corpse.rotation+=.03;var e=this.corpse.scale.x+.01;this.corpse.scale.set(e)}else this.deathScene=!1,this.textMessage.text=this.deathMessages[0|Math.random()*this.deathMessages.length],this.callout.visible=!0,this.btnContinue.visible=!0;else this.corpse.rotation+=.005;var i=Math.max(5,this.corpseBlurFilter.blur+4e-5);this.corpseBlurFilter.blur=i},Object.defineProperty(e.prototype,"DeathScene",{get:function(){return this.deathScene},set:function(t){if(this.deathScene=t,this.deathScene){this.corpseBlurFilter.blur=0;var e=new PIXI.filters.ColorMatrixFilter;e.sepia(),this.backSprite.filters=[e]}else this.backSprite.filters=null},enumerable:!0,configurable:!0}),e.prototype.SetBackGround=function(t,e){this.backSprite?this.backSprite.texture=t:(this.backSprite=new PIXI.Sprite(t),this.addChildAt(this.backSprite,0)),this.backSprite.scale.set(1/e.x,1/e.y)},e.prototype.SetText=function(t){this.textMessage.text=t},e}(s.Scene);e.CutScene=l},31:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.eventEmitter=new PIXI.utils.EventEmitter,e.MOVE_TOPIC="MOVE",e.BURN_TOPIC="BURN",e.STATCHANGE_TOPIC="STATCHANGE",e.DAMAGE_TOPIC="DAMAGE",e.GROUND_SHAKE="SHAKE"},34:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(274),s=function(){function t(){this.musicTrackNames=["assets/audio/Two-Finger-Johnny.mp3","assets/audio/Bumbling-Burglars_Looping.mp3","assets/audio/Bama-Country.mp3","assets/audio/Beachfront-Celebration.mp3","assets/audio/Easy-Jam.mp3","assets/audio/Whiskey-on-the-Mississippi.mp3","assets/audio/ZigZag.mp3","assets/audio/Carrousel.mp3","assets/audio/Disco-Break.mp3"],this.musicTracks=[],this.currentTrack=0,this.previousMusicVolume=.6,this.previousFxVolume=1,this.musicVolume=.6,this.fxVolume=1;for(var t=0,e=this.musicTrackNames.length;t<e;t++){var i=this.musicTrackNames[t];this.musicTracks.push(new n.Howl({preload:!1,src:[i],autoplay:!1,loop:!0,volume:.6}))}this.walkSnd=new n.Howl({src:["assets/audio/effects/step.mp3"],preload:!0,autoplay:!1,loop:!0,volume:1}),this.jumpSnd1=new n.Howl({src:["assets/audio/effects/jump1.mp3"],preload:!0,autoplay:!1,loop:!1,volume:1}),this.jumpSnd2=new n.Howl({src:["assets/audio/effects/jump2.mp3"],preload:!0,autoplay:!1,loop:!1,volume:1}),this.burnSnd=new n.Howl({src:["assets/audio/effects/burn.mp3"],preload:!0,autoplay:!1,loop:!0,volume:1}),this.hurtSnd=new n.Howl({src:["assets/audio/effects/hurt.mp3"],preload:!0,autoplay:!1,loop:!1,volume:1}),this.coinSnd=new n.Howl({src:["assets/audio/effects/coin.mp3"],preload:!0,autoplay:!1,loop:!1,volume:1}),this.gemSnd=new n.Howl({src:["assets/audio/effects/gem.mp3"],preload:!0,autoplay:!1,loop:!1,volume:1}),this.questItemSnd=new n.Howl({src:["assets/audio/effects/quest-item.mp3"],autoplay:!1,loop:!1,volume:1}),this.winSnd=new n.Howl({src:["assets/audio/effects/win.mp3"],autoplay:!1,loop:!1,volume:1}),this.atkMag1=new n.Howl({src:["assets/audio/effects/atk-mag01.mp3"],autoplay:!1,loop:!1,volume:1}),this.hitMag1=new n.Howl({src:["assets/audio/effects/hit-mag01.mp3"],autoplay:!1,loop:!1,volume:1}),this.jumpAtk=new n.Howl({src:["assets/audio/effects/jump-atk01.mp3"],autoplay:!1,loop:!1,volume:1}),this.pain=new n.Howl({src:["assets/audio/effects/pain01.mp3"],autoplay:!1,loop:!1,volume:1}),this.jmpContact=new n.Howl({src:["assets/audio/effects/jmp-contact.mp3"],autoplay:!1,loop:!1,volume:1}),this.woosh=new n.Howl({src:["assets/audio/effects/woosh.mp3"],autoplay:!1,loop:!1,volume:1}),this.squish=new n.Howl({src:["assets/audio/effects/mob-squish.mp3"],autoplay:!1,loop:!1,volume:1}),this.fxDemoSnd=new n.Howl({src:["assets/audio/effects/fx-demo.mp3"],autoplay:!1,loop:!1,volume:1})}return Object.defineProperty(t.prototype,"MusicVolume",{get:function(){return this.musicVolume},set:function(t){this.musicVolume=t,this.backgroundSnd&&this.backgroundSnd.playing()&&this.backgroundSnd.volume(this.musicVolume)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"FxVolume",{get:function(){return this.fxVolume},set:function(t){this.fxVolume=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsFxOn",{get:function(){return this.fxVolume>0},set:function(t){t?this.FxVolume=this.previousFxVolume:(this.previousFxVolume=this.fxVolume,this.FxVolume=0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsMusicOn",{get:function(){return this.musicVolume>0},set:function(t){t?this.MusicVolume=this.previousMusicVolume:(this.previousMusicVolume=this.musicVolume,this.MusicVolume=0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CurrentTrackId",{get:function(){return this.currentTrack},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fxDemo",{get:function(){return this.fxDemoSnd},enumerable:!0,configurable:!0}),t.prototype.jumpAttack=function(){this.walkSnd.pause(),this.jumpAtk.loop(!1),this.jumpAtk.play(),this.jumpAtk.volume(this.fxVolume)},t.prototype.jump=function(){this.walkSnd.pause(),this.jumpSnd1.play(),this.jumpSnd1.volume(this.fxVolume)},t.prototype.idle=function(){this.walkSnd.pause()},t.prototype.walk=function(t){this.walkSnd.rate(t?2:1.2),this.walkSnd.playing()||(this.walkSnd.volume(this.fxVolume),this.walkSnd.play())},t.prototype.atkMagic1=function(){this.atkMag1.volume(this.fxVolume),this.atkMag1.play()},t.prototype.hitMagic1=function(){this.hitMag1.volume(this.fxVolume),this.hitMag1.play()},t.prototype.hitPain=function(){this.pain.volume(this.fxVolume),this.pain.play()},t.prototype.mobSquish=function(){this.squish.volume(this.fxVolume),this.squish.play()},t.prototype.bulletHitWall=function(){this.woosh.volume(this.fxVolume),this.woosh.play()},t.prototype.coin=function(){this.coinSnd.volume(this.fxVolume),this.coinSnd.play()},t.prototype.gem=function(){this.gemSnd.volume(this.fxVolume),this.gemSnd.play()},t.prototype.hurt=function(){this.hurtSnd.volume(this.fxVolume),this.hurtSnd.play()},t.prototype.jumpContact=function(){this.jmpContact.volume(this.fxVolume),this.jmpContact.play()},t.prototype.questItem=function(){this.questItemSnd.volume(this.fxVolume),this.questItemSnd.play()},t.prototype.win=function(){this.backgroundSnd&&this.backgroundSnd.playing()&&this.backgroundSnd.fade(1,0,500),this.hurtSnd.stop(),this.walkSnd.stop(),this.jumpSnd1.stop(),this.jumpSnd2.stop(),this.burnSnd.stop(),this.winSnd.volume(this.fxVolume),this.winSnd.play()},t.prototype.burn=function(){this.burnSnd.playing()||(this.burnSnd.volume(this.fxVolume),this.burnSnd.play()),this.hurt()},t.prototype.burnStop=function(){var t=this;this.burnSnd.fade(1,0,200),setTimeout(function(){return t.burnSnd.stop()},200)},t.prototype.getTrack=function(t){for(var e=0,i=this.musicTrackNames.length;e<i;e++)if(this.musicTrackNames[e].indexOf(t)>=0)return e;return-1},t.prototype.stopTrack=function(){void 0!==this.backgroundSnd&&this.backgroundSnd.stop()},t.prototype.playTrack=function(t){var e=this;void 0===this.backgroundSnd&&(this.backgroundSnd=this.musicTracks[t],console.log("playTrack "+t,this.backgroundSnd)),this.backgroundSnd===this.musicTracks[t]&&this.backgroundSnd.playing()||(this.backgroundSnd.stop(),this.backgroundSnd=this.musicTracks[t],this.backgroundSnd.volume(this.musicVolume),this.backgroundSnd.play(),"unloaded"===this.backgroundSnd.state()&&(this.backgroundSnd.load(),this.backgroundSnd.once("load",function(){e.backgroundSnd.play()}))),this.currentTrack=t},t}();e.SoundMan=s,e.snd=new s},40:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(7),s=i(20),a=i(41),o=i(5),r=i(72),l=i(273),u=i(154),c=i(126),p=i(15),d=i(5),h=function(){function t(t){this.gameLevels=t}return t.registerFactory=function(t,e){this.factoryList.set(t,e)},t.prototype.buildLevel=function(t){for(var e,i=void 0,n=0;n<this.gameLevels.levels.length;n++)if(this.gameLevels.levels[n].id===t){i=this.gameLevels.levels[n];break}return i&&(e=this.createLevel(i)),e},t.prototype.createLevel=function(e){var i={parallax:[],entities:[],start:[],audioTrack:e.audioTrack,templates:[],spawnPoints:[]},n=new PIXI.Point(p.SCENE_WIDTH,p.SCENE_HEIGHT);e.parallax.forEach(function(t){var e=new o.Parallax(n,t.parallaxFactor,t.textures,t.scale);e.y=t.y,i.parallax.push(e)});var a=s.LevelDefinitions.templates.concat(e.map.templates);return i.templates=a,e.map.entities.forEach(function(e,n,s){var o=t.createEntity(a,e);i.entities.push(o)}),e.map.NPC=e.map.NPC||[],e.map.NPC.forEach(function(e,n,s){if(e.type&&"spawn_point"===e.type){var o=e,r=o.entity;i.spawnPoints.push(new l.SpawnPoint(o.name,o.xy[0],o.xy[1],o.area,o.maxMobCount,o.respawnSeconds,r))}else{var u=t.createMob(a,e);i.entities.push(u)}}),i.start=e.map.start,i},t.createEntity=function(e,i){var n,s=c.getEntityDefinition(e,i),o=t.buildDisplayObject(s.doDef);return o.name=i.name||i.template,o.templateName=s.templateName,s.bdDef?((n=t.buildPhysicsObject(s.bdDef,o)).shapes.every(function(t){return"ground"===s.bdDef.collisionType?(t.collisionGroup=r.COL_GRP_GROUND,t.collisionMask=r.COL_GRP_PLAYER|r.COL_GRP_NPC|r.COL_GRP_SCENE|r.COL_GRP_BULLET):(t.collisionGroup=r.COL_GRP_SCENE,t.collisionMask=r.COL_GRP_PLAYER|r.COL_GRP_NPC|r.COL_GRP_SCENE|r.COL_GRP_GROUND),!0}),n.DisplayObject=o,s.trigger&&(n.Trigger=s.trigger)):(n=new a.Body).DisplayObject=o,n},t.createMob=function(e,i){var n=c.getEntityDefinition(e,i),s=t.buildDisplayObject(n.doDef);s.name=i.name||i.template,s.templateName=n.templateName,s.attributes=i.attributes||n.doDef.attributes||[],s.createAI(i.ai||"basic_static"),s.atkTexture=i.attack||n.doDef.attack,n.bdDef.material=n.bdDef.material||"mob_default";var a=t.buildPhysicsObject(n.bdDef,s);return a.shapes.every(function(t){return t.collisionGroup=r.COL_GRP_NPC,t.collisionMask=r.COL_GRP_PLAYER|r.COL_GRP_GROUND|r.COL_GRP_SCENE,!0}),a.DisplayObject=s,n.trigger&&(a.Trigger=n.trigger),a},t.buildDisplayObject=function(t){var e;switch((t=n.__assign({anchor:.5,pivot:.5,scale:[1,1]},t)).typeName){case"Mob":var i=new u.Mob(t.texture);t.sequences&&(i.clearAnimations(),t.sequences.forEach(function(e){var n=e.texture||t.texture,s=new o.AnimationSequence(e.name,n,e.frames,e.framesize[0],e.framesize[1]);i.addAnimations(s)}),i.play(t.sequences[0].name)),t.fps&&(i.fps=t.fps),i.typeName="Mob",e=i;break;case"Sensor":(e=new PIXI.DisplayObject).typeName="Sensor";break;case"AnimatedSprite":var s=new o.AnimatedSprite;t.sequences.forEach(function(t,e,i){var n=new o.AnimationSequence(t.name,t.texture,t.frames,t.framesize[0],t.framesize[1]);s.addAnimations(n)}),s.play(t.sequences[0].name,t.fps),s.typeName="AnimatedSprite",e=s;break;case"Sprite":var a=d.TextureLoader.Get(t.texture),r=new PIXI.Sprite(a);r.typeName="Sprite",e=r;break;default:var l=this.factoryList.get(t.typeName);if(!l)throw"Factory not found for object name: "+t.typeName;e=l(t)}return e.scale.set(t.scale[0],-1*t.scale[1]),e.anchor&&e.anchor.set(t.anchor),e.pivot.set(t.pivot),void 0!==t.visible&&(e.visible=t.visible),e.rotation=t.rotation||0,t.xy&&e.position.set(t.xy[0],t.xy[1]),t.interactionType&&(e.interactionType=t.interactionType),t.drop&&(e.drop=t.drop),t.tint&&(e.tint=parseInt(t.tint,16)),e},t.buildPhysicsObject=function(t,e,i){var n;void 0===i&&(i=!1);var s=0,o=0;if(t){var r={mass:t.mass,position:t.xy?t.xy:[e.x,e.y],angle:t.angle||e.rotation,fixedRotation:t.fixedRotation||!1,angularDamping:t.angularDamping||.1,damping:t.damping||.1};(n=new a.Body(r)).type=t.type||a.Body.KINEMATIC;var l,u=e;switch(t.shape){case"Circle":var c=32;c=t.size?t.size.constructor===Array?t.size[0]:t.size:u.width,l=new a.Circle({radius:c});break;case"Platform":t.size?(s=t.size[0],o=t.size[1]):(s=Math.abs(u.width),o=Math.abs(u.height)),l=new a.Box({width:s,height:o}),n.position[0]=n.position[0]+s/2,n.position[1]=n.position[1]-o/2;break;case"Box":t.size?(s=t.size[0],o=t.size[1]):u.width?(s=Math.abs(u.width),o=Math.abs(u.height)):(s=e.scale.x*e.getLocalBounds().width,o=e.scale.y*e.getLocalBounds().height),l=new a.Box({width:s,height:o})}t.material&&(l.materialName=t.material),!i&&e.interactionType?(l.sensor=!0,n.type=a.Body.STATIC,n.collisionResponse=!1,n.setDensity(0),console.log("created collectible sensor",l)):"Sensor"===e.typeName&&(l.sensor=!0,n.type=a.Body.STATIC,n.collisionResponse=!1,n.setDensity(0)),n.addShape(l)}return n},t.factoryList=new d.Dictionary,t}();e.LevelLoader=h},5:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(7),s=i(0);e.PIXI=s;var a=i(20);e.Global=a,n.__exportStar(i(125),e),n.__exportStar(i(15),e)},72:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.COL_GRP_PLAYER=1,e.COL_GRP_NPC=2,e.COL_GRP_SCENE=4,e.COL_GRP_BULLET=8,e.COL_GRP_GROUND=16}},[[156,0,1,5]]]);