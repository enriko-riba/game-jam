(window.webpackJsonp=window.webpackJsonp||[]).push([[3],[,,,,,,,,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(7);e.PIXI=s;var a=i(55);e.TWEEN=a.default;var o=i(23);e.Global=o,e.createParticleEmitter=o.createParticleEmitter,n.__exportStar(i(56),e),n.__exportStar(i(17),e);var r=i(43);e.TextureLoader=r.TextureLoader;var u=i(27);e.AnimatedSprite=u.AnimatedSprite;var l=i(28);e.AnimationSequence=l.AnimationSequence;var c=i(101);e.SpriteButton=c.SpriteButton;var p=i(102);e.Parallax=p.Parallax;var d=i(57);e.Dictionary=d.Dictionary;var h=i(103);e.KeyboardMapper=h.KeyboardMapper},,,,,,,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SCENE_WIDTH=1920,e.SCENE_HEIGHT=1080,e.SCENE_HALF_WIDTH=e.SCENE_WIDTH/2,e.SCENE_HALF_HEIGHT=e.SCENE_HEIGHT/2,e.BTN_WIDTH=120,e.BTN_HEIGHT=60,e.GUI_FONT="Orbitron",e.SCENE_BACKCOLOR=1122867,e.ANIMATION_FPS_NORMAL=14,e.ANIMATION_FPS_SLOW=4,e.BTN_STYLE={align:"center",padding:0,fontSize:28,fontFamily:e.GUI_FONT,fill:4652029,strokeThickness:1,stroke:0},e.TEXT_STYLE={align:"left",font:{name:"Orbitron",size:21},tint:15066395},e.MSG_COIN_STYLE={align:"left",font:{name:"Orbitron",size:22},tint:16711492},e.MSG_HP_STYLE={align:"center",font:{name:"Orbitron",size:24},tint:16716049},e.MSG_EXP_STYLE={align:"center",font:{name:"Orbitron",size:24},tint:8700418},e.MSG_WARN_STYLE={align:"center",font:{name:"Orbitron",size:27},tint:16711697},e.QUEST_ITEM_STYLE={align:"center",font:{name:"Orbitron",size:28},tint:8700658},e.QUEST_STYLE={align:"left",font:{name:"Orbitron",size:24},tint:16711628}},,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.MaxHP=0]="MaxHP",t[t.MaxDust=1]="MaxDust",t[t.RegenHP=2]="RegenHP",t[t.RegenDust=3]="RegenDust"}(e.BaseStatType||(e.BaseStatType={})),function(t){t[t.MaxHP=0]="MaxHP",t[t.HP=1]="HP",t[t.MaxDust=2]="MaxDust",t[t.Dust=3]="Dust",t[t.RegenHP=4]="RegenHP",t[t.RegenDust=5]="RegenDust",t[t.Coins=6]="Coins",t[t.Gold=7]="Gold",t[t.LevelExp=8]="LevelExp",t[t.LevelMaxExp=9]="LevelMaxExp",t[t.TotalExp=10]="TotalExp",t[t.AttributePoints=11]="AttributePoints",t[t.CharacterLevel=12]="CharacterLevel"}(e.StatType||(e.StatType={})),function(t){t[t.LavaBorder=1e3]="LavaBorder",t[t.Lava=1001]="Lava",t[t.Poison=1002]="Poison"}(e.DamageType||(e.DamageType={})),function(t){t[t.HP=0]="HP",t[t.Atk=1]="Atk",t[t.AtkCD=2]="AtkCD",t[t.Def=3]="Def"}(e.AtrType||(e.AtrType={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right"}(e.DirectionH||(e.DirectionH={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(23),s=i(29),a=i(33),o=i(20),r=function(){function t(){var e=this;this.baseStats=[],this.attributeStats=[],this.stats=[],this.accumulator=0,this.dpsDecreaseAmount=0,this.hasJumpAttack=!1,this.hasMagicAttack=!1,this.characterLevel=0,this.currentGameLevel=0,this.expForNextLevel=0,this.isBurningBuff=!1,this.buffs=[],this.onUpdate=function(t){for(var i=performance.now()/1e3,n=1e3,a=e.buffs.length;n<a;n++)if(e.buffs[n]&&e.buffs[n]>i){var r=0;switch(n){case o.DamageType.LavaBorder:r=5;break;case o.DamageType.Lava:r=15;break;case o.DamageType.Poison:r=10}var u=.001*t*r;e.dpsDecreaseAmount+=u}if(e.accumulator+=t,e.accumulator>500){if(e.accumulator-=500,e.stats[o.StatType.Dust]<e.stats[o.StatType.MaxDust]){var l=.5*e.stats[o.StatType.RegenDust];e.increaseStat(o.StatType.Dust,l)}if(e.stats[o.StatType.HP]<e.stats[o.StatType.MaxHP]){l=.5*e.stats[o.StatType.RegenHP];e.increaseStat(o.StatType.HP,l)}if(e.dpsDecreaseAmount>=1){var c=Math.floor(e.dpsDecreaseAmount),p={OldValue:e.stats[o.StatType.HP],Amount:-c};s.eventEmitter.emit(s.DAMAGE_TOPIC,p),e.increaseStat(o.StatType.HP,-c),e.dpsDecreaseAmount-=c}}var d=e.isBurningBuff;e.isBurningBuff=e.buffs[o.DamageType.LavaBorder]>i||e.buffs[o.DamageType.Lava]>i,d!==e.isBurning&&s.eventEmitter.emit(s.BURN_TOPIC,{wasBurning:d,isBurning:e.isBurningBuff})},this.scevent={Type:o.StatType.Coins,OldValue:0,NewValue:0,Stats:[]},this.id=0,this.attributeStats[o.BaseStatType.RegenHP]=0,this.attributeStats[o.BaseStatType.RegenDust]=0,this.attributeStats[o.BaseStatType.MaxHP]=0,this.attributeStats[o.BaseStatType.MaxDust]=0,this.stats[o.StatType.Coins]=0,this.stats[o.StatType.Dust]=600,this.stats[o.StatType.TotalExp]=0,this.stats[o.StatType.AttributePoints]=0,this.stats[o.StatType.HP]=120;t.expForLevel[0]=0;for(var i=1;i<1e4;i++)t.expForLevel[i]=t.expForLevel[i-1]+1e3*i;this.rebuildStats()}return Object.defineProperty(t.prototype,"LevelLoader",{get:function(){return this.levelLoader||(this.levelLoader=new a.LevelLoader(n.LevelDefinitions)),this.levelLoader},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBurning",{get:function(){return this.isBurningBuff},enumerable:!0,configurable:!0}),t.prototype.loadLevel=function(){this.loadUserState(),this.currentLevel=this.LevelLoader.buildLevel(this.currentGameLevel)},t.prototype.saveUserState=function(t){t&&(this.currentGameLevel+=1);this.id,this.stats[o.StatType.Coins],this.stats[o.StatType.Gold],Math.floor(this.stats[o.StatType.Dust]),this.stats[o.StatType.TotalExp],this.stats[o.StatType.AttributePoints],this.stats[o.StatType.HP],this.currentGameLevel},t.prototype.loadUserState=function(){this.id;var t={HP:this.getStat(o.StatType.MaxHP),Exp:this.getStat(o.StatType.TotalExp),Coins:this.getStat(o.StatType.Coins),Dust:this.getStat(o.StatType.MaxDust),Gold:0,AtrPts:0,LastLevel:this.currentGameLevel};console.log("loadUserState() response",t),e.stats.currentGameLevel=t.LastLevel,t.HP<=0&&(t.HP=this.stats[o.StatType.MaxHP]),this.setStat(o.StatType.HP,t.HP),this.setStat(o.StatType.Coins,t.Coins),this.setStat(o.StatType.Gold,t.Gold),this.setStat(o.StatType.Dust,t.Dust),this.setStat(o.StatType.AttributePoints,t.AtrPts),this.setStat(o.StatType.TotalExp,t.Exp),this.rebuildStats()},Object.defineProperty(t.prototype,"HasJumpAtack",{get:function(){return this.hasJumpAttack},set:function(t){this.hasJumpAttack=t},enumerable:!0,configurable:!0}),t.prototype.setStat=function(e,i){this.stats[e]=i,e===o.StatType.TotalExp&&(this.characterLevel=t.findExpLevel(i),this.stats[o.StatType.LevelMaxExp]=t.expForLevel[this.characterLevel+1]-t.expForLevel[this.characterLevel],this.stats[o.StatType.LevelExp]=this.stats[o.StatType.TotalExp]-t.expForLevel[this.characterLevel],this.expForNextLevel=t.expForLevel[this.characterLevel+1]),this.updateEvent(e,i),s.eventEmitter.emit(s.STATCHANGE_TOPIC,this.scevent)},t.prototype.getStat=function(t){return this.stats[t]},t.prototype.increaseStat=function(e,i,n){var a=this.stats[e]+i;n&&a>n&&(a=n),a<0&&(a=0),this.updateEvent(e,a),this.stats[e]=a,e===o.StatType.TotalExp&&(this.stats[o.StatType.LevelExp]=a-t.expForLevel[this.characterLevel],a>=this.expForNextLevel&&(this.characterLevel=t.findExpLevel(a),this.expForNextLevel=t.expForLevel[this.characterLevel+1],this.stats[o.StatType.LevelMaxExp]=this.expForNextLevel-t.expForLevel[this.characterLevel],this.stats[o.StatType.LevelExp]=a-t.expForLevel[this.characterLevel],this.scevent.Type=o.StatType.CharacterLevel,this.scevent.OldValue=this.characterLevel-1,this.scevent.NewValue=this.characterLevel,this.scevent.Stats=this.stats,s.eventEmitter.emit(s.STATCHANGE_TOPIC,this.scevent),a=this.stats[o.StatType.AttributePoints]+5,this.scevent.Type=o.StatType.AttributePoints,this.scevent.OldValue=this.getStat(o.StatType.AttributePoints),this.scevent.NewValue=a,this.setStat(o.StatType.AttributePoints,a),this.scevent.Stats=this.stats,s.eventEmitter.emit(s.STATCHANGE_TOPIC,this.scevent),this.setStat(o.StatType.Dust,this.stats[o.StatType.MaxDust]),this.setStat(o.StatType.HP,this.stats[o.StatType.MaxHP]),this.scevent.Type=e,this.scevent.OldValue=0,this.scevent.NewValue=this.stats[o.StatType.LevelExp],this.scevent.Stats=this.stats)),s.eventEmitter.emit(s.STATCHANGE_TOPIC,this.scevent)},t.findExpLevel=function(e){for(var i=0,n=t.expForLevel.length;i<n;i++)if(e<t.expForLevel[i])return i-1},t.prototype.rebuildStats=function(){this.baseStats[o.BaseStatType.MaxHP]=150+10*this.characterLevel,this.baseStats[o.BaseStatType.MaxDust]=600+50*this.characterLevel,this.baseStats[o.BaseStatType.RegenDust]=2+this.characterLevel/2,this.baseStats[o.BaseStatType.RegenHP]=1+this.characterLevel/2,this.stats[o.StatType.MaxHP]=this.baseStats[o.BaseStatType.MaxHP]*(1+this.attributeStats[o.BaseStatType.MaxHP]/10),this.stats[o.StatType.MaxDust]=this.baseStats[o.BaseStatType.MaxDust]*(1+this.attributeStats[o.BaseStatType.MaxDust]/10),this.stats[o.StatType.RegenHP]=this.baseStats[o.BaseStatType.RegenHP]*(1+this.attributeStats[o.BaseStatType.RegenHP]/10),this.stats[o.StatType.RegenDust]=this.baseStats[o.BaseStatType.RegenDust]*(1+this.attributeStats[o.BaseStatType.RegenDust]/10)},t.prototype.updateEvent=function(t,e){this.scevent.Type=t,this.scevent.OldValue=this.stats[t],this.scevent.NewValue=e,this.scevent.Stats=this.stats},t.expForLevel=[],t}();e.stats=new r},,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,s=i(10),a=i(7),o=i(100),r=i(56),u=i(17);e.getScm=function(){if(!n){var t=document.getElementById("stage"),e={width:u.SCENE_WIDTH,height:u.SCENE_HEIGHT,view:t,backgroundColor:0,antialias:!1,transparent:!1,resolution:window.devicePixelRatio};n=new r.SceneManager(e)}return n},e.deleteScm=function(){n&&n.Renderer.destroy(),n=void 0},e.position=new a.Point,e.createParticleEmitter=function(t,e,i){var n={alpha:{start:.8,end:.03},color:{start:"#dcff09",end:"#9f1f1f"},scale:{start:.1,end:.4,minimumScaleMultiplier:1},speed:{start:50,end:3,minimumSpeedMultiplier:1},acceleration:new a.Point,startRotation:{min:0,max:360},rotationSpeed:{min:5,max:20},lifetime:{min:.4,max:1},blendMode:"add",frequency:.01,emitterLifetime:-1,maxParticles:200,pos:new a.Point(0,-24),addAtBack:!1,spawnType:"circle",spawnCircle:{x:0,y:0,r:10}};i&&(n=s.__assign(s.__assign({},n),i));var r=new o.Emitter(t,e,n);return r.emit=!1,r},e.LevelDefinitions={templates:void 0,levels:void 0,quests:void 0}},,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(34),s=i(9),a=i(9),o=i(50),r=function(t,e){this.BodyA=t,this.BodyB=e};e.ContactPair=r;var u=function(){function t(){var t=this;this.contactPairs=[],this.contactWatch=[],this.playerBodyContacts=[],this.fixedTimeStep=1/60,this.beginContact=function(e){var i=null,n=null;if(e.bodyA.shapes[0].collisionGroup===o.COL_GRP_BULLET?(i=e.bodyA,n=e.bodyB):e.bodyB.shapes[0].collisionGroup===o.COL_GRP_BULLET&&(i=e.bodyB,n=e.bodyA),i)t.world.emit({type:"bulletContact",playerHit:n===t.playerBody,bulletBody:i,otherBody:n});else{if(t.playerBody===e.bodyA)return t.playerBodyContacts.push(e.bodyB),void t.world.emit({type:"playerContact",velocity:t.playerBody.velocity,body:e.bodyB});if(t.playerBody===e.bodyB)return t.playerBodyContacts.push(e.bodyA),void t.world.emit({type:"playerContact",velocity:t.playerBody.velocity,body:e.bodyA});var s=t.contactWatch.filter((function(t){return t===e.bodyA.id||t===e.bodyB.id}));if(s&&s.length>0){var a=new r(e.bodyA,e.bodyB);t.contactPairs.push(a)}}},this.endContact=function(e){if(!(e.bodyA.shapes[0].collisionGroup===o.COL_GRP_BULLET||e.bodyB.shapes[0].collisionGroup===o.COL_GRP_BULLET)){if(t.playerBody===e.bodyA){var i=t.playerBodyContacts.indexOf(e.bodyB);return t.playerBodyContacts.splice(i,1),void t.world.emit({type:"playerContactEnd",velocity:t.playerBody.velocity,body:e.bodyB})}if(t.playerBody===e.bodyB){i=t.playerBodyContacts.indexOf(e.bodyB);return t.playerBodyContacts.splice(i,1),void t.world.emit({type:"playerContactEnd",velocity:t.playerBody.velocity,body:e.bodyA})}for(var n=-1,s=0;s<t.contactPairs.length;s++){var a=t.contactPairs[s];if(a.BodyA===e.bodyA&&a.BodyB===e.bodyB||a.BodyA===e.bodyB&&a.BodyB===e.bodyA){n=s;break}}n>=0&&t.contactPairs.splice(n,1)}},this.world=new n.World({gravity:[0,-1500]}),this.setupMaterials(),this.ground=new n.Body({mass:0});var e=new n.Plane;e.material=this.materials.get("ground_default"),e.collisionGroup=o.COL_GRP_GROUND,e.collisionMask=o.COL_GRP_SCENE|o.COL_GRP_NPC|o.COL_GRP_PLAYER|o.COL_GRP_BULLET,this.ground.addShape(e),this.world.addBody(this.ground),this.playerBody=new n.Body({mass:42,fixedRotation:!0}),this.playerBody.damping=.001,(e=new n.Circle({radius:24})).collisionGroup=o.COL_GRP_PLAYER,e.collisionMask=o.COL_GRP_GROUND|o.COL_GRP_SCENE|o.COL_GRP_NPC|o.COL_GRP_BULLET,e.material=this.materials.get("player"),this.playerBody.addShape(e),this.world.addBody(this.playerBody),this.world.sleepMode=n.World.BODY_SLEEPING,this.world.on("beginContact",this.beginContact,this),this.world.on("endContact",this.endContact,this)}return t.prototype.clearLevel=function(){for(var t=this.world.bodies,e=t.length-1;e>=0;e--){var i=t[e];i!==this.playerBody&&i!==this.ground&&this.world.removeBody(i)}},Object.defineProperty(t.prototype,"bodies",{get:function(){return this.world.bodies},enumerable:!0,configurable:!0}),t.prototype.on=function(t,e,i){i=i||this,this.world.on(t,e,i)},t.prototype.update=function(t){this.world.step(this.fixedTimeStep,t/1e3),s.Global.position.x=this.playerBody.interpolatedPosition[0],s.Global.position.y=this.playerBody.interpolatedPosition[1]},t.prototype.removeBody=function(t){this.world.removeBody(t)},t.prototype.addBody=function(t){if(t.shapes&&t.shapes.length>0)for(var e=0,i=t.shapes.length;e<i;e++){var n=t.shapes[e];n.materialName&&!n.material&&(n.material=this.materials.get(n.materialName))}this.world.addBody(t)},t.prototype.clearContactsForBody=function(t){if(t!==this.playerBody)for(var e=0;e>-1;){e=-1;for(var i=0;i<this.contactPairs.length;i++){var n=this.contactPairs[i];if(n.BodyA===t||n.BodyB===t){e=i;break}}e>=0&&this.contactPairs.splice(e,1)}else this.playerBodyContacts=[]},t.prototype.getContactsForBody=function(t){for(var e=[],i=0,n=this.contactPairs.length;i<n;i++){var s=this.contactPairs[i];s.BodyA!==t&&s.BodyB!==t||e.push(s)}return e},t.prototype.addContactWatch=function(t){this.contactWatch.push(t.id)},Object.defineProperty(t.prototype,"playerContacts",{get:function(){return this.playerBodyContacts},enumerable:!0,configurable:!0}),t.prototype.setupMaterials=function(){this.materials=new a.Dictionary,this.materials.set("player",new n.Material(n.Material.idCounter++)),this.materials.set("ground_default",new n.Material(n.Material.idCounter++)),this.materials.set("box_default",new n.Material(n.Material.idCounter++)),this.materials.set("box_highfriction",new n.Material(n.Material.idCounter++)),this.materials.set("mob_default",new n.Material(n.Material.idCounter++)),this.materials.set("bumper",new n.Material(n.Material.idCounter++));var t=new n.ContactMaterial(this.materials.get("player"),this.materials.get("ground_default"),{friction:.85,restitution:.1,stiffness:n.Equation.DEFAULT_STIFFNESS,relaxation:n.Equation.DEFAULT_RELAXATION,frictionStiffness:n.Equation.DEFAULT_STIFFNESS,frictionRelaxation:n.Equation.DEFAULT_RELAXATION,surfaceVelocity:0});this.world.addContactMaterial(t);var e=new n.ContactMaterial(this.materials.get("player"),this.materials.get("mob_default"),{friction:.1,restitution:.4,stiffness:n.Equation.DEFAULT_STIFFNESS,relaxation:n.Equation.DEFAULT_RELAXATION,frictionStiffness:n.Equation.DEFAULT_STIFFNESS,frictionRelaxation:n.Equation.DEFAULT_RELAXATION,surfaceVelocity:0});this.world.addContactMaterial(e);var i=new n.ContactMaterial(this.materials.get("player"),this.materials.get("box_default"),{friction:.2,restitution:.25,stiffness:n.Equation.DEFAULT_STIFFNESS,relaxation:n.Equation.DEFAULT_RELAXATION,frictionStiffness:n.Equation.DEFAULT_STIFFNESS,frictionRelaxation:n.Equation.DEFAULT_RELAXATION,surfaceVelocity:0});this.world.addContactMaterial(i);var s=new n.ContactMaterial(this.materials.get("player"),this.materials.get("box_highfriction"),{friction:.7,restitution:.2,stiffness:n.Equation.DEFAULT_STIFFNESS,relaxation:n.Equation.DEFAULT_RELAXATION,frictionStiffness:n.Equation.DEFAULT_STIFFNESS,frictionRelaxation:n.Equation.DEFAULT_RELAXATION,surfaceVelocity:0});this.world.addContactMaterial(s);var o=new n.ContactMaterial(this.materials.get("player"),this.materials.get("bumper"),{friction:.35,restitution:.75,stiffness:Number.MAX_VALUE,relaxation:n.Equation.DEFAULT_RELAXATION,frictionStiffness:Number.MAX_VALUE,frictionRelaxation:n.Equation.DEFAULT_RELAXATION,surfaceVelocity:0});this.world.addContactMaterial(o);var r=new n.ContactMaterial(this.materials.get("box_default"),this.materials.get("ground_default"),{friction:.8,restitution:.3,stiffness:n.Equation.DEFAULT_STIFFNESS,relaxation:n.Equation.DEFAULT_RELAXATION,frictionStiffness:n.Equation.DEFAULT_STIFFNESS,frictionRelaxation:n.Equation.DEFAULT_RELAXATION,surfaceVelocity:0});this.world.addContactMaterial(r)},t}();e.WorldP2=u,e.wp2=new u},,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(9),a=i(57),o=function(t){function e(){var e=t.call(this)||this;return e.currentSequence=null,e.accumulator=0,e.isPlaying=!1,e.isLooping=!1,e.frameIndex=0,e.currentFps=8,e.animations=new a.Dictionary,e.play=function(t,i,n){void 0===n&&(n=!0),e.currentSequence&&e.currentSequence.sequenceName===t||(e.resetAnimation(),e.currentSequence=e.animations.get(t),e.texture=e.currentSequence.spriteSheet,e.texture.frame=e.currentSequence.frames[0],e.isPlaying=!0),e.fps=i||e.fps,e.isLooping=n},e.pivot.set(.5),e.anchor.set(.5),e}return n.__extends(e,t),e.prototype.addAnimations=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];e.forEach((function(e,i){t.animations.set(e.sequenceName,e),t.texture.valid||0!==i||(t.texture=e.spriteSheet,t.texture.frame=e.frames[0])}))},e.prototype.clearAnimations=function(){this.stop(),this.currentSequence=null,this.animations.clear()},e.prototype.onUpdate=function(t){if(this.isPlaying&&this.texture.valid&&this.currentSequence){this.accumulator+=t;var e=1e3/this.fps;this.accumulator>e&&(this.accumulator-=e,this.texture.frame=this.currentSequence.frames[++this.frameIndex],this.frameIndex===this.currentSequence.frames.length-1&&(this.frameIndex=0,this.isLooping||(this.isPlaying=!1,this.onCompleteCallBack&&this.onCompleteCallBack(this.currentSequence))))}},Object.defineProperty(e.prototype,"onComplete",{get:function(){return this.onCompleteCallBack},set:function(t){this.onCompleteCallBack=t},enumerable:!0,configurable:!0}),e.prototype.stop=function(){this.isPlaying=!1},Object.defineProperty(e.prototype,"fps",{get:function(){return this.currentFps},set:function(t){this.currentFps=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loop",{get:function(){return this.isLooping},set:function(t){this.isLooping=t},enumerable:!0,configurable:!0}),e.prototype.resetAnimation=function(){this.stop(),this.currentSequence=null,this.accumulator=0,this.frameIndex=-1},e}(s.PIXI.Sprite);e.AnimatedSprite=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(9),s=function(){function t(t,e,i,s,a){var o=this;void 0===i&&(i=[]),this.sequenceName=t,this.frames=[];var r=n.TextureLoader.Get(e),u=n.TextureLoader.IsAtlas(r);this.spriteSheet=new n.PIXI.Texture(r.baseTexture);var l=u?Math.floor(r.frame.width/s):Math.floor(this.spriteSheet.width/s);i.forEach((function(t){var e,i=Math.floor(t/l),c=t%l;e=u?new n.PIXI.Rectangle(r.frame.x+c*s,r.frame.y+i*a,s,a):new n.PIXI.Rectangle(c*s,i*a,s,a),o.frames.push(e)}))}return Object.defineProperty(t.prototype,"frameCount",{get:function(){return this.frames.length},enumerable:!0,configurable:!0}),t}();e.AnimationSequence=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(9);e.eventEmitter=new n.PIXI.utils.EventEmitter,e.MOVE_TOPIC="MOVE",e.BURN_TOPIC="BURN",e.STATCHANGE_TOPIC="STATCHANGE",e.DAMAGE_TOPIC="DAMAGE",e.GROUND_SHAKE="SHAKE"},,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(119),s=function(){function t(){this.musicTrackNames=["assets/audio/Two-Finger-Johnny.mp3","assets/audio/Bumbling-Burglars_Looping.mp3","assets/audio/Bama-Country.mp3","assets/audio/Beachfront-Celebration.mp3","assets/audio/Easy-Jam.mp3","assets/audio/Whiskey-on-the-Mississippi.mp3","assets/audio/ZigZag.mp3","assets/audio/Carrousel.mp3","assets/audio/Disco-Break.mp3"],this.musicTracks=[],this.currentTrack=0,this.previousMusicVolume=.6,this.previousFxVolume=1,this.musicVolume=.6,this.fxVolume=1;for(var t=0,e=this.musicTrackNames.length;t<e;t++){var i=this.musicTrackNames[t];this.musicTracks.push(new n.Howl({preload:!1,src:[i],autoplay:!1,loop:!0,volume:.6}))}this.walkSnd=new n.Howl({src:["assets/audio/effects/step.mp3"],preload:!0,autoplay:!1,loop:!0,volume:1}),this.jumpSnd1=new n.Howl({src:["assets/audio/effects/jump1.mp3"],preload:!0,autoplay:!1,loop:!1,volume:1}),this.jumpSnd2=new n.Howl({src:["assets/audio/effects/jump2.mp3"],preload:!0,autoplay:!1,loop:!1,volume:1}),this.burnSnd=new n.Howl({src:["assets/audio/effects/burn.mp3"],preload:!0,autoplay:!1,loop:!0,volume:1}),this.hurtSnd=new n.Howl({src:["assets/audio/effects/hurt.mp3"],preload:!0,autoplay:!1,loop:!1,volume:1}),this.coinSnd=new n.Howl({src:["assets/audio/effects/coin.mp3"],preload:!0,autoplay:!1,loop:!1,volume:1}),this.gemSnd=new n.Howl({src:["assets/audio/effects/gem.mp3"],preload:!0,autoplay:!1,loop:!1,volume:1}),this.questItemSnd=new n.Howl({src:["assets/audio/effects/quest-item.mp3"],autoplay:!1,loop:!1,volume:1}),this.winSnd=new n.Howl({src:["assets/audio/effects/win.mp3"],autoplay:!1,loop:!1,volume:1}),this.atkMag1=new n.Howl({src:["assets/audio/effects/atk-mag01.mp3"],autoplay:!1,loop:!1,volume:1}),this.hitMag1=new n.Howl({src:["assets/audio/effects/hit-mag01.mp3"],autoplay:!1,loop:!1,volume:1}),this.jumpAtk=new n.Howl({src:["assets/audio/effects/jump-atk01.mp3"],autoplay:!1,loop:!1,volume:1}),this.pain=new n.Howl({src:["assets/audio/effects/pain01.mp3"],autoplay:!1,loop:!1,volume:1}),this.jmpContact=new n.Howl({src:["assets/audio/effects/jmp-contact.mp3"],autoplay:!1,loop:!1,volume:1}),this.woosh=new n.Howl({src:["assets/audio/effects/woosh.mp3"],autoplay:!1,loop:!1,volume:1}),this.squish=new n.Howl({src:["assets/audio/effects/mob-squish.mp3"],autoplay:!1,loop:!1,volume:1}),this.fxDemoSnd=new n.Howl({src:["assets/audio/effects/fx-demo.mp3"],autoplay:!1,loop:!1,volume:1})}return Object.defineProperty(t.prototype,"MusicVolume",{get:function(){return this.musicVolume},set:function(t){this.musicVolume=t,this.backgroundSnd&&this.backgroundSnd.playing()&&this.backgroundSnd.volume(this.musicVolume)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"FxVolume",{get:function(){return this.fxVolume},set:function(t){this.fxVolume=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsFxOn",{get:function(){return this.fxVolume>0},set:function(t){t?this.FxVolume=this.previousFxVolume:(this.previousFxVolume=this.fxVolume,this.FxVolume=0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsMusicOn",{get:function(){return this.musicVolume>0},set:function(t){t?this.MusicVolume=this.previousMusicVolume:(this.previousMusicVolume=this.musicVolume,this.MusicVolume=0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CurrentTrackId",{get:function(){return this.currentTrack},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fxDemo",{get:function(){return this.fxDemoSnd},enumerable:!0,configurable:!0}),t.prototype.jumpAttack=function(){this.walkSnd.pause(),this.jumpAtk.loop(!1),this.jumpAtk.play(),this.jumpAtk.volume(this.fxVolume)},t.prototype.jump=function(){this.walkSnd.pause(),this.jumpSnd1.play(),this.jumpSnd1.volume(this.fxVolume)},t.prototype.idle=function(){this.walkSnd.pause()},t.prototype.walk=function(t){this.walkSnd.rate(t?2:1.2),this.walkSnd.playing()||(this.walkSnd.volume(this.fxVolume),this.walkSnd.play())},t.prototype.atkMagic1=function(){this.atkMag1.volume(this.fxVolume),this.atkMag1.play()},t.prototype.hitMagic1=function(){this.hitMag1.volume(this.fxVolume),this.hitMag1.play()},t.prototype.hitPain=function(){this.pain.volume(this.fxVolume),this.pain.play()},t.prototype.mobSquish=function(){this.squish.volume(this.fxVolume),this.squish.play()},t.prototype.bulletHitWall=function(){this.woosh.volume(this.fxVolume),this.woosh.play()},t.prototype.coin=function(){this.coinSnd.volume(this.fxVolume),this.coinSnd.play()},t.prototype.gem=function(){this.gemSnd.volume(this.fxVolume),this.gemSnd.play()},t.prototype.hurt=function(){this.hurtSnd.volume(this.fxVolume),this.hurtSnd.play()},t.prototype.jumpContact=function(){this.jmpContact.volume(this.fxVolume),this.jmpContact.play()},t.prototype.questItem=function(){this.questItemSnd.volume(this.fxVolume),this.questItemSnd.play()},t.prototype.win=function(){this.backgroundSnd&&this.backgroundSnd.playing()&&this.backgroundSnd.fade(1,0,500),this.hurtSnd.stop(),this.walkSnd.stop(),this.jumpSnd1.stop(),this.jumpSnd2.stop(),this.burnSnd.stop(),this.winSnd.volume(this.fxVolume),this.winSnd.play()},t.prototype.burn=function(){this.burnSnd.playing()||(this.burnSnd.volume(this.fxVolume),this.burnSnd.play()),this.hurt()},t.prototype.burnStop=function(){var t=this;this.burnSnd.fade(1,0,200),setTimeout((function(){return t.burnSnd.stop()}),200)},t.prototype.getTrack=function(t){for(var e=0,i=this.musicTrackNames.length;e<i;e++)if(this.musicTrackNames[e].indexOf(t)>=0)return e;return-1},t.prototype.stopTrack=function(){void 0!==this.backgroundSnd&&this.backgroundSnd.stop()},t.prototype.playTrack=function(t){var e=this;void 0===this.backgroundSnd&&(this.backgroundSnd=this.musicTracks[t],console.log("playTrack "+t,this.backgroundSnd)),this.backgroundSnd===this.musicTracks[t]&&this.backgroundSnd.playing()||(this.backgroundSnd.stop(),this.backgroundSnd=this.musicTracks[t],this.backgroundSnd.volume(this.musicVolume),this.backgroundSnd.play(),"unloaded"===this.backgroundSnd.state()&&(this.backgroundSnd.load(),this.backgroundSnd.once("load",(function(){e.backgroundSnd.play()})))),this.currentTrack=t},t}();e.SoundMan=s,e.snd=new s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(23),a=i(34),o=i(9),r=i(50),u=i(118),l=i(86),c=i(58),p=i(17),d=function(){function t(t){this.gameLevels=t}return t.registerFactory=function(t,e){this.factoryList.set(t,e)},t.prototype.buildLevel=function(t){for(var e,i=void 0,n=0;n<this.gameLevels.levels.length;n++)if(this.gameLevels.levels[n].id===t){i=this.gameLevels.levels[n];break}return i&&(e=this.createLevel(i)),e},t.prototype.createLevel=function(e){var i={parallax:[],entities:[],start:[],audioTrack:e.audioTrack,templates:[],spawnPoints:[]},n=new o.PIXI.Point(p.SCENE_WIDTH,p.SCENE_HEIGHT);e.parallax.forEach((function(t){var e=new o.Parallax(n,t.parallaxFactor,t.textures,t.scale);e.y=t.y,i.parallax.push(e)}));var a=s.LevelDefinitions.templates.concat(e.map.templates);return i.templates=a,e.map.entities.forEach((function(e,n,s){var o=t.createEntity(a,e);i.entities.push(o)})),e.map.NPC=e.map.NPC||[],e.map.NPC.forEach((function(e,n,s){if(e.type&&"spawn_point"===e.type){var o=e,r=o.entity;i.spawnPoints.push(new u.SpawnPoint(o.name,o.xy[0],o.xy[1],o.area,o.maxMobCount,o.respawnSeconds,r))}else{var l=t.createMob(a,e);i.entities.push(l)}})),i.start=e.map.start,i},t.createEntity=function(e,i){var n,s=c.getEntityDefinition(e,i),o=t.buildDisplayObject(s.doDef);return o.name=i.name||i.template,o.templateName=s.templateName,s.bdDef?((n=t.buildPhysicsObject(s.bdDef,o)).shapes.every((function(t){return"ground"===s.bdDef.collisionType?(t.collisionGroup=r.COL_GRP_GROUND,t.collisionMask=r.COL_GRP_PLAYER|r.COL_GRP_NPC|r.COL_GRP_SCENE|r.COL_GRP_BULLET):(t.collisionGroup=r.COL_GRP_SCENE,t.collisionMask=r.COL_GRP_PLAYER|r.COL_GRP_NPC|r.COL_GRP_SCENE|r.COL_GRP_GROUND),!0})),n.DisplayObject=o,s.trigger&&(n.Trigger=s.trigger)):(n=new a.Body).DisplayObject=o,n},t.createMob=function(e,i){var n=c.getEntityDefinition(e,i),s=t.buildDisplayObject(n.doDef);s.name=i.name||i.template,s.templateName=n.templateName,s.attributes=i.attributes||n.doDef.attributes||[],s.createAI(i.ai||"basic_static"),s.atkTexture=i.attack||n.doDef.attack,n.bdDef.material=n.bdDef.material||"mob_default";var a=t.buildPhysicsObject(n.bdDef,s);return a.shapes.every((function(t){return t.collisionGroup=r.COL_GRP_NPC,t.collisionMask=r.COL_GRP_PLAYER|r.COL_GRP_GROUND|r.COL_GRP_SCENE,!0})),a.DisplayObject=s,n.trigger&&(a.Trigger=n.trigger),a},t.buildDisplayObject=function(t){var e;switch((t=n.__assign({anchor:.5,pivot:.5,scale:[1,1]},t)).typeName){case"Mob":var i=new l.Mob(t.texture);t.sequences&&(i.clearAnimations(),t.sequences.forEach((function(e){var n=e.texture||t.texture,s=new o.AnimationSequence(e.name,n,e.frames,e.framesize[0],e.framesize[1]);i.addAnimations(s)})),i.play(t.sequences[0].name)),t.fps&&(i.fps=t.fps),i.typeName="Mob",e=i;break;case"Sensor":(e=new o.PIXI.DisplayObject).typeName="Sensor";break;case"AnimatedSprite":var s=new o.AnimatedSprite;t.sequences.forEach((function(t,e,i){var n=new o.AnimationSequence(t.name,t.texture,t.frames,t.framesize[0],t.framesize[1]);s.addAnimations(n)})),s.play(t.sequences[0].name,t.fps),s.typeName="AnimatedSprite",e=s;break;case"Sprite":var a=o.TextureLoader.Get(t.texture),r=new o.PIXI.Sprite(a);r.typeName="Sprite",e=r;break;default:var u=this.factoryList.get(t.typeName);if(!u)throw"Factory not found for object name: "+t.typeName;e=u(t)}return e.scale.set(t.scale[0],-1*t.scale[1]),e.anchor&&e.anchor.set(t.anchor),e.pivot.set(t.pivot),void 0!==t.visible&&(e.visible=t.visible),e.rotation=t.rotation||0,t.xy&&e.position.set(t.xy[0],t.xy[1]),t.interactionType&&(e.interactionType=t.interactionType),t.drop&&(e.drop=t.drop),t.tint&&(e.tint=parseInt(t.tint,16)),e},t.buildPhysicsObject=function(t,e,i){var n;void 0===i&&(i=!1);var s=0,o=0;if(t){var r={mass:t.mass,position:t.xy?t.xy:[e.x,e.y],angle:t.angle||e.rotation,fixedRotation:t.fixedRotation||!1,angularDamping:t.angularDamping||.1,damping:t.damping||.1};(n=new a.Body(r)).type=t.type||a.Body.KINEMATIC;var u,l=e;switch(t.shape){case"Circle":var c=32;c=t.size?t.size.constructor===Array?t.size[0]:t.size:l.width,u=new a.Circle({radius:c});break;case"Platform":t.size?(s=t.size[0],o=t.size[1]):(s=Math.abs(l.width),o=Math.abs(l.height)),u=new a.Box({width:s,height:o}),n.position[0]=n.position[0]+s/2,n.position[1]=n.position[1]-o/2;break;case"Box":t.size?(s=t.size[0],o=t.size[1]):l.width?(s=Math.abs(l.width),o=Math.abs(l.height)):(s=e.scale.x*e.getLocalBounds().width,o=e.scale.y*e.getLocalBounds().height),u=new a.Box({width:s,height:o})}t.material&&(u.materialName=t.material),!i&&e.interactionType?(u.sensor=!0,n.type=a.Body.STATIC,n.collisionResponse=!1,n.setDensity(0),console.log("created collectible sensor",u)):"Sensor"===e.typeName&&(u.sensor=!0,n.type=a.Body.STATIC,n.collisionResponse=!1,n.setDensity(0)),n.addShape(u)}return n},t.factoryList=new o.Dictionary,t}();e.LevelLoader=d},,,,,,,,,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(9),s=function(){function t(){}return t.IsAtlas=function(t){return t.frame.width!==t.baseTexture.width||t.frame.height!==t.baseTexture.height},t.Get=function(e,i,s){void 0===i&&(i=!1),void 0===s&&(s=n.PIXI.SCALE_MODES.LINEAR);var a=e.indexOf(".json@"),o=a>0?e.substr(a+6):e,r=a>0?e.substr(0,a+5):e,u=t.resourceCache[r];if(!u){t.resourceCache[r]=n.PIXI.Loader.shared.resources[r];var l=1===(u=t.resourceCache[r]).loadType?u.spritesheet.baseTexture:u.texture.baseTexture;l.mipmap=i,l.scaleMode=s}if(u){switch(u.loadType){case 1:return u.textures[o];case 2:return u.texture}console.error("Resource:'"+e+"' unknown load type!",u)}else console.error("Resource:'"+e+"' not found!")},t.resourceCache={},t}();e.TextureLoader=s},,,,,,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.COL_GRP_PLAYER=1,e.COL_GRP_NPC=2,e.COL_GRP_SCENE=4,e.COL_GRP_BULLET=8,e.COL_GRP_GROUND=16},,,,,,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.dictValues={},this.dictKeys=[]}return t.prototype.get=function(t){return this.dictValues[t]},t.prototype.contains=function(t){return t in this.dictValues},t.prototype.remove=function(t){var e=this.dictKeys.indexOf(t,0);this.dictKeys.splice(e,1),delete this.dictValues[t]},t.prototype.set=function(t,e){t in this.dictValues||this.dictKeys.push(t),this.dictValues[t]=e},Object.defineProperty(t.prototype,"keys",{get:function(){return this.dictKeys},enumerable:!0,configurable:!0}),t.prototype.getAll=function(){return this.dictValues},t.prototype.getSet=function(t,e){return this.contains(t)||this.set(t,"function"==typeof e?e():e),this.get(t)},t.prototype.clear=function(){this.dictKeys=[],this.dictValues={}},t}();e.Dictionary=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10);function s(t,e){var i=null,s=null,a={name:null,displayObject:{typeName:"Sprite"},body:null,trigger:null,drop:null},o=t.filter((function(t){return t.name===e.template}));o&&o.length>0&&(a=o[0]),i=n.__assign(n.__assign({},a.displayObject),e),a.drop&&(i=n.__assign(n.__assign({},i),{drop:a.drop})),a.body&&(s=a.body);var r=void 0;return(a.trigger||i.trigger)&&(r=n.__assign(n.__assign({},a.trigger),i.trigger)),{templateName:a.name,doDef:i,bdDef:s,trigger:r}}function a(t){for(var e={},i=[],n=0;n<t.length;n++)e[t[n]]||(e[t[n]]=!0,i.push(t[n]));return i}e.GetLevelAssets=function(t,e){for(var i=[],o=void 0,r=0;r<t.levels.length;r++)if(t.levels[r].id===e){o=t.levels[r];break}if(o){o.parallax.forEach((function(t){i=i.concat(t.textures)})),o.assets&&o.assets.length>0&&(i=i.concat(o.assets));var u=t.templates.concat(o.map.templates);o.map.templates.forEach((function(t){if(!t.type||"spawn_point"!==t.type){var e=t.displayObject;e.texture&&("string"==typeof e.texture?i.push(e.texture):i=i.concat(e.texture)),e.sequences&&e.sequences.forEach((function(t){i.push(t.texture)}))}})),o.map.entities.forEach((function(t){var e=s(u,t);e.doDef.texture&&("string"==typeof e.doDef.texture?i.push(e.doDef.texture):i=i.concat(e.doDef.texture)),e.doDef.sequences&&e.doDef.sequences.forEach((function(t){i.push(t.texture)}))})),o.map.NPC=o.map.NPC||[],o.map.NPC.forEach((function(t){if(t.type&&"spawn_point"===t.type);else{var e=t;e.attack&&(i=i.concat(e.attack));var s=u.filter((function(t){return t.name===e.template}));if(s&&s.length>0){var a=s[0],o=n.__assign(n.__assign({},a.displayObject),e);o.texture&&("string"==typeof o.texture?i.push(o.texture):i=i.concat(o.texture)),o.attack&&(i=i.concat(o.attack)),o.sequences&&o.sequences.forEach((function(t){t.texture&&i.push(t.texture)}))}}}))}return i=a(i=i.map((function(t){var e=t.indexOf(".json@");return e>0?t.substr(0,e+5):t})))},e.getEntityDefinition=s,e.getUniqueItems=a},,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(87),a=i(32),o=i(120),r=i(25),u=i(20),l=i(28),c=i(27),p=function(t){function e(e){var i=t.call(this)||this;return i.textureName=e,i._isDead=!1,i.isLoading=!1,i.attack=function(){var t=i.currentSequence,e=i.fps;a.snd.atkMagic1(),i._direction==u.DirectionH.Left?i.play("latk",e,!1):i.play("ratk",e,!1),i.onComplete=function(n){i.onComplete=null,i.fireBullet(),i.play(t.sequenceName,e)}},i.addAnimations(new l.AnimationSequence("left",i.textureName,[0,1,2],48,48)),i.addAnimations(new l.AnimationSequence("right",i.textureName,[3,4,5],48,48)),i.addAnimations(new l.AnimationSequence("latk",i.textureName,[6,7,8],48,48)),i.addAnimations(new l.AnimationSequence("ratk",i.textureName,[9,10,11],48,48)),i.addAnimations(new l.AnimationSequence("lsquish",i.textureName,[12,13,14,15,16,17],48,48)),i.addAnimations(new l.AnimationSequence("rsquish",i.textureName,[18,19,20,21,22,23],48,48)),i.play("left"),i._direction=u.DirectionH.Left,i}return n.__extends(e,t),Object.defineProperty(e.prototype,"isDead",{get:function(){return this._isDead},set:function(t){t!=this._isDead&&(this._isDead=t,this._isDead&&this.onDeathCallBack&&this.onDeathCallBack())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onDeath",{get:function(){return this.onDeathCallBack},set:function(t){this.onDeathCallBack=t},enumerable:!0,configurable:!0}),e.prototype.squish=function(t){this.isDead=!0;var e=this._direction==u.DirectionH.Left?"lsquish":"rsquish";this.onComplete=t,this.play(e,12,!1),a.snd.mobSquish()},Object.defineProperty(e.prototype,"direction",{get:function(){return this._direction},set:function(t){this._direction!=t&&(this._direction=t,t===u.DirectionH.Left?this.play("left"):this.play("right"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attributes",{get:function(){return this._attributes},set:function(t){this._attributes=t},enumerable:!0,configurable:!0}),e.prototype.fireBullet=function(){this.atkTexture.constructor===Array||s.Bullet.emitBullet(this.atkTexture,this.position,r.wp2.playerBody.position,this._attributes[u.AtrType.Atk])},e.prototype.createAI=function(t){switch(t.toLowerCase()){case"basic_static":this._ai=new o.BasicStaticAI(this)}},e.prototype.onUpdate=function(e){t.prototype.onUpdate.call(this,e),this.isDead||this.isLoading||this._ai.onUpdate(e)},e}(c.AnimatedSprite);e.Mob=p},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(34),a=i(50),o=i(25),r=i(9),u=i(43),l=function(t){function e(e,i,n,s){var a=t.call(this,e)||this;return a.velocity=i,a.damage=s,a.direction=new r.PIXI.Point,a.interactionType=666,a.onUpdate=function(){if(!a.isDead){var t=performance.now()/1e3-a.startTime;a.IsDead=a.ttl<t}},a.ttl=n,a.IsDead=!1,a}return n.__extends(e,t),Object.defineProperty(e.prototype,"Direction",{get:function(){return this.direction},set:function(t){var e=t.x*t.x+t.y*t.y;e=1/Math.sqrt(e),this.direction.set(t.x*e,t.y*e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IsDead",{get:function(){return this.isDead},set:function(t){t!=this.isDead&&(this.isDead=t,this.isDead?this.body&&(this.body.velocity=[0,0]):(this.startTime=performance.now()/1e3,this.body&&(this.body.position=[this.position.x,this.position.y])),this.isDead&&this.onDeath&&this.onDeath(),this.visible=!this.isDead)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"OnDeath",{get:function(){return this.onDeath},set:function(t){this.onDeath=t},enumerable:!0,configurable:!0}),e.reset=function(){e.bullets=[]},e.bullets=[],e.emitBullet=function(t,i,n,l){var c=e.findDeadBullet();if(!c){(c=new e(u.TextureLoader.Get(t),200,5,l)).anchor.set(.5),c.scale.set(.5,-.5),e.bullets.push(c),r.Global.worldContainer.addChild(c);var p=new s.Circle({radius:c.width/2});p.collisionGroup=a.COL_GRP_BULLET,p.collisionMask=a.COL_GRP_PLAYER|a.COL_GRP_SCENE|a.COL_GRP_GROUND,p.sensor=!0;var d={mass:0,position:[i.x,i.y],angle:0,fixedRotation:!1,angularDamping:0,damping:0},h=new s.Body(d);h.addShape(p),h.setDensity(0),h.gravityScale=0,h.angularVelocity=2,h.collisionResponse=!1,h.type=s.Body.DYNAMIC,h.DisplayObject=c,c.body=h,o.wp2.addBody(h)}c.position=i;var f=n instanceof Float32Array?new r.PIXI.Point(n[0]-i.x,n[1]-i.y):new r.PIXI.Point(n.x-i.x,n.y-i.y);return c.Direction=f,c.damage=l,c.IsDead=!1,c.body.velocity[0]=c.Direction.x*c.velocity,c.body.velocity[1]=c.Direction.y*c.velocity,c},e.findDeadBullet=function(){for(var t=0,i=e.bullets.length;t<i;t++){var n=e.bullets[t];if(n.IsDead)return n}return null},e}(r.PIXI.Sprite);e.Bullet=l},,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(9),s=i(104),a=["Permanent Marker","Orbitron"];console.log("initializing google webfont loader ...",a);try{var o={google:{families:a},active:function(){console.log("fonts preload finished!");var t=n.Global.getScm(),e=new s.BootScene(t);t.AddScene(e),t.ActivateScene(e)}};window.WebFontConfig=o}catch(t){console.log(t)}var r=("https:"===document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",u=document.createElement("script");u.src=r,u.type="text/javascript",u.async=!0;var l=document.getElementsByTagName("script")[0];l.parentNode&&l.parentNode.insertBefore(u,l)},,,,,,,,,,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(9),a=function(t){function e(e,i,n,s,a){void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=128),void 0===a&&(a=32);var o=t.call(this)||this;return o.isHighlightedValue=!1,o.isPressedValue=!1,o.isDisabledValue=!1,o.isClickStartedValue=!1,o.requestedWidth=0,o.requestedHeight=0,o.onButtonDown=function(){o.isDisabledValue||(o.isClickStartedValue=!0,o.texture=o.textureDown)},o.onButtonUp=function(t){o.isDisabledValue||(o.isClickStartedValue&&(o.isClickStartedValue=!1,o.onClickHandler(t)),o.applyTexture())},o.onButtonUpOutside=function(){o.isDisabledValue||(o.applyTexture(),o.isClickStartedValue=!1)},o.onButtonOver=function(t){o.isDisabledValue||(o.texture=o.textureHighlight,o.mouseover&&o.mouseover(t))},o.onButtonOut=function(t){o.isDisabledValue||(o.isClickStartedValue=!1,o.applyTexture(),o.mouseout&&o.mouseout(t))},o.position.set(i||0,n||0),o.requestedHeight=a,o.requestedWidth=s,o.setTexture(e),o.buttonMode=!1,o.interactive=!0,o.cursor="hover",o.on("pointerdown",o.onButtonDown),o.on("pointerup",o.onButtonUp),o.on("pointerupoutside",o.onButtonUpOutside),o.on("pointerover",o.onButtonOver),o.on("pointerout",o.onButtonOut),o.isPressed=!1,o}return n.__extends(e,t),Object.defineProperty(e.prototype,"disabled",{get:function(){return this.isDisabledValue},set:function(t){this.isDisabledValue=t,this.cursor=t?"":"hover",this.applyTexture()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPressed",{get:function(){return this.isPressedValue},set:function(t){this.isPressedValue=t,this.applyTexture()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isHighlighted",{get:function(){return this.isHighlightedValue},set:function(t){this.isHighlightedValue=t,this.applyTexture()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this.textValue},set:function(t){if(this.textValue&&this.removeChild(this.textValue),this.textValue=t,this.textValue){this.textValue.anchor.set(.5,.5);var e=this.width/this.scale.x/2,i=this.height/this.scale.y/2;this.textValue.position.set(e,i),this.addChild(this.textValue)}},enumerable:!0,configurable:!0}),e.prototype.performClick=function(t){this.onClickHandler(t)},e.prototype.setTexture=function(t){var e=s.TextureLoader.Get(t,!0,s.PIXI.SCALE_MODES.NEAREST);e.baseTexture.scaleMode=s.PIXI.SCALE_MODES.NEAREST;var i=e.height/3,n=e.width;this.textureUp=new s.PIXI.Texture(e.baseTexture,new s.PIXI.Rectangle(e.frame.x,e.frame.y,n,i)),this.textureHighlight=new s.PIXI.Texture(e.baseTexture,new s.PIXI.Rectangle(e.frame.x,e.frame.y+1*i,n,i)),this.textureDown=new s.PIXI.Texture(e.baseTexture,new s.PIXI.Rectangle(e.frame.x,e.frame.y+2*i,n,i));var a=(this.requestedWidth||n)/n,o=(this.requestedHeight||i)/i;this.scale.set(a,o),this.applyTexture()},e.prototype.onClickHandler=function(t){this.onClick?this.onClick(t):console.warn("onClick() empty, did you forget to attach a handler?")},e.prototype.applyTexture=function(){this.isDisabledValue?(this.texture=this.textureUp,this.tint=6316128):this.isHighlightedValue?(this.texture=this.textureHighlight,this.tint=6710886):(this.texture=this.isPressedValue?this.textureDown:this.textureUp,this.tint=16777215)},e}(s.PIXI.Sprite);e.SpriteButton=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(9),a=function(t){function e(e,i,n,a){var o=t.call(this)||this;return o.textureScale=a,o.spriteBuffer=[],o.spriteOrderList=[],o.totalWidth=0,o.recalculatePosition=function(t){var e=o.spriteOrderList[0],i=o.spriteBuffer[e],n=o.spriteOrderList[o.spriteOrderList.length-1],s=o.spriteBuffer[n],a=(o.worldPosition-t)*o.parallaxFactor;o.updatePositions(a),t>o.worldPosition?i.x+i.width<0&&(o.spriteOrderList.push(o.spriteOrderList.shift()),i.x=s.x+s.width):s.x>o.viewPortSize.x&&(o.spriteOrderList.unshift(o.spriteOrderList.pop()),s.x=i.x-s.width),o.worldPosition=t},o.viewPortSize=e||new s.PIXI.Point(100,100),o.parallaxFactor=i||1,o.textureScale=o.textureScale||1,o.setTextures(n),o.worldPosition=0,o.SetViewPortX(1),o}return n.__extends(e,t),Object.defineProperty(e.prototype,"WorldPosition",{get:function(){return this.worldPosition},enumerable:!0,configurable:!0}),e.prototype.SetViewPortX=function(t){this.worldPosition!==t&&this.recalculatePosition(t)},Object.defineProperty(e.prototype,"ViewPortSize",{get:function(){return this.viewPortSize},set:function(t){this.viewPortSize=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ParallaxFactor",{get:function(){return this.parallaxFactor},set:function(t){this.parallaxFactor=t},enumerable:!0,configurable:!0}),e.prototype.setTextures=function(t){for(var e,i=0,n=this.getTexture(t,0),a=n.width*this.textureScale;this.spriteBuffer.length<3||this.spriteBuffer.length<t.length||this.totalWidth<=this.viewPortSize.x+a;){e=i%t.length,(n=this.getTexture(t,e)).rotate=8;var o=new s.PIXI.Sprite(n);o.x=this.totalWidth,o.scale.set(this.textureScale,this.textureScale),o.anchor.set(0,0),this.spriteBuffer.push(o),this.spriteOrderList.push(this.spriteBuffer.length-1),this.addChild(o),this.totalWidth+=o.width,i++}},e.prototype.getTexture=function(t,e){return"string"==typeof t[e]?s.TextureLoader.Get(t[e]):t[e]},e.prototype.updatePositions=function(t){for(var e=0,i=this.spriteBuffer;e<i.length;e++){i[e].position.x+=t}},e}(s.PIXI.Container);e.Parallax=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,s=function(){function t(){var t=this;this.ALT_KEY=18,this.SHIFT_KEY=16,this.CTRL_KEY=17,this.addKeyboardActionHandler=function(e,i){t.stateActions[i]||(t.stateActions[i]=[]),t.stateActions[i].push(e)},this.stateActions={},this.keyboard=[];for(var e=0;e<256;e++)this.keyboard[e]=!1;document.addEventListener("keydown",this.keydown.bind(this),!1),document.addEventListener("keyup",this.keyup.bind(this),!1)}return t.prototype.update=function(t){var e=this.stateActions[t];this.findHandlerAndInvoke(e),e=this.stateActions[n.GLOBAL],this.findHandlerAndInvoke(e)},t.prototype.isKeyDown=function(t){return this.keyboard[t]},t.prototype.findHandlerAndInvoke=function(t){if(t)for(var e=t.length,i=0;i<e;i++){var n=t[i];n&&n.isAssigned()&&n.handler&&this.keyboard[n.key]&&this.keyboard[this.ALT_KEY]===n.altKey&&this.keyboard[this.SHIFT_KEY]===n.shiftKey&&this.keyboard[this.CTRL_KEY]===n.ctrlKey&&(n.handler(),n.releaseKeyAfterInvoke&&(this.keyboard[n.key]=!1))}},t.prototype.keydown=function(t){this.keyboard[t.which]=!0},t.prototype.keyup=function(t){this.keyboard[t.which]=!1},t}();e.KeyboardMapper=s,function(t){t[t.GLOBAL=0]="GLOBAL",t[t.MENU=1]="MENU",t[t.IN_GAME=2]="IN_GAME",t[t.CUSTOM1=3]="CUSTOM1",t[t.CUSTOM2=4]="CUSTOM2",t[t.CUSTOM3=5]="CUSTOM3",t[t.CUSTOM4=6]="CUSTOM4",t[t.CUSTOM5=7]="CUSTOM5"}(n=e.State||(e.State={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(9),a=i(105),o=["assets/cur_default.png","assets/cur_hover.png","assets/cur_target.png","assets/levels.json","assets/quests.json"],r=function(t){function e(e){var i=t.call(this,"Boot")||this;return i.sceneManager=e,i.onUpdate=function(t){i.spinner&&(i.spinner.rotation+=.05)},i.onActivate=function(){i.loadingMessage=new s.PIXI.Text("booting ...",{fontSize:"36px",fontFamily:"Permanent Marker",fill:65280,dropShadow:!0,stroke:4521796,strokeThickness:1}),i.loadingMessage.anchor.set(.5,.5),i.loadingMessage.position.set(s.SCENE_HALF_WIDTH,s.SCENE_HALF_HEIGHT-80),i.addChild(i.loadingMessage),s.PIXI.Loader.shared.reset().add("assets/loading.png").load(i.startPreloading)},i.startPreloading=function(){return n.__awaiter(i,void 0,void 0,(function(){var t;return n.__generator(this,(function(e){return t=s.PIXI.Texture.from("assets/loading.png"),this.spinner=new s.PIXI.Sprite(t),this.spinner.position.set(s.SCENE_HALF_WIDTH,s.SCENE_HALF_HEIGHT),this.spinner.anchor.set(.5,.5),this.spinner.scale.set(.5),this.addChild(this.spinner),console.log("initializing common assets preloading ...",o),s.PIXI.Loader.shared.add(o).load(this.onPreloadFinished),[2]}))}))},i.onPreloadFinished=function(){return n.__awaiter(i,void 0,void 0,(function(){var t,e,i;return n.__generator(this,(function(n){return t="url('assets/cur_default.png'),auto","url('assets/cur_hover.png'),auto","url('assets/cur_target.png') 24 24, auto",this.sceneManager.Renderer.plugins.interaction.cursorStyles.default=t,this.sceneManager.Renderer.plugins.interaction.cursorStyles.hover="url('assets/cur_hover.png'),auto",this.sceneManager.Renderer.plugins.interaction.cursorStyles.target="url('assets/cur_target.png') 24 24, auto",document.body.style.cursor=t,s.Global.LevelDefinitions=s.PIXI.Loader.shared.resources["assets/levels.json"].data,e=s.PIXI.Loader.shared.resources["assets/quests.json"].data,s.Global.LevelDefinitions.quests=e.quests,s.Global.LevelDefinitions.quests.forEach((function(t){t.itemId=t.itemId||0,t.itemsNeeded=t.itemsNeeded||0,t.itemsCollected=0,t.rewardCoins=t.rewardCoins||0,t.rewardExp=t.rewardExp||0})),i=new a.LoaderScene(this.sceneManager),this.sceneManager.AddScene(i),this.sceneManager.ActivateScene(i),[2]}))}))},i.BackGroundColor=0,i}return n.__extends(e,t),e}(s.Scene);e.BootScene=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(9),a=i(58),o=i(21),r=i(17),u=i(122),l=i(123),c=i(132),p=i(133),d=function(t){function e(e){var i=t.call(this,"Loader")||this;i.sceneManager=e,i.preloadAssets=["assets/gui-atlas.json","assets/objects-atlas.json","assets/entities-atlas.json","assets/background-atlas.json"],i.onUpdate=function(t){i.spinner&&(i.spinner.rotation+=.05)},i.onActivate=function(){console.log("downloading level "+o.stats.currentGameLevel+"...");var t=a.GetLevelAssets(s.Global.LevelDefinitions,o.stats.currentGameLevel);t=t.concat(i.preloadAssets,"assets/font/orbitron.fnt","assets/font/orbitron_outline.fnt","assets/font/bauhaus.fnt"),t=a.getUniqueItems(t),s.PIXI.Loader.shared.reset().add(t).load(i.handleLevelLoading).on("progress",i.onProgress)},i.handleLevelLoading=function(){i.sceneManager.HasScene("Main")||(console.log("adding scenes..."),i.sceneManager.AddScene(new l.MainScene(i.sceneManager)),i.sceneManager.AddScene(new c.OptionsScene(i.sceneManager)),i.sceneManager.AddScene(new p.CutScene(i.sceneManager)),i.sceneManager.MasterHudOverlay=new u.MasterHud(i.sceneManager));try{var t=i.sceneManager.GetScene("Main");setTimeout((function(){t.startLevel()}),200)}catch(t){console.log("exception: ",t)}},i.onProgress=function(t,e){var n=t.progress;console.log("progress: "+n.toFixed(0)+"%, asset: "+e.name),i.loadingMessage.text="Loading "+n.toFixed(0)+" %"},i.BackGroundColor=0,i.loadingMessage=new s.PIXI.Text("loading ...",{fontSize:36,fontFamily:"Permanent Marker",fill:65280,dropShadow:!0,align:"center",stroke:4521796,strokeThickness:1}),i.loadingMessage.anchor.set(.5,.5),i.loadingMessage.position.set(r.SCENE_HALF_WIDTH,r.SCENE_HALF_HEIGHT-80),i.addChild(i.loadingMessage);var n=s.PIXI.Texture.from("assets/loading.png");return i.spinner=new s.PIXI.Sprite(n),i.spinner.position.set(r.SCENE_HALF_WIDTH,r.SCENE_HALF_HEIGHT),i.spinner.anchor.set(.5,.5),i.spinner.scale.set(.5),i.addChild(i.spinner),i}return n.__extends(e,t),e}(s.Scene);e.LoaderScene=d},,,,,,,,,,,,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(33),s=i(25),a=i(21),o=i(9),r=i(27),u=i(28),l=function(){function t(t,e,i,n,s,a,o,r){void 0===r&&(r=!0),this.name=t,this.x=e,this.y=i,this.area=n,this.maxMobCount=s,this.respawnSeconds=a,this.entity=o,this.active=r,this.mobCount=0,this.nextSpawn=0,this.nextSpawn=performance.now()/1e3}return Object.defineProperty(t.prototype,"IsActive",{get:function(){return this.active},set:function(t){this.active=t},enumerable:!0,configurable:!0}),t.prototype.onUpdate=function(t){var e=this;if(this.active&&this.mobCount<this.maxMobCount){var i=performance.now()/1e3;if(this.nextSpawn<=i){this.worldContainer||(this.worldContainer=o.Global.getScm().GetScene("Main").worldContainer);var l=n.LevelLoader.createMob(a.stats.currentLevel.templates,this.entity),c=l.DisplayObject,p=this.x+Math.random()*this.area-this.area/2,d=this.y;l.position=[p,d],s.wp2.addBody(l),c.position.set(p,d),c.visible=!1,c.isLoading=!0,this.worldContainer.addChild(c);var h=new r.AnimatedSprite;h.addAnimations(new u.AnimationSequence("load","assets/entities-atlas.json@load.png",[0,1,2,3],64,64)),h.anchor.set(.5),h.position.set(p,d+10),h.play("load",4,!0),h.scale.set(1,-1),this.worldContainer.addChild(h),setTimeout((function(){e.worldContainer.removeChild(h),c.isLoading=!1,c.visible=!0}),3e3),c.onDeath=function(){console.log("mob died"),e.mobCount--},this.mobCount++,this.nextSpawn=performance.now()/1e3+this.respawnSeconds}}},t}();e.SpawnPoint=l},,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=function(t){function e(e){return t.call(this,e)||this}return n.__extends(e,t),e.prototype.canFire=function(){var t=performance.now(),e=2e3*Math.random(),i=this.lastFire+this.attackCD+e<=t;if(i){var n=Math.random();i=i&&n>.3,this.lastFire=performance.now()}return i},e}(i(121).AI);e.BasicStaticAI=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(23),s=i(20),a=function(){function t(t){var e=this;this.mobEntity=t,this.lastFire=0,this.onUpdate=function(t){e.calcDistance(),e.targetDistance<1050&&e.turnTowardsTarget(),e.targetDistance<800?(e.hasTarget=!0,e.canFire()&&(e.mobEntity.attack(),e.lastFire=performance.now())):e.hasTarget=!1},this.attackCD=t.attributes[s.AtrType.AtkCD]}return t.prototype.calcDistance=function(){var t=n.position.x-this.mobEntity.x,e=n.position.y-this.mobEntity.y;this.targetDistance=Math.sqrt(t*t+e*e)},t.prototype.turnTowardsTarget=function(){var t=n.position.x-this.mobEntity.x;t<0&&this.mobEntity.direction!=s.DirectionH.Left?this.mobEntity.direction=s.DirectionH.Left:t>0&&this.mobEntity.direction!=s.DirectionH.Right&&(this.mobEntity.direction=s.DirectionH.Right)},t.prototype.canFire=function(){var t=performance.now();return this.lastFire+this.attackCD<=t},t}();e.AI=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(9),a=s.SCENE_WIDTH-48,o=function(t){function e(e){var i=t.call(this)||this;i.sceneManager=e,["","webkit","moz","ms"].forEach((function(t){return document.addEventListener(t+"fullscreenchange",(function(t){i.isFullScreen?n.setTexture("assets/gui-atlas.json@gui_fs_exit.png"):n.setTexture("assets/gui-atlas.json@gui_fs_enter.png"),n.scale.set(1)}),!1)}));var n=new s.SpriteButton("assets/gui-atlas.json@gui_fs_enter.png",a,4);n.onClick=function(){return i.toggleFullScreen()},n.scale.set(1),i.addChild(n);var o=new s.SpriteButton("assets/gui-atlas.json@gui_options.png",a-48,4);return o.onClick=function(){return i.sceneManager.ActivateScene("Options")},o.name="BTN_OPTIONS",o.scale.set(1),i.addChild(o),i}return n.__extends(e,t),Object.defineProperty(e.prototype,"isFullScreen",{get:function(){var t=document;return!!(t.fullscreenElement||t.mozFullScreenElement||t.webkitFullscreenElement||t.msFullscreenElement)},enumerable:!0,configurable:!0}),e.prototype.toggleFullScreen=function(){var t=document,e=document.documentElement,i=e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullScreen||e.msRequestFullscreen,n=t.exitFullscreen||t.mozCancelFullScreen||t.webkitExitFullscreen||t.msExitFullscreen;this.isFullScreen?n.call(t):i.call(e)},e}(s.PIXI.Container);e.MasterHud=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(34),a=i(9),o=i(25),r=i(124),u=i(126),l=i(21),c=i(87),p=i(29),d=i(17),h=i(127),f=i(33),m=i(128),y=i(129),v=i(32),g=i(130),S=i(20),b=function(t){function e(e){var i=t.call(this,"Main")||this;return i.sceneManager=e,i.shakeDuration=0,i.shakeEnd=0,i.nextShake=0,i.magnitude=0,i.SHAKE_COUNT=15,i.startGroundShake=function(t){i.shakeEnd=performance.now()+t.milliSeconds,i.magnitude=t.magnitudeInPixels,i.shakeDuration=t.milliSeconds/i.SHAKE_COUNT},i.BackGroundColor=d.SCENE_BACKCOLOR,i.setup(),i}return n.__extends(e,t),e.prototype.onUpdate=function(t,e){o.wp2.update(t),this.worldContainer.x=d.SCENE_HALF_WIDTH-this.hero.x,this.worldContainer.y=d.SCENE_HEIGHT-70,a.TWEEN.update(),l.stats.currentLevel.parallax.forEach((function(t){t.SetViewPortX(a.Global.position.x),t.position.x=a.Global.position.x-d.SCENE_HALF_WIDTH}));for(var i=o.wp2.bodies,n=0,r=i.length;n<r;n++){var u=(f=i[n]).DisplayObject;if(u&&u.visible&&f.type!==s.Body.STATIC&&(u.position.set(Math.floor(f.interpolatedPosition[0]),Math.floor(f.interpolatedPosition[1])),u.rotation=f.interpolatedAngle),f.Trigger&&"distance"===f.Trigger.type&&this.questMngr.canActivateTrigger(f.Trigger)){var c=this.hero.position.x-f.position[0],p=this.hero.position.y-f.position[1],h=Math.sqrt(c*c+p*p);f.Trigger.distance>=h&&this.questMngr.handleTriggerEvent(f)}}for(n=0,r=o.wp2.playerContacts.length;n<r;n++){var f;(f=o.wp2.playerContacts[n]).DisplayObject&&f.DisplayObject.interactionType&&this.handleInteractiveCollision(f),f.Trigger&&"collision"===f.Trigger.type&&this.questMngr.handleTriggerEvent(f)}for(n=0,r=this.worldContainer.children.length;n<r;n++){var m=this.worldContainer.children[n];m&&m.onUpdate&&m.onUpdate(t)}for(n=0,r=l.stats.currentLevel.spawnPoints.length;n<r;n++)l.stats.currentLevel.spawnPoints[n].onUpdate(t);this.hud.onUpdate(t),l.stats.onUpdate(t);var y=performance.now();if(l.stats.getStat(S.StatType.HP)<=0){this.IsHeroInteractive=!1,this.hero.visible=!1;var v=this.sceneManager.GetScene("CutScene"),g=this.sceneManager.CaptureScene();v.SetBackGround(g,this.scale),v.DeathScene=!0,this.sceneManager.ActivateScene(v)}else if(this.shakeEnd>=y){if(this.nextShake<=y){c=d.SCENE_HALF_WIDTH-this.hero.x,p=d.SCENE_HEIGHT-70;this.shakeX=c+this.randomRange(-this.magnitude/2,this.magnitude/2),this.shakeY=p+this.randomRange(-this.magnitude,this.magnitude),this.magnitude-=this.magnitude/this.SHAKE_COUNT,this.nextShake=y+this.shakeDuration}this.worldContainer.x=this.shakeX,this.worldContainer.y=this.shakeY}},e.prototype.setup=function(){this.worldContainer=new a.PIXI.Container,this.worldContainer.scale.y=-1,this.addChild(this.worldContainer),a.Global.worldContainer=this.worldContainer,this.hero=new r.HeroCharacter(this.worldContainer),this.hero.name="hero",this.hero.x=d.SCENE_HALF_WIDTH,this.worldContainer.addChild(this.hero),this.hero.play("idle",d.ANIMATION_FPS_SLOW),this.hud=new u.StatsHud,this.HudOverlay=this.hud,f.LevelLoader.registerFactory("Lava",(function(t){return new h.Lava(t.texture)})),f.LevelLoader.registerFactory("Platform",(function(t){return"string"==typeof t.texture?new m.Platform(t.tilesX||1,1,[t.texture]):new m.Platform(t.tilesX||1,t.tilesY||1,t.texture)})),f.LevelLoader.registerFactory("Bumper",(function(t){return new y.Bumper})),this.questMngr=new g.QuestManager(this),p.eventEmitter.on(p.BURN_TOPIC,(function(t){return t.isBurning?v.snd.burn():v.snd.burnStop()})),p.eventEmitter.on(p.GROUND_SHAKE,this.startGroundShake)},e.prototype.startLevel=function(){var t=this;this.clearLevel(),l.stats.loadLevel(),v.snd.playTrack(l.stats.currentLevel.audioTrack||0),l.stats.currentLevel.parallax.forEach((function(e,i){t.worldContainer.addChildAt(e,i),e.SetViewPortX(l.stats.currentLevel.start[0])})),l.stats.currentLevel.entities.forEach((function(e){t.worldContainer.addChild(e.DisplayObject),e.shapes&&e.shapes.length>0&&o.wp2.addBody(e)})),o.wp2.playerBody.position[0]=l.stats.currentLevel.start[0],o.wp2.playerBody.position[1]=l.stats.currentLevel.start[1],this.questMngr.reset(),this.hero.visible=!0,this.IsHeroInteractive=!0,this.hud.visible=!0,this.sceneManager.ActivateScene(this)},Object.defineProperty(e.prototype,"IsHeroInteractive",{set:function(t){this.hero.IsInteractive!==t&&(this.hero.IsInteractive=t,this.hero.IsInteractive||(this.hero.play("idle",d.ANIMATION_FPS_SLOW),v.snd.idle()))},enumerable:!0,configurable:!0}),e.prototype.collectObject=function(t){var e=this,i=t.DisplayObject,n=i.scale.x,s=i.position.x+45,o=i.position.y+160,r=i.position.x-d.SCENE_HALF_WIDTH,u=d.SCENE_HEIGHT,l=new a.TWEEN.Tween(i.position).to({x:s,y:o},150),c=new a.TWEEN.Tween(i.scale).to({x:n+.5,y:n+.5},500).easing(a.TWEEN.Easing.Linear.None),p=new a.TWEEN.Tween(i.position).to({x:r,y:u},2e3).easing(a.TWEEN.Easing.Back.In).onComplete((function(){return e.worldContainer.removeChild(i)}));l.chain(c,p).start(),this.removeEntity(t)},e.prototype.handleInteractiveCollision=function(t){var e=t.DisplayObject;switch(t.DisplayObject.interactionType){case 1:l.stats.increaseStat(S.StatType.Coins,1),this.collectObject(t),this.hud.addInfoMessage(e.position,"+1 coin",d.MSG_COIN_STYLE,-100),v.snd.coin();break;case 2:l.stats.increaseStat(S.StatType.Coins,10),this.collectObject(t),this.hud.addInfoMessage(e.position,"+10 coins",d.MSG_COIN_STYLE,-100),v.snd.coin();break;case 3:l.stats.increaseStat(S.StatType.Coins,100),this.collectObject(t),this.hud.addInfoMessage(e.position,"+100 coins",d.MSG_COIN_STYLE,-100),v.snd.gem();break;case 201:this.hud.addInfoMessage(e.position,"Kendo knowledge acquired!",d.MSG_COIN_STYLE),this.collectObject(t),v.snd.questItem(),this.questMngr.acquireItem(201);break;case 202:this.hud.addInfoMessage(e.position,"1 Ki acquired!",d.MSG_COIN_STYLE),this.collectObject(t),v.snd.questItem(),this.questMngr.acquireItem(202);break;case S.DamageType.LavaBorder:var i=performance.now()/1e3;(!l.stats.buffs[S.DamageType.LavaBorder]||l.stats.buffs[S.DamageType.LavaBorder]<i)&&this.hud.addInfoMessage(e.position,"Burning",d.MSG_WARN_STYLE,100),l.stats.buffs[S.DamageType.LavaBorder]=this.secondsFromNow(1);break;case S.DamageType.Lava:i=performance.now()/1e3;(!l.stats.buffs[S.DamageType.Lava]||l.stats.buffs[S.DamageType.Lava]<i)&&this.hud.addInfoMessage(e.position,"Burning",d.MSG_WARN_STYLE,100),l.stats.buffs[S.DamageType.Lava]=this.secondsFromNow(4)}},e.prototype.secondsFromNow=function(t){var e=performance.now()/1e3;return e+=t},e.prototype.removeEntity=function(t,e){void 0===e&&(e=!1),o.wp2.removeBody(t),e&&this.worldContainer.removeChild(t.DisplayObject),t.DisplayObject=null},e.prototype.clearLevel=function(){var t=this;l.stats.currentLevel&&(l.stats.currentLevel.parallax.forEach((function(e,i){t.worldContainer.removeChild(e)})),l.stats.currentLevel.entities.forEach((function(e){e!==o.wp2.playerBody&&(t.worldContainer.removeChild(e.DisplayObject),o.wp2.removeBody(e),e.DisplayObject=null)})),this.worldContainer.children.filter((function(t){return"hero"!==t.name})).forEach((function(e){t.worldContainer.removeChild(e)})),o.wp2.clearLevel(),c.Bullet.reset())},e.prototype.randomRange=function(t,e){return t+Math.random()*(e-t)},e}(a.Scene);e.MainScene=b},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(23),a=i(9),o=i(29),r=i(125),u=i(25),l=i(21),c=i(86),p=i(33),d=i(32),h=i(20),f=i(27),m=i(43),y=i(28),v=function(t){function e(e){var i=t.call(this)||this;i.container=e,i.onUpdate=function(e){switch(i.position.x=a.Global.position.x,i.position.y=a.Global.position.y,i.IsInteractive&&i.movementCtrl.update(e),i.movementCtrl.MovementState){case r.MovementState.Idle:i.emitterPixies.emit=!1;break;case r.MovementState.Left:case r.MovementState.JumpLeft:i.emitterPixies.emit=i.movementCtrl.IsRunning,i.emitterPixies.minStartRotation=-25,i.emitterPixies.maxStartRotation=25;break;case r.MovementState.Right:case r.MovementState.JumpRight:i.emitterPixies.emit=i.movementCtrl.IsRunning,i.emitterPixies.minStartRotation=155,i.emitterPixies.maxStartRotation=205;break;case r.MovementState.JumpUp:i.emitterPixies.emit=i.movementCtrl.IsRunning,i.emitterPixies.minStartRotation=245,i.emitterPixies.maxStartRotation=295}if(i.emitterPixies.update(.001*e),i.emitterPixies.updateOwnerPos(i.position.x,i.position.y),i.emitterBurn.update(.001*e),i.movementCtrl.IsRunning&&i.movementCtrl.MovementState!==r.MovementState.Idle){l.stats.increaseStat(h.StatType.Dust,.005*-e);var n=8*Math.PI/180;i.rotation=i.movementCtrl.MovementState===r.MovementState.Left?n:-n}else i.rotation=0;i.emitterBurn.emit=l.stats.isBurning,t.prototype.onUpdate.call(i,e)},i.onPlayerMove=function(t){var e=t.newState,n=t.isRunning?1.6*a.ANIMATION_FPS_NORMAL:a.ANIMATION_FPS_NORMAL;switch(e){case r.MovementState.Idle:i.idleAnimationTimeoutHandle&&clearTimeout(i.idleAnimationTimeoutHandle),i.idleAnimationTimeoutHandle=setTimeout((function(){i.play("idle",a.ANIMATION_FPS_SLOW),d.snd.idle()}),300);break;case r.MovementState.Left:clearTimeout(i.idleAnimationTimeoutHandle),i.play("left",n),d.snd.walk(t.isRunning);break;case r.MovementState.Right:clearTimeout(i.idleAnimationTimeoutHandle),i.play("right",n),d.snd.walk(t.isRunning);break;case r.MovementState.JumpLeft:clearTimeout(i.idleAnimationTimeoutHandle),i.play("jumpleft",n),d.snd.jump();break;case r.MovementState.JumpRight:clearTimeout(i.idleAnimationTimeoutHandle),i.play("jumpright",n),d.snd.jump();break;case r.MovementState.JumpUp:clearTimeout(i.idleAnimationTimeoutHandle),i.play("jumpup",n),d.snd.jump();break;case r.MovementState.JumpDownLeft:clearTimeout(i.idleAnimationTimeoutHandle),i.play("jumpdownleft",n,!1),d.snd.jumpAttack();break;case r.MovementState.JumpDownRight:clearTimeout(i.idleAnimationTimeoutHandle),i.play("jumpdownright",n,!1),d.snd.jumpAttack();break;case r.MovementState.JumpDown:clearTimeout(i.idleAnimationTimeoutHandle),i.play("jumpdown",n,!1),d.snd.jumpAttack()}},i.movementCtrl=new r.MovementController(u.wp2),u.wp2.on("playerContact",i.onPlayerContact,i),u.wp2.on("bulletContact",i.onBulletContact,i);var n={alpha:{start:.7,end:0},blendMode:"normal",frequency:.01,startRotation:{min:265,max:275},color:{start:"#ffffff",end:"#ff5050"},speed:{start:1,end:.5,minimumSpeedMultiplier:1},scale:{start:.2,end:.6},maxParticles:20,lifetime:{min:.25,max:.75},spawnType:"circle",spawnCircle:{x:0,y:39,r:25}};i.emitterBurn=s.createParticleEmitter(i,[m.TextureLoader.Get("assets/entities-atlas.json@flame.png")],n),i.emitterPixies=s.createParticleEmitter(e,[m.TextureLoader.Get("assets/objects-atlas.json@star.png")]);var c="assets/objects-atlas.json@hero.png";return i.addAnimations(new y.AnimationSequence("right",c,[18,19,20,21,22,23],64,64)),i.addAnimations(new y.AnimationSequence("left",c,[12,13,14,15,16,17],64,64)),i.addAnimations(new y.AnimationSequence("jumpleft",c,[24,25,26,27,28,29],64,64)),i.addAnimations(new y.AnimationSequence("jumpright",c,[30,31,32,33,34,35],64,64)),i.addAnimations(new y.AnimationSequence("jumpup",c,[1,3,4,6],64,64)),i.addAnimations(new y.AnimationSequence("idle",c,[1,1,0,1,2,3,,4,5,13,12,6,7,11,18,19,0],64,64)),i.addAnimations(new y.AnimationSequence("jumpdownleft",c,[36,37,38],64,64)),i.addAnimations(new y.AnimationSequence("jumpdownright",c,[39,40,41],64,64)),i.addAnimations(new y.AnimationSequence("jumpdown",c,[42,43,44],64,64)),i.anchor.set(.5,.58),i.scale.y*=-1,o.eventEmitter.on(o.MOVE_TOPIC,i.onPlayerMove),i}return n.__extends(e,t),Object.defineProperty(e.prototype,"IsInteractive",{get:function(){return this.movementCtrl.isInteractive},set:function(t){this.movementCtrl.isInteractive=t},enumerable:!0,configurable:!0}),e.prototype.onPlayerContact=function(t){var e=this,i=t.body,n=t.body.DisplayObject,s=Math.abs(t.velocity[1]);if(s>505){n instanceof c.Mob&&(n.isLoading||this.handleMobInteraction(n,i));var a=this.movementCtrl.MovementState;if(a===r.MovementState.JumpDown||a===r.MovementState.JumpDownLeft||a===r.MovementState.JumpDownRight)return d.snd.jumpContact(),void o.eventEmitter.emit(o.GROUND_SHAKE,{milliSeconds:600,magnitudeInPixels:9})}if(s>450){console.log("Vert velocity: "+s);var u=new f.AnimatedSprite;u.addAnimations(new y.AnimationSequence("smoke","assets/entities-atlas.json@jump_smoke.png",[0,1,2,3,4,5],64,64)),u.anchor.set(.5),u.pivot.set(.5),u.x=this.x,u.y=this.y-25,u.alpha=.7,u.rotation=Math.random()*Math.PI,this.container.addChild(u),u.onComplete=function(){return e.container.removeChild(u)},u.play("smoke",6,!1)}s>400&&(d.snd.jumpContact(),console.log("velocity: "+t.velocity))},e.prototype.onBulletContact=function(t){var e=this,i=t.bulletBody.DisplayObject;if(!i.IsDead){if(t.playerHit)d.snd.hitPain(),l.stats.increaseStat(h.StatType.HP,-i.damage);else{var n=new f.AnimatedSprite;n.addAnimations(new y.AnimationSequence("exp","assets/entities-atlas.json@slime_atk_exp.png",[0,1,2,3,4,5],32,32)),n.anchor.set(.5),n.pivot.set(.5),n.x=i.x,n.y=i.y,n.alpha=.7,n.rotation=Math.random()*Math.PI,this.container.addChild(n),n.onComplete=function(){return e.container.removeChild(n)},n.play("exp",10,!1),d.snd.bulletHitWall()}i.IsDead=!0}},e.prototype.handleMobInteraction=function(t,e){var i=this,n=e.DisplayObject,s=n;if(s.drop&&Math.random()<=s.drop.chance){var a=p.LevelLoader.createEntity(l.stats.currentLevel.templates,s.drop.entity);this.addDropItem(t,a)}this.removeEntity(e),t.squish((function(){return i.container.removeChild(n)}));var o=t.attributes[h.AtrType.HP]/2;l.stats.increaseStat(h.StatType.TotalExp,o)},e.prototype.addDropItem=function(t,e){var i=e.DisplayObject;i.x=t.x,i.y=t.y+40,this.container.addChild(i);var n=i.position.x+75,s=i.position.y+200,o=new a.TWEEN.Tween(i.position).to({x:n,y:s},400).onComplete((function(){e.position=[i.position.x,i.position.y],u.wp2.addBody(e)})),r=i.scale.x,l=i.scale.y,c=new a.TWEEN.Tween(i.scale).to({x:r+.3,y:r+.3},350).easing(a.TWEEN.Easing.Linear.None),p=this.x,d=this.y+8,h=new a.TWEEN.Tween(i.position).to({x:p,y:d},350).easing(a.TWEEN.Easing.Back.In).onUpdate((function(t){e.position=[i.position.x,i.position.y]})).onComplete((function(){return i.scale.set(r,l)}));o.chain(c,h).start()},e.prototype.removeEntity=function(t,e){void 0===e&&(e=!1),u.wp2.removeBody(t),e&&this.container.removeChild(t.DisplayObject),t.DisplayObject=null},e}(f.AnimatedSprite);e.HeroCharacter=v},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,s=i(9),a=i(21),o=i(29),r=i(20),u=function(){function t(t){this.VELOCITY=150,this.JUMP_FORCE=17e3,this.JUMP_ATTACK_FORCE=-17e3,this.JUMP_COOLDOWN=500,this.JUMP_ATTACK_COOLDOWN=1e3,this.JUMP_ATTACK_FREEZE=800,this.nextJumpAllowed=0,this.nextJumpDownAllowed=0,this.movementState=-1,this.kbd=new s.KeyboardMapper,this.isRunning=!1,this.isJumping=!1,this.newState=n.Idle,this._isInteractive=!0,this.world=t}return Object.defineProperty(t.prototype,"isInteractive",{get:function(){return this._isInteractive},set:function(t){this._isInteractive=t,this._isInteractive||(this.isRunning=!1,this.movementState=n.Idle)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsJumping",{get:function(){return this.isJumping},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CanJump",{get:function(){return!this.isJumping&&this.nextJumpAllowed<performance.now()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsRunning",{get:function(){return this.isRunning},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MovementState",{get:function(){return this.movementState},enumerable:!0,configurable:!0}),t.prototype.StartJump=function(t){var e;t===n.JumpUp?e=[0,this.JUMP_FORCE]:t===n.JumpLeft?e=[.1*-this.JUMP_FORCE,this.JUMP_FORCE]:t===n.JumpRight&&(e=[.1*this.JUMP_FORCE,this.JUMP_FORCE]),this.world.playerBody.applyImpulse(e),this.world.clearContactsForBody(this.world.playerBody),this.nextJumpAllowed=performance.now()+this.JUMP_COOLDOWN},t.prototype.StartJumpDown=function(){var t=this;switch(this.movementState){case n.Left:case n.JumpLeft:this.newState=n.JumpDownLeft;break;case n.Right:case n.JumpRight:this.newState=n.JumpDownRight;break;default:this.newState=n.JumpDown}console.log("state change: "+n[this.movementState]+" -> "+n[this.newState]);var e=[0,this.JUMP_ATTACK_FORCE];this.world.playerBody.setZeroForce(),this.world.playerBody.applyImpulse(e),this.nextJumpDownAllowed=performance.now()+this.JUMP_ATTACK_COOLDOWN,this.isInteractive=!1,setTimeout((function(){return t.isInteractive=!0}),this.JUMP_ATTACK_FREEZE),o.eventEmitter.emit(o.MOVE_TOPIC,{newState:this.newState,oldState:this.movementState,isJumping:!0,isRunning:!1}),this.movementState=this.newState},t.prototype.update=function(t){if(this.newState=n.Idle,Math.abs(this.world.playerBody.velocity[1])>.01){var e=this.world.playerContacts.every((function(t){return t.shapes[0].sensor}));this.isJumping=e}else this.isJumping=!1;var i=this.calcMovementVelocity();if(this.isJumping&&this._isInteractive)return(this.kbd.isKeyDown(83)||this.kbd.isKeyDown(40))&&a.stats.HasJumpAtack&&this.nextJumpDownAllowed<performance.now()&&this.StartJumpDown(),void(this.world.playerBody.velocity[0]+=i);this.world.playerBody.velocity[0]=i;var s=a.stats.getStat(r.StatType.Dust)>1,u=this.kbd.isKeyDown(16)&&s&&this._isInteractive;if(this.kbd.isKeyDown(65)||this.kbd.isKeyDown(37)?this.newState=n.Left:(this.kbd.isKeyDown(68)||this.kbd.isKeyDown(39))&&(this.newState=n.Right),(this.kbd.isKeyDown(87)||this.kbd.isKeyDown(38)||this.kbd.isKeyDown(32))&&this.CanJump&&(this.movementState===n.Left?this.newState=n.JumpLeft:this.movementState===n.Right?this.newState=n.JumpRight:this.movementState===n.Idle&&(this.newState=n.JumpUp,u=!1)),this.newState!==this.movementState||u!==this.IsRunning){var l=!1;switch(this.newState){case n.JumpLeft:this.StartJump(n.JumpLeft),l=!0;break;case n.JumpRight:this.StartJump(n.JumpRight),l=!0;break;case n.JumpUp:this.StartJump(n.JumpUp),l=!0}o.eventEmitter.emit(o.MOVE_TOPIC,{newState:this.newState,oldState:this.movementState,isJumping:l,isRunning:u})}this.movementState=this.newState,this.isRunning=u},t.prototype.calcMovementVelocity=function(){var t=0;return this.movementState===n.Left||this.movementState===n.JumpLeft?t=-1:this.movementState!==n.Right&&this.movementState!==n.JumpRight||(t=1),this.IsJumping?.2*t:t*this.VELOCITY*(this.IsRunning?2:1)},t}();e.MovementController=u,function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Idle=2]="Idle",t[t.JumpLeft=3]="JumpLeft",t[t.JumpRight=4]="JumpRight",t[t.JumpUp=5]="JumpUp",t[t.JumpDownLeft=6]="JumpDownLeft",t[t.JumpDownRight=7]="JumpDownRight",t[t.JumpDown=8]="JumpDown"}(n=e.MovementState||(e.MovementState={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(9),a=i(21),o=i(29),r=i(17),u=i(20),l=function(t){function e(){var e=t.call(this)||this;return e.questMsgEndTime=0,e.handleDpsChange=function(t){e.addInfoMessage(s.Global.position,t.Amount+" HP",r.MSG_HP_STYLE,50)},e.handleStatChange=function(t){switch(t.Type){case u.StatType.Coins:e.txtCoins.text=t.NewValue.toString();break;case u.StatType.Dust:e.txtDust.text=t.NewValue.toFixed(0)+" / "+t.Stats[u.StatType.MaxDust].toFixed(0);break;case u.StatType.MaxDust:e.txtDust.text=Math.floor(t.Stats[u.StatType.Dust])+" / "+t.NewValue.toFixed(0);break;case u.StatType.HP:e.txtHP.text=Math.round(t.NewValue)+" / "+t.Stats[u.StatType.MaxHP];break;case u.StatType.MaxHP:e.txtHP.text=Math.round(t.Stats[u.StatType.HP])+" / "+t.NewValue;break;case u.StatType.TotalExp:var i=t.NewValue-t.OldValue;0!=i&&e.addInfoMessage({x:0,y:90},"+"+i+" exp",r.MSG_EXP_STYLE,-50),e.renderExp(t);break;case u.StatType.CharacterLevel:e.handleLevelUp(t)}},e.handleLevelUp=function(t){e.txtExp.text=Math.round(t.Stats[u.StatType.LevelExp])+" / "+t.Stats[u.StatType.LevelMaxExp],e.expFiller.width=1,e.addLvlUpMessage("Level "+t.NewValue),e.txtLevel.text="Level "+a.stats.characterLevel},e.setup(),e}return n.__extends(e,t),e.prototype.setup=function(){this.txtPlayerPosition=new s.PIXI.BitmapText("0",r.QUEST_STYLE),this.txtPlayerPosition.position=new s.PIXI.Point(r.SCENE_WIDTH,r.SCENE_HEIGHT),this.txtPlayerPosition.anchor.set(1,1),this.addChild(this.txtPlayerPosition),this.statContainer=new s.PIXI.Sprite(s.TextureLoader.Get("assets/gui-atlas.json@panel_stats.png",!0)),this.statContainer.position.set(4),this.statContainer.name="TriggerMessage",this.statContainer.anchor.set(0),this.addChild(this.statContainer),this.questPanel=new s.PIXI.Sprite(s.TextureLoader.Get("assets/gui-atlas.json@panel.png")),this.questPanel.anchor.set(0),this.questPanel.position.set(4,88),this.addChild(this.questPanel),this.txtQuestMessage=new s.PIXI.BitmapText("",r.QUEST_STYLE),this.txtQuestMessage.position.set(14),this.txtQuestMessage.anchor.set(0),this.questPanel.addChild(this.txtQuestMessage);var t,e={font:{name:"Orbitron",size:26},tint:16711424};this.statContainer.height;this.txtHP=new s.PIXI.BitmapText("0",e),this.txtHP.anchor.set(0,.5),this.txtHP.position=new s.PIXI.Point(84,this.statContainer.height/2),this.statContainer.addChild(this.txtHP),(t=new s.PIXI.Sprite(s.TextureLoader.Get("assets/gui-atlas.json@heart.png"))).anchor.set(.5),t.position.set(45,this.statContainer.height/2),this.statContainer.addChild(t),this.txtDust=new s.PIXI.BitmapText("0",e),this.txtDust.anchor.set(0,.5),this.txtDust.position=new s.PIXI.Point(334,this.statContainer.height/2),this.statContainer.addChild(this.txtDust),this.emitter=s.createParticleEmitter(this.statContainer,[s.TextureLoader.Get("assets/objects-atlas.json@star.png")]),this.emitter.updateOwnerPos(292,64),this.emitter.maxLifetime=.6,this.emitter.maxParticles=50,this.emitter.emit=!0,this.txtCoins=new s.PIXI.BitmapText("0",e),this.txtCoins.anchor.set(0,.5),this.txtCoins.position=new s.PIXI.Point(586,this.statContainer.height/2),this.statContainer.addChild(this.txtCoins),(t=new s.PIXI.Sprite(s.TextureLoader.Get("assets/gui-atlas.json@coin.png"))).anchor.set(.5),t.position.set(544,this.statContainer.height/2),this.statContainer.addChild(t);var i=new s.PIXI.Sprite(s.TextureLoader.Get("assets/gui-atlas.json@exp_panel.png"));i.position.set(0,r.SCENE_HEIGHT-i.height),this.addChild(i),this.expPreFiller=new s.PIXI.Sprite(s.TextureLoader.Get("assets/gui-atlas.json@exp_prefill.png")),this.expPreFiller.position.set(3,3),i.addChild(this.expPreFiller),this.expFiller=new s.PIXI.Sprite(s.TextureLoader.Get("assets/gui-atlas.json@exp_fill.png")),this.expFiller.position.set(3,3),i.addChild(this.expFiller),this.fillLen=i.width-6;var n={font:{name:"Bauhaus",size:18}};this.txtExp=new s.PIXI.BitmapText("0 / 1000",n),this.txtExp.pivot.set(.5),this.txtExp.anchor.set(.5),this.txtExp.position=new s.PIXI.Point(i.width/2,i.height/2),this.txtExp.tint=16711492,i.addChild(this.txtExp),this.txtLevel=new s.PIXI.BitmapText("Level "+a.stats.characterLevel,n),this.txtLevel.position.set(i.x+i.width+4,i.y),this.txtLevel.tint=16711492,this.addChild(this.txtLevel),o.eventEmitter.on(o.STATCHANGE_TOPIC,this.handleStatChange),o.eventEmitter.on(o.DAMAGE_TOPIC,this.handleDpsChange)},e.prototype.onUpdate=function(t){this.emitter.update(.001*t),this.questPanel.visible&&this.questMsgEndTime<performance.now()&&(this.questPanel.visible=!1,this.onCompleteCB&&this.onCompleteCB()),this.txtPlayerPosition.text=s.Global.position.x.toFixed(0)+", "+s.Global.position.y.toFixed(0)},e.prototype.addInfoMessage=function(t,e,i,a){var o=this,u=n.__assign({font:"Orbitron",size:24,tint:16777215},i),l=new s.PIXI.BitmapText(e,u);a=a||0,l.position.set(r.SCENE_HALF_WIDTH+a,r.SCENE_HEIGHT-t.y-70),l.scale.set(1,1),this.addChild(l);var c=t.y>r.SCENE_HALF_HEIGHT?250:-250,p=r.SCENE_HEIGHT-t.y+c;new s.TWEEN.Tween(l.position).to({y:p},2e3).start();var d=new s.TWEEN.Tween(l.scale).to({x:1.6,y:1.6},2200).easing(s.TWEEN.Easing.Linear.None),h=new s.TWEEN.Tween(l).to({alpha:0},3e3).onComplete((function(){return o.removeChild(l)}));d.chain(h).start()},e.prototype.addQuestItemMessage=function(t){var e=this,i=new s.PIXI.BitmapText(t,r.QUEST_ITEM_STYLE);i.anchor.set(.5),i.position.set(r.SCENE_HALF_WIDTH,150),this.addChild(i);var n=new s.TWEEN.Tween(i.scale).to({x:1.8,y:1.8},2200).easing(s.TWEEN.Easing.Linear.None),a=new s.TWEEN.Tween(i).to({alpha:0},3e3).onComplete((function(){return e.removeChild(i)}));n.chain(a).start()},e.prototype.setQuestMessage=function(t,e,i){void 0===e&&(e=8e3),void 0===i&&(i=null),this.txtQuestMessage.text=t,this.questPanel.visible=!0,this.questMsgEndTime=performance.now()+e,this.onCompleteCB=i},e.prototype.addLvlUpMessage=function(t){var e=this,i={align:"center",padding:0,fontSize:"64px",fontFamily:r.GUI_FONT,fill:3364147,strokeThickness:6,stroke:13421823},n=new s.PIXI.Text(t,i);n.scale.set(1),n.anchor.set(.5),n.position.set(r.SCENE_HALF_WIDTH,r.SCENE_HEIGHT-s.Global.position.y-70),this.addChild(n);var a=s.Global.position.y>r.SCENE_HALF_HEIGHT?450:-450,o=r.SCENE_HEIGHT-s.Global.position.y+a;new s.TWEEN.Tween(n.position).to({y:o},2e3).start();var u=new s.TWEEN.Tween(n.scale).to({x:1.6,y:1.6},1500).easing(s.TWEEN.Easing.Linear.None),l=new s.TWEEN.Tween(n).to({alpha:.4},6e3).onComplete((function(){return e.removeChild(n)}));u.chain(l).start()},e.prototype.renderExp=function(t){this.txtExp.text=Math.round(t.Stats[u.StatType.LevelExp])+" / "+t.Stats[u.StatType.LevelMaxExp],this.txtLevel.text="Level "+a.stats.characterLevel;var e=Math.min(t.Stats[u.StatType.LevelExp]/t.Stats[u.StatType.LevelMaxExp],1);if(0===e)return this.expFiller.width=1,void(this.expPreFiller.position.x=1+this.expFiller.x);this.expPreFiller.position.x=this.expFiller.width+this.expFiller.x;var i=this.fillLen*e|0,n=i-this.expFiller.width;this.expPreFiller.width=1;var o=new s.TWEEN.Tween(this.expPreFiller).to({width:n},1500).easing(s.TWEEN.Easing.Linear.None),r=new s.TWEEN.Tween(this.expFiller).to({width:i},2e3).easing(s.TWEEN.Easing.Bounce.Out);o.chain(r).start()},e}(s.PIXI.Container);e.StatsHud=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(27),a=i(28),o=function(t){function e(e){var i=t.call(this)||this;return i.FRAME_SIZE_X=64,i.FRAME_SIZE_Y=128,i.addAnimations(new a.AnimationSequence("lava",e,[0,1,2,3],i.FRAME_SIZE_X,i.FRAME_SIZE_Y)),i.play("lava",3),i}return n.__extends(e,t),e}(s.AnimatedSprite);e.Lava=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(9),a=function(t){function e(e,i,n){void 0===e&&(e=1),void 0===i&&(i=1);var a,o,r,u,l,c=t.call(this)||this;c.scale.y*=-1;var p,d=n[0];(e>1||n.length>1)&&(a=n[1],o=n[2]),i>1&&(r=n[3],u=n[4],l=n[5]);var h=0;a&&(f=s.TextureLoader.Get(a),(p=new s.PIXI.Sprite(f)).position.set(h+1,0),h+=f.width,c.addChild(p));var f=s.TextureLoader.Get(d);if(e>1){var m=f.width*e,y=f.height;(p=new s.PIXI.TilingSprite(f,m,y)).position.set(h,0),h+=m}else(p=new s.PIXI.Sprite(f)).position.set(h,0),h+=p.width;c.addChild(p),o&&(f=s.TextureLoader.Get(o),(p=new s.PIXI.Sprite(f)).position.set(h-1,0),h+=p.width,c.addChild(p));var v=e+2;if(i>1)for(h=0;h<v;h++){var g;g=0===h?u:h===v-1?l:r;for(var S=1;S<i;S++)f=s.TextureLoader.Get(g),(p=new s.PIXI.Sprite(f)).position.set(h*p.width,S*p.height),c.addChild(p)}return c}return n.__extends(e,t),e}(s.PIXI.Container);e.Platform=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(9),a=Math.PI/8,o=function(t){function e(){var e=t.call(this,s.TextureLoader.Get("assets/objects-atlas.json@bumper_01.png"))||this;return e.onUpdate=function(t){var i=e.rotor.rotation-a*t/1e3;e.rotor.rotation=i%Math.PI},e.rotor=new s.PIXI.Sprite(s.TextureLoader.Get("assets/objects-atlas.json@bumper_rotor_01.png")),e.rotor.anchor.set(.5),e.rotor.pivot.set(.5),e.addChild(e.rotor),e.anchor.set(.5),e}return n.__extends(e,t),e}(s.PIXI.Sprite);e.Bumper=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(23),s=i(131),a=i(21),o=i(25),r=i(32),u=i(20),l=function(){function t(t){this.gameScene=t,this.questState=[],this.hud=this.gameScene.HudOverlay}return t.prototype.reset=function(){var t=this;this.questState.forEach((function(e,i){e!=s.QuestState.None&&(t.findQuest(i).itemsCollected=0)})),this.questState=[]},t.prototype.acquireItem=function(t){var e=this.findQuestWithItem(t);e&&(e.itemsCollected++,this.hud.addQuestItemMessage("collected "+e.itemsCollected+" / "+e.itemsNeeded),e.itemsCollected>=e.itemsNeeded&&(this.setQuestState(e.id,s.QuestState.Completed),e.completedMsg&&this.hud.setQuestMessage(e.completedMsg)))},t.prototype.canActivateTrigger=function(t){if(!t||!t.questId)return!1;if(Array.isArray(t.dependsOn))for(var e=0;e<t.dependsOn.length;e++){var i=t.dependsOn[e],n=this.questState[i];if(!n||n!=s.QuestState.Rewarded)return!1}return(t.lastActive||-1e4)+1e4<performance.now()},t.prototype.handleTriggerEvent=function(t){var e=this,i=n.getScm(),o=t.Trigger,u=Math.max(this.getQuestState(o.questId),o.state||0);if(this.canActivateTrigger(o)){o.lastActive=performance.now();var l=this.findQuest(o.questId);switch(o.questId){case 1:u===s.QuestState.None&&(this.setQuestState(o.questId,s.QuestState.Completed),this.gameScene.IsHeroInteractive=!1,this.hud.setQuestMessage(l.welcomeMsg,2e3,(function(){e.hud.setQuestMessage(l.completedMsg,2e3,(function(){e.gameScene.IsHeroInteractive=!0,e.setQuestState(o.questId,s.QuestState.Finished),e.giveRewards(l),e.setQuestState(o.questId+1,s.QuestState.InProgress),l=e.findQuest(o.questId+1),e.hud.setQuestMessage(l.welcomeMsg,4e3)}))})));break;case 2:this.getQuestState(1)>s.QuestState.Finished&&(u===s.QuestState.InProgress?(this.setQuestState(o.questId,s.QuestState.Completed),this.hud.setQuestMessage(l.completedMsg,4e3,(function(){e.gameScene.IsHeroInteractive=!0,e.setQuestState(o.questId,s.QuestState.Finished),e.giveRewards(l),l=e.findQuest(o.questId+1),e.setQuestState(o.questId+1,s.QuestState.InProgress),e.hud.setQuestMessage(l.welcomeMsg)}))):u>=s.QuestState.Finished&&(l=this.findQuest(o.questId+1),this.hud.setQuestMessage(l.welcomeMsg,4e3)));break;case 3:u===s.QuestState.InProgress&&(this.setQuestState(o.questId,s.QuestState.Finished),this.giveRewards(l),this.gameScene.IsHeroInteractive=!1,this.hud.setQuestMessage(l.completedMsg,4e3,(function(){n.getScm().ActivateScene("Loader")})),a.stats.saveUserState(!0),r.snd.win());break;case 201:this.genericQuestHandler(l,u,t,[function(){n.worldContainer.getChildByName("quest_item_201").visible=!0;var t=e.findBodyByName("lock");e.gameScene.removeEntity(t,!0)},function(){},function(){e.setQuestState(o.questId,s.QuestState.Finished),e.giveRewards(l),e.gameScene.IsHeroInteractive=!1,a.stats.saveUserState(!0),r.snd.win(),e.hud.visible=!1;var t=i.GetScene("CutScene");t.SetText(l.finishedMsg);var n=i.CaptureScene();t.SetBackGround(n,e.gameScene.scale),i.ActivateScene(t)}]);break;case 203:this.genericQuestHandler(l,u,t,[function(){a.stats.HasJumpAtack=!0},function(){},function(){},function(){}]);break;default:this.genericQuestHandler(l,u,t)}}},t.prototype.genericQuestHandler=function(t,e,i,n){var a=i.Trigger;switch(e){case s.QuestState.None:this.setQuestState(t.id,s.QuestState.InProgress),this.hud.setQuestMessage(t.welcomeMsg);break;case s.QuestState.InProgress:this.hud.setQuestMessage(t.objectiveMsg);break;case s.QuestState.Completed:t.itemId&&t.itemsCollected>=t.itemsNeeded?(this.setQuestState(t.id,s.QuestState.Finished),a.lastActive=0):this.hud.setQuestMessage(t.completedMsg);break;case s.QuestState.Finished:this.hud.setQuestMessage(t.finishedMsg),this.giveRewards(t),this.gameScene.removeEntity(i,!0)}n&&n[e]&&n[e]()},t.prototype.giveRewards=function(t){r.snd.questItem(),t.rewardExp&&a.stats.increaseStat(u.StatType.TotalExp,t.rewardExp),t.rewardCoins&&a.stats.increaseStat(u.StatType.Coins,t.rewardCoins),this.setQuestState(t.id,s.QuestState.Rewarded)},t.prototype.findQuest=function(t){return n.LevelDefinitions.quests.filter((function(e){return e.id===t}))[0]},t.prototype.findQuestWithItem=function(t){var e=this,i=n.LevelDefinitions.quests.filter((function(i){if(i.itemId===t){var n=e.getQuestState(i.id);return n<s.QuestState.Completed&&n>s.QuestState.None}return!1}));return i.length>0?i[0]:null},t.prototype.setQuestState=function(t,e){this.questState[t]=e},t.prototype.getQuestState=function(t){return this.questState[t]||s.QuestState.None},t.prototype.findBodyByName=function(t){var e=void 0;return o.wp2.bodies.forEach((function(i){var n=i.DisplayObject;n&&n.name===t&&(e=i)})),e},t}();e.QuestManager=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.None=0]="None",t[t.InProgress=1]="InProgress",t[t.Completed=2]="Completed",t[t.Finished=3]="Finished",t[t.Rewarded=4]="Rewarded"}(e.QuestState||(e.QuestState={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(9),a=i(17),o=function(t){function e(e){var i=t.call(this,"Options")||this;return i.sceneManager=e,i.currentMusicTrack=0,i.onActivate=function(){i.sceneManager.MasterHudOverlay.children.find((function(t){return"BTN_OPTIONS"==t.name})).visible=!1},i.onDeactivate=function(){i.sceneManager.MasterHudOverlay.children.find((function(t){return"BTN_OPTIONS"==t.name})).visible=!0},i.setup=function(){var t=new s.PIXI.BitmapText("Options",a.TEXT_STYLE);i.addChild(t),t.anchor.set(.5),t.x=a.SCENE_HALF_WIDTH,t.y=20;var e=a.BTN_WIDTH/3,n=a.SCENE_HEIGHT-a.BTN_HEIGHT-e,o=new s.SpriteButton("assets/gui-atlas.json@gui_button1.png",e,n,a.BTN_WIDTH,a.BTN_HEIGHT);o.text=new s.PIXI.Text("Back to game",a.BTN_STYLE),o.onClick=function(){i.sceneManager.ActivatePreviousScene()},i.addChild(o)},i.BackGroundColor=a.SCENE_BACKCOLOR,i.setup(),i}return n.__extends(e,t),e}(s.Scene);e.OptionsScene=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),s=i(9),a=i(32),o=i(17),r=function(t){function e(e){var i=t.call(this,"CutScene")||this;return i.sceneManager=e,i.deathScene=!1,i.onActivate=function(){if(i.btnContinue.visible=!i.deathScene,i.callout.visible=!i.deathScene,i.corpse.visible=i.deathScene,i.corpse.scale.set(.1),i.btnContinue.text.text=i.deathScene?"Retry":"Continue",i.deathScene){var t=a.snd.getTrack("Carrousel");a.snd.playTrack(t)}},i.deathMessages=["Life sucks and you just died!","You decided to check the afterlife.\nGuess what? You are dead!","Owned!\nMore luck next time.","You have died!\nRest in peace.","Your quest has failed.\nMay you find more peace in\nthat world than you found in this one.","Here's a picture of your corpse.\nNot pretty!","Yep, you're dead.\nMaybe you should consider\nplaying a Barbie game!","Died..."],i.BackGroundColor=1087931,i.corpse=new s.PIXI.Sprite(s.TextureLoader.Get("assets/objects-atlas.json@hero-dead.png")),i.corpse.anchor.set(.5),i.corpse.pivot.set(.5),i.corpse.position.set(s.SCENE_HALF_WIDTH,s.SCENE_HALF_HEIGHT),i.addChild(i.corpse),i.corpseBlurFilter=new s.PIXI.filters.BlurFilter,i.corpse.filters=[i.corpseBlurFilter],i.callout=new s.PIXI.Sprite(s.TextureLoader.Get("assets/gui-atlas.json@rect.png")),i.callout.anchor.set(.5),i.callout.position.set(s.SCENE_HALF_WIDTH,s.SCENE_HEIGHT/5),i.addChild(i.callout),i.textMessage=new s.PIXI.BitmapText("",o.QUEST_STYLE),i.textMessage.anchor.set(.5),i.textMessage.position.set(0,0),i.callout.addChild(i.textMessage),i.btnContinue=new s.SpriteButton("assets/gui-atlas.json@gui_button1.png",(s.SCENE_WIDTH-s.BTN_WIDTH)/2,i.callout.height+s.BTN_HEIGHT,s.BTN_WIDTH,s.BTN_HEIGHT),i.btnContinue.text=new s.PIXI.Text("Continue",s.BTN_STYLE),i.btnContinue.onClick=function(){i.sceneManager.ActivateScene("Loader")},i.addChild(i.btnContinue),i}return n.__extends(e,t),e.prototype.onUpdate=function(t){if(this.deathScene)if(this.corpse.scale.x<2.5){this.corpse.rotation+=.03;var e=this.corpse.scale.x+.01;this.corpse.scale.set(e)}else this.deathScene=!1,this.textMessage.text=this.deathMessages[0|Math.random()*this.deathMessages.length],this.callout.visible=!0,this.btnContinue.visible=!0;else this.corpse.rotation+=.005;var i=Math.max(5,this.corpseBlurFilter.blur+4e-5);this.corpseBlurFilter.blur=i},Object.defineProperty(e.prototype,"DeathScene",{get:function(){return this.deathScene},set:function(t){if(this.deathScene=t,this.deathScene){this.corpseBlurFilter.blur=0;var e=new s.PIXI.filters.ColorMatrixFilter;e.sepia(!1),this.backSprite.filters=[e]}else this.backSprite.filters=null},enumerable:!0,configurable:!0}),e.prototype.SetBackGround=function(t,e){this.backSprite?this.backSprite.texture=t:(this.backSprite=new s.PIXI.Sprite(t),this.addChildAt(this.backSprite,0)),this.backSprite.scale.set(1/e.x,1/e.y)},e.prototype.SetText=function(t){this.textMessage.text=t},e}(s.Scene);e.CutScene=r}],[[90,0,1,5]]]);
//# sourceMappingURL=main.a3924fe905f1fff3d9ba.js.map