{"version":3,"sources":["webpack:///./_engine/TextureLoader.ts","webpack:///./_engine/Button.ts","webpack:///./_engine/SceneManager.ts","webpack:///./_engine/Scene.ts","webpack:///./world/LevelHelper.ts","webpack:///./mobs/Mob.ts","webpack:///./objects/Bullet.ts","webpack:///./app.ts","webpack:///./enums.ts","webpack:///./global.ts","webpack:///./_engine/index.ts","webpack:///./constants.ts","webpack:///./objects/PlayerStats.ts","webpack:///./world/WorldP2.ts","webpack:///./_engine/KeyboardMapper.ts","webpack:///./_engine/LinkedList.ts","webpack:///./_engine/Parallax.ts","webpack:///./_engine/Slider.ts","webpack:///./scenes/BootScene.ts","webpack:///./scenes/LoaderScene.ts","webpack:///./mobs/SpawnPoint.ts","webpack:///./mobs/BasicStaticAI.ts","webpack:///./mobs/AI.ts","webpack:///./objects/MasterHud.ts","webpack:///./scenes/MainScene.ts","webpack:///./objects/HeroCharacter.ts","webpack:///./objects/MovementController.ts","webpack:///./objects/StatsHud.ts","webpack:///./objects/Lava.ts","webpack:///./objects/Platform.ts","webpack:///./objects/Bumper.ts","webpack:///./questSystem/QuestManager.ts","webpack:///./questSystem/QuestState.ts","webpack:///./scenes/OptionsScene.ts","webpack:///./scenes/CutScene.ts","webpack:///./events.ts","webpack:///./world/SoundMan.ts","webpack:///./_engine/AnimatedSprite.ts","webpack:///./world/LevelLoader.ts","webpack:///./index.ts","webpack:///./_engine/Dictionary.ts","webpack:///./world/CollisionGroups.ts"],"names":["__1","__webpack_require__","TextureLoader","IsAtlas","texture","frame","width","baseTexture","height","resourceCache","Get","fullName","mipmap","idx","indexOf","textureName","substr","resourceName","PIXI","loader","resources","spritesheet","res","console","error","loadType","t","textures","scaleMode","SCALE_MODES","LINEAR","exports","OutlineMode","filter_outline_1","_1","Button","_super","texturePath","x","y","_this","call","this","_outlineMode","Filter","_isHighlighted","_isPressed","_isDisabled","_isClickStarted","requestedWidth","requestedHeight","onButtonDown","textureDown","onButtonUp","event","onClickHandler","applyTexture","onButtonUpOutside","onButtonOver","textureHighlight","mouseover","onButtonOut","mouseout","position","set","setTexture","buttonMode","interactive","cursor","on","isPressed","tslib_1","__extends","Object","defineProperty","prototype","state","filters","OutlineFilter","_outlineColor","value","_text","text","removeChild","anchor","scale","addChild","onClick","warn","textureUp","tint","performClick","textureAtlasName","spriteSheet","NEAREST","btnHeight","btnWidth","Texture","Rectangle","scaleW","scaleH","Sprite","TWEEN","State","SceneManager","options","resizer","currentScene","scenes","startTime","animationFrameHandle","Destroy","cancelAnimationFrame","pause","forEach","scene","RemoveScene","renderer","destroy","resizeHandler","avlSize","sceneResizer","GetAvailableSize","aspect","GetAspectRatio","size","CalculateSize","resize","CalculateScale","onResize","masterHudOverlay","render","timestamp","requestAnimationFrame","update","isPaused","dt","onUpdate","masterContainer","undefined","clear","designWidth","designHeight","DefaultResizer","Container","antialias","roundPixels","backgroundColor","transparent","autoDetectRenderer","autoResize","textureGC","mode","GC_MODES","AUTO","window","removeEventListener","addEventListener","AddScene","push","sceneManager","RemoveAllScenes","onDestroy","filter","item","index","arr","HasScene","name","found","Name","length","GetScene","Error","ActivateScene","sceneOrName","log","onDeactivate","lastScene","BackGroundColor","onActivate","removeChildren","settings","RESOLUTION","devicePixelRatio","ActivatePreviousScene","hud","CaptureScene","renderTexture","RenderTexture","create","designedWidth","designedHeight","innerWidth","innerHeight","availableSize","maxWidth","maxHeight","Math","floor","min","newSize","Scene","scm","paused","hudScene","_clear","color","maxIndex","children","addChildAt","child","dispObj","setChildIndex","resume","clearFlag","getEntityDefinition","templates","entity","displayObjectDefinition","bodyDefinition","template","displayObject","typeName","body","trigger","drop","entityTemplate","__assign","triggerTemplate","templateName","doDef","bdDef","getUniqueItems","n","r","i","GetLevelAssets","root","levelId","assets","level","levels","id","parallax","iplx","concat","map","tos","type","sequences","entities","defs","NPC","entity_1","attack","AnimatedSprite_1","Bullet_1","SoundMan_1","BasicStaticAI_1","WorldP2_1","enums_1","FRAME_SIZE","Mob","_isDead","isLoading","currentSeq","currentSequence","currentFps","fps","snd","atkMagic1","_direction","DirectionH","Left","play","onComplete","seq","fireBullet","sequenceName","addAnimations","AnimationSequence","onDeathCallBack","cb","squish","isDead","aname","mobSquish","dir","_attributes","values","atkTexture","constructor","Array","Bullet","emitBullet","wp2","playerBody","AtrType","Atk","createAI","aiTypeName","toLowerCase","_ai","BasicStaticAI","AnimatedSprite","p2","CollisionGroups_1","_engine_1","velocity","ttl","damage","direction","Point","interactionType","ellapsed","performance","now","IsDead","len","sqrt","onDeath","visible","reset","bullets","target","bullet","findDeadBullet","Global","worldContainer","shape","Circle","radius","collisionGroup","COL_GRP_BULLET","collisionMask","COL_GRP_PLAYER","COL_GRP_SCENE","COL_GRP_GROUND","sensor","mass","angle","fixedRotation","angularDamping","damping","Body","addShape","setDensity","gravityScale","angularVelocity","collisionResponse","DYNAMIC","DisplayObject","addBody","pt","Float32Array","Direction","blt","BootScene_1","PRELOAD_FONTS","cfg","google","families","active","getScm","boot","BootScene","WebFontConfig","e","src","document","location","protocol","wf","createElement","async","s","getElementsByTagName","parentNode","insertBefore","BaseStatType","StatType","DamageType","particles","constants_1","renderOptions","view","getElementById","resolution","SCENE_WIDTH","SCENE_HEIGHT","deleteScm","Renderer","createParticleEmitter","container","config","alpha","start","end","minimumScaleMultiplier","speed","minimumSpeedMultiplier","acceleration","startRotation","max","rotationSpeed","lifetime","blendMode","frequency","emitterLifetime","maxParticles","pos","addAtBack","spawnType","spawnCircle","emitter","Emitter","emit","LevelDefinitions","quests","Button_1","Dictionary_1","Dictionary","KeyboardMapper_1","KeyboardMapper","LinkedList_1","LinkedList","Parallax_1","Parallax","Scene_1","SceneManager_1","Slider_1","Slider","TextureLoader_1","SCENE_HALF_WIDTH","SCENE_HALF_HEIGHT","BTN_WIDTH","BTN_HEIGHT","MENU_LINE_HEIGHT","GUI_FONT","SCENE_BACKCOLOR","ANIMATION_FPS_NORMAL","ANIMATION_FPS_SLOW","BTN_STYLE","align","padding","fontSize","fontFamily","fill","strokeThickness","stroke","TEXT_STYLE","MSG_COIN_STYLE","MSG_HP_STYLE","MSG_EXP_STYLE","MSG_WARN_STYLE","EXP_BAR_STYLE","QUEST_ITEM_STYLE","QUEST_STYLE","dropShadow","dropShadowDistance","dropShadowBlur","global_1","events_1","LevelLoader_1","PlayerStats","baseStats","attributeStats","stats","accumulator","dpsDecreaseAmount","hasJumpAttack","hasMagicAttack","characterLevel","currentGameLevel","expForNextLevel","isBurningBuff","buffs","dps","LavaBorder","Lava","Poison","dmg","Dust","MaxDust","v","INTERVAL","RegenDust","increaseStat","HP","MaxHP","RegenHP","amount","event_1","OldValue","Amount","eventEmitter","DAMAGE_TOPIC","wasBurning","isBurning","BURN_TOPIC","scevent","Type","Coins","NewValue","Stats","TotalExp","AttributePoints","expForLevel","rebuildStats","levelLoader","LevelLoader","loadLevel","loadUserState","currentLevel","buildLevel","saveUserState","isLevelCompleted","Gold","data","getStat","Exp","AtrPts","LastLevel","setStat","findExpLevel","LevelMaxExp","LevelExp","updateEvent","STATCHANGE_TOPIC","maxValue","newValue","CharacterLevel","exp","ContactPair","BodyA","BodyB","WorldP2","contactPairs","contactWatch","playerBodyContacts","fixedTimeStep","beginContact","evt","other","bodyA","shapes","bodyB","world","playerHit","bulletBody","otherBody","watchedItemFound","bodyId","cp","endContact","bodyIDX","splice","foundIdx","World","gravity","setupMaterials","ground","Plane","material","materials","get","COL_GRP_NPC","sleepMode","BODY_SLEEPING","clearLevel","bodies","b","removeBody","eventName","handler","context","step","interpolatedPosition","materialName","clearContactsForBody","getContactsForBody","foundPairs","addContactWatch","Material","idCounter","playerGroundContactMaterial","ContactMaterial","friction","restitution","stiffness","Equation","DEFAULT_STIFFNESS","relaxation","DEFAULT_RELAXATION","frictionStiffness","frictionRelaxation","surfaceVelocity","addContactMaterial","playerMobContactMaterial","playerBoxContactMaterial","playerBoxHighFirctContactMaterial","playerBumperContactMaterial","Number","MAX_VALUE","boxGroundContactMaterial","ALT_KEY","SHIFT_KEY","CTRL_KEY","addKeyboardActionHandler","action","stateActions","keyboard","keydown","bind","keyup","currentState","actions","findHandlerAndInvoke","GLOBAL","ka","isAssigned","key","altKey","shiftKey","ctrlKey","releaseKeyAfterInvoke","which","isKeyDown","keyCode","KeyboardAction","first","last","AddNode","newLastNode","LinkedListNode","previous","next","list","InsertNode","newFirstNode","node","RemoveNode","RollLeft","second","callback","InsertBefore","First","FindFirst","InsertAfter","Last","FindLast","parallaxFactor","textureScale","worldPosition","spriteBuffer","spriteOrderList","totalWidth","recalculatePosition","newPositionX","firstIdx","firstSpr","lastIdx","lastSpr","delta","updatePositions","shift","viewPortSize","unshift","pop","ViewPortSize","setTextures","SetViewPortX","point","factor","textureIndex","getTexture","rotate","spr","imageUrl","textureAtlas","sliderFrameWidth","setSliderFromeEvent","Value","getCalculatedValue","dragOffsetX","isDragging","onDragStart","getLocalPosition","handle","onDragEnd","stopped","onDragMove","textureControl","frameDownControl","textureHandle","frameDownHandle","applyTextureFrames","control","frameHighlightControl","frameHighlightHandle","handleWidth","SetTexture","IsPressed","maxX","pct","minX","precise_round","newPosition","parent","num","decimals","pow","result","round","sign","toFixed","parseFloat","frameUpControl","frameUpHandle","frameHeight","frameWidth","LoaderScene_1","__2","PRELOAD_BOOT_ASSETS","spinner","rotation","loadingMessage","Text","add","load","startPreloading","__awaiter","loadingTexture","fromImage","onPreloadFinished","defaultIcon","plugins","interaction","cursorStyles","default","hover","style","questsObj","q","itemId","itemsNeeded","itemsCollected","rewardCoins","rewardExp","ls","LoaderScene","LevelHelper_1","PlayerStats_1","MasterHud_1","MainScene_1","OptionsScene_1","CutScene_1","preloadAssets","handleLevelLoading","onProgress","MainScene","OptionsScene","CutScene","MasterHudOverlay","MasterHud","startLevel","resource","progress","SpawnPoint","area","maxMobCount","respawnSeconds","mobCount","nextSpawn","mobBody","createMob","dispObj_1","random","loadSpr_1","setTimeout","mobEntity","canFire","nowMilliseconds","rnd","can","lastFire","attackCD","rnd_1","AI","LOCK_DISTANCE","TRACK_DISTANCE","calcDistance","targetDistance","turnTowardsTarget","hasTarget","attributes","AtkCD","dx","dy","Right","BTN_X","BTN_Y","BTN_SCALE","prefix","isFullScreen","btnFullScreen","toggleFullScreen","btnOptions","doc","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","docElm","documentElement","requestFullScreen","requestFullscreen","mozRequestFullScreen","webkitRequestFullScreen","msRequestFullscreen","exitFullScreen","exitFullscreen","mozCancelFullScreen","webkitExitFullscreen","msExitFullscreen","HeroCharacter_1","StatsHud_1","Lava_1","Platform_1","Bumper_1","QuestManager_1","shakeDuration","shakeEnd","nextShake","magnitude","SHAKE_COUNT","startGroundShake","milliSeconds","magnitudeInPixels","setup","hero","p","STATIC","interpolatedAngle","Trigger","questMngr","canActivateTrigger","distance","handleTriggerEvent","playerContacts","handleInteractiveCollision","spawnPoints","IsHeroInteractive","cutScene","backGroundTexture","SetBackGround","DeathScene","shakeX","randomRange","shakeY","HeroCharacter","StatsHud","HudOverlay","registerFactory","def","Platform","tilesX","tilesY","Bumper","QuestManager","burn","burnStop","GROUND_SHAKE","playTrack","audioTrack","plx","IsInteractive","idle","collectObject","orgScaleX","upX","upY","endX","endY","moveUp","Tween","to","easing","Easing","Linear","None","moveAway","Back","In","chain","removeEntity","addInfoMessage","coin","gem","questItem","acquireItem","secondsFromNow","seconds","removeDisplayObject","c","MovementController_1","Mob_1","HERO_FRAME_SIZE","movementCtrl","MovementState","Idle","emitterPixies","JumpLeft","IsRunning","minStartRotation","maxStartRotation","JumpRight","JumpUp","updateOwnerPos","emitterBurn","degree","PI","onPlayerMove","newState","isRunning","idleAnimationTimeoutHandle","clearTimeout","walk","jump","JumpDownLeft","jumpAttack","JumpDownRight","JumpDown","MovementController","onPlayerContact","onBulletContact","asset","MOVE_TOPIC","isInteractive","mob","verticalVelocity","abs","handleMobInteraction","movementState","jumpContact","smoke","pivot","hitPain","explode","bulletHitWall","it","chance","dropItemBody","createEntity","addDropItem","itemBody","orgScaleY","VELOCITY","JUMP_FORCE","JUMP_ATTACK_FORCE","JUMP_COOLDOWN","JUMP_ATTACK_COOLDOWN","JUMP_ATTACK_FREEZE","nextJumpAllowed","nextJumpDownAllowed","kbd","isJumping","_isInteractive","StartJump","forceVector","applyImpulse","StartJumpDown","setZeroForce","oldState","hasOnlySensorContacts","every","calcMovementVelocity","HasJumpAtack","canRun","newIsRunning","CanJump","isCurrentJumping","IsJumping","questMsgEndTime","handleDpsChange","handleStatChange","txtCoins","toString","txtDust","txtHP","renderExp","handleLevelUp","txtExp","expFiller","addLvlUpMessage","txtLevel","txtPlayerPosition","statContainer","txtQuestMessage","pnl","maxLifetime","expPreFiller","fillLen","onCompleteCB","message","offsetX","stl","txtInfo","fade","addQuestItemMessage","setQuestMessage","msg","ttlMilis","targetWidth","diff","preFillTween","fillTween","Bounce","Out","FRAME_SIZE_X","FRAME_SIZE_Y","textureNameTopLeft","textureNameTopRight","textureNameBtmMid","textureNameBtmLeft","textureNameBtmRight","textureNameTopMid","w","h","extras","TilingSprite","xTiles","TEXTURE_BUMPER","TEXTURE_ROTOR","ROTATION","rot","rotor","QuestState_1","gameScene","questState","qs","QuestState","findQuest","quest","findQuestWithItem","setQuestState","Completed","completedMsg","questId","isArray","dependsOn","dependency","Rewarded","lastActive","getQuestState","quest_1","welcomeMsg","Finished","giveRewards","InProgress","win","genericQuestHandler","getChildByName","lock","findBodyByName","cs","SetText","finishedMsg","rt","objectiveMsg","foundBody","currentMusicTrack","find","obj","title","OFFSET","btnBack","deathScene","btnContinue","callout","corpse","deathTrackId","getTrack","deathMessages","corpseBlurFilter","BlurFilter","textMessage","blr","blur","clm","ColorMatrixFilter","sepia","backSprite","TextStyle","utils","EventEmitter","howler_1","SoundMan","musicTrackNames","musicTracks","currentTrack","previousMusicVolume","previousFxVolume","musicVolume","fxVolume","trackName","Howl","autoplay","loop","volume","walkSnd","preload","jumpSnd1","jumpSnd2","burnSnd","hurtSnd","coinSnd","gemSnd","questItemSnd","winSnd","atkMag1","hitMag1","jumpAtk","pain","jmpContact","woosh","fxDemoSnd","backgroundSnd","playing","FxVolume","MusicVolume","rate","hitMagic1","hurt","stop","stopTrack","trackId","animations","resetAnimation","frames","isPlaying","isLooping","frameIndex","_i","arguments","valid","clearAnimations","secForFrame","onCompleteCallBack","spriteSheetName","tempTexure","isAtlas","xFrames","rect","SpawnPoint_1","gameLevels","factory","factoryList","levelDefinition","createLevel","vps","p2body","npc","sp","xy","buildDisplayObject","buildPhysicsObject","collisionType","mobDispObj","ai","definition","mob_1","aseq","framesize","aspr","sprTexture","parseInt","preventSensor","KINEMATIC","dispObjAsAny","Box","getLocalBounds","pixi","g","__exportStar","_values","_keys","contains","remove","getAll","getSet","valueOrvalueGetter"],"mappings":"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","file":"./main.f4e9bcb878bdb99af3e6.js","sourcesContent":["import { PIXI } from \"..\";\r\nexport class TextureLoader{\r\n\r\n    private static resourceCache = {};\r\n\r\n    public static Get = (fullName: string, mipmap: boolean = false): PIXI.Texture | null => {\r\n        var idx = fullName.indexOf('.json@');\r\n        var textureName = (idx > 0) ? fullName.substr(idx + 6) : fullName; \r\n        var resourceName =    (idx > 0) ? fullName.substr(0, idx + 5) : fullName;   \r\n        if(!TextureLoader.resourceCache[resourceName]) {\r\n            TextureLoader.resourceCache[resourceName] = PIXI.loader.resources[resourceName];\r\n            TextureLoader.resourceCache[resourceName].spritesheet.baseTexture.mipmap = mipmap;\r\n        }\r\n        var res = TextureLoader.resourceCache[resourceName];\r\n\r\n        if(!res){\r\n            console.error(`Resource:'${fullName}' not found!`);\r\n            return null;\r\n        }\r\n\r\n        if(res.loadType == 2){\r\n            return res.texture;\r\n        } else if(res.loadType == 1){\r\n            \r\n            var t = res.textures[textureName];\r\n            t.baseTexture.scaleMode = PIXI.SCALE_MODES.LINEAR;\r\n            //t.baseTexture.mipmap = false;\r\n            return t;\r\n        }else{\r\n            console.error(`Resource:'${fullName}' unknown load type!`, res);\r\n        }  \r\n        return null;      \r\n    }\r\n\r\n    public static IsAtlas(texture:PIXI.Texture) {\r\n        return texture.frame.width != texture.baseTexture.width || texture.frame.height != texture.baseTexture.height;\r\n    }\r\n}","import * as PIXI from 'pixi.js';\r\nimport { OutlineFilter } from '@pixi/filter-outline';\r\nimport { TextureLoader } from '.';\r\n\r\nexport enum OutlineMode {\r\n    /**\r\n     * The outline is backed in the buttons texture.\r\n     * This looks excelent if the button's size matches the texture.  \r\n     * */\r\n    Texture,\r\n    /**\r\n     * The outline is created with the OutlineFilter.\r\n     * Best to be used with small uniform textures (so scaling will not affect the texture). \r\n     */\r\n    Filter\r\n}\r\nexport class Button extends PIXI.Sprite {\r\n\r\n    private textureUp: PIXI.Texture;\r\n    private textureHighlight!: PIXI.Texture;\r\n    private textureDown: PIXI.Texture;\r\n    private _outlineMode: OutlineMode = OutlineMode.Filter;\r\n    private _outlineColor: number;\r\n    private _isHighlighted: boolean = false;\r\n    private _isPressed: boolean = false;\r\n    private _isDisabled: boolean = false;\r\n    private _isClickStarted: boolean = false;\r\n    private _text: PIXI.Text;\r\n    private requestedWidth: number = 0;\r\n    private requestedHeight: number = 0;\r\n\r\n    constructor(texturePath: string, x: number = 0, y: number = 0, width: number = 128, height: number = 32) {\r\n        super();\r\n        this.position.set(x || 0, y || 0);\r\n        this.requestedHeight = height;\r\n        this.requestedWidth = width;\r\n\r\n        //  setup button textures\r\n        this.setTexture(texturePath);\r\n\r\n        this.buttonMode = false;\r\n        this.interactive = true;\r\n        this.cursor = \"hover\";\r\n\r\n        // set the mousedown and touchstart callback...\r\n        this.on('pointerdown', this.onButtonDown)\r\n        this.on('pointerup', this.onButtonUp)\r\n        this.on('pointerupoutside', this.onButtonUpOutside)\r\n        this.on('pointerover', this.onButtonOver)\r\n        this.on('pointerout', this.onButtonOut)\r\n\r\n        this.isPressed = false;       \r\n    }\r\n\r\n    public get outlineMode(){\r\n        return this._outlineMode;\r\n    }\r\n    public set outlineMode(state: OutlineMode) {\r\n        this._outlineMode = state;\r\n        this.filters = this._outlineMode == OutlineMode.Filter ? [new OutlineFilter(1, this._outlineColor, 0.5)]  : null;      \r\n    }\r\n\r\n    public get outlineColor(){\r\n        return this._outlineColor;\r\n    }\r\n    public set outlineColor(value: number) {\r\n        this._outlineColor = value;\r\n        this.filters = this._outlineMode == OutlineMode.Filter ? [new OutlineFilter(1, this._outlineColor, 0.5)]  : null;      \r\n    }\r\n\r\n    public get disabled() {\r\n        return this._isDisabled;\r\n    }\r\n    public set disabled(state: boolean) {\r\n        this._isDisabled = state;\r\n        this.cursor = state ? \"\" : \"hover\";\r\n        this.applyTexture();\r\n    }\r\n\r\n    public get isPressed() {\r\n        return this._isPressed;\r\n    }\r\n    public set isPressed(state: boolean) {\r\n        this._isPressed = state;\r\n        this.applyTexture();\r\n    }\r\n\r\n    public get isHighlighted() {\r\n        return this._isHighlighted;\r\n    }\r\n    public set isHighlighted(state: boolean) {\r\n        this._isHighlighted = state;\r\n        this.applyTexture();\r\n    }\r\n\r\n    public get text() {\r\n        return this._text;\r\n    }\r\n    public set text(text: PIXI.Text) {\r\n        if (this._text) {\r\n            this.removeChild(this._text);\r\n        }\r\n        this._text = text;\r\n        if (this._text) {\r\n            this._text.anchor.set(0.5, 0.5);\r\n            var x = (this.width / this.scale.x) / 2;\r\n            var y = (this.height / this.scale.y) / 2;\r\n            this._text.position.set(x, y);\r\n            this.addChild(this._text);\r\n        }\r\n    }\r\n\r\n    public onClick!: (event:any) => void;\r\n    public mouseover!:(event:any) => void;\r\n    public mouseout!:(event:any) => void;\r\n\r\n    private onClickHandler(event:any){\r\n        if(!this.onClick){\r\n            console.warn(\"onClick() empty, did you forget to attach a handler?\");\r\n        } \r\n        else {\r\n            this.onClick(event);\r\n        }\r\n    }\r\n    \r\n    private onButtonDown = () => {\r\n        if(this._isDisabled) return;\r\n        this._isClickStarted = true;\r\n        this.texture = this.textureDown;\r\n    }\r\n\r\n    private onButtonUp = (event:any) => {\r\n        if(this._isDisabled) return;\r\n        if (this._isClickStarted) {\r\n            this._isClickStarted = false;\r\n            this.onClickHandler(event);\r\n        }\r\n        this.applyTexture();\r\n    }\r\n\r\n    private onButtonUpOutside = () => {\r\n        if(this._isDisabled) return;\r\n        this.applyTexture();\r\n        this._isClickStarted = false;\r\n    }\r\n\r\n    private onButtonOver = (event:any) => {\r\n        if(this._isDisabled) return;\r\n        this.texture = this.textureHighlight;\r\n        if(this.mouseover)this.mouseover(event);\r\n    }\r\n\r\n    private onButtonOut = (event:any) => {\r\n        if(this._isDisabled) return;\r\n        this._isClickStarted = false;\r\n        this.applyTexture();\r\n        if(this.mouseout)this.mouseout(event);\r\n    }\r\n\r\n    private applyTexture() {\r\n        if(this._isDisabled){\r\n            this.texture = this.textureUp;\r\n            this.tint = 0x606060;\r\n        }else if(this._isHighlighted){\r\n            this.texture = this.textureHighlight;\r\n            this.tint = 0x666666;\r\n        }\r\n        else{\r\n            this.texture = this._isPressed ? this.textureDown : this.textureUp;\r\n            this.tint = 0xffffff;\r\n        }\r\n    }\r\n\r\n    public performClick(event:any){\r\n        this.onClickHandler(event);\r\n    }\r\n    \r\n    public setTexture(textureAtlasName: string) {\r\n        //var spriteSheet = PIXI.loader.resources[textureAtlasName].texture;\r\n        var spriteSheet = TextureLoader.Get(textureAtlasName);\r\n        spriteSheet.baseTexture.scaleMode = PIXI.SCALE_MODES.NEAREST;\r\n        var btnHeight = spriteSheet.height / 3;\r\n        var btnWidth = spriteSheet.width;\r\n        this.textureUp = new PIXI.Texture(spriteSheet.baseTexture, new PIXI.Rectangle(spriteSheet.frame.x, spriteSheet.frame.y, btnWidth, btnHeight));\r\n        this.textureHighlight = new PIXI.Texture(spriteSheet.baseTexture, new PIXI.Rectangle(spriteSheet.frame.x, spriteSheet.frame.y +  1 * btnHeight, btnWidth, btnHeight));\r\n        this.textureDown = new PIXI.Texture(spriteSheet.baseTexture, new PIXI.Rectangle(spriteSheet.frame.x, spriteSheet.frame.y + 2 * btnHeight, btnWidth, btnHeight));\r\n\r\n        //  calc the scale based on desired height/width\r\n        var scaleW = (this.requestedWidth || btnWidth ) / btnWidth;\r\n        var scaleH = (this.requestedHeight || btnHeight) / btnHeight;\r\n        this.scale.set(scaleW, scaleH);\r\n\r\n        this.applyTexture();\r\n    }\r\n}\r\n","import * as PIXI from 'pixi.js';\r\nimport { Scene } from \"./Scene\";\r\nimport * as TWEEN from \"@tweenjs/tween.js\";\r\nexport enum State {\r\n    GLOBAL,\r\n    MENU,\r\n    IN_GAME,\r\n    CUSTOM1,\r\n    CUSTOM2,\r\n    CUSTOM3,\r\n    CUSTOM4,\r\n    CUSTOM5,\r\n}\r\n\r\n//declare var stats: Stats;\r\n\r\n/**\r\n *   Handles multiple scenes, scene activation, rendering and updates.\r\n */\r\nexport class SceneManager {\r\n    private masterHudOverlay! : PIXI.Container;\r\n\r\n    /**\r\n     * This object is only to support rendering masterHudOverlay together with the current scene!!!\r\n     */\r\n    private masterContainer : PIXI.Container;\r\n    \r\n    private currentScene: Scene | null = null;\r\n    private lastScene!: Scene;\r\n    private scenes: Array<Scene> = [];\r\n    private renderer: PIXI.WebGLRenderer | PIXI.CanvasRenderer;\r\n\r\n    private designWidth: number;\r\n    private designHeight: number;\r\n    private sceneResizer: ISceneResizer;\r\n\r\n    private startTime = null;\r\n    private animationFrameHandle: number =-1;\r\n\r\n    /**\r\n     *   Creates a new SceneManager instance.\r\n     *\r\n     *   @param width the width of the scene\r\n     *   @param height the height of the scene\r\n     *   @param resizer custom resize function\r\n     */\r\n    constructor(width: number, height: number, options?: PIXI.RendererOptions, resizer?: ISceneResizer) {\r\n        this.designWidth = width;\r\n        this.designHeight = height;\r\n        this.sceneResizer = resizer || new DefaultResizer(this.designWidth, this.designHeight);\r\n        this.masterContainer = new PIXI.Container();\r\n\r\n        if (!options) {\r\n            options = { antialias: false, roundPixels: true, backgroundColor: 0x012135, transparent: true };\r\n        }\r\n        this.renderer = PIXI.autoDetectRenderer(width, height, options);\r\n        this.renderer.autoResize = true;\r\n\r\n        //  textureGC is only used for web GL renderer\r\n        if ((this.render as any).textureGC) {\r\n            (this.render as any).textureGC.mode = PIXI.GC_MODES.AUTO;\r\n        }\r\n\r\n        window.removeEventListener(\"resize\", this.resizeHandler);\r\n        window.addEventListener(\"resize\", this.resizeHandler, true);\r\n\r\n        /*\r\n        stats.showPanel(0); // 0 – use the FPS mode, 1 – use the milliseconds mode\r\n\r\n        // Position the meter in the top-left corner\r\n        stats.domElement.style.position = \"absolute\";\r\n        stats.domElement.style.left = \"\";\r\n        stats.domElement.style.right = \"20px\";\r\n        stats.domElement.style.bottom = \"20px\";\r\n        stats.domElement.style.top = \"\"; \r\n\r\n        // Append the meter to the body of your HTML5 document.\r\n        document.body.appendChild(stats.domElement);\r\n        */\r\n\r\n        this.render(0);\r\n    }\r\n\r\n    /**\r\n     *   Returns the renderer instance.\r\n     */\r\n    public get Renderer(): PIXI.WebGLRenderer | PIXI.CanvasRenderer {\r\n        return this.renderer;\r\n    }\r\n\r\n    /**\r\n     *   Returns the current scene instance.\r\n     */\r\n    public get CurrentScene(): Scene {\r\n        return this.currentScene as Scene;\r\n    }\r\n\r\n    /**\r\n     *   Adds a scene.\r\n     */\r\n    public AddScene(scene: Scene):void {\r\n        this.scenes.push(scene);\r\n        scene.sceneManager = this;\r\n    }\r\n\r\n    /**\r\n     *   Removes all scenes.\r\n     */\r\n    public RemoveAllScenes(): void {\r\n        this.scenes.forEach((scene: Scene) => {            \r\n            (scene.sceneManager as any) = undefined;\r\n            scene.onDestroy(true);\r\n        });\r\n        this.scenes = [];\r\n        this.currentScene = null;\r\n    }\r\n\r\n    /**\r\n     *   Removes a scene.\r\n     */\r\n    public RemoveScene(scene: Scene): void {\r\n        this.scenes = this.scenes.filter((item: Scene, index: number, arr) => {\r\n            return item !== scene;\r\n        });\r\n        (scene.sceneManager as any) = undefined;\r\n    }\r\n\r\n    /**\r\n     * Returns true if the scene exists.\r\n     * @param name\r\n     */\r\n    public HasScene(name: string): boolean {\r\n        var found = this.scenes.filter((item: Scene) => { return item.Name === name; });\r\n        return (found && found.length > 0);\r\n    }\r\n\r\n    /**\r\n     * Returns the scene by its name.\r\n     * @param name\r\n     */\r\n    public GetScene(name: string): Scene{\r\n        var found = this.scenes.filter((item: Scene) => { return item.Name === name; });\r\n        if (!found || found.length === 0) {\r\n            throw Error(\"Scene: '\" + name + \"' not found\");\r\n        }\r\n        if (found.length > 1) {\r\n            throw Error(\"Multiple scenes: '\" + name + \"' found\");\r\n        }\r\n        return found[0];\r\n    }\r\n\r\n    /**\r\n     *   Activates the given scene.\r\n     */\r\n    public ActivateScene(sceneOrName: Scene | string):void {       \r\n        var scene: Scene;\r\n        if (typeof (sceneOrName) === \"string\") {\r\n            var found = this.scenes.filter((item:Scene) => { return item.Name === sceneOrName; });\r\n            if (!found || found.length === 0) {\r\n                throw Error(\"Scene: '\" + sceneOrName + \"' not found\");\r\n            }\r\n            if (found.length > 1) {\r\n                throw Error(\"Multiple scenes: '\" + sceneOrName + \"' found\");\r\n            }\r\n            scene = found[0];\r\n        }else {\r\n            scene = sceneOrName as Scene;\r\n        }\r\n\r\n        if(this.currentScene /*&& this.currentScene.onDeactivate*/ && this.currentScene !== scene){\r\n\r\n            console.log(\"DeactivateScene \" + this.currentScene.Name);\r\n            this.currentScene.onDeactivate();\r\n        }\r\n\r\n        console.log(\"ActivateScene \" + scene.Name);\r\n        this.startTime = null;\r\n        this.lastScene = (this.currentScene != scene ? this.currentScene : this.lastScene) as Scene;\r\n        this.currentScene = scene;\r\n        this.renderer.backgroundColor = scene.BackGroundColor;\r\n        this.resizeHandler();\r\n\r\n        //if (scene.onActivate) {\r\n            scene.onActivate();\r\n        //}\r\n        \r\n        this.masterContainer.removeChildren();\r\n        this.masterContainer.addChild(this.currentScene);\r\n        if(this.masterHudOverlay)this.masterContainer.addChild(this.masterHudOverlay);\r\n\r\n        PIXI.settings.RESOLUTION = window.devicePixelRatio;\r\n    }\r\n    \r\n    public ActivatePreviousScene() {\r\n        this.ActivateScene(this.lastScene);\r\n    }\r\n\r\n    /**\r\n     * gets the master HUD overlay object.\r\n     */\r\n    public get MasterHudOverlay(){\r\n        return this.masterHudOverlay;\r\n    }\r\n    /**\r\n     * Sets the master HUD overlay object.\r\n     */\r\n    public set MasterHudOverlay(hud: PIXI.Container) { \r\n        this.masterHudOverlay = hud;\r\n        this.masterContainer.removeChildren();\r\n        this.masterContainer.addChild(this.currentScene as Scene);\r\n        if(this.masterHudOverlay)this.masterContainer.addChild(this.masterHudOverlay);\r\n        this.resizeHandler();\r\n    }\r\n\r\n    /**\r\n     *  Renders the current scene in a rendertexture.\r\n     */\r\n    public CaptureScene(): PIXI.RenderTexture {\r\n        console.log(`Capturing scene, width: ${this.renderer.width}, height: ${this.renderer.height}`);\r\n        var renderTexture = PIXI.RenderTexture.create(this.renderer.width, this.renderer.height);\r\n        this.renderer.render(this.currentScene as Scene, renderTexture);\r\n        return renderTexture;\r\n    }\r\n\r\n    /**\r\n     *   Cancels the animationFrame loop, removes all scenes and finally destroys the renderer.\r\n     */\r\n    public Destroy = () => {\r\n        cancelAnimationFrame(this.animationFrameHandle);\r\n        if (this.currentScene) { this.currentScene.pause(); }\r\n        this.scenes.forEach((scene: Scene) => {\r\n            this.RemoveScene(scene);\r\n        });\r\n        this.renderer.destroy(true);\r\n    };\r\n\r\n    private resizeHandler = () => {\r\n        var avlSize = this.sceneResizer.GetAvailableSize();\r\n        var aspect = this.sceneResizer.GetAspectRatio();\r\n        var size = this.sceneResizer.CalculateSize(avlSize, aspect);\r\n        this.renderer.resize(size.x, size.y);\r\n\r\n        if (this.currentScene) {\r\n            this.currentScene.scale.set(this.sceneResizer.CalculateScale(size));\r\n            //if (this.currentScene.onResize) {\r\n                this.currentScene.onResize();\r\n            //}\r\n        }\r\n\r\n        if(this.masterHudOverlay){\r\n            this.masterHudOverlay.scale.set(this.sceneResizer.CalculateScale(size));            \r\n        }\r\n    };\r\n\r\n    private render = (timestamp) => {\r\n        //stats.begin();\r\n        \r\n        this.animationFrameHandle = requestAnimationFrame(this.render);\r\n        \r\n        //  for tween support\r\n        TWEEN.update(timestamp);\r\n\r\n        //  exit if no scene or paused\r\n        if (!this.currentScene || this.currentScene.isPaused()) {\r\n            return;\r\n        }\r\n\r\n        if (!this.startTime) {\r\n            this.startTime = timestamp;\r\n        }\r\n\r\n        //if (this.currentScene.onUpdate) {\r\n            var dt = timestamp - this.startTime!;\r\n            if (dt > 50) {\r\n                dt = 50;\r\n            }\r\n            this.currentScene.onUpdate(dt);\r\n        //}\r\n\r\n        this.startTime = timestamp;       \r\n        this.renderer.render(this.masterContainer, undefined, this.currentScene.clear); \r\n        \r\n        //stats.end();\r\n    };\r\n}\r\n\r\nexport class DefaultResizer implements ISceneResizer {\r\n    constructor(protected designedWidth:number, protected designedHeight:number) {\r\n    }\r\n    public GetAvailableSize():ISize {\r\n        return { x: window.innerWidth, y: window.innerHeight};\r\n    }\r\n    public GetAspectRatio():number {\r\n        return this.designedWidth / this.designedHeight;\r\n    }\r\n    public CalculateSize(availableSize: ISize, aspect: number): ISize {\r\n        var maxWidth: number, maxHeight: number;\r\n        maxWidth = Math.floor(aspect * availableSize.y);\r\n        maxHeight = Math.floor(window.innerHeight);\r\n        return { x: Math.min(maxWidth, availableSize.x ), y: Math.min(maxHeight, availableSize.y) };\r\n    }\r\n    public CalculateScale(newSize: ISize):number {\r\n        return newSize.x / this.designedWidth;\r\n    }\r\n}\r\n\r\nexport interface ISize {\r\n    x: number;\r\n    y: number;\r\n}\r\n\r\n/**\r\n *   Object passed to the SceneManager handling various aspects of scene resizing.\r\n */\r\nexport interface ISceneResizer {\r\n\r\n    /*\r\n     *   Returns the available width.\r\n     */\r\n    GetAvailableSize: () => ISize;\r\n\r\n    /*\r\n     *   Returns the desired aspect ratio for the stage.\r\n     */\r\n    GetAspectRatio: () => number;\r\n\r\n    CalculateSize: (availableSize: ISize, aspect: number) => ISize;\r\n\r\n    CalculateScale(newSize: ISize): number;\r\n}\r\n","import * as PIXI from 'pixi.js';\r\nimport { SceneManager } from \"./SceneManager\";\r\n\r\n/**\r\n *   Represents a scene. \r\n *   Only one scene at a time is rendered.\r\n */\r\nexport abstract class Scene extends PIXI.Container {\r\n    private paused: boolean = false;\r\n    private hudScene: PIXI.Container | null = null;\r\n    private backgroundColor: number;\r\n    public sceneManager: SceneManager;\r\n    public onActivate(): void{}\r\n    public onDeactivate(): void{}\r\n    public onResize(): void{}\r\n    public onUpdate(dt: number):void{};\r\n    public onDestroy(options?: PIXI.DestroyOptions | boolean): void{}\r\n\r\n    /**\r\n     *   Creates a new scene instance.\r\n     *   @param name the scene name.\r\n     */\r\n    constructor(scm: SceneManager, name: string) {\r\n        super();\r\n        this.sceneManager = scm;\r\n        this.backgroundColor = 0x0;\r\n        this.Name = name;\r\n    }\r\n\r\n    public Name: string;\r\n\r\n    public get BackGroundColor():number {\r\n        return this.backgroundColor;\r\n    }\r\n    public set BackGroundColor(color: number) {\r\n        this.backgroundColor = color;\r\n    }\r\n\r\n    public get HudOverlay(): PIXI.Container | null {\r\n        return this.hudScene;\r\n    }\r\n    public set HudOverlay(hud: PIXI.Container | null) {\r\n        if (this.hudScene) {\r\n            this.removeChild(this.hudScene);\r\n        }\r\n        this.hudScene = hud;\r\n\r\n        if (this.hudScene) {\r\n            var maxIndex = this.children.length;\r\n            this.addChildAt(this.hudScene, maxIndex);\r\n        }\r\n    }\r\n\r\n    public addChild<T extends PIXI.DisplayObject>(child: T): T {\r\n        var dispObj = super.addChild(child);\r\n        if (this.hudScene) {\r\n            var maxIndex = this.children.length - 1;\r\n            this.setChildIndex(this.hudScene, maxIndex);\r\n        }        \r\n        return dispObj;\r\n    }\r\n\r\n    public addChildAt<T extends PIXI.DisplayObject>(child: T, index: number): T {\r\n        var dispObj = super.addChildAt(child, index);\r\n        if (this.hudScene) {\r\n            var maxIndex = this.children.length - 1;\r\n            this.setChildIndex(this.hudScene, maxIndex);\r\n        }        \r\n        return dispObj;\r\n    }\r\n\r\n    public pause():void {\r\n        this.paused = true;\r\n    }\r\n    public resume():void {\r\n        this.paused = false;\r\n    }\r\n    public isPaused():boolean {\r\n        return this.paused;\r\n    }\r\n\r\n    private _clear:boolean = true;\r\n    public get clear() {\r\n        return this._clear;\r\n    }\r\n\r\n    public set clear(clearFlag: boolean) {\r\n        this._clear = clearFlag;\r\n    }    \r\n}\r\n","import { IRootObject, ILevelDefinition, ITemplate, IMapEntity, IMobEntity } from './LevelInterfaces';\r\n\r\n/**\r\n* Returns all assets referenced in the level.\r\n* @param root\r\n* @param levelId\r\n*/\r\nexport function GetLevelAssets(root: IRootObject, levelId: number): string[] {\r\n    var assets: string[] = [];\r\n\r\n    var level: ILevelDefinition = undefined;\r\n    for (var i = 0; i < root.levels.length; i++) {\r\n        if (root.levels[i].id === levelId) {\r\n            level = root.levels[i];\r\n            break;\r\n        }\r\n    }\r\n\r\n    if (level) {\r\n        level.parallax.forEach((iplx) => {\r\n            assets = assets.concat(iplx.textures);\r\n        });\r\n\r\n        if (level.assets && level.assets.length > 0) {\r\n            assets = assets.concat(level.assets);\r\n        }\r\n\r\n        //  merge global templates with level templates\r\n        var templates = root.templates.concat(level.map.templates);\r\n\r\n        // add all textures from templates (we don't need to have entities referencing the template if they are in a spawn)\r\n        level.map.templates.forEach((tos) => {\r\n            if (!tos.type || tos.type !== \"spawn_point\") {\r\n                let templ = tos as ITemplate;\r\n                let dispObj = templ.displayObject;\r\n                if (dispObj.texture) {\r\n                    if (typeof dispObj.texture === \"string\") {\r\n                        assets.push(dispObj.texture);\r\n                    } else {\r\n                        assets = assets.concat(dispObj.texture);\r\n                    }\r\n                }\r\n                if (dispObj.sequences) {\r\n                    dispObj.sequences.forEach((item) => {\r\n                        assets.push(item.texture);\r\n                    });\r\n                }\r\n            }\r\n        });\r\n\r\n        level.map.entities.forEach((entity: IMapEntity) => {\r\n            let defs = getEntityDefinition(templates, entity);\r\n            if (defs.doDef.texture) {\r\n                if (typeof defs.doDef.texture === \"string\") {\r\n                    assets.push(defs.doDef.texture);\r\n                } else {\r\n                    assets = assets.concat(defs.doDef.texture);\r\n                }\r\n            }\r\n            if (defs.doDef.sequences) {\r\n                defs.doDef.sequences.forEach((item) => {\r\n                    assets.push(item.texture);\r\n                });\r\n            }\r\n        });\r\n\r\n        level.map.NPC = level.map.NPC || [];\r\n        level.map.NPC.forEach((tos: IMobEntity) => {\r\n            //  check if its a template or spawn_point\r\n            if (tos.type && tos.type === \"spawn_point\") {\r\n\r\n            } else {\r\n                //  this is an entity definition\r\n                let entity: IMobEntity = tos as IMobEntity;\r\n\r\n                //  concat attack (string | string[])\r\n                if (entity.attack) {\r\n                    assets = assets.concat(entity.attack);\r\n                }\r\n\r\n                var entityTemplate = templates.filter((item) => item.name === entity.template);\r\n                if (entityTemplate && entityTemplate.length > 0) {\r\n                    var template = entityTemplate[0];\r\n                    // var temp = $.extend(true, {}, template.displayObject);\r\n                    // var displayObjectDefinition = $.extend(temp, entity);\r\n                    var displayObjectDefinition = { ...template.displayObject, ...entity };\r\n                    if (displayObjectDefinition.texture) {\r\n                        if (typeof displayObjectDefinition.texture === \"string\") {\r\n                            assets.push(displayObjectDefinition.texture);\r\n                        } else {\r\n                            assets = assets.concat(displayObjectDefinition.texture);\r\n                        }\r\n                    }\r\n\r\n                    if (displayObjectDefinition.attack) {\r\n                        assets = assets.concat(displayObjectDefinition.attack);\r\n                    }\r\n\r\n                    if (displayObjectDefinition.sequences) {\r\n                        displayObjectDefinition.sequences.forEach((item) => {\r\n                            //  add only if texture exists\r\n                            if (item.texture) {\r\n                                assets.push(item.texture);\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    //  convert json atlas prefixed texture names to only json file names\r\n    assets = assets.map((name)=> {\r\n        let idx = name.indexOf('.json@');        \r\n        return idx > 0 ? name.substr(0, idx + 5) : name;\r\n    });\r\n    assets = getUniqueItems(assets);\r\n    return assets;\r\n}\r\n\r\n/**\r\n* Returns an object containing extracted display object and body definitions.\r\n* @param templates\r\n* @param entity\r\n*/\r\nexport function getEntityDefinition(templates: Array<any>, entity: IMapEntity | IMobEntity) {\r\n    let displayObjectDefinition = null;\r\n    let bodyDefinition = null;\r\n    let template = {\r\n        name: null,\r\n        displayObject: { typeName: \"Sprite\" }, //    sprite is the default if no template exists\r\n        body: null,\r\n        trigger: null,\r\n        drop: null\r\n    };\r\n    var entityTemplate = templates.filter((item) => item.name === entity.template);\r\n    if (entityTemplate && entityTemplate.length > 0) {\r\n        template = entityTemplate[0];\r\n    }\r\n    displayObjectDefinition = { ...template.displayObject, ...entity };\r\n\r\n    if (template.drop) {\r\n        displayObjectDefinition = { ...displayObjectDefinition, drop: template.drop }\r\n    }\r\n    if (template.body) {\r\n        bodyDefinition = template.body;\r\n    }\r\n\r\n    let triggerTemplate = undefined;\r\n    if (template.trigger || displayObjectDefinition.trigger) {\r\n        triggerTemplate = { ...template.trigger, ...displayObjectDefinition.trigger };\r\n    }\r\n    return {\r\n        templateName: template.name,\r\n        doDef: displayObjectDefinition,\r\n        bdDef: bodyDefinition,\r\n        trigger: triggerTemplate\r\n    };\r\n}\r\n/**\r\n * Returns a filtered array with unique only items from the input array\r\n * @param arr \r\n */\r\nexport function getUniqueItems(arr) {\r\n    var n = {}, r = [];\r\n    for (var i = 0; i < arr.length; i++) {\r\n        if (!n[arr[i]]) {\r\n            n[arr[i]] = true;\r\n            r.push(arr[i]);\r\n        }\r\n    }\r\n    return r;\r\n}\r\n\r\n","import { AnimatedSprite, AnimationSequence } from \"../_engine/AnimatedSprite\";\r\nimport { Bullet } from \"../objects/Bullet\";\r\nimport { snd } from \"../world/SoundMan\";\r\nimport { AI } from \"./AI\";\r\nimport { BasicStaticAI } from \"./BasicStaticAI\";\r\nimport { wp2 } from '../world/WorldP2';\r\nimport { DirectionH, AtrType } from '../enums';\r\n\r\nconst FRAME_SIZE: number = 48;\r\n\r\n\r\n\r\n/**\r\n * Represents a monster entity\r\n */\r\nexport class Mob extends AnimatedSprite {\r\n\r\n    private onDeathCallBack: () => void;\r\n    private _isDead: boolean = false;\r\n    private _attributes: number[];\r\n    private _ai: AI;\r\n    private _direction: DirectionH;\r\n    \r\n    constructor(private textureName: string) {\r\n        super();\r\n\r\n        this.addAnimations(new AnimationSequence(\"left\", this.textureName, [0, 1, 2], FRAME_SIZE, FRAME_SIZE));\r\n        this.addAnimations(new AnimationSequence(\"right\", this.textureName, [3, 4, 5], FRAME_SIZE, FRAME_SIZE));\r\n        this.addAnimations(new AnimationSequence(\"latk\", this.textureName, [6, 7, 8], FRAME_SIZE, FRAME_SIZE));\r\n        this.addAnimations(new AnimationSequence(\"ratk\", this.textureName, [9, 10, 11], FRAME_SIZE, FRAME_SIZE));\r\n        this.addAnimations(new AnimationSequence(\"lsquish\", this.textureName, [12, 13, 14, 15, 16, 17], FRAME_SIZE, FRAME_SIZE));\r\n        this.addAnimations(new AnimationSequence(\"rsquish\", this.textureName, [18, 19, 20, 21, 22, 23], FRAME_SIZE, FRAME_SIZE));\r\n        this.play(\"left\");   \r\n        this._direction = DirectionH.Left;  \r\n    }\r\n\r\n    public isLoading: boolean = false;\r\n\r\n    public get isDead() {\r\n        return this._isDead;\r\n    }\r\n    public set isDead(value: boolean) {\r\n        if (value != this._isDead) {\r\n            this._isDead = value;\r\n            if (this._isDead && this.onDeathCallBack) {\r\n                this.onDeathCallBack();\r\n            }\r\n        }\r\n    }\r\n\r\n    public set onDeath(cb: () => void) {\r\n        this.onDeathCallBack = cb;\r\n    }\r\n    public get onDeath(): () => void {\r\n        return this.onDeathCallBack;\r\n    }\r\n\r\n\r\n    /**\r\n     * texture used for attacks emitted by the mob.\r\n     */\r\n    public atkTexture: string | string[];\r\n\r\n    /**\r\n     * Kills the mob, plays squish animation and sound. Optionaly invokes the call back on animation end.\r\n     * @param cb\r\n     */\r\n    public squish(cb?: () => void) {     \r\n        this.isDead = true;   \r\n        var aname = (this._direction == DirectionH.Left ? \"lsquish\" : \"rsquish\");\r\n        this.onComplete = cb;\r\n        this.play(aname, 12, false);\r\n        snd.mobSquish();\r\n    }\r\n\r\n    public get direction(): DirectionH {\r\n        return this._direction;\r\n    }\r\n    public set direction(dir: DirectionH) {\r\n        if (this._direction != dir) {\r\n            this._direction = dir;\r\n            if (dir === DirectionH.Left) {\r\n                this.play(\"left\");\r\n            } else {\r\n                this.play(\"right\");\r\n            }\r\n        }\r\n    }\r\n\r\n    public set attributes(values: number[]) {\r\n        this._attributes = values;\r\n    }\r\n    public get attributes(): number[] {\r\n        return this._attributes;\r\n    }\r\n\r\n    public attack = ()=> {\r\n        var currentSeq = this.currentSequence;\r\n        var currentFps = this.fps;\r\n        snd.atkMagic1();\r\n        if (this._direction == DirectionH.Left) {\r\n            this.play(\"latk\", currentFps, false);\r\n        } else {\r\n            this.play(\"ratk\", currentFps, false);\r\n        }\r\n\r\n        this.onComplete = (seq: AnimationSequence) => {\r\n            this.onComplete = null;\r\n            this.fireBullet();\r\n            this.play(currentSeq.sequenceName, currentFps);\r\n        };\r\n    }\r\n\r\n    private fireBullet() {\r\n        if (this.atkTexture.constructor === Array) {\r\n            //  TODO: animated sprite\r\n        } else {\r\n            //  sprite\r\n            Bullet.emitBullet(this.atkTexture as string, this.position, wp2.playerBody.position, this._attributes[AtrType.Atk]);\r\n        }\r\n    }\r\n\r\n    public createAI(aiTypeName: string):void {\r\n        switch (aiTypeName.toLowerCase()) {\r\n            case \"basic_static\":\r\n                this._ai = new BasicStaticAI(this);\r\n                break;\r\n\r\n            case \"basic\":\r\n                //  TODO: implement AI logic variations \r\n                break;\r\n        }\r\n    }\r\n\r\n    public onUpdate(dt: number) {\r\n        super.onUpdate(dt);\r\n\r\n        if (!this.isDead && !this.isLoading) {\r\n            this._ai.onUpdate(dt);\r\n        }\r\n    }\r\n}","import * as p2 from \"p2\";\r\nimport { COL_GRP_PLAYER, COL_GRP_BULLET, COL_GRP_SCENE, COL_GRP_GROUND } from '../world/CollisionGroups';\r\nimport { wp2 } from '../world/WorldP2';\r\nimport { Global } from '..';\r\nimport { TextureLoader } from '../_engine';\r\n\r\n/**\r\n * Base for bullets, decals etc.\r\n */\r\nexport class Bullet extends PIXI.Sprite {\r\n    private direction: PIXI.Point = new PIXI.Point();\r\n    private ttl: number;\r\n    private startTime: number;\r\n    private isDead: boolean;\r\n    private onDeath: () => void;\r\n\r\n    public readonly interactionType: number = 666;\r\n    public body: p2.Body;\r\n\r\n    /**\r\n     * Creates a new bullet particle.\r\n     *\r\n     * @param texture\r\n     * @param velocity in pixels per second\r\n     * @param ttl time to live in seconds\r\n     * @param damage bullet hit damage\r\n     */\r\n    constructor(texture: PIXI.Texture, public velocity: number, ttl: number, public damage: number) {\r\n        super(texture);\r\n        this.ttl = ttl;\r\n        this.IsDead = false;\r\n    }\r\n\r\n    public set Direction(direction: PIXI.Point) {\r\n        //  normalize movement vector\r\n        let len = direction.x * direction.x + direction.y * direction.y;\r\n        len = 1 / Math.sqrt(len);\r\n        this.direction.set(direction.x * len, direction.y * len);\r\n    }\r\n    public get Direction() {\r\n        return this.direction;\r\n    }\r\n\r\n    public get IsDead() {\r\n        return this.isDead;\r\n    }\r\n    public set IsDead(value: boolean) {\r\n        if (value != this.isDead) {\r\n            this.isDead = value;\r\n            //console.log(\"bullet is dead: \" + value);\r\n\r\n            //  if set to alive remember start time\r\n            if (this.isDead) {\r\n                if (this.body) {\r\n                    this.body.velocity = [0, 0];\r\n                }\r\n            } else {\r\n                this.startTime = performance.now() / 1000;\r\n                if (this.body) {\r\n                    this.body.position = [this.position.x, this.position.y];\r\n                }\r\n            }\r\n\r\n            //  fire OnDeath if needed\r\n            if (this.isDead && this.onDeath) {\r\n                this.onDeath();\r\n            }\r\n\r\n            this.visible = !this.isDead;\r\n        }\r\n    }\r\n\r\n    public set OnDeath(cb: { (): void }) {\r\n        this.onDeath = cb;\r\n    }\r\n    public get OnDeath() {\r\n        return this.onDeath;\r\n    }\r\n\r\n    public onUpdate = () => {\r\n        // TTL expiry\r\n        if (!this.isDead) {\r\n            let now = performance.now() / 1000;\r\n            let ellapsed = now - this.startTime;\r\n            this.IsDead = this.ttl < ellapsed;\r\n        }\r\n    }\r\n\r\n    private static bullets: Bullet[] = [];\r\n    public static emitBullet = (textureName: string, position: PIXI.Point, target:any, damage: number): Bullet => {\r\n        let bullet = Bullet.findDeadBullet();\r\n        if (!bullet) {\r\n\r\n            //  create new bullet\r\n            var t = TextureLoader.Get(textureName);\r\n            bullet = new Bullet(t, 200, 5, damage);\r\n            bullet.anchor.set(0.5);\r\n            bullet.scale.set(0.5, -0.5);    //  worldcontainer is upside down\r\n            Bullet.bullets.push(bullet);\r\n            Global.worldContainer.addChild(bullet);\r\n\r\n            //-----------------------------\r\n            //  create body (sensor shape)\r\n            //-----------------------------\r\n            let shape = new p2.Circle({ radius: bullet.width / 2 });\r\n            shape.collisionGroup = COL_GRP_BULLET;\r\n            shape.collisionMask = COL_GRP_PLAYER | COL_GRP_SCENE | COL_GRP_GROUND;\r\n            shape.sensor = true;\r\n            var options: p2.BodyOptions = {\r\n                mass: 0,\r\n                position: [position.x, position.y],\r\n                angle: 0,\r\n                fixedRotation: false,\r\n                angularDamping: 0,\r\n                damping: 0\r\n            } as p2.BodyOptions;\r\n            let body = new p2.Body(options);\r\n            body.addShape(shape);\r\n            body.setDensity(0.0);\r\n            body.gravityScale = 0;\r\n            body.angularVelocity = 2;\r\n            body.collisionResponse = false;\r\n            body.type = p2.Body.DYNAMIC;\r\n            (body as any).DisplayObject = bullet;\r\n            bullet.body = body;\r\n            wp2.addBody(body);\r\n        } \r\n\r\n        bullet.position = position;\r\n        let pt = (target instanceof Float32Array) ? new PIXI.Point(target[0] - position.x, target[1] - position.y) : new PIXI.Point(target.x - position.x, target.y - position.y);\r\n        bullet.Direction = pt;\r\n        bullet.damage = damage;\r\n        bullet.IsDead = false;\r\n        bullet.body.velocity[0] = bullet.Direction.x * bullet.velocity;\r\n        bullet.body.velocity[1] = bullet.Direction.y * bullet.velocity;\r\n\r\n        return bullet;\r\n    };\r\n\r\n    public static reset(){\r\n        Bullet.bullets = [];\r\n    }\r\n\r\n    private static findDeadBullet = (): Bullet => {\r\n        for (var i = 0, len = Bullet.bullets.length; i < len; i++) {\r\n            let blt = Bullet.bullets[i];\r\n            if (blt.IsDead) {\r\n                return blt;\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n}","import { Global } from '.';\r\nimport { BootScene } from './scenes/BootScene';\r\n\r\n\r\n/**\r\n *  Here we just preload fonts via google webfont.js\r\n *  after the fonts are loaded the bootstraper is taking over\r\n */\r\n\r\nconst PRELOAD_FONTS = [\r\n                        'Permanent Marker',\r\n                        'Orbitron',\r\n                        'Farsan',\r\n                    ];\r\n\r\n//------------------------\r\n// webfont loader config\r\n//------------------------\r\nconsole.log('initializing google webfont loader ...', PRELOAD_FONTS);\r\ntry {\r\n    var cfg = {\r\n        google: { families: PRELOAD_FONTS },\r\n        active: () => {\r\n            console.log('fonts preload finished!');          \r\n            const scm = Global.getScm();\r\n            const boot = new BootScene(scm);\r\n            scm.AddScene(boot);\r\n            scm.ActivateScene(boot);\r\n        }\r\n    };\r\n    (window as any).WebFontConfig = cfg;\r\n}\r\ncatch (e) {\r\n    console.log(e);\r\n}\r\n\r\n//------------------------\r\n// start webfont loader\r\n//------------------------\r\n/* jshint ignore:start */\r\n{\r\n    var src = ('https:' === document.location.protocol ? 'https' : 'http') +\r\n               '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';\r\n    var wf = document.createElement('script');\r\n    wf.src = src;\r\n    wf.type = 'text/javascript';\r\n    wf.async = true;\r\n    var s = document.getElementsByTagName('script')[0];\r\n    if(s.parentNode)s.parentNode.insertBefore(wf, s);\r\n};\r\n/* jshint ignore:end */","export enum BaseStatType {\r\n    MaxHP,\r\n    MaxDust,\r\n    RegenHP,\r\n    RegenDust,\r\n}\r\n\r\nexport enum StatType {\r\n    MaxHP,\r\n    HP,\r\n\r\n    MaxDust,\r\n    Dust,\r\n\r\n    RegenHP,\r\n    RegenDust,\r\n\r\n    Coins,\r\n    Gold,           //  not used\r\n\r\n    LevelExp,       // calculated value: current level exp, starts from 0 each level\r\n    LevelMaxExp,    // calculated value: current level exp needed to reach next level \r\n    TotalExp,       // total exp  \r\n\r\n    AttributePoints,\r\n\r\n    CharacterLevel, // calculated value: current char level based on total experience\r\n}\r\n\r\nexport enum DamageType {\r\n    LavaBorder = 1000,\r\n    Lava = 1001,\r\n    Poison = 1002\r\n}\r\n\r\n\r\nexport enum AtrType {\r\n    HP,\r\n    Atk,\r\n    AtkCD,\r\n    Def,\r\n}\r\n\r\nexport enum DirectionH {\r\n    Left,\r\n    Right,\r\n}","import * as PIXI from \"pixi.js\";\r\nimport * as particles from \"pixi-particles\";\r\nimport { SceneManager } from \"./_engine\";\r\nimport { IRootObject } from './world/LevelInterfaces';\r\nimport { SCENE_HEIGHT, SCENE_WIDTH } from './constants';\r\n\r\n\r\n\r\n/**\r\n * The global scene manager.\r\n */\r\nexport function getScm() {\r\n    if (!sceneManager) {\r\n        const canvas: HTMLCanvasElement = document.getElementById(\"stage\") as HTMLCanvasElement;\r\n        const renderOptions: PIXI.RendererOptions = {\r\n            view: canvas,\r\n            backgroundColor: 0,\r\n            antialias: false,\r\n            transparent: false,\r\n            roundPixels: true,\r\n            resolution: window.devicePixelRatio\r\n        };\r\n        sceneManager = new SceneManager(SCENE_WIDTH, SCENE_HEIGHT, renderOptions);\r\n    }\r\n    return sceneManager;\r\n}\r\nexport function deleteScm() {\r\n    if (sceneManager) {\r\n        sceneManager.Renderer.destroy();\r\n    }\r\n    (sceneManager as any) = undefined;\r\n}\r\nlet sceneManager: SceneManager;\r\n\r\n/**\r\n * Player position.\r\n */\r\nexport var position = new PIXI.Point();\r\n\r\nexport var worldContainer : PIXI.Container;\r\n\r\nexport function createParticleEmitter(container: PIXI.Container, textures: PIXI.Texture[], config?: any): particles.Emitter {\r\n    \"use strict\";\r\n    var cfg: any = {\r\n        alpha: {\r\n            start: 0.8,\r\n            end: 0.03\r\n        },\r\n        color: {\r\n            start: \"#dcff09\",\r\n            end: \"#9f1f1f\"\r\n        },\r\n        scale: {\r\n            start: 0.1,\r\n            end: 0.4,\r\n            minimumScaleMultiplier: 1\r\n        },\r\n        speed: {\r\n            start: 50,\r\n            end: 3,\r\n            minimumSpeedMultiplier: 1\r\n        },\r\n        acceleration: new PIXI.Point(),\r\n        startRotation: {\r\n            min: 0,\r\n            max: 360\r\n        },\r\n        rotationSpeed: {\r\n            min: 5,\r\n            max: 20\r\n        },\r\n        lifetime: {\r\n            min: 0.4,\r\n            max: 1.0\r\n        },\r\n        blendMode: \"add\",\r\n        frequency: 0.01,\r\n        emitterLifetime: -1,\r\n        maxParticles: 200,\r\n        pos: new PIXI.Point(0, -24),\r\n        addAtBack: false,\r\n        spawnType: \"circle\",\r\n        spawnCircle: {\r\n            x: 0,\r\n            y: 0,\r\n            r: 10\r\n        }\r\n    };\r\n    if (config) {\r\n        cfg = { ...cfg, ...config };\r\n    }\r\n\r\n    var emitter = new particles.Emitter(\r\n        // the PIXI.Container to put the emitter in\r\n        // if using blend modes, it's important to put this\r\n        // on top of a bitmap, and not use the root stage Container\r\n        container,\r\n        textures,\r\n        cfg\r\n    );\r\n    emitter.emit = false;\r\n    return emitter;\r\n}\r\n\r\nexport var LevelDefinitions: IRootObject = {\r\n        templates: undefined,\r\n        levels: undefined,\r\n        quests: undefined\r\n};","export {AnimatedSprite, AnimationSequence} from \"./AnimatedSprite\";\r\nexport {Button, OutlineMode} from \"./Button\";\r\nexport {Dictionary} from \"./Dictionary\";\r\nexport {KeyboardMapper} from \"./KeyboardMapper\";\r\nexport {LinkedList} from \"./LinkedList\";\r\nexport {Parallax} from \"./Parallax\";\r\nexport {Scene} from \"./Scene\";\r\nexport {SceneManager, DefaultResizer, ISize, ISceneResizer} from \"./SceneManager\";\r\nexport {Slider} from \"./Slider\";\r\nexport {TextureLoader} from \"./TextureLoader\";","export const SCENE_WIDTH: number = 1920;\r\nexport const SCENE_HEIGHT: number = 1080;\r\nexport const SCENE_HALF_WIDTH = SCENE_WIDTH / 2;\r\nexport const SCENE_HALF_HEIGHT = SCENE_HEIGHT / 2;\r\nexport const BTN_WIDTH: number = 120;\r\nexport const BTN_HEIGHT: number = 60;\r\nexport const MENU_LINE_HEIGHT = 60;\r\nexport const GUI_FONT = \"Orbitron\";\r\n\r\nexport const SCENE_BACKCOLOR = 0x112233;\r\n\r\n\r\nexport const ANIMATION_FPS_NORMAL = 14;\r\nexport const ANIMATION_FPS_SLOW = 4;\r\n\r\nexport const BTN_STYLE = {\r\n    align: \"center\",\r\n    padding: 0,\r\n    fontSize: 28,\r\n    fontFamily: GUI_FONT,\r\n    fill: 0x46fbfd,\r\n    strokeThickness: 1,\r\n    stroke: 0x0\r\n};\r\n\r\nexport const TEXT_STYLE: PIXI.TextStyleOptions = {\r\n    align: \"left\",\r\n    padding: 0,\r\n    fontSize: 21,\r\n    fontFamily: GUI_FONT,\r\n    fill: 0xE5E51B,\r\n    strokeThickness: 3,\r\n    stroke: 0x0f0f2f,\r\n};\r\n\r\nexport const MSG_COIN_STYLE: PIXI.TextStyleOptions =\r\n{\r\n    align: \"center\",\r\n    padding: 0,\r\n    fontSize: 22,\r\n    fontFamily: GUI_FONT,\r\n    fill: 0xaaaa00,\r\n    strokeThickness: 3,\r\n    stroke: 0x904b15\r\n};\r\n\r\nexport const MSG_HP_STYLE: PIXI.TextStyleOptions =\r\n{\r\n    align: \"center\",\r\n    padding: 0,\r\n    fontSize: 24,\r\n    fontFamily: GUI_FONT,\r\n    fill: 0x904b15,\r\n    strokeThickness: 3,\r\n    stroke: 0x111111\r\n};\r\n\r\nexport const MSG_EXP_STYLE: PIXI.TextStyleOptions =\r\n    {\r\n        align: \"center\",\r\n        padding: 0,\r\n        fontSize: 24,\r\n        fontFamily: GUI_FONT,\r\n        fill: 0x84c202,\r\n        strokeThickness: 3,\r\n        stroke: 0x112111\r\n    };\r\n\r\nexport const MSG_WARN_STYLE: PIXI.TextStyleOptions =\r\n{\r\n    align: \"center\",\r\n    padding: 0,\r\n    fontSize: 27,\r\n    fontFamily: GUI_FONT,\r\n    fill: 0xff0011,\r\n    strokeThickness: 4,\r\n    stroke: 0x222222\r\n};\r\n\r\nexport const EXP_BAR_STYLE: PIXI.TextStyleOptions =\r\n{\r\n    align: \"center\",\r\n    padding: 0,\r\n    fontSize: 13,\r\n    fontFamily: GUI_FONT,\r\n    fill: 0x111111,\r\n    strokeThickness: 4,\r\n    stroke: 0xffffff\r\n};\r\n\r\nexport const QUEST_ITEM_STYLE: PIXI.TextStyleOptions =\r\n    {\r\n        align: \"center\",\r\n        padding: 0,\r\n        fontSize: 28,\r\n        fontFamily: \"Farsan\",\r\n        fill: 0x84c2f2,\r\n        strokeThickness: 4,\r\n        stroke: 0x111121\r\n    };\r\n\r\n    export const QUEST_STYLE: PIXI.TextStyleOptions =\r\n    {\r\n        align: \"center\",\r\n        padding: 0,\r\n        fontSize: 30,\r\n        fontFamily: \"Farsan\",\r\n        fill: 0xffffff,\r\n        strokeThickness: 2,\r\n        stroke: 0x8a8343,\r\n        dropShadow: true,\r\n        dropShadowDistance: 6,\r\n        dropShadowBlur:3\r\n    };","import { LevelDefinitions } from '../global';\r\nimport { eventEmitter, DAMAGE_TOPIC, STATCHANGE_TOPIC, BURN_TOPIC, IStatChangeEvent, IDpsChangeEvent} from \"../events\";\r\nimport { LevelLoader } from '../world/LevelLoader';\r\nimport { ILevel } from '../world/LevelInterfaces';\r\nimport { BaseStatType, StatType, DamageType } from '../enums';\r\n\r\n\r\n\r\nclass PlayerStats {\r\n    /**\r\n     * Base stats are fixed values increased with level.\r\n     */\r\n    private baseStats: Array<number> = [];\r\n\r\n    /**\r\n     * Attribute stats are player assigned values (point distribution).\r\n     */\r\n    private attributeStats: Array<number> = [];\r\n    \r\n    private stats: Array<number> = [];\r\n\r\n    private accumulator: number = 0.0;\r\n    private dpsDecreaseAmount: number = 0;\r\n    private static expForLevel: Array<number> = [];\r\n\r\n    //  acquired skills\r\n    private hasJumpAttack: boolean = false;\r\n    private hasMagicAttack: boolean = false;\r\n\r\n    //  achievement levels\r\n    public characterLevel: number = 0;\r\n    public currentGameLevel: number = 0;\r\n    private expForNextLevel: number = 0;\r\n\r\n    //  user related\r\n    public id: number;\r\n\r\n    private isBurningBuff: boolean = false;\r\n\r\n    /**\r\n     *   Stores timestamps (Unix timestamps in seconds with fractions) when the buff elapses.\r\n     */\r\n    public buffs: Array<number> = [];\r\n\r\n    private levelLoader : LevelLoader;\r\n\r\n    constructor() {\r\n        this.id = 0;\r\n\r\n        //  attr  stats\r\n        this.attributeStats[BaseStatType.RegenHP] = 0;\r\n        this.attributeStats[BaseStatType.RegenDust] = 0;\r\n        this.attributeStats[BaseStatType.MaxHP] = 0;\r\n        this.attributeStats[BaseStatType.MaxDust] = 0;\r\n\r\n        // runtime stats\r\n        this.stats[StatType.Coins] = 0;\r\n        this.stats[StatType.Dust] = 600;\r\n        this.stats[StatType.TotalExp] = 0;\r\n        this.stats[StatType.AttributePoints] = 0;\r\n        this.stats[StatType.HP] = 120;\r\n\r\n        let diff = 1000;\r\n        PlayerStats.expForLevel[0] = 0;\r\n        for (var i = 1; i < 10000; i++) {\r\n            PlayerStats.expForLevel[i] = PlayerStats.expForLevel[i - 1] + (i * diff);\r\n        }\r\n\r\n        this.rebuildStats();\r\n    }\r\n\r\n    /**\r\n     * Rteurns the level loader.\r\n     */\r\n    public get LevelLoader(){\r\n        if(!this.levelLoader){\r\n            this.levelLoader = new LevelLoader(LevelDefinitions);\r\n        }\r\n        return this.levelLoader;\r\n    }\r\n\r\n    /**\r\n     *  Updates stats that increase/decrease over time.\r\n     *  The update is calculated in a half second interval.\r\n     */\r\n    public onUpdate = (dt: number) => {\r\n\r\n        let INTERVAL = 500;\r\n        let SECOND_2_INTERVAL = INTERVAL / 1000; //  this factor converts per second values to per interval values\r\n\r\n        var now = performance.now() / 1000;\r\n\r\n        //  accumulate dps\r\n        for (let i = 1000, len = this.buffs.length; i < len; i++) {\r\n            if (this.buffs[i] && this.buffs[i] > now) {\r\n                let dps = 0;\r\n                switch (i) {\r\n                    case DamageType.LavaBorder:  \r\n                        dps = 5;\r\n                        break;\r\n                    case DamageType.Lava:  \r\n                        dps = 15;\r\n                        break;\r\n                    case DamageType.Poison:  \r\n                        dps = 10;\r\n                        break;\r\n                }\r\n                let dmg = dt * 0.001 * dps;\r\n                this.dpsDecreaseAmount += dmg;\r\n            }\r\n        }\r\n\r\n        //  handle once per interval ticks\r\n        this.accumulator += dt;\r\n        if (this.accumulator > INTERVAL) {\r\n            this.accumulator -= INTERVAL;\r\n\r\n            //  dust\r\n            if (this.stats[StatType.Dust] < this.stats[StatType.MaxDust]) {\r\n                let v = this.stats[StatType.RegenDust] * SECOND_2_INTERVAL;\r\n                this.increaseStat(StatType.Dust, v);\r\n            }\r\n\r\n            //  hp\r\n            if (this.stats[StatType.HP] < this.stats[StatType.MaxHP]) {\r\n                let v = this.stats[StatType.RegenHP] * SECOND_2_INTERVAL;\r\n                this.increaseStat(StatType.HP, v);\r\n            }\r\n\r\n            //  dps\r\n            if (this.dpsDecreaseAmount >= 1) {\r\n                var amount = Math.floor(this.dpsDecreaseAmount);\r\n                let event: IDpsChangeEvent = {\r\n                    OldValue: this.stats[StatType.HP],\r\n                    Amount: -amount\r\n                };                \r\n                eventEmitter.emit(DAMAGE_TOPIC, event);\r\n                this.increaseStat(StatType.HP, -amount);\r\n                this.dpsDecreaseAmount -= amount;\r\n            }\r\n        }\r\n\r\n        //--------------------------\r\n        //  check if is burning\r\n        //--------------------------\r\n        let wasBurning = this.isBurningBuff;\r\n        this.isBurningBuff = this.buffs[DamageType.LavaBorder] > now || this.buffs[DamageType.Lava] > now;\r\n        if (wasBurning !== this.isBurning) {            \r\n            eventEmitter.emit(BURN_TOPIC, { wasBurning: wasBurning, isBurning: this.isBurningBuff });\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Returns true if the player is taking burn damage.\r\n     */\r\n    public get isBurning() {\r\n        return this.isBurningBuff;\r\n    }\r\n\r\n    /**\r\n     * The parsed current level.\r\n     */\r\n    public currentLevel : ILevel;\r\n\r\n    public loadLevel(){\r\n        this.loadUserState();\r\n        this.currentLevel =  this.LevelLoader.buildLevel(this.currentGameLevel);\r\n    }\r\n\r\n    /**\r\n     * Saves user data.\r\n     */\r\n    public saveUserState(isLevelCompleted: boolean) {\r\n        if (isLevelCompleted) {\r\n            this.currentGameLevel += 1;\r\n        }\r\n        let model = {\r\n            ExternalId: this.id,\r\n            Coins: this.stats[StatType.Coins],\r\n            Gold: this.stats[StatType.Gold],\r\n            Dust: Math.floor(this.stats[StatType.Dust]),\r\n            Exp: this.stats[StatType.TotalExp],\r\n            AtrPts: this.stats[StatType.AttributePoints],\r\n            HP: this.stats[StatType.HP],\r\n            LastLevel: this.currentGameLevel,\r\n            // TODO: add sending skills etc.\r\n        };\r\n        // AjaxHelper.Post(baseUrl + \"/api/user/save\", model, (data, status) => {\r\n        //     console.log(\"connectUser() response\", data);\r\n        // });\r\n        //TODO: implement\r\n    }\r\n\r\n    /**\r\n     * Loads user data.\r\n     */\r\n    public loadUserState() {\r\n        let model = { id: this.id };\r\n        var data = {\r\n            HP: this.getStat(StatType.MaxHP),\r\n            Exp : this.getStat(StatType.TotalExp),\r\n            Coins: this.getStat(StatType.Coins),\r\n            Dust: this.getStat(StatType.MaxDust),\r\n            Gold: 0,\r\n            AtrPts: 0,\r\n            LastLevel: this.currentGameLevel\r\n        };\r\n        //  todo: http get\r\n        console.log(\"loadUserState() response\", data);\r\n\r\n            stats.currentGameLevel = data.LastLevel;\r\n\r\n            //  we never accept 0 hp, convert to full health instead\r\n            if (data.HP <= 0) {\r\n                data.HP = this.stats[StatType.MaxHP];\r\n            }\r\n            this.setStat(StatType.HP, data.HP);\r\n            this.setStat(StatType.Coins, data.Coins);\r\n            this.setStat(StatType.Gold, data.Gold);\r\n            this.setStat(StatType.Dust, data.Dust);\r\n            this.setStat(StatType.AttributePoints, data.AtrPts);\r\n            this.setStat(StatType.TotalExp, data.Exp);\r\n            //  TODO: attributeStats\r\n            this.rebuildStats();\r\n    }\r\n\r\n    public get HasJumpAtack() {\r\n        return this.hasJumpAttack;\r\n    }\r\n    public set HasJumpAtack(value: boolean) {\r\n        this.hasJumpAttack = value;\r\n    }\r\n\r\n    public setStat(type: StatType, value: number) {\r\n        this.stats[type] = value;\r\n        if (type === StatType.TotalExp) {\r\n            this.characterLevel = PlayerStats.findExpLevel(value);\r\n            this.stats[StatType.LevelMaxExp] = PlayerStats.expForLevel[this.characterLevel + 1] - PlayerStats.expForLevel[this.characterLevel];\r\n            this.stats[StatType.LevelExp] = this.stats[StatType.TotalExp] - PlayerStats.expForLevel[this.characterLevel];\r\n            this.expForNextLevel = PlayerStats.expForLevel[this.characterLevel + 1];\r\n        }\r\n        this.updateEvent(type, value);\r\n        eventEmitter.emit(STATCHANGE_TOPIC, this.scevent);\r\n    }\r\n\r\n    public getStat(type: StatType): number {\r\n        return this.stats[type];\r\n    }\r\n\r\n    public increaseStat(type: StatType, value: number, maxValue?: number) {\r\n\r\n        var newValue = this.stats[type] + value;\r\n        if (maxValue && newValue > maxValue) {\r\n            newValue = maxValue;\r\n        }\r\n        if (newValue < 0) {\r\n            newValue = 0;\r\n        }\r\n\r\n        this.updateEvent(type, newValue);\r\n        this.stats[type] = newValue;\r\n\r\n        //  special logic for experience\r\n        if (type === StatType.TotalExp) {\r\n            this.stats[StatType.LevelExp] = newValue - PlayerStats.expForLevel[this.characterLevel];\r\n\r\n            //  level up check\r\n            if (newValue >= this.expForNextLevel) {\r\n                this.characterLevel = PlayerStats.findExpLevel(newValue);\r\n                this.expForNextLevel = PlayerStats.expForLevel[this.characterLevel + 1];\r\n\r\n                this.stats[StatType.LevelMaxExp] = this.expForNextLevel - PlayerStats.expForLevel[this.characterLevel];\r\n                this.stats[StatType.LevelExp] = newValue - PlayerStats.expForLevel[this.characterLevel];\r\n\r\n                //  lvl up event\r\n                this.scevent.Type = StatType.CharacterLevel;\r\n                this.scevent.OldValue = this.characterLevel - 1;\r\n                this.scevent.NewValue = this.characterLevel;\r\n                this.scevent.Stats = this.stats;\r\n                eventEmitter.emit(STATCHANGE_TOPIC, this.scevent);\r\n\r\n                //  attr change event\r\n                newValue = this.stats[StatType.AttributePoints] + 5;\r\n                this.scevent.Type = StatType.AttributePoints;\r\n                this.scevent.OldValue = this.getStat(StatType.AttributePoints);\r\n                this.scevent.NewValue = newValue;\r\n                this.setStat(StatType.AttributePoints, newValue);\r\n                this.scevent.Stats = this.stats;\r\n                eventEmitter.emit(STATCHANGE_TOPIC, this.scevent);\r\n\r\n                // refill HP & dust\r\n                this.setStat(StatType.Dust, this.stats[StatType.MaxDust]);\r\n                this.setStat(StatType.HP, this.stats[StatType.MaxHP]);\r\n\r\n                //  prepare regular stat change event (for exp)\r\n                this.scevent.Type = type;\r\n                this.scevent.OldValue = 0;\r\n                this.scevent.NewValue = this.stats[StatType.LevelExp];\r\n                this.scevent.Stats = this.stats;\r\n                //this.saveUserState(false);\r\n            }\r\n        }\r\n\r\n        eventEmitter.emit(STATCHANGE_TOPIC, this.scevent);\r\n    }\r\n\r\n    /**\r\n     * Finds the exp level for the given total exp value.\r\n     * @param exp\r\n     */\r\n    public static findExpLevel(exp: number) {\r\n        for (var i = 0, len = PlayerStats.expForLevel.length; i < len; i++) {\r\n            if (exp < PlayerStats.expForLevel[i]) {\r\n                return i - 1;\r\n            }\r\n        }\r\n    }\r\n\r\n    private rebuildStats() {\r\n        //  calc max & regen stats\r\n        this.baseStats[BaseStatType.MaxHP] = 150 + (this.characterLevel * 10);\r\n        this.baseStats[BaseStatType.MaxDust] = 600 + (this.characterLevel * 50);\r\n        this.baseStats[BaseStatType.RegenDust] = 2 + (this.characterLevel / 2);\r\n        this.baseStats[BaseStatType.RegenHP] = 1 + (this.characterLevel / 2);\r\n\r\n        //  each max attribute increases base stat by 10%\r\n        this.stats[StatType.MaxHP] = this.baseStats[BaseStatType.MaxHP] * (1 + this.attributeStats[BaseStatType.MaxHP]/10);\r\n        this.stats[StatType.MaxDust] = this.baseStats[BaseStatType.MaxDust] * (1 + this.attributeStats[BaseStatType.MaxDust] / 10);\r\n\r\n        //  each regen attribute increases base stat by 10%\r\n        this.stats[StatType.RegenHP] = this.baseStats[BaseStatType.RegenHP] * (1 + this.attributeStats[BaseStatType.RegenHP] / 10);\r\n        this.stats[StatType.RegenDust] = this.baseStats[BaseStatType.RegenDust] * (1 + this.attributeStats[BaseStatType.RegenDust] / 10);\r\n    }\r\n\r\n    private scevent: IStatChangeEvent = {\r\n        Type: StatType.Coins,\r\n        OldValue: 0,\r\n        NewValue: 0,\r\n        Stats: []\r\n    };\r\n\r\n    private updateEvent(type: StatType, newValue: number) {\r\n        this.scevent.Type = type;\r\n        this.scevent.OldValue = this.stats[type];\r\n        this.scevent.NewValue = newValue;\r\n        this.scevent.Stats = this.stats;\r\n    }\r\n}\r\n\r\nexport var stats = new PlayerStats();","import * as p2 from \"p2\";\r\nimport { Global } from '..';\r\nimport {Dictionary} from '../_engine/Dictionary';\r\nimport { COL_GRP_GROUND, COL_GRP_SCENE, COL_GRP_NPC, COL_GRP_PLAYER, COL_GRP_BULLET } from './CollisionGroups';\r\n\r\n/**\r\n * Tuple of two physics bodies touching or penetrating each other.\r\n */\r\nexport class ContactPair {\r\n    constructor(public BodyA: p2.Body, public BodyB: p2.Body) { }\r\n}\r\n\r\n\r\n/**\r\n * Takes care of the physics simulations.\r\n */\r\nexport class WorldP2 {\r\n\r\n    public playerBody: p2.Body;\r\n    private world: p2.World;\r\n    private ground: p2.Body;\r\n    private materials: Dictionary<p2.Material>;\r\n    private contactPairs: Array<ContactPair> = [];\r\n    private contactWatch: Array<number> = [];\r\n\r\n    /**\r\n     * We hold all player contacts separate (due to heavy usage).\r\n     */\r\n    private playerBodyContacts: Array<p2.Body> = [];\r\n\r\n    private readonly fixedTimeStep = 1 / 60; // seconds\r\n\r\n\r\n    constructor() {\r\n        this.world = new p2.World({\r\n            gravity: [0, -1500],\r\n        });\r\n\r\n        this.setupMaterials();\r\n\r\n        //------------------------------------------\r\n        // create an infinite ground plane body\r\n        //------------------------------------------\r\n        this.ground = new p2.Body({\r\n            mass: 0,\r\n        });\r\n        var shape = new p2.Plane();\r\n        shape.material = this.materials.get(\"ground_default\");\r\n        shape.collisionGroup = COL_GRP_GROUND;\r\n        shape.collisionMask = COL_GRP_SCENE | COL_GRP_NPC | COL_GRP_PLAYER | COL_GRP_BULLET;\r\n        this.ground.addShape(shape);\r\n        this.world.addBody(this.ground);\r\n\r\n        //------------------------------------------\r\n        //  player body\r\n        //------------------------------------------\r\n        this.playerBody = new p2.Body({\r\n            mass: 42,\r\n            fixedRotation: true,            \r\n        });\r\n        this.playerBody.damping = 0.001;\r\n        shape = new p2.Circle({\r\n            radius: 24,\r\n        });\r\n        shape.collisionGroup = COL_GRP_PLAYER;\r\n        shape.collisionMask = COL_GRP_GROUND | COL_GRP_SCENE | COL_GRP_NPC | COL_GRP_BULLET;\r\n        shape.material = this.materials.get(\"player\");\r\n        this.playerBody.addShape(shape);\r\n        this.world.addBody(this.playerBody);\r\n\r\n        //------------------------------------------\r\n        //  settings\r\n        //------------------------------------------\r\n        this.world.sleepMode = p2.World.BODY_SLEEPING;\r\n        this.world.on(\"beginContact\", this.beginContact, this);\r\n        this.world.on(\"endContact\", this.endContact, this);\r\n    }\r\n\r\n    /**\r\n     * Removes all bodies except the player body and ground plane.\r\n     */\r\n    public clearLevel() {\r\n        var bodies = this.world.bodies;\r\n        for (var i = bodies.length-1; i >=0; i--) {\r\n            let b = bodies[i];\r\n            if (b !== this.playerBody && b !== this.ground) {\r\n                this.world.removeBody(b);\r\n            }\r\n        }       \r\n    }\r\n\r\n    /**\r\n     * Returns the world bodies.\r\n     */\r\n    public get bodies(): Array<p2.Body> {\r\n        return this.world.bodies;\r\n    }\r\n\r\n    /**\r\n     * Adds an event handler to the p2 world object.\r\n     * @param eventName\r\n     * @param handler\r\n     */\r\n    public on(eventName: string, handler: any, context?: any): void {\r\n        context = context || this;\r\n        this.world.on(eventName, handler, context);\r\n    }\r\n\r\n    /**\r\n     * advances the physics simulation for the given dt time\r\n     * @param dt the time in seconds since the last simulation step\r\n     */\r\n    public update(dt: number): void {\r\n        this.world.step(this.fixedTimeStep, dt/1000);\r\n        Global.position.x = this.playerBody.interpolatedPosition[0];\r\n        Global.position.y = this.playerBody.interpolatedPosition[1];\r\n    }\r\n\r\n    /**\r\n     * Removes the body from world.\r\n     * @param body\r\n     */\r\n    public removeBody(body: p2.Body): void {\r\n        this.world.removeBody(body);\r\n    }\r\n\r\n    /**\r\n     * adds an object to the p2 world\r\n     * @param body\r\n     */\r\n    public addBody(body: p2.Body): void {\r\n        // HACK: loader specific implementation stores the material name in shape.materialName\r\n        if (body.shapes && body.shapes.length > 0) {\r\n            for (var i = 0, len = body.shapes.length; i < len; i++) {\r\n                let shape: any = body.shapes[i];\r\n                if (shape.materialName && !shape.material) {\r\n                    shape.material = this.materials.get(shape.materialName);\r\n                }\r\n            }            \r\n        }\r\n        this.world.addBody(body);\r\n    }\r\n\r\n    /**\r\n     * Clears all saved contacts (from contactPairs) for the given body.\r\n     * @param body\r\n     */\r\n    public clearContactsForBody(body: p2.Body):void {\r\n        if (body === this.playerBody) {\r\n            this.playerBodyContacts = [];\r\n            return;\r\n        }\r\n\r\n        var foundIdx: number = 0;\r\n        while (foundIdx > -1) {\r\n            foundIdx = -1;\r\n            for (var i = 0; i < this.contactPairs.length; i++) {\r\n                let cp:ContactPair = this.contactPairs[i];\r\n                if (cp.BodyA === body || cp.BodyB === body)  {\r\n                    foundIdx = i;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (foundIdx >= 0) {\r\n                this.contactPairs.splice(foundIdx, 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * returns all contact pairs for the given body.\r\n     * Note: the body must be in the contact watch list or an empty array will be returned.\r\n     * @param body\r\n     */\r\n    public getContactsForBody(body: p2.Body): Array<ContactPair> {\r\n        var foundPairs: Array<ContactPair> = [];\r\n        for (var i = 0, len = this.contactPairs.length; i < len; i++) {\r\n            let cp: ContactPair = this.contactPairs[i];        \r\n            if (cp.BodyA === body || cp.BodyB === body) {\r\n                foundPairs.push(cp);\r\n            }\r\n        };\r\n        return foundPairs;\r\n    }\r\n\r\n    /**\r\n     * Adds the body to the contact watch list.\r\n     * Only bodies in this list can be retrieved via the getContactsForBody() function.\r\n     * @param body\r\n     */\r\n    public addContactWatch(body: p2.Body): void {\r\n        this.contactWatch.push(body.id);\r\n    }\r\n\r\n    /**\r\n     * Returns all bodies the player has contact with.\r\n     */\r\n    public get playerContacts(): p2.Body[]{\r\n        return this.playerBodyContacts;\r\n    }\r\n\r\n    private beginContact = (evt: any) => {\r\n        \r\n        let bullet: p2.Body = null;\r\n        let other: p2.Body = null;\r\n        if (evt.bodyA.shapes[0].collisionGroup === COL_GRP_BULLET) {\r\n            bullet = evt.bodyA;\r\n            other = evt.bodyB;\r\n        } else if (evt.bodyB.shapes[0].collisionGroup === COL_GRP_BULLET){\r\n            bullet = evt.bodyB;\r\n            other = evt.bodyA;\r\n        }\r\n        if (bullet) {\r\n           // console.log(\"emitting bulettContact, body.id: \" + bullet.id);\r\n            this.world.emit({ type: \"bulletContact\", playerHit: other === this.playerBody, bulletBody: bullet, otherBody: other });\r\n            return;\r\n        }\r\n\r\n        //  check for player contacts (but only with dynamic bodies)\r\n        if (this.playerBody === evt.bodyA) {\r\n            this.playerBodyContacts.push(evt.bodyB);\r\n            this.world.emit({ type: \"playerContact\", velocity: this.playerBody.velocity, body: evt.bodyB });\r\n            return;\r\n        } else if (this.playerBody === evt.bodyB) {\r\n            this.playerBodyContacts.push(evt.bodyA);\r\n            this.world.emit({ type: \"playerContact\", velocity: this.playerBody.velocity, body: evt.bodyA });\r\n            return;\r\n        }\r\n\r\n        //  check for watched bodies and store pairs if match\r\n        var watchedItemFound = this.contactWatch.filter((bodyId) => {\r\n            return (bodyId === evt.bodyA.id || bodyId === evt.bodyB.id);\r\n        });\r\n        if (watchedItemFound && watchedItemFound.length > 0) {\r\n            let cp: ContactPair = new ContactPair(evt.bodyA, evt.bodyB);\r\n            this.contactPairs.push(cp);\r\n        }\r\n        \r\n    };\r\n\r\n    private endContact = (evt: any) => {\r\n        //  no need to update player contacts or contact pairs for bullets\r\n        let isBulletConntact = evt.bodyA.shapes[0].collisionGroup === COL_GRP_BULLET || evt.bodyB.shapes[0].collisionGroup === COL_GRP_BULLET;\r\n        if (isBulletConntact) return;\r\n\r\n        //  if it is a player contact remove the foreign body from the playerBodyContacts list\r\n        if (this.playerBody === evt.bodyA ) {\r\n            var bodyIDX = this.playerBodyContacts.indexOf(evt.bodyB);\r\n            this.playerBodyContacts.splice(bodyIDX, 1);\r\n            this.world.emit({ type: \"playerContactEnd\", velocity: this.playerBody.velocity, body: evt.bodyB });\r\n            //console.log(\"endContact\",evt.bodyB);\r\n            return;\r\n        } else if (this.playerBody === evt.bodyB) {\r\n            var bodyIDX = this.playerBodyContacts.indexOf(evt.bodyB);\r\n            this.playerBodyContacts.splice(bodyIDX, 1);\r\n            this.world.emit({ type: \"playerContactEnd\", velocity: this.playerBody.velocity, body: evt.bodyA });\r\n            //console.log(\"endContact\", evt.bodyA);\r\n            return;\r\n        }\r\n\r\n\r\n        //console.log(\"endContact: \", evt);\r\n        var foundIdx: number = -1;\r\n        for (var i = 0; i < this.contactPairs.length; i++) {\r\n            let cp: ContactPair = this.contactPairs[i];\r\n            if (\r\n                (cp.BodyA === evt.bodyA && cp.BodyB === evt.bodyB) ||\r\n                (cp.BodyA === evt.bodyB && cp.BodyB === evt.bodyA)) {\r\n                foundIdx = i;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (foundIdx >= 0) {\r\n            this.contactPairs.splice(foundIdx, 1);\r\n        }\r\n    };\r\n\r\n    private setupMaterials(): void {\r\n        this.materials = new Dictionary<p2.Material>();\r\n        this.materials.set(\"player\", new p2.Material(p2.Material.idCounter++));\r\n        this.materials.set(\"ground_default\", new p2.Material(p2.Material.idCounter++));\r\n        this.materials.set(\"box_default\", new p2.Material(p2.Material.idCounter++));\r\n        this.materials.set(\"box_highfriction\", new p2.Material(p2.Material.idCounter++));\r\n        this.materials.set(\"mob_default\", new p2.Material(p2.Material.idCounter++));\r\n        this.materials.set(\"bumper\", new p2.Material(p2.Material.idCounter++));\r\n\r\n\r\n        var playerGroundContactMaterial = new p2.ContactMaterial(\r\n            this.materials.get(\"player\"),\r\n            this.materials.get(\"ground_default\"),\r\n            {\r\n                friction: 0.85,\r\n                restitution: 0.1,\r\n                stiffness: p2.Equation.DEFAULT_STIFFNESS,\r\n                relaxation: p2.Equation.DEFAULT_RELAXATION,\r\n                frictionStiffness: p2.Equation.DEFAULT_STIFFNESS,\r\n                frictionRelaxation: p2.Equation.DEFAULT_RELAXATION,\r\n                surfaceVelocity:0\r\n            });\r\n        this.world.addContactMaterial(playerGroundContactMaterial);\r\n\r\n        var playerMobContactMaterial = new p2.ContactMaterial(\r\n            this.materials.get(\"player\"),\r\n            this.materials.get(\"mob_default\"),\r\n            {\r\n                friction: 0.1,\r\n                restitution: 0.4,\r\n                stiffness: p2.Equation.DEFAULT_STIFFNESS,\r\n                relaxation: p2.Equation.DEFAULT_RELAXATION,\r\n                frictionStiffness: p2.Equation.DEFAULT_STIFFNESS,\r\n                frictionRelaxation: p2.Equation.DEFAULT_RELAXATION,\r\n                surfaceVelocity: 0\r\n            });\r\n        this.world.addContactMaterial(playerMobContactMaterial);\r\n\r\n\r\n        var playerBoxContactMaterial = new p2.ContactMaterial(\r\n            this.materials.get(\"player\"),\r\n            this.materials.get(\"box_default\"),\r\n            {\r\n                friction: 0.20,\r\n                restitution: 0.25,\r\n                stiffness: p2.Equation.DEFAULT_STIFFNESS,\r\n                relaxation: p2.Equation.DEFAULT_RELAXATION,\r\n                frictionStiffness: p2.Equation.DEFAULT_STIFFNESS,\r\n                frictionRelaxation: p2.Equation.DEFAULT_RELAXATION,\r\n                surfaceVelocity: 0\r\n            });\r\n        this.world.addContactMaterial(playerBoxContactMaterial);\r\n\r\n        var playerBoxHighFirctContactMaterial = new p2.ContactMaterial(\r\n            this.materials.get(\"player\"),\r\n            this.materials.get(\"box_highfriction\"),\r\n            {\r\n                friction: 0.70,\r\n                restitution: 0.20,\r\n                stiffness: p2.Equation.DEFAULT_STIFFNESS,\r\n                relaxation: p2.Equation.DEFAULT_RELAXATION,\r\n                frictionStiffness: p2.Equation.DEFAULT_STIFFNESS,\r\n                frictionRelaxation: p2.Equation.DEFAULT_RELAXATION,\r\n                surfaceVelocity: 0\r\n            });\r\n        this.world.addContactMaterial(playerBoxHighFirctContactMaterial);\r\n\r\n        var playerBumperContactMaterial = new p2.ContactMaterial(\r\n            this.materials.get(\"player\"),\r\n            this.materials.get(\"bumper\"),\r\n            {\r\n                friction: 0.35,\r\n                restitution: 0.75,\r\n                stiffness: Number.MAX_VALUE,\r\n                relaxation: p2.Equation.DEFAULT_RELAXATION,\r\n                frictionStiffness: Number.MAX_VALUE,\r\n                frictionRelaxation: p2.Equation.DEFAULT_RELAXATION,\r\n                surfaceVelocity: 0\r\n            });\r\n        this.world.addContactMaterial(playerBumperContactMaterial);\r\n\r\n        var boxGroundContactMaterial = new p2.ContactMaterial(\r\n            this.materials.get(\"box_default\"),\r\n            this.materials.get(\"ground_default\"),\r\n            {\r\n                friction: 0.8,\r\n                restitution: 0.3,\r\n                stiffness: p2.Equation.DEFAULT_STIFFNESS,\r\n                relaxation: p2.Equation.DEFAULT_RELAXATION,\r\n                frictionStiffness: p2.Equation.DEFAULT_STIFFNESS,\r\n                frictionRelaxation: p2.Equation.DEFAULT_RELAXATION,\r\n                surfaceVelocity: 0\r\n            });\r\n        this.world.addContactMaterial(boxGroundContactMaterial);\r\n    }\r\n}\r\n\r\nexport var wp2 = new WorldP2();","import { State } from \"./SceneManager\";\r\n\r\n/**\r\n*   Simple keyboard mapper.\r\n*/\r\nexport class KeyboardMapper {\r\n\r\n    /**\r\n     *   Stores keyboard pressed state.\r\n     */\r\n    private keyboard: boolean[];\r\n\r\n    /**\r\n     *   Stores an array of KeyboardAction instances per Global.State. The 'state' indexer is a numeric value from the Global.State enum.\r\n     */\r\n    private stateActions: { [state: number]: KeyboardAction[]; };\r\n\r\n    private ALT_KEY: number = 18;\r\n    private SHIFT_KEY: number = 16;\r\n    private CTRL_KEY: number = 17;\r\n\r\n\r\n    /**\r\n     *   Creates a new KeyboardMapper instance.\r\n     */\r\n    constructor() {\r\n        this.stateActions = {};\r\n        this.keyboard = [];\r\n        for (var i: number = 0; i < 256; i++) { this.keyboard[i] = false; }\r\n\r\n        document.addEventListener('keydown', this.keydown.bind(this), false);\r\n        document.addEventListener('keyup', this.keyup.bind(this), false);\r\n    }\r\n\r\n    /*\r\n     *   Invokes needed action handlers based on the pressed keys.\r\n     */\r\n    public update(currentState: State) {\r\n\r\n        //  state specific handler\r\n        var actions: KeyboardAction[] = this.stateActions[currentState];\r\n        this.findHandlerAndInvoke(actions);\r\n\r\n\r\n        //  global handlers\r\n        actions = this.stateActions[State.GLOBAL];\r\n        this.findHandlerAndInvoke(actions);\r\n    }\r\n\r\n    /**\r\n     *   Searches for all keyboard handlers with matching current pressed key combinations and invokes them.\r\n     */\r\n    private findHandlerAndInvoke(actions: KeyboardAction[]) {\r\n        if (actions) {\r\n            var len = actions.length;\r\n            for (var i: number = 0; i < len; i++) {\r\n                var ka = actions[i];\r\n                if (ka && ka.isAssigned() && ka.handler\r\n                    && this.keyboard[ka.key]\r\n                    && this.keyboard[this.ALT_KEY] == ka.altKey\r\n                    && this.keyboard[this.SHIFT_KEY] == ka.shiftKey\r\n                    && this.keyboard[this.CTRL_KEY] == ka.ctrlKey) {\r\n                    ka.handler();\r\n                    if (ka.releaseKeyAfterInvoke) this.keyboard[ka.key] = false;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private keydown(e) {\r\n        this.keyboard[e.which] = true;\r\n    }\r\n\r\n    private keyup(e) {\r\n        this.keyboard[e.which] = false;\r\n    }\r\n\r\n    public addKeyboardActionHandler = (action: KeyboardAction, state: State) => {\r\n        if (!this.stateActions[state]) this.stateActions[state] = [];\r\n        this.stateActions[state].push(action);\r\n    }\r\n\r\n    public isKeyDown(keyCode: number) {\r\n        return this.keyboard[keyCode];\r\n    }\r\n}\r\n\r\n\r\nexport class KeyboardAction {\r\n\r\n    /**\r\n    *   Returns true if the handler is assigned.\r\n    */\r\n    public isAssigned(): boolean {\r\n        return this.handler !== undefined;\r\n    }\r\n\r\n    /**\r\n    *   Creates a new KeyboardAction instance.\r\n    */\r\n    constructor(\r\n        public key: number,\r\n        public name: string,\r\n        public handler: KeyboardActionCallback | undefined = undefined,\r\n        public releaseKeyAfterInvoke: boolean = true,\r\n        public shiftKey: boolean = false,\r\n        public ctrlKey: boolean = false,\r\n        public altKey: boolean = false) {\r\n    }\r\n}\r\n\r\nexport interface KeyboardActionCallback {\r\n    (): void;\r\n}\r\n","export class LinkedList<T>{\r\n\r\n    private first: LinkedListNode<T> | null = null;\r\n    private last: LinkedListNode<T> | null= null;\r\n    private length: number = 0;\r\n\r\n    public get First(): LinkedListNode<T> | null {\r\n        return this.first;\r\n    }\r\n    public set First(node: LinkedListNode<T>| null) {\r\n        this.first = node;\r\n    }\r\n\r\n    public get Last(): LinkedListNode<T>| null {\r\n        return this.last;\r\n    }\r\n    public set Last(node: LinkedListNode<T>| null) {\r\n        this.last = node;\r\n    }\r\n\r\n    public get Length(): number {\r\n        return this.length;\r\n    }\r\n\r\n    public AddNode = (data: T): LinkedListNode<T> => {\r\n        var newLastNode = new LinkedListNode<T>();\r\n        newLastNode.data = data;\r\n        newLastNode.previous = newLastNode.next = null;\r\n        newLastNode.list = this;\r\n        if (!this.first) {\r\n            this.first = newLastNode;\r\n            this.last = newLastNode;\r\n        } else {\r\n            newLastNode.previous = this.last;\r\n            this.last!.next = newLastNode;\r\n            this.last = newLastNode;\r\n        }\r\n        this.length++;\r\n        return newLastNode;\r\n    }\r\n\r\n    public InsertNode = (data: T): LinkedListNode<T> => {\r\n        var newFirstNode = new LinkedListNode<T>();\r\n        newFirstNode.data = data;\r\n        newFirstNode.previous = newFirstNode.next = null;\r\n        newFirstNode.list = this;\r\n        if (!this.first) {\r\n            this.first = newFirstNode;\r\n            this.last = newFirstNode;\r\n        } else {\r\n            newFirstNode.next = this.first;\r\n            this.first.previous = newFirstNode;\r\n            this.first = newFirstNode;\r\n        }\r\n        this.length++;\r\n        return newFirstNode;\r\n    }\r\n\r\n    public RemoveNode(node: LinkedListNode<T>) {\r\n        if (node.previous) node.previous.next = node.next;\r\n        if (node.next) node.next.previous = node.previous;\r\n        this.length--;\r\n    }\r\n\r\n    public RollLeft() {\r\n        var last = this.first;\r\n        var second = this.first!.next;\r\n        last!.next = null;\r\n        last!.previous = this.last;\r\n        this.last!.next = last;\r\n        this.last = last;\r\n\r\n        this.first = second;\r\n        this.first!.previous = null;\r\n    }\r\n\r\n    public forEach(callback: (node: LinkedListNode<T>) => void) {\r\n        var node = this.first;\r\n        while (node) {\r\n            callback(node);\r\n            node = node.next;\r\n        }\r\n    }\r\n}\r\n\r\nexport class LinkedListNode<T>{\r\n    public previous : LinkedListNode<T>|null = null;\r\n    public next : LinkedListNode<T>| null = null;\r\n    public data!: T;\r\n    public list!: LinkedList<T>;\r\n\r\n    public InsertBefore(data: T) {\r\n        var node = this.list.AddNode(data);\r\n        var previous = this.previous;\r\n        node.next = this;\r\n        node.previous = previous;\r\n        this.previous = node;\r\n        if (previous) {\r\n            previous.next = node;\r\n        }  \r\n        node.list = this.list;   \r\n        this.list.First = this.FindFirst();   \r\n    }\r\n\r\n    public InsertAfter(data: T) {\r\n        var node = this.list.AddNode(data);\r\n        var next = this.next;\r\n        node.previous = this;\r\n        node.next = next;\r\n        this.next = node;\r\n        if (next) {\r\n            next.previous = node;\r\n        }\r\n        node.list = this.list;\r\n        this.list.Last = this.FindLast();\r\n    }\r\n\r\n    public FindFirst(): LinkedListNode<T> {\r\n        var node: LinkedListNode<T> = this;\r\n        while (node.previous) { node = node.previous; }\r\n        return node;\r\n    }\r\n\r\n    public FindLast(): LinkedListNode<T> {\r\n        var node: LinkedListNode<T> = this;\r\n        while (node.next) { node = node.next; }\r\n        return node;\r\n    }\r\n}","import * as PIXI from 'pixi.js';\r\nimport { TextureLoader } from '.';\r\n\r\n/**\r\n *   Represents a parallax background with textures that tile inside the viewport. \r\n */\r\nexport class Parallax extends PIXI.Container {\r\n\r\n    private viewPortSize!: PIXI.Point;\r\n    private worldPosition: number = 0;\r\n    private parallaxFactor: number;\r\n\r\n    private spriteBuffer: Array<PIXI.Sprite> = [];\r\n    private spriteOrderList: Array<number> = [];\r\n\r\n    /**\r\n     * total width of all textures \r\n     */\r\n    private totalWidth: number = 0;\r\n\r\n    /**\r\n     *   Creates a new ParalaxSprite instance.\r\n     */\r\n    constructor(size: PIXI.Point, parallaxFactor: number, textures: Array<string | PIXI.Texture>, private textureScale?: number) {\r\n        super();\r\n        this.ViewPortSize = size || new PIXI.Point(100, 100);\r\n        this.parallaxFactor = parallaxFactor || 1;\r\n        this.textureScale = this.textureScale || 1;\r\n        this.setTextures(textures);\r\n        this.worldPosition = 0;\r\n        this.SetViewPortX(1);\r\n    }\r\n\r\n    public get WorldPosition(){\r\n        return this.worldPosition;\r\n    }\r\n\r\n    public SetViewPortX(newPositionX: number): void {\r\n        if (this.worldPosition !== newPositionX) {\r\n            this.recalculatePosition(newPositionX);\r\n        }\r\n    }\r\n\r\n    public get ViewPortSize(): PIXI.Point {\r\n        return this.viewPortSize;\r\n    }\r\n    public set ViewPortSize(point: PIXI.Point) {\r\n        this.viewPortSize = point;\r\n    }\r\n    public get ParallaxFactor(): number {\r\n        return this.parallaxFactor;\r\n    }\r\n    public set ParallaxFactor(factor: number) {\r\n        this.parallaxFactor = factor;\r\n    }\r\n\r\n    public setTextures(textures: Array<string | PIXI.Texture>): void {\r\n        var index = 0;\r\n        var textureIndex : number;\r\n\r\n        //  get the first texture to fetch the width\r\n        var t: PIXI.Texture = this.getTexture(textures, 0);\r\n        var width = t.width * this.textureScale;\r\n\r\n        while (this.spriteBuffer.length < 3  ||                 //  at least 3 textures (for shifting right/left and central)\r\n               this.spriteBuffer.length < textures.length ||    //  at least as many as given in input\r\n               this.totalWidth <= this.viewPortSize.x + width   //  at least to cover whole viewport size extended for one width\r\n            ) {\r\n\r\n            //  get the texture\r\n            textureIndex = index % textures.length;\r\n            t = this.getTexture(textures, textureIndex);\r\n            t.rotate = 8;   //  to adjust for worldContainer y scale -1\r\n\r\n            // create a sprite\r\n            var spr = new PIXI.Sprite(t);\r\n            spr.x = this.totalWidth;\r\n            spr.scale.set(this.textureScale, this.textureScale);\r\n            spr.anchor.set(0, 0);\r\n            this.spriteBuffer.push(spr);\r\n            this.spriteOrderList.push(this.spriteBuffer.length-1); //   will hold sprite indices from spritebuffer [0,1,2,3,4...]\r\n            this.addChild(spr);\r\n\r\n            //  update \r\n            this.totalWidth += spr.width;\r\n            console.log(`${t.baseTexture.imageUrl} -> width: ${t.width} spr width: ${spr.width}, total width: ${this.totalWidth}`);\r\n            index++;            \r\n        }        \r\n    }\r\n\r\n    private getTexture(textures: Array<string | PIXI.Texture>, textureIndex: number){\r\n        var t: PIXI.Texture;\r\n        if (typeof textures[textureIndex] === \"string\") {\r\n            //var res = PIXI.loader.resources[textures[textureIndex] as string];            \r\n            // if(!res || !res.texture){\r\n            //     console.error('texture not found: ' + textures[textureIndex]);\r\n            // }\r\n            // t = res.texture;\r\n            t = TextureLoader.Get(textures[textureIndex] as string);\r\n            //t.baseTexture.scaleMode = PIXI.SCALE_MODES.NEAREST;\r\n        } else {\r\n            t = textures[textureIndex] as PIXI.Texture;\r\n        }\r\n        return t; \r\n    }\r\n\r\n    private recalculatePosition = (newPositionX: number) => {\r\n        const firstIdx = this.spriteOrderList[0];\r\n        const firstSpr: PIXI.Sprite = this.spriteBuffer[firstIdx];\r\n        const lastIdx = this.spriteOrderList[this.spriteOrderList.length-1];\r\n        const lastSpr: PIXI.Sprite = this.spriteBuffer[lastIdx]; \r\n\r\n        //  update sprite positions\r\n        var delta =  (this.worldPosition - newPositionX) * this.parallaxFactor;\r\n        this.updatePositions(delta);\r\n\r\n        if (newPositionX > this.worldPosition) {            \r\n            //  check for removals from left side\r\n            if (firstSpr.x + firstSpr.width < 0) {\r\n                this.spriteOrderList.push(this.spriteOrderList.shift());    //  move first element to end\r\n                firstSpr.x = lastSpr.x + lastSpr.width;               \r\n            }            \r\n        } else {\r\n            //  check for removals from right side  \r\n            if (lastSpr.x > this.viewPortSize.x) {\r\n                this.spriteOrderList.unshift(this.spriteOrderList.pop());    //  move last element to start\r\n                lastSpr.x = firstSpr.x - lastSpr.width;               \r\n            }           \r\n        }\r\n        this.worldPosition = newPositionX;\r\n    };\r\n\r\n    private updatePositions(delta:number){\r\n        for(var i = 0; i< this.spriteBuffer.length; i++){\r\n            this.spriteBuffer[i].position.x += delta;\r\n        }\r\n    }\r\n}\r\n\r\n","import * as PIXI from 'pixi.js';\r\nimport { OutlineFilter } from '@pixi/filter-outline';\r\nimport { TextureLoader } from '.';\r\n\r\nlet COLUMN_PADDING = 1;\r\n\r\nexport class Slider extends PIXI.Container {\r\n    private textureHandle: PIXI.Texture;\r\n    private textureControl: PIXI.Texture;\r\n    private frameUpControl: PIXI.Rectangle;\r\n    private frameHighlightControl: PIXI.Rectangle;\r\n    private frameDownControl: PIXI.Rectangle;\r\n\r\n    private frameUpHandle!: PIXI.Rectangle;\r\n    private frameHighlightHandle!: PIXI.Rectangle;\r\n    private frameDownHandle!: PIXI.Rectangle;\r\n\r\n    private isPressed: boolean = false;\r\n    private text: PIXI.Text;\r\n    private requestedWidth: number;\r\n    private requestedHeight: number;\r\n\r\n    private control : PIXI.Sprite;\r\n\r\n    private handle: PIXI.Sprite;\r\n    private handleWidth: number;\r\n    private value: number = 0;\r\n\r\n    private maxX: number;\r\n    private minX: number;\r\n\r\n    private _outlineColor: number;\r\n\r\n    /**\r\n     * \r\n     * @param textureAtlas slider texture, two columns (outline, handle) and three rows (normal, highlight, pressed).\r\n     * @param sliderFrameWidth width of the second column holding the slider handle\r\n     * @param x\r\n     * @param y\r\n     * @param width\r\n     * @param height\r\n     */\r\n    constructor(textureAtlas: string, sliderFrameWidth: number, x: number = 0, y: number = 0 , width: number, height: number) {\r\n        super();\r\n        this.position.set(x || 0, y || 0);\r\n        this.requestedHeight = height;\r\n        this.requestedWidth = width;\r\n\r\n        this.control = new PIXI.Sprite();\r\n        this.control.anchor.set(0);\r\n        this.control.interactive = true;\r\n        this.control.buttonMode = false;\r\n        this.control.cursor = \"hover\";\r\n        this.addChild(this.control);\r\n        this.control\r\n            .on('pointerdown', this.onButtonDown)\r\n            .on('pointerup', this.onButtonUp)\r\n            .on('pointertap', this.onClick)\r\n            .on('pointerupoutside', this.onButtonUpOutside)\r\n            .on('mouseover', this.onButtonOver)\r\n            .on('mouseout', this.onButtonOut);\r\n\r\n\r\n        this.handleWidth = sliderFrameWidth;\r\n        this.handle = new PIXI.Sprite();\r\n        this.handle.position.set(0, this.requestedHeight/2);\r\n        this.handle.anchor.set(0, 0.5);\r\n        this.addChild(this.handle);\r\n        this.handle.interactive = true;\r\n        this.handle.buttonMode = false;\r\n        this.handle.cursor = \"hover\";\r\n        this.handle\r\n            .on('pointerdown', this.onDragStart)\r\n            .on('pointerup', this.onDragEnd)\r\n            .on('pointerupoutside', this.onDragEnd)\r\n            .on('pointermove', this.onDragMove);\r\n           \r\n\r\n        //  setup textures\r\n        this.SetTexture(textureAtlas, sliderFrameWidth);\r\n        this.IsPressed = false;\r\n        this.applyTextureFrames();\r\n\r\n        this.Value = 0.1;\r\n    }\r\n\r\n\r\n    public get Value() {\r\n        return this.value;\r\n    }\r\n    public set Value(value: number) {\r\n        if (this.value !== value) {\r\n            this.value = value;            \r\n            this.handle.position.x = this.maxX * value;\r\n            this.emit('valueChange', value);\r\n            this.emit('valueChanged', value);\r\n        }        \r\n    }\r\n\r\n    public get outlineColor(){\r\n        return this._outlineColor;\r\n    }\r\n    public set outlineColor(value: number) {\r\n        this._outlineColor = value;\r\n        this.control.filters = [new OutlineFilter(1, this._outlineColor, 0.5)];      \r\n    }\r\n\r\n    public get IsPressed() {\r\n        return this.isPressed;\r\n    }\r\n    public set IsPressed(state: boolean) {\r\n        this.isPressed = state;\r\n        this.applyTextureFrames();\r\n    }\r\n\r\n    public get Text() {\r\n        return this.text;\r\n    }\r\n    public set Text(text: PIXI.Text) {\r\n        if (this.text) {\r\n            this.removeChild(this.text);\r\n        }\r\n        this.text = text;\r\n        if (this.text) {\r\n            this.text.anchor.set(0.5, 0.5);\r\n            var x = (this.width / this.scale.x) / 2;\r\n            var y = (this.height / this.scale.y) / 2;\r\n            this.text.position.set(x, y);\r\n            this.addChild(this.text);\r\n        }\r\n    }\r\n\r\n\r\n    public onClick = (e) => {\r\n        this.setSliderFromeEvent(e);\r\n        this.Value = this.getCalculatedValue();\r\n        return false;\r\n    }\r\n\r\n    private dragOffsetX: number = 0;\r\n    private isDragging: boolean = false;\r\n\r\n    private getCalculatedValue() {\r\n        var position = this.handle.x - this.minX;\r\n        var pct = position / this.maxX;\r\n        return this.precise_round(pct, 2);\r\n    }\r\n\r\n    private onDragStart = (e) => {\r\n        this.isDragging = true;\r\n        var pos = e.data.getLocalPosition(this.handle);\r\n        this.dragOffsetX = pos.x;\r\n    }\r\n    private onDragEnd = (e) => {\r\n        this.isDragging = false;\r\n        this.Value = this.getCalculatedValue();\r\n        e.stopped = true;\r\n    }\r\n\r\n    private onDragMove = (e:Event) => {\r\n        if (this.isDragging) {\r\n            this.setSliderFromeEvent(e);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    private setSliderFromeEvent(e) {\r\n        var newPosition = e.data.getLocalPosition(this.handle.parent);\r\n        if (this.isDragging && this.dragOffsetX) {\r\n            newPosition.x -= this.dragOffsetX;\r\n        }\r\n        this.handle.x = Math.min(this.maxX, Math.max(this.minX, newPosition.x));\r\n        this.emit('valueChange', this.getCalculatedValue());\r\n    }\r\n    private precise_round(num, decimals): number {\r\n        var t = Math.pow(10, decimals);\r\n        var result = (Math.round((num * t) + (decimals > 0 ? 1 : 0) * ((Math as any).sign(num) * (10 / Math.pow(100, decimals)))) / t).toFixed(decimals);\r\n        return parseFloat(result);\r\n    }\r\n\r\n    private onButtonDown = () => {\r\n        this.textureControl.frame = this.frameDownControl;\r\n        this.textureHandle.frame = this.frameDownHandle;\r\n    };\r\n\r\n    private onButtonUp = (e) => {\r\n        this.applyTextureFrames();\r\n    };\r\n\r\n    private onButtonUpOutside = () => {\r\n        this.applyTextureFrames();\r\n    };\r\n\r\n    private onButtonOver = () => {\r\n        this.control.texture.frame = this.frameHighlightControl;\r\n        this.textureHandle.frame = this.frameHighlightHandle;\r\n    };\r\n\r\n    private onButtonOut = () => {\r\n        this.applyTextureFrames();\r\n    };\r\n\r\n\r\n    private applyTextureFrames() {\r\n        this.textureControl.frame = this.isPressed ? this.frameDownControl : this.frameUpControl;\r\n        this.textureHandle.frame = this.isPressed ? this.frameDownHandle : this.frameUpHandle;\r\n    }\r\n\r\n    public SetTexture(textureName: string, handleWidth: number) {\r\n        let t = TextureLoader.Get(textureName);\r\n        //  prepare textures\r\n        this.textureControl = new PIXI.Texture(t.baseTexture);\r\n        this.textureControl.baseTexture.scaleMode = PIXI.SCALE_MODES.NEAREST;\r\n        this.textureHandle = new PIXI.Texture(t.baseTexture);\r\n        \r\n        //  calculate rect frames for textures\r\n        var frameHeight = this.textureControl.height / 3;\r\n        var frameWidth = this.textureControl.width - handleWidth - COLUMN_PADDING;\r\n        this.frameUpControl = new PIXI.Rectangle(0, 0 * frameHeight, frameWidth, frameHeight);\r\n        this.frameHighlightControl = new PIXI.Rectangle(0, 1 * frameHeight, frameWidth, frameHeight);\r\n        this.frameDownControl = new PIXI.Rectangle(0, 2 * frameHeight, frameWidth, frameHeight);\r\n        \r\n        var x = frameWidth + COLUMN_PADDING; //  texture elements are separated by padding pixels\r\n        this.frameUpHandle = new PIXI.Rectangle(x, 0 * frameHeight, handleWidth, frameHeight);\r\n        this.frameHighlightHandle = new PIXI.Rectangle(x, 1 * frameHeight, handleWidth, frameHeight);\r\n        this.frameDownHandle = new PIXI.Rectangle(x, 2 * frameHeight, handleWidth, frameHeight);\r\n\r\n        // set frames\r\n        this.applyTextureFrames();\r\n        \r\n        this.control.texture = this.textureControl;\r\n        this.control.width = this.requestedWidth;     \r\n        this.control.height = this.requestedHeight;     \r\n\r\n        // handle\r\n        this.handle.texture = this.textureHandle;\r\n        this.handle.height = this.requestedHeight;\r\n\r\n\r\n        this.maxX = this.requestedWidth - this.handleWidth;\r\n        this.minX = 0;\r\n    }\r\n}\r\n","import { PIXI, Scene, Global} from \"..\";\r\nimport { SceneManager } from \"..\";\r\nimport { LoaderScene } from \"./LoaderScene\";\r\nimport { SCENE_HALF_WIDTH, SCENE_HALF_HEIGHT } from '..';\r\nimport { Quest } from '../QuestSystem/Quest';\r\n\r\nconst PRELOAD_BOOT_ASSETS = [\r\n    //  cursors\r\n    'assets/cur_default.png',\r\n    'assets/cur_hover.png',\r\n    'assets/cur_target.png',\r\n    'assets/levels.json',\r\n    'assets/quests.json'\r\n];\r\n\r\n/**\r\n * Preloads common assets, after preloading parses user state and starts preloading level assets.\r\n */\r\nexport class BootScene extends Scene {\r\n    private loadingMessage!: PIXI.Text;\r\n    private spinner!: PIXI.Sprite;\r\n    \r\n    \r\n    constructor(scm:SceneManager) {\r\n        super(scm, \"Boot\");\r\n        this.BackGroundColor = 0;\r\n    }\r\n\r\n    public onUpdate = (dt: number)=>{\r\n        if (this.spinner) {\r\n            this.spinner.rotation += 0.05;\r\n        }\r\n    }\r\n\r\n    public onActivate = () => {\r\n        this.loadingMessage = new PIXI.Text(\"booting ...\", {\r\n             fontSize: \"36px\", \r\n             fontFamily: \"Permanent Marker\", \r\n             fill: 0x0ff00, \r\n             dropShadow: true, \r\n             stroke: 0x44ff44, \r\n             strokeThickness: 1 \r\n        });\r\n        this.loadingMessage.anchor.set(0.5, 0.5);\r\n        this.loadingMessage.position.set(SCENE_HALF_WIDTH, SCENE_HALF_HEIGHT - 80);\r\n        this.addChild(this.loadingMessage);\r\n\r\n        //------------------------------------------------------\r\n        //  get loading image and define callback on image load\r\n        //------------------------------------------------------\r\n        PIXI.loader.reset()\r\n        .add(\"assets/loading.png\")\r\n        .load(this.startPreloading);\r\n    };\r\n    \r\n    /**\r\n     *  Downloads common assets, JSON files etc.\r\n     */\r\n    private startPreloading = async () => {\r\n        \r\n        //   first add a loading spinner\r\n        var loadingTexture = PIXI.Texture.fromImage(\"assets/loading.png\");\r\n        this.spinner = new PIXI.Sprite(loadingTexture);\r\n        this.spinner.position.set(SCENE_HALF_WIDTH, SCENE_HALF_HEIGHT);\r\n        this.spinner.anchor.set(0.5, 0.5);\r\n        this.spinner.scale.set(0.5);\r\n        this.addChild(this.spinner);\r\n        \r\n        console.log('initializing common assets preloading ...', PRELOAD_BOOT_ASSETS);\r\n        PIXI.loader\r\n            .add(PRELOAD_BOOT_ASSETS)\r\n            .load(this.onPreloadFinished); \r\n    }\r\n\r\n    private onPreloadFinished = async ()=>{\r\n        //  preload of common content is finished\r\n        \r\n        //  setup custom cursors\r\n        var defaultIcon = \"url('assets/cur_default.png'),auto\";\r\n        var hoverIcon = \"url('assets/cur_hover.png'),auto\";\r\n        var targetIcon = \"url('assets/cur_target.png') 24 24, auto\";\r\n        this.sceneManager.Renderer.plugins.interaction.cursorStyles.default = defaultIcon;\r\n        this.sceneManager.Renderer.plugins.interaction.cursorStyles.hover = hoverIcon;\r\n        this.sceneManager.Renderer.plugins.interaction.cursorStyles.target = targetIcon;\r\n        document.body.style.cursor = defaultIcon;\r\n\r\n        // save levels and quests\r\n        Global.LevelDefinitions = PIXI.loader.resources[\"assets/levels.json\"].data;\r\n        var questsObj = PIXI.loader.resources[\"assets/quests.json\"].data;\r\n        Global.LevelDefinitions.quests = questsObj.quests as Array<Quest>;\r\n        Global.LevelDefinitions.quests.forEach((q: Quest) => {\r\n            q.itemId = q.itemId || 0;\r\n            q.itemsNeeded = q.itemsNeeded || 0;\r\n            q.itemsCollected = 0;\r\n            q.rewardCoins = q.rewardCoins || 0;\r\n            q.rewardExp = q.rewardExp || 0;\r\n        });\r\n\r\n        const ls = new LoaderScene(this.sceneManager);\r\n        this.sceneManager.AddScene(ls);\r\n        this.sceneManager.ActivateScene(ls); \r\n    }\r\n}","import { Global, PIXI, Scene, SceneManager } from \"..\";\r\nimport { GetLevelAssets, getUniqueItems } from '../world/LevelHelper';\r\nimport { stats } from '../objects/PlayerStats';\r\nimport { SCENE_HALF_WIDTH, SCENE_HALF_HEIGHT } from '../constants';\r\nimport { MasterHud } from '../objects/MasterHud';\r\nimport { MainScene } from './MainScene';\r\nimport { OptionsScene } from './OptionsScene';\r\nimport { CutScene } from './CutScene';\r\n\r\n\r\nexport class LoaderScene extends Scene {\r\n    private loadingMessage: PIXI.Text;\r\n    private spinner: PIXI.Sprite;\r\n\r\n    private readonly preloadAssets : string[] = [  \r\n        'assets/gui-atlas.json', \r\n        'assets/objects-atlas.json',\r\n        'assets/entities-atlas.json',\r\n        'assets/background-atlas.json',     \r\n    ];\r\n\r\n    constructor(scm:SceneManager) {\r\n        super(scm, \"Loader\");\r\n        this.BackGroundColor = 0;\r\n        this.loadingMessage = new PIXI.Text(\"loading ...\", { \r\n            fontSize: 36, \r\n            fontFamily: \"Permanent Marker\", \r\n            fill: 0x0ff00, \r\n            dropShadow: true, \r\n            align: \"center\",\r\n            stroke: 0x44ff44, \r\n            strokeThickness: 1\r\n        });\r\n        this.loadingMessage.anchor.set(0.5, 0.5);\r\n        this.loadingMessage.position.set(SCENE_HALF_WIDTH, SCENE_HALF_HEIGHT - 80);\r\n        this.addChild(this.loadingMessage);\r\n\r\n        var loadingTexture = PIXI.Texture.fromImage(\"assets/loading.png\");\r\n        this.spinner = new PIXI.Sprite(loadingTexture);\r\n        this.spinner.position.set(SCENE_HALF_WIDTH, SCENE_HALF_HEIGHT);\r\n        this.spinner.anchor.set(0.5, 0.5);\r\n        this.spinner.scale.set(0.5);\r\n        this.addChild(this.spinner); \r\n    }\r\n\r\n    public onUpdate = (dt: number)=>{\r\n        if (this.spinner) {\r\n            this.spinner.rotation += 0.05;\r\n        }\r\n    }\r\n\r\n    public onActivate = () => {   \r\n        console.log(`downloading level ${stats.currentGameLevel}...`);\r\n        let assets: string[] = GetLevelAssets(Global.LevelDefinitions, stats.currentGameLevel);\r\n        assets = assets.concat(this.preloadAssets);\r\n        assets = getUniqueItems(assets);\r\n        \r\n        PIXI.loader\r\n            .reset()\r\n            .add(assets)\r\n            .load(this.handleLevelLoading)\r\n            .on(\"progress\", this.onProgress);\r\n    };\r\n   \r\n    private handleLevelLoading = ()=> {        \r\n        if(!this.sceneManager.HasScene(\"Main\")){\r\n            console.log('adding scenes...');    \r\n            this.sceneManager.AddScene(new MainScene(this.sceneManager));\r\n            this.sceneManager.AddScene(new OptionsScene(this.sceneManager));\r\n            this.sceneManager.AddScene(new CutScene(this.sceneManager));\r\n            this.sceneManager.MasterHudOverlay = new MasterHud(this.sceneManager);;\r\n        }\r\n\r\n        try {\r\n            let mainScene = this.sceneManager.GetScene(\"Main\") as MainScene;\r\n            mainScene.startLevel();            \r\n        } catch (e) {\r\n            console.log(\"exception: \", e);\r\n        }\r\n    }\r\n\r\n    \r\n    private onProgress = (loader: PIXI.loaders.Loader, resource: PIXI.loaders.Resource) => {\r\n        var progress = loader.progress;\r\n        console.log(\"progress: \" + progress.toFixed(0) + \"%, asset: \" + resource.name);\r\n        this.loadingMessage.text = \"Loading \" + progress.toFixed(0) + \" %\";\r\n    };\r\n}","import { LevelLoader } from \"../world/LevelLoader\";\r\nimport { wp2 } from \"../world/WorldP2\";\r\nimport { Mob } from \"../mobs/Mob\";\r\nimport { AnimatedSprite, AnimationSequence } from \"../_engine/AnimatedSprite\";\r\nimport { stats } from '../objects/PlayerStats';\r\nimport { Global } from '..';\r\n\r\nexport class SpawnPoint {\r\n    private mobCount: number = 0;\r\n    private nextSpawn: number = 0;\r\n    private worldContainer: PIXI.Container;\r\n\r\n    constructor(public name: string,\r\n        private x: number,\r\n        private y: number,\r\n        private area: number,\r\n        private maxMobCount: number,\r\n        private respawnSeconds: number,\r\n        private entity: any,\r\n        private active: boolean = true) {\r\n        this.nextSpawn = performance.now() / 1000;\r\n    }\r\n\r\n    public get IsActive() { return this.active; };\r\n    public set IsActive(value: boolean) { this.active = value; };\r\n\r\n    public onUpdate(dt: number) {\r\n        if (this.active && this.mobCount < this.maxMobCount) {\r\n\r\n            //  is it time to respawn?\r\n            var now = performance.now() / 1000;\r\n            if (this.nextSpawn <= now) {\r\n\r\n                if (!this.worldContainer) {\r\n                    this.worldContainer = (Global.getScm().GetScene(\"Main\") as any).worldContainer;\r\n                }\r\n                var mobBody = LevelLoader.createMob(stats.currentLevel.templates, this.entity);\r\n                let dispObj = (mobBody as any).DisplayObject as Mob;\r\n\r\n                let x = this.x + (Math.random() * this.area) - (this.area / 2);\r\n                let y = this.y;\r\n\r\n                mobBody.position = [x, y];\r\n                wp2.addBody(mobBody);\r\n\r\n                dispObj.position.set(x, y);\r\n                dispObj.visible = false;\r\n                dispObj.isLoading = true;\r\n                this.worldContainer.addChild(dispObj);\r\n\r\n                let loadSpr = new AnimatedSprite();\r\n                loadSpr.addAnimations(new AnimationSequence(\"load\", \"assets/entities-atlas.json@load.png\", [0, 1, 2, 3], 64, 64));\r\n                loadSpr.anchor.set(0.5);\r\n                loadSpr.position.set(x, y + 10);\r\n                loadSpr.play(\"load\", 4, true);\r\n                loadSpr.scale.set(1, -1);   //  the worldContainer has -y scale so we must flip it up again \r\n                this.worldContainer.addChild(loadSpr);\r\n\r\n                setTimeout(() => {\r\n                    this.worldContainer.removeChild(loadSpr);\r\n                    dispObj.isLoading = false;\r\n                    dispObj.visible = true;\r\n                }, 3000);\r\n\r\n                (dispObj as Mob).onDeath = () => {\r\n                    console.log(\"mob died\");\r\n                    this.mobCount--;\r\n                }\r\n\r\n                this.mobCount++;\r\n                this.nextSpawn = (performance.now() / 1000) + this.respawnSeconds;\r\n            }\r\n        }\r\n    }\r\n}","import { AI } from \"./AI\";\r\nimport { Mob } from \"./Mob\";\r\n\r\n/**\r\n * Can attack and turn towards player but invokes no other actions.\r\n */\r\nexport class BasicStaticAI extends AI {\r\n\r\n    constructor(mobEntity: Mob) {\r\n        super(mobEntity);\r\n    }\r\n\r\n    public canFire() {\r\n        let nowMilliseconds = performance.now();\r\n        let rnd = Math.random() * 2000;\r\n        let can = (this.lastFire + this.attackCD  + rnd <= nowMilliseconds);\r\n        if (can) {\r\n            let rnd = Math.random();\r\n            can = can && rnd > 0.3;\r\n            this.lastFire = performance.now(); //  set to prevent firing in next update if 'can' is false\r\n        }\r\n        return can;\r\n    };\r\n}","import * as Global from \"../global\";\r\nimport { Mob} from \"./Mob\";\r\nimport { AtrType, DirectionH } from '../enums';\r\n\r\n/**\r\n * Max distance at which the target can be acquired.\r\n */\r\nlet LOCK_DISTANCE = 800;\r\n\r\n/**\r\n * Max distance at which the target is tracked.\r\n */\r\nlet TRACK_DISTANCE = 1050;\r\n\r\n/**\r\n * Base for all mob AI. Provides low level AI functions.\r\n */\r\nexport class AI {\r\n\r\n    /**\r\n     * True if the AI has a 'target lock' on the player.\r\n     */\r\n    protected hasTarget: boolean;\r\n\r\n    /**\r\n     * Distance from player.\r\n     */\r\n    protected targetDistance: number;\r\n\r\n    protected lastFire: number = 0;//performance.now() + Math.random() * 10;    //  so that the attack is not triggered at init time\r\n\r\n    protected attackCD: number;\r\n\r\n    constructor(protected mobEntity: Mob) {\r\n        this.attackCD = mobEntity.attributes[AtrType.AtkCD];\r\n    }\r\n\r\n    private calcDistance() {\r\n        let dx = Global.position.x - this.mobEntity.x;\r\n        let dy = Global.position.y - this.mobEntity.y;\r\n        this.targetDistance = Math.sqrt(dx * dx + dy * dy);\r\n    }\r\n\r\n    private turnTowardsTarget() {\r\n        //  negative left, positive right\r\n        let dir = Global.position.x - this.mobEntity.x;\r\n\r\n        if (dir < 0 && this.mobEntity.direction != DirectionH.Left) {\r\n            this.mobEntity.direction = DirectionH.Left;\r\n        } else if (dir > 0 && this.mobEntity.direction != DirectionH.Right) {\r\n            this.mobEntity.direction = DirectionH.Right;\r\n        }\r\n    }\r\n\r\n    public canFire() {\r\n        let nowMilliseconds = performance.now();\r\n        return (this.lastFire + this.attackCD <= nowMilliseconds);\r\n    };\r\n\r\n    public onUpdate = (dt: number) => {\r\n        this.calcDistance();\r\n\r\n        //  TODO: implement visibility check\r\n        if (this.targetDistance < TRACK_DISTANCE) {\r\n            this.turnTowardsTarget();\r\n        }\r\n\r\n        if (this.targetDistance < LOCK_DISTANCE) {\r\n            this.hasTarget = true;\r\n\r\n            //  check attack CD            \r\n            if (this.canFire()) {\r\n                this.mobEntity.attack();\r\n                this.lastFire = performance.now();\r\n            }\r\n        } else {\r\n            this.hasTarget = false;\r\n        }\r\n    }\r\n}","import { SceneManager, Button, SCENE_WIDTH } from \"..\";\r\n\r\nconst BTN_X = SCENE_WIDTH - 48;\r\nconst BTN_Y = 4;\r\nconst BTN_SCALE = 1.0;\r\n\r\n/**\r\n * Implements options and full screen togle buttons.\r\n */\r\nexport class MasterHud extends PIXI.Container {\r\n    constructor(private sceneManager:SceneManager){\r\n        super();\r\n\r\n        //----------------------------\r\n        //  full screen toggler\r\n        //----------------------------\r\n        [\"\", \"webkit\", \"moz\", \"ms\"].forEach(\r\n            prefix => document.addEventListener(prefix + \"fullscreenchange\", (event) => {\r\n                if (this.isFullScreen) {\r\n                    btnFullScreen.setTexture(\"assets/gui-atlas.json@gui_fs_exit.png\");\r\n                } else {\r\n                    btnFullScreen.setTexture(\"assets/gui-atlas.json@gui_fs_enter.png\");\r\n                }\r\n                btnFullScreen.scale.set(BTN_SCALE);\r\n            }, false)\r\n        );\r\n\r\n        //--------------------------------\r\n        //  add full screen, options and \r\n        //  back buttons\r\n        //--------------------------------       \r\n        var btnFullScreen = new Button(\"assets/gui-atlas.json@gui_fs_enter.png\", BTN_X, BTN_Y);\r\n        btnFullScreen.onClick = () => this.toggleFullScreen();\r\n        btnFullScreen.scale.set(BTN_SCALE);\r\n        this.addChild(btnFullScreen);\r\n\r\n        var btnOptions = new Button(\"assets/gui-atlas.json@gui_options.png\", BTN_X - 48, BTN_Y);\r\n        btnOptions.onClick = () => this.sceneManager.ActivateScene(\"Options\");\r\n        btnOptions.name = \"BTN_OPTIONS\";\r\n        btnOptions.scale.set(BTN_SCALE);\r\n        this.addChild(btnOptions);\r\n    }   \r\n\r\n    private get isFullScreen(): boolean {\r\n        var doc: any = document;\r\n        return !(!doc.fullscreenElement && !doc.mozFullScreenElement && !doc.webkitFullscreenElement && !doc.msFullscreenElement);\r\n    }\r\n    private toggleFullScreen() {\r\n        var doc: any = document;\r\n        var docElm: any = document.documentElement;\r\n\r\n        var requestFullScreen = docElm.requestFullscreen || docElm.mozRequestFullScreen || docElm.webkitRequestFullScreen || docElm.msRequestFullscreen;\r\n        var exitFullScreen = doc.exitFullscreen || doc.mozCancelFullScreen || doc.webkitExitFullscreen || doc.msExitFullscreen;\r\n\r\n        if (!this.isFullScreen) {\r\n            requestFullScreen.call(docElm);\r\n        } else {\r\n            exitFullScreen.call(doc);\r\n        }\r\n    } \r\n}","import * as p2 from 'p2';\r\nimport * as TWEEN from \"@tweenjs/tween.js\";\r\nimport { PIXI, SceneManager, Scene, Parallax, Global } from \"..\";\r\nimport { wp2 } from '../world/WorldP2';\r\nimport { HeroCharacter } from '../objects/HeroCharacter';\r\nimport { StatsHud } from '../objects/StatsHud';\r\nimport { stats } from '../objects/PlayerStats';\r\nimport { Bullet } from '../objects/Bullet';\r\nimport { BURN_TOPIC, IBurnChangeEvent, GROUND_SHAKE, eventEmitter } from '../events';\r\nimport { SCENE_HEIGHT, SCENE_HALF_WIDTH, SCENE_BACKCOLOR, MSG_COIN_STYLE, MSG_WARN_STYLE, ANIMATION_FPS_SLOW } from '../constants';\r\nimport { Lava } from '../objects/Lava';\r\nimport { LevelLoader } from '../world/LevelLoader';\r\nimport { Platform } from '../objects/Platform';\r\nimport { Bumper } from '../objects/Bumper';\r\nimport { snd } from '../world/SoundMan';\r\nimport { CutScene } from './CutScene';\r\nimport { QuestManager } from '../questSystem/QuestManager';\r\nimport { StatType, DamageType } from '../enums';\r\n\r\n\r\nexport class MainScene extends Scene {\r\n    private worldContainer: PIXI.Container;\r\n    private hero: HeroCharacter;\r\n    private questMngr : QuestManager;\r\n    private hud : StatsHud;\r\n\r\n\r\n    private shakeDuration: number = 0;\r\n    private shakeEnd: number = 0;\r\n    private nextShake: number = 0;\r\n    private magnitude: number = 0;\r\n    private shakeX: number;\r\n    private shakeY: number;\r\n    private readonly SHAKE_COUNT = 15;\r\n\r\n    constructor(scm: SceneManager) {\r\n        super(scm, \"Main\");\r\n        this.BackGroundColor = SCENE_BACKCOLOR;\r\n        this.setup();\r\n    }\r\n\r\n    public onUpdate(dt: number) {\r\n        //-------------------------------------------\r\n        //  update world & world container position\r\n        //-------------------------------------------        \r\n        wp2.update(dt);\r\n        this.worldContainer.x = (SCENE_HALF_WIDTH - this.hero.x);\r\n        this.worldContainer.y = (SCENE_HEIGHT - 70);\r\n        \r\n        //-------------------------------------------\r\n        //  update parallax\r\n        //-------------------------------------------\r\n        stats.currentLevel.parallax.forEach(p => {\r\n            p.SetViewPortX(Global.position.x);\r\n            p.position.x = Global.position.x - SCENE_HALF_WIDTH;\r\n        });\r\n\r\n        //-------------------------------------------\r\n        //  update entities position\r\n        //-------------------------------------------\r\n        var bodies = wp2.bodies;\r\n        for (var i = 0, len = bodies.length; i < len; i++) {\r\n            let body = bodies[i] as any;\r\n            let displayObject: PIXI.DisplayObject = (body as any).DisplayObject as PIXI.DisplayObject;\r\n            if (displayObject && displayObject.visible && body.type !== p2.Body.STATIC) {\r\n                displayObject.position.set(Math.floor(body.interpolatedPosition[0]), Math.floor(body.interpolatedPosition[1]));\r\n                displayObject.rotation = body.interpolatedAngle;\r\n            }            \r\n            \r\n            if (body.Trigger && body.Trigger.type === \"distance\") {\r\n                if (this.questMngr.canActivateTrigger(body.Trigger)) {\r\n                    let x = this.hero.position.x - body.position[0];\r\n                    let y = this.hero.position.y - body.position[1];\r\n                    let distance = Math.sqrt(x * x + y * y);\r\n                    if (body.Trigger.distance >= distance) {\r\n                        this.questMngr.handleTriggerEvent(body);\r\n                    }\r\n                }\r\n            }\r\n            \r\n        }\r\n\r\n        //-------------------------------------------\r\n        //  collisions with collectible items\r\n        //-------------------------------------------\r\n        for (var i = 0, len = wp2.playerContacts.length; i < len; i++) {\r\n            let body: any = wp2.playerContacts[i];\r\n            if (body.DisplayObject && body.DisplayObject.interactionType) {\r\n                this.handleInteractiveCollision(body);\r\n            }\r\n            \r\n            if (body.Trigger && body.Trigger.type === \"collision\") {\r\n                this.questMngr.handleTriggerEvent(body);\r\n            }            \r\n        }\r\n\r\n        //-------------------------------------------\r\n        //  invoke update on each updateable\r\n        //-------------------------------------------\r\n        for (var i = 0, len = this.worldContainer.children.length; i < len; i++) {\r\n            let child: any = this.worldContainer.children[i];\r\n            if (child && child.onUpdate) {\r\n                child.onUpdate(dt);\r\n            }\r\n        };\r\n\r\n        //-------------------------------------------\r\n        //  Spawn points\r\n        //-------------------------------------------\r\n        for (var i = 0, len = stats.currentLevel.spawnPoints.length; i < len; i++) {\r\n            stats.currentLevel.spawnPoints[i].onUpdate(dt);\r\n        }\r\n\r\n        this.hud.onUpdate(dt);\r\n        stats.onUpdate(dt);\r\n\r\n        var now = performance.now();\r\n\r\n        //-------------------------------------------\r\n        //  check if player is dead\r\n        //-------------------------------------------\r\n        if (stats.getStat(StatType.HP) <= 0) {\r\n            this.IsHeroInteractive = false;\r\n            this.hero.visible = false;\r\n            var cutScene = this.sceneManager.GetScene(\"CutScene\") as CutScene;\r\n            var backGroundTexture = this.sceneManager.CaptureScene();\r\n            cutScene.SetBackGround(backGroundTexture, this.scale);\r\n            cutScene.DeathScene = true;\r\n            this.sceneManager.ActivateScene(cutScene);\r\n        }  else if (this.shakeEnd >= now) {\r\n            if (this.nextShake <= now) {\r\n                //  original start position\r\n                let x = (SCENE_HALF_WIDTH - this.hero.x);\r\n                let y = (SCENE_HEIGHT - 70);\r\n\r\n                this.shakeX = x + this.randomRange(-this.magnitude / 2, this.magnitude / 2);\r\n                this.shakeY = y + this.randomRange(-this.magnitude, this.magnitude);\r\n                //console.log(\"shake: \" + this.shakeX + \", \" + this.shakeY, this.magnitude, this.shakeEnd);\r\n\r\n                //  reduce for next shake\r\n                this.magnitude -= this.magnitude / this.SHAKE_COUNT;\r\n                this.nextShake = now + this.shakeDuration;\r\n            }\r\n\r\n            this.worldContainer.x = this.shakeX;\r\n            this.worldContainer.y = this.shakeY;\r\n        }\r\n    }\r\n\r\n    private setup() {\r\n        this.worldContainer = new PIXI.Container();\r\n        this.worldContainer.scale.y = -1;\r\n        this.addChild(this.worldContainer);\r\n        Global.worldContainer = this.worldContainer;\r\n\r\n        //-----------------------------\r\n        //  setup hero \r\n        //-----------------------------     \r\n        this.hero = new HeroCharacter(this.worldContainer);\r\n        this.hero.name = \"hero\";\r\n        this.hero.x = SCENE_HALF_WIDTH;\r\n        this.worldContainer.addChild(this.hero);\r\n        this.hero.play(\"idle\", ANIMATION_FPS_SLOW);\r\n\r\n        //--------------------------------------\r\n        //  setup hud's\r\n        //--------------------------------------\r\n        this.hud = new StatsHud();\r\n        this.HudOverlay = this.hud;\r\n\r\n        //--------------------------------------\r\n        //  register custom entity factories\r\n        //--------------------------------------\r\n        LevelLoader.registerFactory(\"Lava\", (def)=> new Lava(def.texture as string));\r\n        LevelLoader.registerFactory(\"Platform\", (def)=> {            \r\n            if (typeof def.texture === \"string\") {\r\n                return new Platform(def.tilesX || 1, 1, [def.texture]);\r\n            } else {\r\n                return new Platform(def.tilesX || 1, def.tilesY || 1, def.texture);\r\n            }\r\n        });\r\n        LevelLoader.registerFactory(\"Bumper\", (def)=> new Bumper());\r\n\r\n        this.questMngr = new QuestManager(this);\r\n        eventEmitter.on(BURN_TOPIC, (event: IBurnChangeEvent) => event.isBurning ? snd.burn():snd.burnStop() );  \r\n        eventEmitter.on(GROUND_SHAKE, this.startGroundShake);\r\n    }\r\n\r\n    public startLevel(){\r\n        this.clearLevel();\r\n\r\n        //--------------------------------------\r\n        //  test level loading\r\n        //  TODO: this should be via user save file\r\n        //--------------------------------------\r\n        stats.loadLevel();\r\n        snd.playTrack(stats.currentLevel.audioTrack || 0);\r\n        stats.currentLevel.parallax.forEach((plx, idx) => {\r\n            this.worldContainer.addChildAt(plx, idx);\r\n            plx.SetViewPortX(stats.currentLevel.start[0]);\r\n        });\r\n\r\n        //--------------------------------------\r\n        //  add all objects from level to scene\r\n        //--------------------------------------\r\n        stats.currentLevel.entities.forEach((body: any) => {\r\n            this.worldContainer.addChild(body.DisplayObject);\r\n\r\n            //  if entity is a simple sprite it has a \"fake\" body  \r\n            //  without any shapes, so no need to add it to world\r\n            if (body.shapes && body.shapes.length > 0) {\r\n                wp2.addBody(body);\r\n            }\r\n        });\r\n\r\n        //  set start for player\r\n        wp2.playerBody.position[0] = stats.currentLevel.start[0];\r\n        wp2.playerBody.position[1] = stats.currentLevel.start[1];\r\n        \r\n        this.questMngr.reset();\r\n        this.hero.visible = true;\r\n        this.IsHeroInteractive = true;\r\n        this.hud.visible = true;\r\n        this.sceneManager.ActivateScene(this);\r\n    }\r\n\r\n    /**\r\n     * Sets player interactivity.\r\n     */\r\n    public set IsHeroInteractive(value: boolean) {\r\n        if (this.hero.IsInteractive !== value) {\r\n            this.hero.IsInteractive = value;\r\n            if (!this.hero.IsInteractive) {\r\n                this.hero.play(\"idle\", ANIMATION_FPS_SLOW);\r\n                snd.idle();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Starts an animation tween and removes the display object & body from scene.\r\n     * @param dispObj\r\n     */\r\n    private collectObject(body): void {\r\n        var dispObj: PIXI.DisplayObject = body.DisplayObject as PIXI.DisplayObject;\r\n\r\n        var orgScaleX = dispObj.scale.x;\r\n        var upX = dispObj.position.x + 45;\r\n        var upY = dispObj.position.y + 160;\r\n\r\n        var endX = dispObj.position.x - SCENE_HALF_WIDTH;\r\n        var endY = SCENE_HEIGHT;\r\n\r\n        var moveUp = new TWEEN.Tween(dispObj.position)\r\n            .to({ x: upX, y: upY }, 150);\r\n\r\n        var scale = new TWEEN.Tween(dispObj.scale)\r\n            .to({ x: orgScaleX + 0.5, y: orgScaleX + 0.5 }, 500)\r\n            .easing(TWEEN.Easing.Linear.None);\r\n\r\n        var moveAway = new TWEEN.Tween(dispObj.position)\r\n            .to({ x: endX, y: endY }, 2000)\r\n            .easing(TWEEN.Easing.Back.In)\r\n            .onComplete(() => this.worldContainer.removeChild(dispObj));\r\n\r\n        moveUp.chain(scale, moveAway).start();\r\n        this.removeEntity(body);\r\n    }\r\n\r\n    /**\r\n     * Handles player collision with interactive objects.\r\n     * @param body\r\n     */\r\n    private handleInteractiveCollision(body: any): void {\r\n        var dispObj: PIXI.DisplayObject = body.DisplayObject as PIXI.DisplayObject;\r\n        let interactionType: number = body.DisplayObject.interactionType;\r\n        switch (interactionType) {\r\n            case 1: //  small coin\r\n                stats.increaseStat(StatType.Coins, 1);\r\n                this.collectObject(body);\r\n                this.hud.addInfoMessage(dispObj.position, \"+1 coin\", MSG_COIN_STYLE, -100);\r\n                snd.coin();\r\n                break;\r\n\r\n            case 2: //  coin\r\n                stats.increaseStat(StatType.Coins, 10);\r\n                this.collectObject(body);\r\n                this.hud.addInfoMessage(dispObj.position, \"+10 coins\", MSG_COIN_STYLE, -100);\r\n                snd.coin();\r\n                break;\r\n\r\n            case 3: //  blue gem\r\n                stats.increaseStat(StatType.Coins, 100);\r\n                this.collectObject(body);\r\n                this.hud.addInfoMessage(dispObj.position, \"+100 coins\", MSG_COIN_STYLE, -100);\r\n                snd.gem();\r\n                break;\r\n\r\n            //------------------------------------\r\n            //  QUEST ITEMS 200-999\r\n            //------------------------------------\r\n\r\n            case 201:  //  kendo knowledge\r\n                this.hud.addInfoMessage(dispObj.position, \"Kendo knowledge acquired!\", MSG_COIN_STYLE);\r\n                this.collectObject(body);\r\n                snd.questItem();\r\n                this.questMngr.acquireItem(201);\r\n                break;\r\n\r\n            case 202:  //  KI\r\n                this.hud.addInfoMessage(dispObj.position, \"1 Ki acquired!\", MSG_COIN_STYLE);\r\n                this.collectObject(body);\r\n                snd.questItem();\r\n                this.questMngr.acquireItem(202);\r\n                //  TODO: quest manager\r\n                break;\r\n\r\n            //------------------------------------\r\n            //  OBJECTS DOING DAMAGE 1000-1999\r\n            //------------------------------------\r\n            case DamageType.LavaBorder:  //  border lava   \r\n                {\r\n                    let now = performance.now() / 1000;\r\n                    if (!stats.buffs[DamageType.LavaBorder] || stats.buffs[DamageType.LavaBorder] < now) {\r\n                        this.hud.addInfoMessage(dispObj.position, \"Burning\", MSG_WARN_STYLE, 100);\r\n                    }\r\n                    stats.buffs[DamageType.LavaBorder] = this.secondsFromNow(1);\r\n                }\r\n                break;\r\n            case DamageType.Lava:  //  lava\r\n                {\r\n                    let now = performance.now() / 1000;\r\n                    if (!stats.buffs[DamageType.Lava] || stats.buffs[DamageType.Lava] < now) {\r\n                        this.hud.addInfoMessage(dispObj.position, \"Burning\", MSG_WARN_STYLE, 100);\r\n                    }\r\n                    stats.buffs[DamageType.Lava] = this.secondsFromNow(4);\r\n                }\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Helper that returns time tick value with the given seconds added.\r\n     * @param seconds\r\n     */\r\n    private secondsFromNow(seconds: number): number {\r\n        var now = performance.now() / 1000;\r\n        now += seconds;\r\n        return now;\r\n    }    \r\n\r\n    /**\r\n     * Removes an entity from the p2 world and sets its DisplayObject to null.\r\n     * If the removeDisplayObject is true the display object will be also removed from the worldContainer.\r\n     *\r\n     * @param body\r\n     * @param removeDisplayObject\r\n     */\r\n    public removeEntity(body: p2.Body, removeDisplayObject: boolean = false): void {\r\n        wp2.removeBody(body);\r\n        if (removeDisplayObject) {\r\n            this.worldContainer.removeChild((body as any).DisplayObject);\r\n        }\r\n        (body as any).DisplayObject = null;\r\n    }\r\n\r\n    private clearLevel() {\r\n        if (stats.currentLevel) {\r\n            stats.currentLevel.parallax.forEach((plx: Parallax, idx: number) => {\r\n                this.worldContainer.removeChild(plx);\r\n            });\r\n            stats.currentLevel.entities.forEach((body: any) => {\r\n                if (body !== wp2.playerBody) {\r\n                    this.worldContainer.removeChild(body.DisplayObject);\r\n                    wp2.removeBody(body);\r\n                    body.DisplayObject = null;\r\n                }\r\n            });\r\n\r\n            //  now remove all other display objects except hero\r\n            var all = this.worldContainer.children.filter((c: PIXI.DisplayObject) => c.name !== \"hero\");\r\n            all.forEach((child: any) => {\r\n                this.worldContainer.removeChild(child);\r\n            });\r\n            wp2.clearLevel();\r\n            Bullet.reset();\r\n        }\r\n    }\r\n\r\n    private randomRange(min: number, max: number) {\r\n        return min + (Math.random() * (max - min));\r\n    }\r\n\r\n    private startGroundShake = (event: {milliSeconds: number, magnitudeInPixels: number})=> {\r\n        this.shakeEnd = performance.now() + event.milliSeconds;\r\n        this.magnitude = event.magnitudeInPixels;\r\n        this.shakeDuration = event.milliSeconds / this.SHAKE_COUNT;\r\n    }\r\n}","import * as particles from \"pixi-particles\";\r\nimport * as TWEEN from \"@tweenjs/tween.js\";\r\n\r\nimport { createParticleEmitter } from '../global';\r\nimport { ANIMATION_FPS_SLOW, ANIMATION_FPS_NORMAL, TextureLoader } from '..';\r\nimport { MOVE_TOPIC, GROUND_SHAKE, eventEmitter } from '../events';\r\nimport { AnimatedSprite, AnimationSequence, Global } from '..';\r\nimport { MovementController, MovementState } from './MovementController';\r\nimport { wp2 } from '../world/WorldP2';\r\nimport { stats } from './PlayerStats';\r\nimport { Mob } from '../mobs/Mob';\r\nimport { LevelLoader } from '../world/LevelLoader';\r\nimport { IInteractionType } from '../world/LevelInterfaces';\r\nimport { snd } from '../world/SoundMan';\r\nimport { Bullet } from './Bullet';\r\nimport { StatType, AtrType } from '../enums';\r\n\r\nconst HERO_FRAME_SIZE: number = 64;\r\n\r\nexport class HeroCharacter extends AnimatedSprite {\r\n    private emitterPixies: particles.Emitter;\r\n    private emitterBurn: particles.Emitter;\r\n    private movementCtrl: MovementController;\r\n    private idleAnimationTimeoutHandle: any;\r\n\r\n    constructor(private container: PIXI.Container) {\r\n        super();\r\n        \r\n        this.movementCtrl = new MovementController(wp2);\r\n        wp2.on(\"playerContact\", this.onPlayerContact, this);\r\n        wp2.on(\"bulletContact\", this.onBulletContact, this);\r\n\r\n        var cfg = {     \r\n            alpha: {\r\n                start: 0.7,\r\n                end: 0\r\n            },\r\n            blendMode: \"normal\",\r\n            frequency: 0.01,\r\n            startRotation: {\r\n                min: 265,\r\n                max: 275\r\n            },\r\n            color: {\r\n                start: \"#ffffff\",\r\n                end: \"#ff5050\"\r\n            },\r\n            speed: {\r\n                start: 1,\r\n                end: 0.5,\r\n                minimumSpeedMultiplier: 1\r\n            },\r\n            scale: {\r\n                start: 0.2,\r\n                end: 0.6\r\n            },\r\n            maxParticles: 20,\r\n            lifetime: {\r\n                min: 0.25,\r\n                max: 0.75\r\n            },\r\n            spawnType: \"circle\",\r\n            spawnCircle: {\r\n                x: 0,\r\n                y: HERO_FRAME_SIZE-25,\r\n                r: 25\r\n            }\r\n        };\r\n        //    attached to hero sprite\r\n        this.emitterBurn = createParticleEmitter(this, [TextureLoader.Get(\"assets/entities-atlas.json@flame.png\")], cfg);  \r\n        //   attached to container since it must emit outside hero sprite\r\n        this.emitterPixies = createParticleEmitter(container, [TextureLoader.Get(\"assets/objects-atlas.json@star.png\")]);  \r\n\r\n        const asset = \"assets/objects-atlas.json@hero.png\";\r\n        this.addAnimations(new AnimationSequence(\"right\", asset, [18, 19, 20, 21, 22, 23], HERO_FRAME_SIZE, HERO_FRAME_SIZE));\r\n        this.addAnimations(new AnimationSequence(\"left\", asset, [12, 13, 14, 15, 16, 17], HERO_FRAME_SIZE, HERO_FRAME_SIZE));\r\n        this.addAnimations(new AnimationSequence(\"jumpleft\", asset, [24, 25, 26, 27, 28, 29], HERO_FRAME_SIZE, HERO_FRAME_SIZE));\r\n        this.addAnimations(new AnimationSequence(\"jumpright\", asset, [30, 31, 32, 33, 34, 35], HERO_FRAME_SIZE, HERO_FRAME_SIZE));\r\n        this.addAnimations(new AnimationSequence(\"jumpup\", asset, [1, 3, 4, 6], HERO_FRAME_SIZE, HERO_FRAME_SIZE));\r\n        this.addAnimations(new AnimationSequence(\"idle\", asset, [1, 1, 0, 1, 2, 3, , 4, 5, 13, 12, 6, 7, 11, 18, 19, 0], HERO_FRAME_SIZE, HERO_FRAME_SIZE));\r\n\r\n        this.addAnimations(new AnimationSequence(\"jumpdownleft\", asset, [36, 37, 38], HERO_FRAME_SIZE, HERO_FRAME_SIZE));\r\n        this.addAnimations(new AnimationSequence(\"jumpdownright\", asset, [39, 40, 41], HERO_FRAME_SIZE, HERO_FRAME_SIZE));\r\n        this.addAnimations(new AnimationSequence(\"jumpdown\", asset, [42, 43, 44], HERO_FRAME_SIZE, HERO_FRAME_SIZE));\r\n        this.anchor.set(0.5, 0.58);\r\n        this.scale.y *= -1; //  the worldContainer has -y scale so we must flip it up again \r\n        eventEmitter.on(MOVE_TOPIC, this.onPlayerMove);\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * Returns if the player can interact via controls.\r\n     */\r\n    public get IsInteractive(): boolean {\r\n        return this.movementCtrl.isInteractive;\r\n    }\r\n    \r\n    /**\r\n     * Sets if the player can interact via controls.\r\n     */\r\n    public set IsInteractive(newValue: boolean) {\r\n        this.movementCtrl.isInteractive = newValue;\r\n    }\r\n\r\n   \r\n\r\n    /**\r\n     * Checks movementCtrl.MovementState and updates pixi dust emitter and consumption.\r\n     * @param dt elapsed time in milliseconds\r\n     */\r\n    public onUpdate = (dt: number) => {\r\n        this.position.x = Global.position.x;\r\n        this.position.y = Global.position.y;\r\n\r\n        if (this.IsInteractive) {\r\n            this.movementCtrl.update(dt);\r\n        }\r\n\r\n        switch (this.movementCtrl.MovementState) {\r\n            case MovementState.Idle:\r\n                this.emitterPixies.emit = false;\r\n                break;\r\n            case MovementState.Left:\r\n            case MovementState.JumpLeft:\r\n                this.emitterPixies.emit = this.movementCtrl.IsRunning;\r\n                this.emitterPixies.minStartRotation = -25;\r\n                this.emitterPixies.maxStartRotation = 25;\r\n                break;\r\n            case MovementState.Right:\r\n            case MovementState.JumpRight:\r\n                this.emitterPixies.emit = this.movementCtrl.IsRunning;\r\n                this.emitterPixies.minStartRotation = 155;\r\n                this.emitterPixies.maxStartRotation = 205;\r\n                break;\r\n\r\n            case MovementState.JumpUp:\r\n                this.emitterPixies.emit = this.movementCtrl.IsRunning;\r\n                this.emitterPixies.minStartRotation = 245;\r\n                this.emitterPixies.maxStartRotation = 295;\r\n                break;\r\n        }\r\n        this.emitterPixies.update(dt * 0.001);\r\n        this.emitterPixies.updateOwnerPos(this.position.x, this.position.y);\r\n        this.emitterBurn.update(dt * 0.001);\r\n\r\n        //--------------------------\r\n        //  check if running\r\n        //--------------------------\r\n        if (this.movementCtrl.IsRunning && this.movementCtrl.MovementState !== MovementState.Idle) {\r\n            stats.increaseStat(StatType.Dust, -dt * 0.005);   //  5/sec\r\n            let angle = 8;\r\n            let degree = Math.PI * angle / 180;\r\n            this.rotation = (this.movementCtrl.MovementState === MovementState.Left) ? degree : -degree;\r\n        } else {\r\n            this.rotation = 0;\r\n        }\r\n        this.emitterBurn.emit = stats.isBurning;\r\n        super.onUpdate(dt);        \r\n    };\r\n\r\n    private onPlayerMove = (event: any) => {\r\n        var state: MovementState = event.newState as MovementState;\r\n        var fps = event.isRunning ? ANIMATION_FPS_NORMAL * 1.6 : ANIMATION_FPS_NORMAL;\r\n        switch (state) {\r\n            case MovementState.Idle:\r\n                if(this.idleAnimationTimeoutHandle) clearTimeout(this.idleAnimationTimeoutHandle);\r\n                this.idleAnimationTimeoutHandle = setTimeout(() => {\r\n                    this.play(\"idle\", ANIMATION_FPS_SLOW);\r\n                    snd.idle();\r\n                }, 300);\r\n                break;\r\n            case MovementState.Left:\r\n                clearTimeout(this.idleAnimationTimeoutHandle);\r\n                this.play(\"left\", fps);\r\n                snd.walk(event.isRunning);\r\n                break;\r\n            case MovementState.Right:\r\n                clearTimeout(this.idleAnimationTimeoutHandle);\r\n                this.play(\"right\", fps);\r\n                snd.walk(event.isRunning);\r\n                break;\r\n            case MovementState.JumpLeft:\r\n                clearTimeout(this.idleAnimationTimeoutHandle);\r\n                this.play(\"jumpleft\", fps);\r\n                snd.jump();\r\n                break;\r\n            case MovementState.JumpRight:\r\n                clearTimeout(this.idleAnimationTimeoutHandle);\r\n                this.play(\"jumpright\", fps);\r\n                snd.jump();\r\n                break;\r\n            case MovementState.JumpUp:\r\n                clearTimeout(this.idleAnimationTimeoutHandle);\r\n                this.play(\"jumpup\", fps);\r\n                snd.jump();\r\n                break;\r\n            case MovementState.JumpDownLeft:\r\n                clearTimeout(this.idleAnimationTimeoutHandle);\r\n                this.play(\"jumpdownleft\", fps, false);\r\n                snd.jumpAttack();\r\n                break;\r\n            case MovementState.JumpDownRight:\r\n                clearTimeout(this.idleAnimationTimeoutHandle);\r\n                this.play(\"jumpdownright\", fps, false);\r\n                snd.jumpAttack();\r\n                break;\r\n            case MovementState.JumpDown:\r\n                clearTimeout(this.idleAnimationTimeoutHandle);\r\n                this.play(\"jumpdown\", fps, false);\r\n                snd.jumpAttack();\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Checks if the player has jumped on something with a high velocity.\r\n     * Adds smoke for ground contacts and handles mob collision for npc's.\r\n     *\r\n     * @param event\r\n     */\r\n    private onPlayerContact(event: any): void {\r\n        const SND_TRESHOLD_VELOCITY: number = 400;\r\n        const SMOKE_VELOCITY: number = 450;\r\n        const ATTACK_VELOCITY: number = 505;\r\n\r\n        let body: p2.Body = event.body as p2.Body;\r\n        var mob: Mob = event.body.DisplayObject as Mob;\r\n\r\n        let verticalVelocity = Math.abs(event.velocity[1]);\r\n       \r\n        if (verticalVelocity > ATTACK_VELOCITY) {\r\n            //console.log(\"Vert velocity: \" + verticalVelocity);\r\n            //  check collision vs mobs\r\n            if (mob instanceof Mob) {\r\n                if (!mob.isLoading) {\r\n                    this.handleMobInteraction(mob, body);\r\n                }\r\n            }\r\n\r\n            var movementState = this.movementCtrl.MovementState;\r\n            if (movementState === MovementState.JumpDown || \r\n                movementState === MovementState.JumpDownLeft ||\r\n                movementState === MovementState.JumpDownRight\r\n            ) {\r\n                snd.jumpContact();\r\n                eventEmitter.emit(GROUND_SHAKE, {milliSeconds: 600, magnitudeInPixels: 9});\r\n                return;\r\n            }\r\n        } \r\n        \r\n        if (verticalVelocity > SMOKE_VELOCITY) {\r\n            console.log(\"Vert velocity: \" + verticalVelocity);\r\n            var smoke: AnimatedSprite = new AnimatedSprite();\r\n            smoke.addAnimations(new AnimationSequence(\"smoke\", \"assets/entities-atlas.json@jump_smoke.png\",\r\n                [0, 1, 2, 3, 4, 5], HERO_FRAME_SIZE, HERO_FRAME_SIZE));\r\n            smoke.anchor.set(0.5);\r\n            smoke.pivot.set(0.5);\r\n            smoke.x = this.x;\r\n            smoke.y = this.y - 25;\r\n            smoke.alpha = 0.7;\r\n            smoke.rotation = Math.random() * Math.PI;\r\n            this.container.addChild(smoke);\r\n            smoke.onComplete = () => this.container.removeChild(smoke);\r\n            smoke.play(\"smoke\", 6, false);\r\n        }\r\n        \r\n        if(verticalVelocity > SND_TRESHOLD_VELOCITY){\r\n            snd.jumpContact();\r\n            console.log(\"velocity: \" + event.velocity);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handles bullets hitting the player or obstacle.\r\n     *\r\n     * @param event\r\n     */\r\n    private onBulletContact(event: any): void {\r\n        let bullet: Bullet = event.bulletBody.DisplayObject as Bullet;\r\n        if (!bullet.IsDead) {\r\n            if (event.playerHit) {\r\n                snd.hitPain();\r\n                //this.hud.addInfoMessage(this.position, `${-bullet.damage} HP`, MSG_HP_STYLE, 50);\r\n                stats.increaseStat(StatType.HP, -bullet.damage);\r\n            } else {\r\n\r\n                //  TODO: recycle explode animations\r\n                var explode: AnimatedSprite = new AnimatedSprite();\r\n                explode.addAnimations(new AnimationSequence(\"exp\",\r\n                    \"assets/entities-atlas.json@slime_atk_exp.png\",\r\n                    [0, 1, 2, 3, 4, 5], 32, 32)\r\n                );\r\n                explode.anchor.set(0.5);\r\n                explode.pivot.set(0.5);\r\n                explode.x = bullet.x;\r\n                explode.y = bullet.y;\r\n                explode.alpha = 0.7;\r\n                explode.rotation = Math.random() * Math.PI;\r\n                this.container.addChild(explode);\r\n                explode.onComplete = () => this.container.removeChild(explode);\r\n                explode.play(\"exp\", 10, false);\r\n                snd.bulletHitWall();\r\n            }\r\n            bullet.IsDead = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handles interaction with mobs (mob kill).\r\n     * @param mob\r\n     * @param body\r\n     */\r\n    private handleMobInteraction(mob: Mob, body: p2.Body) {\r\n        let dispObj = (body as any).DisplayObject as PIXI.DisplayObject;\r\n        let it = dispObj as IInteractionType;\r\n\r\n        //  generate drop\r\n        if (it.drop) {\r\n            let isDropping = Math.random() <= it.drop.chance;\r\n            if (isDropping) {\r\n                var dropItemBody = LevelLoader.createEntity(stats.currentLevel.templates, it.drop.entity);\r\n                this.addDropItem(mob, dropItemBody);\r\n            }\r\n            \r\n        }\r\n\r\n        this.removeEntity(body);\r\n        mob.squish(() => this.container.removeChild(dispObj));\r\n        \r\n\r\n        //  add exp       \r\n        var exp = mob.attributes[AtrType.HP] / 2;\r\n        stats.increaseStat(StatType.TotalExp, exp);\r\n    }\r\n\r\n    /**\r\n     * Adds an drop item to the scene with a tween animation.\r\n     * @param dispObj\r\n     */\r\n    private addDropItem(mob: Mob, itemBody: p2.Body): void {\r\n        let dispObj = (itemBody as any).DisplayObject as PIXI.DisplayObject;\r\n        dispObj.x = mob.x;\r\n        dispObj.y = mob.y + 40;\r\n        this.container.addChild(dispObj);\r\n\r\n        //  tween from mob position to random position near hero\r\n        var upX = dispObj.position.x + 75;\r\n        var upY = dispObj.position.y + 200;\r\n        var moveUp = new TWEEN.Tween(dispObj.position)\r\n            .to({ x: upX, y: upY }, 400)\r\n            .onComplete(() => {\r\n                itemBody.position = [dispObj.position.x, dispObj.position.y];\r\n                wp2.addBody(itemBody);\r\n            });\r\n\r\n\r\n        var orgScaleX = dispObj.scale.x;\r\n        var orgScaleY = dispObj.scale.y;\r\n        var scale = new TWEEN.Tween(dispObj.scale)\r\n            .to({ x: orgScaleX + 0.3, y: orgScaleX + 0.3 }, 350)\r\n            .easing(TWEEN.Easing.Linear.None);\r\n\r\n        var endX = this.x;\r\n        var endY = this.y + 8;\r\n        var moveAway = new TWEEN.Tween(dispObj.position)\r\n            .to({ x: endX, y: endY }, 350)\r\n            .easing(TWEEN.Easing.Back.In)\r\n            .onUpdate((pos: PIXI.Point) => {\r\n                itemBody.position = [dispObj.position.x, dispObj.position.y];\r\n            })\r\n            .onComplete(() => dispObj.scale.set(orgScaleX, orgScaleY));\r\n\r\n        moveUp.chain(scale, moveAway).start();\r\n    }\r\n\r\n    /**\r\n     * Removes an entity from the p2 world and sets its DisplayObject to null.\r\n     * If the removeDisplayObject is true the display object will be also removed from the worldContainer\r\n     *\r\n     * @param body\r\n     * @param removeDisplayObject\r\n     */\r\n    public removeEntity(body: p2.Body, removeDisplayObject: boolean = false): void {\r\n        wp2.removeBody(body);\r\n        if (removeDisplayObject) {\r\n            this.container.removeChild((body as any).DisplayObject);\r\n        }\r\n        (body as any).DisplayObject = null;\r\n    }\r\n}","import { KeyboardMapper } from '..';\r\nimport { WorldP2 } from '../world/WorldP2';\r\nimport { stats } from './PlayerStats';\r\nimport { eventEmitter, MOVE_TOPIC } from '../events';\r\nimport { StatType } from '../enums';\r\n\r\nexport class MovementController {\r\n    private readonly VELOCITY = 150;\r\n    private readonly JUMP_FORCE = 17000;\r\n    private readonly JUMP_ATTACK_FORCE = -17000;\r\n\r\n    private readonly JUMP_COOLDOWN = 500;\r\n    private readonly JUMP_ATTACK_COOLDOWN = 2000;\r\n    private readonly JUMP_ATTACK_FREEZE = 800;\r\n\r\n\r\n    private nextJumpAllowed: number = 0;\r\n    private nextJumpDownAllowed: number = 0;\r\n\r\n    private world: WorldP2;\r\n    private movementState: MovementState = -1;\r\n    private kbd = new KeyboardMapper();\r\n\r\n    private isRunning = false;\r\n    private isJumping = false;\r\n    private newState: MovementState = MovementState.Idle;\r\n\r\n    private _isInteractive: boolean = true;\r\n    \r\n    constructor(world: WorldP2) {\r\n        this.world = world;\r\n    }\r\n\r\n    /**\r\n     * Returns if the player can interact via controls.\r\n     */\r\n    public get isInteractive(): boolean {\r\n        return this._isInteractive;\r\n    }\r\n\r\n    /**\r\n     * Sets if the player can interact via controls.\r\n     */\r\n    public set isInteractive(newValue: boolean) {\r\n        this._isInteractive = newValue;\r\n        if (!this._isInteractive) {\r\n            this.isRunning = false;\r\n            this.movementState = MovementState.Idle;\r\n        }\r\n    }\r\n\r\n    public get IsJumping(): boolean {\r\n        return this.isJumping;\r\n    }\r\n\r\n    public get CanJump(): boolean {\r\n        return !this.isJumping && this.nextJumpAllowed < performance.now();\r\n    }\r\n\r\n    public get IsRunning(): boolean {\r\n        return this.isRunning;\r\n    }\r\n\r\n    public get MovementState(): MovementState {\r\n        return this.movementState;\r\n    }\r\n\r\n    public StartJump(direction: MovementState.JumpLeft | MovementState.JumpRight | MovementState.JumpUp): void {\r\n        var forceVector: Array<number>;\r\n\r\n        if (direction === MovementState.JumpUp) {\r\n            forceVector = [0, this.JUMP_FORCE];\r\n        } else if (direction === MovementState.JumpLeft) {\r\n            forceVector = [-this.JUMP_FORCE * 0.10, this.JUMP_FORCE];\r\n        } else if (direction === MovementState.JumpRight) {\r\n            forceVector = [this.JUMP_FORCE * 0.10, this.JUMP_FORCE];\r\n        }\r\n        this.world.playerBody.applyImpulse(forceVector);\r\n        this.world.clearContactsForBody(this.world.playerBody);\r\n        this.nextJumpAllowed = performance.now() + this.JUMP_COOLDOWN;\r\n    }\r\n\r\n    public StartJumpDown(): void {\r\n        switch (this.movementState) {\r\n            case MovementState.Left:\r\n            case MovementState.JumpLeft:\r\n                this.newState = MovementState.JumpDownLeft;\r\n                break;\r\n\r\n            case MovementState.Right:\r\n            case MovementState.JumpRight:\r\n                this.newState = MovementState.JumpDownRight;\r\n                break;\r\n\r\n            default:\r\n                this.newState = MovementState.JumpDown;\r\n                break;\r\n        }\r\n        console.log(\"state change: \" + MovementState[this.movementState] + \" -> \" + MovementState[this.newState]);\r\n        \r\n        var forceVector: number[] = [0, this.JUMP_ATTACK_FORCE];\r\n        this.world.playerBody.setZeroForce();\r\n        this.world.playerBody.applyImpulse(forceVector);\r\n        this.nextJumpDownAllowed = performance.now() + this.JUMP_ATTACK_COOLDOWN;\r\n        \r\n        this.isInteractive = false;\r\n        setTimeout(() => this.isInteractive = true, this.JUMP_ATTACK_FREEZE);\r\n        \r\n        eventEmitter.emit(MOVE_TOPIC, {\r\n            newState: this.newState,\r\n            oldState: this.movementState,\r\n            isJumping: true,\r\n            isRunning: false // makes no difference during jumps\r\n        });\r\n        this.movementState = this.newState;\r\n    }\r\n\r\n    public update(dt: number): void {\r\n\r\n        const KEY_A: number = 65;\r\n        const KEY_D: number = 68;\r\n        const KEY_W: number = 87;\r\n        const KEY_S: number = 83;\r\n\r\n        const KEY_SHIFT: number = 16;\r\n        const KEY_LEFT: number = 37;\r\n        const KEY_RIGHT: number = 39;\r\n        const KEY_UP: number = 38;\r\n        const KEY_DOWN: number = 40;\r\n        const SPACE: number = 32;\r\n\r\n        this.newState = MovementState.Idle;\r\n\r\n        var isMovingVerticaly = Math.abs(this.world.playerBody.velocity[1]) > 0.01;\r\n        if (isMovingVerticaly) {\r\n            let hasOnlySensorContacts = this.world.playerContacts.every((body) => body.shapes[0].sensor);\r\n            this.isJumping = hasOnlySensorContacts;\r\n        } else {\r\n            this.isJumping = false;\r\n        }\r\n\r\n        //  calculate the horizontal velocity\r\n        var v: number = this.calcMovementVelocity();\r\n\r\n        //  no movement (except jump down) while jumping\r\n        if (this.isJumping && this._isInteractive) {\r\n            if ((this.kbd.isKeyDown(KEY_S) || this.kbd.isKeyDown(KEY_DOWN)) && stats.HasJumpAtack && this.nextJumpDownAllowed < performance.now()) {\r\n                this.StartJumpDown();\r\n            }\r\n            this.world.playerBody.velocity[0] += v;\r\n            return;\r\n\r\n        } else {\r\n            //  calculate the horizontal velocity\r\n            this.world.playerBody.velocity[0] = v;\r\n        }\r\n\r\n\r\n        var canRun = stats.getStat(StatType.Dust) > 1;\r\n        var newIsRunning: boolean = this.kbd.isKeyDown(KEY_SHIFT) && canRun && this._isInteractive;\r\n\r\n        if (this.kbd.isKeyDown(KEY_A) || this.kbd.isKeyDown(KEY_LEFT) ) {\r\n            this.newState = MovementState.Left;\r\n        } else if (this.kbd.isKeyDown(KEY_D) || this.kbd.isKeyDown(KEY_RIGHT)) {\r\n            this.newState = MovementState.Right;\r\n        }\r\n\r\n        //  check if jump is pressed\r\n        if ((this.kbd.isKeyDown(KEY_W) || this.kbd.isKeyDown(KEY_UP) || this.kbd.isKeyDown(SPACE)) && this.CanJump) {\r\n            if (this.movementState === MovementState.Left) {\r\n                this.newState = MovementState.JumpLeft;\r\n            } else if (this.movementState === MovementState.Right) {\r\n                this.newState = MovementState.JumpRight;\r\n            } else if (this.movementState === MovementState.Idle) {\r\n                this.newState = MovementState.JumpUp;\r\n                newIsRunning = false;\r\n            }\r\n        }\r\n\r\n        //  has state changed\r\n        if (this.newState !== this.movementState || newIsRunning !== this.IsRunning) {\r\n            var isCurrentJumping = false;\r\n            switch (this.newState) {\r\n                case MovementState.JumpLeft:\r\n                    this.StartJump(MovementState.JumpLeft);\r\n                    isCurrentJumping = true;\r\n                    break;\r\n                case MovementState.JumpRight:\r\n                    this.StartJump(MovementState.JumpRight);\r\n                    isCurrentJumping = true;\r\n                    break;\r\n                case MovementState.JumpUp:\r\n                    this.StartJump(MovementState.JumpUp);\r\n                    isCurrentJumping = true;\r\n                    break;\r\n            }\r\n            eventEmitter.emit(MOVE_TOPIC, {\r\n                newState: this.newState,\r\n                oldState: this.movementState,\r\n                isJumping: isCurrentJumping,\r\n                isRunning: newIsRunning \r\n            });\r\n        }\r\n\r\n        //  update new states\r\n        this.movementState = this.newState;\r\n        this.isRunning = newIsRunning;\r\n    }\r\n\r\n    private calcMovementVelocity(): number {\r\n        var direction: number = 0;\r\n        if (this.movementState === MovementState.Left || this.movementState === MovementState.JumpLeft) {\r\n            direction = -1;\r\n        } else if (this.movementState === MovementState.Right || this.movementState === MovementState.JumpRight) {\r\n            direction = 1;\r\n        }\r\n\r\n        if (this.IsJumping) {\r\n            //  allow for some minimal horizontal movement (this is to prevent getting stuck in air if between two bodies with friction and no contacts)\r\n            return direction * 0.2;\r\n        } else {\r\n            var velocity: number = direction * this.VELOCITY * (this.IsRunning ? 2 : 1.0);\r\n            return velocity;\r\n        }\r\n    }\r\n}\r\n\r\nexport enum MovementState {\r\n    Left,\r\n    Right,\r\n    Idle,\r\n\r\n    JumpLeft,\r\n    JumpRight,\r\n    JumpUp,\r\n\r\n    JumpDownLeft,\r\n    JumpDownRight,\r\n    JumpDown,\r\n}","import * as particles from \"pixi-particles\";\r\nimport * as TWEEN from \"@tweenjs/tween.js\";\r\nimport { Global, TextureLoader } from '..';\r\nimport { createParticleEmitter } from '../global';\r\nimport { stats } from './PlayerStats';\r\nimport { eventEmitter, STATCHANGE_TOPIC, DAMAGE_TOPIC, IStatChangeEvent, IDpsChangeEvent } from '../events';\r\nimport { SCENE_HALF_WIDTH, TEXT_STYLE, SCENE_HEIGHT, SCENE_HALF_HEIGHT, EXP_BAR_STYLE, MSG_HP_STYLE, QUEST_ITEM_STYLE, SCENE_WIDTH, QUEST_STYLE, GUI_FONT, MSG_EXP_STYLE } from '../constants';\r\nimport { StatType } from '../enums';\r\n\r\nexport class StatsHud extends PIXI.Container {\r\n    private txtHP: PIXI.Text;\r\n    private txtDust: PIXI.Text;\r\n    private txtCoins: PIXI.Text;\r\n    private txtExp: PIXI.Text;\r\n    private txtLevel: PIXI.Text;\r\n    private expPreFiller: PIXI.Sprite;\r\n    private expFiller: PIXI.Sprite;\r\n    private fillLen: number;\r\n\r\n    private emitter: particles.Emitter;\r\n\r\n    private statContainer: PIXI.Sprite;\r\n    private txtQuestMessage: PIXI.Text;\r\n    private questMsgEndTime = 0;\r\n    private onCompleteCB?: () => void;\r\n\r\n    private txtPlayerPosition: PIXI.Text;\r\n\r\n    constructor() {\r\n        super();\r\n        this.setup();\r\n    }\r\n\r\n    private setup() {\r\n        //  TODO: remove or make a hud for player position\r\n        this.txtPlayerPosition = new PIXI.Text(\"\", QUEST_STYLE);\r\n        this.txtPlayerPosition.position = new PIXI.Point(SCENE_WIDTH, SCENE_HEIGHT);\r\n        this.txtPlayerPosition.anchor.set(1, 1);\r\n        this.addChild(this.txtPlayerPosition);\r\n\r\n        //  top left stat container panel\r\n        this.statContainer = new PIXI.Sprite(TextureLoader.Get(\"assets/gui-atlas.json@panel.png\", true));\r\n        this.statContainer.position.set(4);\r\n        this.statContainer.name = \"TriggerMessage\";\r\n        this.statContainer.anchor.set(0);\r\n        this.addChild(this.statContainer);\r\n\r\n        this.txtQuestMessage = new PIXI.Text(\"\", QUEST_STYLE);\r\n        this.txtQuestMessage.position.set(384, 100);\r\n        this.txtQuestMessage.anchor.set(0.5, 0);\r\n        this.statContainer.addChild(this.txtQuestMessage);\r\n\r\n        let y: number = 5;\r\n        //  HP\r\n        {\r\n            let pnl = new PIXI.Sprite(TextureLoader.Get(\"assets/gui-atlas.json@stat_panel.png\"));\r\n            pnl.position.set(5, y);\r\n            this.statContainer.addChild(pnl);\r\n\r\n            this.txtHP = new PIXI.Text(\"0\", TEXT_STYLE);\r\n            this.txtHP.position = new PIXI.Point(70, y + 10);\r\n            pnl.addChild(this.txtHP);\r\n\r\n            let spr = new PIXI.Sprite(TextureLoader.Get(\"assets/gui-atlas.json@heart.png\"));\r\n            spr.position.set(8, y + 4);\r\n            pnl.addChild(spr);\r\n        }\r\n\r\n        //  pixi dust\r\n        {\r\n            //let y = 75;\r\n            let pnl = new PIXI.Sprite(TextureLoader.Get(\"assets/gui-atlas.json@stat_panel.png\"));\r\n            //pnl.texture.baseTexture.scaleMode = PIXI.SCALE_MODES.LINEAR;\r\n            pnl.position.set(261, y);\r\n            this.statContainer.addChild(pnl);\r\n\r\n            this.txtDust = new PIXI.Text(\"0\", TEXT_STYLE);\r\n            this.txtDust.position = new PIXI.Point(70, y + 10);\r\n            pnl.addChild(this.txtDust);\r\n\r\n            this.emitter = createParticleEmitter(pnl, [TextureLoader.Get(\"assets/objects-atlas.json@star.png\")]);\r\n            this.emitter.updateOwnerPos(32, 55);\r\n            this.emitter.maxLifetime = 0.6;\r\n            this.emitter.maxParticles = 50;\r\n            this.emitter.emit = true;\r\n        }\r\n\r\n        //  coins\r\n        {\r\n            //let y = 145;\r\n\r\n            let pnl = new PIXI.Sprite(TextureLoader.Get(\"assets/gui-atlas.json@stat_panel.png\"));            \r\n            pnl.position.set(517, y);\r\n            this.statContainer.addChild(pnl);\r\n\r\n            this.txtCoins = new PIXI.Text(\"0\", TEXT_STYLE);\r\n            this.txtCoins.position = new PIXI.Point(70, y + 10);\r\n            pnl.addChild(this.txtCoins);\r\n\r\n            let spr = new PIXI.Sprite(TextureLoader.Get(\"assets/gui-atlas.json@coin.png\"));\r\n            spr.position.set(8, y + 4);\r\n            pnl.addChild(spr);\r\n        }\r\n\r\n        //  Exp\r\n        {\r\n            let pnl = new PIXI.Sprite(TextureLoader.Get(\"assets/gui-atlas.json@exp_panel.png\"));\r\n            \r\n            pnl.position.set(0, SCENE_HEIGHT - pnl.height);\r\n            this.addChild(pnl);\r\n\r\n            //  pre filler rect\r\n            this.expPreFiller = new PIXI.Sprite(TextureLoader.Get(\"assets/gui-atlas.json@exp_prefill.png\"));\r\n            this.expPreFiller.position.set(3, 3);\r\n            pnl.addChild(this.expPreFiller);\r\n\r\n            //  filler rect\r\n            this.expFiller = new PIXI.Sprite(TextureLoader.Get(\"assets/gui-atlas.json@exp_fill.png\"));\r\n            this.expFiller.position.set(3, 3);\r\n            pnl.addChild(this.expFiller);\r\n            this.fillLen = pnl.width - 6; // 3 pixels for left/right border;\r\n\r\n\r\n            this.txtExp = new PIXI.Text(\"0 / 1000\", EXP_BAR_STYLE);\r\n            this.txtExp.pivot.set(0.5);\r\n            this.txtExp.anchor.set(0.5);\r\n            this.txtExp.position = new PIXI.Point(pnl.width / 2, pnl.height / 2);\r\n            pnl.addChild(this.txtExp);\r\n\r\n            //  character level\r\n            this.txtLevel = new PIXI.Text(`Level ${stats.characterLevel}`, TEXT_STYLE);\r\n            this.txtLevel.anchor.set(0, 0.2);\r\n            this.txtLevel.position.set(pnl.x + pnl.width + 4, pnl.y);\r\n            this.addChild(this.txtLevel);\r\n        }\r\n\r\n        eventEmitter.on(STATCHANGE_TOPIC, this.handleStatChange);\r\n        eventEmitter.on(DAMAGE_TOPIC, this.handleDpsChange);\r\n    }\r\n\r\n    public onUpdate(dt: number) {\r\n        this.emitter.update(dt * 0.001);\r\n\r\n        if (this.txtQuestMessage.visible && this.questMsgEndTime < performance.now()) {\r\n            this.txtQuestMessage.visible = false;\r\n            if (this.onCompleteCB) {\r\n                this.onCompleteCB();\r\n            }\r\n        }\r\n\r\n        this.txtPlayerPosition.text = `${Global.position.x.toFixed(0)}, ${Global.position.y.toFixed(0)}`;\r\n    }\r\n\r\n    /**\r\n     * Starts an animation tween with informational text moving upwards from the given position.\r\n     * @param position the start position of the message\r\n     * @param message the message to be added\r\n     * @param style optional PIXI.ITextStyle\r\n     */\r\n    public addInfoMessage(position: PIXI.PointLike | { x: number, y: number }, message: string, style?: PIXI.TextStyleOptions, offsetX?: number): void {\r\n        var stl = style || TEXT_STYLE;\r\n        var txtInfo = new PIXI.Text(message, stl);\r\n        offsetX = offsetX || 0;\r\n        txtInfo.position.set(SCENE_HALF_WIDTH + offsetX, SCENE_HEIGHT - position.y - 70);\r\n        txtInfo.scale.set(1, 1);\r\n\r\n        this.addChild(txtInfo);\r\n\r\n        var dy = (position.y > SCENE_HALF_HEIGHT) ? 250 : -250;\r\n        var upY = SCENE_HEIGHT - position.y + dy;\r\n        var moveUp = new TWEEN.Tween(txtInfo.position)\r\n            .to({ y: upY }, 2000);\r\n        moveUp.start();\r\n\r\n        var scale = new TWEEN.Tween(txtInfo.scale)\r\n            .to({ x: 1.6, y: 1.6 }, 2200)\r\n            .easing(TWEEN.Easing.Linear.None);\r\n\r\n        var fade = new TWEEN.Tween(txtInfo)\r\n            .to({ alpha: 0 }, 3000)\r\n            .onComplete(() => this.removeChild(txtInfo));\r\n        scale.chain(fade).start();\r\n    }\r\n\r\n    /**\r\n     * Adds text message about acquired quest items.\r\n     * @param message the message to be added\r\n     * @param style optional PIXI.ITextStyle\r\n     */\r\n    public addQuestItemMessage(message: string, style?: PIXI.TextStyle): void {\r\n        var stl = style || QUEST_ITEM_STYLE;\r\n        var txtInfo = new PIXI.Text(message, stl);\r\n        txtInfo.anchor.set(0.5, 0.5);\r\n        txtInfo.position.set(SCENE_HALF_WIDTH, 150);\r\n\r\n        this.addChild(txtInfo);\r\n\r\n        var scale = new TWEEN.Tween(txtInfo.scale)\r\n            .to({ x: 1.8, y: 1.8 }, 2200)\r\n            .easing(TWEEN.Easing.Linear.None);\r\n\r\n        var fade = new TWEEN.Tween(txtInfo)\r\n            .to({ alpha: 0 }, 3000)\r\n            .onComplete(() => this.removeChild(txtInfo));\r\n        scale.chain(fade).start();\r\n    }\r\n\r\n    /**\r\n     * Displays the quest message in the quest rectangle.\r\n     * @param msg\r\n     * @param ttlMilis\r\n     */\r\n    public setQuestMessage(msg: string, ttlMilis: number = 8000, onCompleteCB: () => void = null) {\r\n        this.txtQuestMessage.text = msg;\r\n        this.statContainer.visible = true;\r\n        this.txtQuestMessage.visible = true;\r\n        this.questMsgEndTime = performance.now() + ttlMilis;\r\n        this.onCompleteCB = onCompleteCB;\r\n    }\r\n\r\n    /**\r\n     * Starts an animation tween with level up message.\r\n     * @param message the message to be added\r\n     */\r\n    private addLvlUpMessage(message: string): void {\r\n        var stl: PIXI.TextStyleOptions = {\r\n            align: \"center\",\r\n            padding: 0,\r\n            fontSize: \"64px\",\r\n            fontFamily: GUI_FONT,\r\n            fill: 0x335533,\r\n            strokeThickness: 6,\r\n            stroke: 0xccccff\r\n        };\r\n\r\n        var txtInfo = new PIXI.Text(message, stl);\r\n        txtInfo.scale.set(1);\r\n        txtInfo.anchor.set(0.5);\r\n        txtInfo.position.set(SCENE_HALF_WIDTH, SCENE_HEIGHT - Global.position.y - 70);\r\n        this.addChild(txtInfo);\r\n\r\n        var dy = (Global.position.y > SCENE_HALF_HEIGHT) ? 450 : -450;\r\n        var upY = SCENE_HEIGHT - Global.position.y + dy;\r\n        var moveUp = new TWEEN.Tween(txtInfo.position)\r\n            .to({ y: upY }, 2000);\r\n        moveUp.start();\r\n\r\n        var scale = new TWEEN.Tween(txtInfo.scale)\r\n            .to({ x: 1.6, y: 1.6 }, 1500)\r\n            .easing(TWEEN.Easing.Linear.None);\r\n\r\n        var fade = new TWEEN.Tween(txtInfo)\r\n            .to({ alpha: 0.4 }, 6000)\r\n            .onComplete(() => this.removeChild(txtInfo));\r\n        scale.chain(fade).start();\r\n    }    \r\n\r\n    private handleDpsChange = (event: IDpsChangeEvent) => {\r\n        this.addInfoMessage(Global.position, `${event.Amount} HP`, MSG_HP_STYLE, 50);\r\n    };\r\n\r\n    private handleStatChange = (event: IStatChangeEvent) => {\r\n        switch (event.Type) {\r\n            case StatType.Coins:\r\n                this.txtCoins.text = event.NewValue.toString();\r\n                break;\r\n            case StatType.Dust:\r\n                this.txtDust.text = `${event.NewValue.toFixed(0)} / ${event.Stats[StatType.MaxDust].toFixed(0)}`;\r\n                break;\r\n            case StatType.MaxDust:\r\n                this.txtDust.text = `${Math.floor(event.Stats[StatType.Dust])} / ${event.NewValue.toFixed(0)}`;\r\n                break;\r\n            case StatType.HP:\r\n                this.txtHP.text = `${Math.round(event.NewValue)} / ${event.Stats[StatType.MaxHP]}`;\r\n                break;\r\n            case StatType.MaxHP:\r\n                this.txtHP.text = `${Math.round(event.Stats[StatType.HP])} / ${event.NewValue}`;\r\n                break;\r\n            case StatType.TotalExp:\r\n                let exp = event.NewValue - event.OldValue;\r\n                if (exp != 0)\r\n                    this.addInfoMessage({ x: 0, y: 90 }, `+${exp} exp`, MSG_EXP_STYLE, -50);\r\n                this.renderExp(event);\r\n                break;\r\n            case StatType.CharacterLevel:\r\n                this.handleLevelUp(event);\r\n                break;\r\n\r\n            // case StatType.AttributePoints:\r\n            //     this.characterMngr.visible = event.NewValue > 0;\r\n            //     this.txtAtrPts.visible = event.NewValue > 0;\r\n            //     //this.txtAtrPts.text = \"points available\";\r\n            //     break;\r\n        }\r\n    }\r\n\r\n    private handleLevelUp = (event: IStatChangeEvent) => {\r\n        this.txtExp.text = `${Math.round(event.Stats[StatType.LevelExp])} / ${event.Stats[StatType.LevelMaxExp]}`;\r\n        this.expFiller.width = 1;\r\n        this.addLvlUpMessage(\"Level \" + event.NewValue);\r\n        this.txtLevel.text = `Level ${stats.characterLevel}`;\r\n    };\r\n\r\n    private renderExp(event: IStatChangeEvent) {\r\n        this.txtExp.text = `${Math.round(event.Stats[StatType.LevelExp])} / ${event.Stats[StatType.LevelMaxExp]}`;\r\n        this.txtLevel.text = `Level ${stats.characterLevel}`;\r\n\r\n        var pct = Math.min(event.Stats[StatType.LevelExp] / event.Stats[StatType.LevelMaxExp], 1.0);\r\n\r\n        //  special case during level up\r\n        if (pct === 0) {\r\n            this.expFiller.width = 1;\r\n            this.expPreFiller.position.x = 1 + this.expFiller.x;\r\n            return;\r\n        }\r\n\r\n        this.expPreFiller.position.x = this.expFiller.width + this.expFiller.x;\r\n        var targetWidth = (this.fillLen * pct) | 0;\r\n\r\n        var diff = targetWidth - this.expFiller.width;\r\n\r\n        //  tween pre-fill width\r\n        this.expPreFiller.width = 1;\r\n        var preFillTween = new TWEEN.Tween(this.expPreFiller)\r\n            .to({ width: diff }, 1500)\r\n            .easing(TWEEN.Easing.Linear.None);\r\n\r\n        var fillTween = new TWEEN.Tween(this.expFiller)\r\n            .to({ width: targetWidth }, 2000)\r\n            .easing(TWEEN.Easing.Bounce.Out);\r\n        preFillTween.chain(fillTween).start();\r\n    }\r\n}","import { AnimatedSprite, AnimationSequence } from \"../_engine/AnimatedSprite\";\r\n\r\nexport class Lava extends AnimatedSprite {\r\n    private readonly FRAME_SIZE_X: number = 64;\r\n    private readonly FRAME_SIZE_Y: number = 128;\r\n\r\n    constructor(textureName: string) {\r\n        super();\r\n        this.addAnimations(new AnimationSequence(\"lava\", textureName, [0, 1, 2, 3], this.FRAME_SIZE_X, this.FRAME_SIZE_Y));\r\n        this.play(\"lava\", 3);\r\n    }\r\n}","import { TextureLoader } from '..';\r\n\r\nexport class Platform extends PIXI.Container {\r\n\r\n    /**\r\n     * \r\n     * @param tilesX number of horizontal mid tiles. Note: this is the number of mid tiles - the actual width is tilesX + 2\r\n     * @param tilesY number of vertical tiles\r\n     * @param textures array of textures in specific order: top mid, top left, top right, bottom mid, bottom left, bottom right.\r\n     */\r\n    constructor(tilesX: number = 1, tilesY: number = 1, textures:string[]) {\r\n        super();\r\n        this.scale.y *= -1; //  the worldContainer has -y scale so we must flip it up again\r\n        var textureNameTopLeft: string,\r\n            textureNameTopRight: string,\r\n            textureNameBtmMid: string,\r\n            textureNameBtmLeft: string,\r\n            textureNameBtmRight: string;\r\n\r\n        //  this one must exist\r\n        var textureNameTopMid: string = textures[0];\r\n        if (tilesX > 1 || textures.length > 1) {\r\n            textureNameTopLeft = textures[1];\r\n            textureNameTopRight = textures[2];\r\n        }\r\n        if (tilesY > 1) {\r\n            textureNameBtmMid = textures[3];\r\n            textureNameBtmLeft = textures[4];\r\n            textureNameBtmRight = textures[5];\r\n        }\r\n        var spr: PIXI.Sprite;\r\n        var x = 0;\r\n\r\n        //--------------------------\r\n        //  left border\r\n        //--------------------------\r\n        if (textureNameTopLeft) {\r\n            //texture = PIXI.loader.resources[textureNameTopLeft].texture;\r\n            texture = TextureLoader.Get(textureNameTopLeft);\r\n            spr = new PIXI.Sprite(texture);\r\n            spr.position.set(x+1, 0);\r\n            x += texture.width;\r\n            this.addChild(spr);\r\n        }\r\n\r\n        //--------------------------\r\n        //  mid tiles\r\n        //--------------------------\r\n        //var texture = PIXI.loader.resources[textureNameTopMid].texture;\r\n        var texture = TextureLoader.Get(textureNameTopMid);\r\n        if (tilesX > 1) {\r\n            let w = texture.width * tilesX;\r\n            let h = texture.height;\r\n            spr = new PIXI.extras.TilingSprite(texture, w, h);\r\n            spr.position.set(x, 0);\r\n            x += w;\r\n        } else {\r\n            spr = new PIXI.Sprite(texture);\r\n            spr.position.set(x, 0);\r\n            x += spr.width;\r\n        }\r\n        this.addChild(spr);\r\n\r\n        //--------------------------\r\n        //  right border\r\n        //--------------------------\r\n        if (textureNameTopRight) {\r\n            //texture = PIXI.loader.resources[textureNameTopRight].texture;\r\n            texture = TextureLoader.Get(textureNameTopRight);\r\n            spr = new PIXI.Sprite(texture);\r\n            spr.position.set(x -1, 0);\r\n            x += spr.width;\r\n            this.addChild(spr);\r\n        }\r\n\r\n        //--------------------------\r\n        //  fill downwards\r\n        //--------------------------\r\n        let xTiles = tilesX + 2;\r\n        if (tilesY > 1) {\r\n            for (var x = 0; x < xTiles; x++) {\r\n                var name: string;\r\n                if (x === 0) {\r\n                    name = textureNameBtmLeft;\r\n\r\n\r\n                } else if (x === xTiles - 1) {\r\n                    name = textureNameBtmRight;\r\n                } else {\r\n                    name = textureNameBtmMid;\r\n                }\r\n\r\n                for (var y = 1; y < tilesY; y++) {                    \r\n                    //texture = PIXI.loader.resources[name].texture;\r\n                    texture = TextureLoader.Get(name);\r\n                    spr = new PIXI.Sprite(texture);\r\n                    spr.position.set(x * spr.width, y * spr.height);\r\n                    this.addChild(spr);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}","import { TextureLoader } from '..';\r\n\r\nconst TEXTURE_BUMPER = \"assets/objects-atlas.json@bumper_01.png\";\r\nconst TEXTURE_ROTOR =  \"assets/objects-atlas.json@bumper_rotor_01.png\";\r\nconst ROTATION = Math.PI / 8;\r\n\r\nexport class Bumper extends PIXI.Sprite {\r\n    private rotor: PIXI.Sprite;\r\n\r\n    constructor() {\r\n        super(TextureLoader.Get(TEXTURE_BUMPER)/*PIXI.loader.resources[TEXTURE_BUMPER].texture*/);\r\n        this.rotor = new PIXI.Sprite(TextureLoader.Get(TEXTURE_ROTOR)/*PIXI.loader.resources[TEXTURE_ROTOR].texture*/);\r\n        this.rotor.anchor.set(0.5);\r\n        this.rotor.pivot.set(0.5);\r\n        this.addChild(this.rotor);\r\n        this.anchor.set(0.5);\r\n    }\r\n\r\n    public onUpdate = (dt: number) => {\r\n        var rot = this.rotor.rotation - (ROTATION * dt / 1000);\r\n        this.rotor.rotation = rot % Math.PI;\r\n    };\r\n}","import * as Global from \"../global\";\r\nimport { QuestState } from \"./QuestState\";\r\nimport { Quest } from \"./Quest\";\r\nimport { ITriggerDefinition } from \"../world/LevelInterfaces\";\r\nimport { MainScene } from \"../Scenes/MainScene\";\r\nimport { CutScene } from \"../Scenes/CutScene\";\r\nimport { stats } from \"../objects/PlayerStats\";\r\nimport { StatsHud } from \"../objects/StatsHud\";\r\nimport { wp2 } from '../world/WorldP2';\r\nimport { snd } from '../world/SoundMan';\r\nimport { QUEST_STYLE } from '..';\r\nimport { StatType } from '../enums';\r\n\r\n/**\r\n * Contains quest related logic, checks and helpers.\r\n */\r\nexport class QuestManager {\r\n    private questState: Array<QuestState> = [];\r\n    private hud: StatsHud;\r\n\r\n    constructor(private gameScene: MainScene) {\r\n        this.hud = this.gameScene.HudOverlay as StatsHud;\r\n    }\r\n\r\n    /**\r\n     * Resets state of all quests.\r\n     */\r\n    public reset() {\r\n        this.questState.forEach((qs, index) => {\r\n            if (qs != QuestState.None) {\r\n                var quest = this.findQuest(index);\r\n                quest.itemsCollected  = 0;\r\n            }\r\n        });\r\n        this.questState = [];\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param itemId\r\n     */\r\n    public acquireItem(itemId: number) {\r\n        //  find if there is an unfinished quest depending on that item\r\n        let quest = this.findQuestWithItem(itemId);\r\n        if (quest) {\r\n            quest.itemsCollected++;\r\n            this.hud.addQuestItemMessage(`collected ${quest.itemsCollected} / ${quest.itemsNeeded}`);\r\n            if (quest.itemsCollected >= quest.itemsNeeded) {\r\n                this.setQuestState(quest.id, QuestState.Completed);\r\n                if (quest.completedMsg) {\r\n                    this.hud.setQuestMessage(quest.completedMsg);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Checks if a trigger can be activated. \r\n     * @param trigger\r\n     */\r\n    public canActivateTrigger(trigger: ITriggerDefinition): boolean {\r\n        if (!trigger || !trigger.questId) {\r\n            return false;\r\n        }\r\n\r\n        //  check if trigger depends on quest \r\n        if (Array.isArray(trigger.dependsOn)) {\r\n            for (var i = 0; i < trigger.dependsOn.length; i++) {\r\n                let dependency = trigger.dependsOn[i];\r\n                let state = this.questState[dependency];\r\n                if (!state || state != QuestState.Rewarded)\r\n                    return false;\r\n            }\r\n        }\r\n\r\n        let TEN_SECONDS = 10000;\r\n        let nextAllowedTime = (trigger.lastActive || -TEN_SECONDS) + TEN_SECONDS;\r\n        return nextAllowedTime < performance.now();\r\n    }\r\n\r\n    /**\r\n     * Handles level events triggers.\r\n     * @param body\r\n     */\r\n    public handleTriggerEvent(body: any): void {\r\n        let scm = Global.getScm();\r\n        var trigger: ITriggerDefinition = body.Trigger;\r\n\r\n        //  note: trigger can have a predefined state (so we skip previous states)\r\n        let state = Math.max(this.getQuestState(trigger.questId), trigger.state || 0);\r\n\r\n        // react only if trigger has quest id and last active is older than 10 seconds \r\n        if (this.canActivateTrigger(trigger)) {\r\n            trigger.lastActive = performance.now();\r\n\r\n            let quest: Quest = this.findQuest(trigger.questId);\r\n\r\n            switch (trigger.questId) {\r\n                case 1: //   intro\r\n                    if (state === QuestState.None) {\r\n\r\n                        this.setQuestState(trigger.questId, QuestState.Completed);\r\n                        this.gameScene.IsHeroInteractive = false;\r\n\r\n                        this.hud.setQuestMessage(quest.welcomeMsg, 2000, () => {\r\n                            this.hud.setQuestMessage(quest.completedMsg, 2000, () => {\r\n                                this.gameScene.IsHeroInteractive = true;\r\n                                this.setQuestState(trigger.questId, QuestState.Finished);\r\n                                this.giveRewards(quest);\r\n\r\n                                this.setQuestState(trigger.questId + 1, QuestState.InProgress);\r\n                                quest = this.findQuest(trigger.questId + 1);\r\n                                this.hud.setQuestMessage(quest.welcomeMsg, 4000);\r\n                            });\r\n                        });\r\n                    }\r\n                    break;\r\n\r\n                case 2: //  intro - jump on box task\r\n                    if (this.getQuestState(1) > QuestState.Finished) {\r\n                        if (state === QuestState.InProgress) {\r\n                            this.setQuestState(trigger.questId, QuestState.Completed);\r\n                            //this.gameScene.IsHeroInteractive = false;\r\n                            this.hud.setQuestMessage(quest.completedMsg, 4000, () => {\r\n                                this.gameScene.IsHeroInteractive = true;\r\n                                this.setQuestState(trigger.questId, QuestState.Finished);\r\n                                this.giveRewards(quest);\r\n\r\n                                //  start quest 3\r\n                                quest = this.findQuest(trigger.questId + 1);\r\n                                this.setQuestState(trigger.questId + 1, QuestState.InProgress);\r\n                                this.hud.setQuestMessage(quest.welcomeMsg);\r\n                            });\r\n                        } else if (state >= QuestState.Finished) {\r\n                            quest = this.findQuest(trigger.questId + 1);\r\n                            this.hud.setQuestMessage(quest.welcomeMsg, 4000);\r\n                        }\r\n                    }\r\n                    break;\r\n\r\n                case 3: //  intro - exit sign                                           \r\n                    if (state === QuestState.InProgress) {\r\n                        this.setQuestState(trigger.questId, QuestState.Finished);\r\n                        this.giveRewards(quest);\r\n                        this.gameScene.IsHeroInteractive = false;\r\n                        this.hud.setQuestMessage(quest.completedMsg, 4000, () => {\r\n                            Global.getScm().ActivateScene(\"Loader\");\r\n                        });\r\n                        stats.saveUserState(true);\r\n                        snd.win();\r\n                    }\r\n                    break;\r\n\r\n                case 201:   //  Kendo knowledge\r\n                    this.genericQuestHandler(quest, state, body, [\r\n                        () => {\r\n                            let item = Global.worldContainer.getChildByName(\"quest_item_201\");\r\n                            item.visible = true;\r\n                            var lock: any = this.findBodyByName(\"lock\");\r\n                            this.gameScene.removeEntity(lock, true);\r\n                        },\r\n                        () => { },\r\n                        () => {\r\n                            this.setQuestState(trigger.questId, QuestState.Finished);\r\n                            this.giveRewards(quest);\r\n                            this.gameScene.IsHeroInteractive = false;\r\n\r\n                            stats.saveUserState(true);\r\n\r\n                            snd.win();\r\n                            this.hud.visible = false;\r\n                            var cs = scm.GetScene(\"CutScene\") as CutScene;\r\n                            cs.SetText(quest.finishedMsg, QUEST_STYLE);\r\n                            var rt = scm.CaptureScene();\r\n                            cs.SetBackGround(rt, this.gameScene.scale);\r\n                            scm.ActivateScene(cs);\r\n                        }\r\n                    ]);\r\n                    break;\r\n\r\n                // case 202:   //  seek the hanshi Kendo master\r\n                //     this.genericQuestHandler(quest, state, body);\r\n                //     break;\r\n\r\n                case 203:   //  hanshi Kendo master dojo: collect 10 ki\r\n                    this.genericQuestHandler(quest, state, body, [\r\n                        () => { stats.HasJumpAtack = true; },\r\n                        () => { },\r\n                        () => { },\r\n                        () => { }\r\n                    ]);\r\n                    break;\r\n\r\n                // case 204:   //  hanshi Kendo master dojo: collect 25 ki\r\n                //     this.genericQuestHandler(quest, state, body);\r\n                //     break;\r\n\r\n                default:\r\n                    this.genericQuestHandler(quest, state, body);\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param quest \r\n     * @param state \r\n     * @param body the physics sensor or trigger that causes this quest\r\n     * @param actions array of actions (one optional action for each state)\r\n     */\r\n    private genericQuestHandler(quest: Quest, state: QuestState, body, actions?: Array<() => void>) {\r\n        let trigger: ITriggerDefinition = body.Trigger;\r\n        switch (state) {\r\n            case QuestState.None:\r\n                this.setQuestState(quest.id, QuestState.InProgress);\r\n                this.hud.setQuestMessage(quest.welcomeMsg);\r\n                break;\r\n            case QuestState.InProgress:\r\n                this.hud.setQuestMessage(quest.objectiveMsg);\r\n                break;\r\n            case QuestState.Completed:\r\n                if (quest.itemId && quest.itemsCollected >= quest.itemsNeeded) { //  if the acquireItem has set quest to completed move to next stated\r\n                    this.setQuestState(quest.id, QuestState.Finished);\r\n                    trigger.lastActive = 0;\r\n                } else {\r\n                    this.hud.setQuestMessage(quest.completedMsg);\r\n                }\r\n                break;\r\n            case QuestState.Finished:\r\n                this.hud.setQuestMessage(quest.finishedMsg);\r\n                this.giveRewards(quest);\r\n                this.gameScene.removeEntity(body, true); // remove the sensor from physics and the displayobject from scene\r\n                break;\r\n        }\r\n        if (actions && actions[state]) {\r\n            actions[state]();\r\n        }\r\n    }\r\n\r\n    private giveRewards(quest: Quest) {\r\n        snd.questItem();\r\n        if (quest.rewardExp) {\r\n            stats.increaseStat(StatType.TotalExp, quest.rewardExp);\r\n            // let pt = new PIXI.Point(Global.position.x, Global.position.y + 50);\r\n            // this.hud.addInfoMessage(pt, `+${quest.rewardExp} exp`, MSG_EXP_STYLE);\r\n        }\r\n        if (quest.rewardCoins) {\r\n            stats.increaseStat(StatType.Coins, quest.rewardCoins);\r\n            // let pt = new PIXI.Point(Global.position.x + 50, Global.position.y + 100);\r\n            // this.hud.addInfoMessage(pt, `+${quest.rewardCoins} coins`);\r\n        }\r\n        this.setQuestState(quest.id, QuestState.Rewarded);\r\n    }\r\n\r\n    private findQuest(questId: number): Quest {\r\n        var quests = Global.LevelDefinitions.quests.filter((q) => {\r\n            return q.id === questId;\r\n        });\r\n        var quest: Quest = quests[0];\r\n        return quest;\r\n    }\r\n\r\n    private findQuestWithItem(itemId: number): Quest {\r\n        var quests = Global.LevelDefinitions.quests.filter((q: Quest) => {\r\n            if (q.itemId === itemId) {\r\n                let state = this.getQuestState(q.id);\r\n                return state < QuestState.Completed && state > QuestState.None;\r\n            }\r\n            return false;\r\n        });\r\n        if (quests.length > 0) {\r\n            return quests[0];\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n    * Sets the quest state.\r\n    */\r\n    private setQuestState(questId: number, state: QuestState) {\r\n        this.questState[questId] = state;\r\n    }\r\n\r\n    /**\r\n     * Gets the quest state.\r\n     */\r\n    private getQuestState(questId: number): QuestState {\r\n        return this.questState[questId] || QuestState.None;\r\n    }\r\n\r\n    /**\r\n     * Finds a body with the given display objects name.\r\n     * @param name\r\n     */\r\n    private findBodyByName(name: string): p2.Body {\r\n        var foundBody = undefined;\r\n        wp2.bodies.forEach((body: any) => {\r\n            var dispObj = body.DisplayObject as PIXI.DisplayObject;\r\n            if (dispObj && dispObj.name === name) {\r\n                foundBody = body;\r\n            }\r\n        });\r\n        return foundBody;\r\n    }\r\n}\r\n\r\n","\r\nexport enum QuestState {\r\n    None,\r\n\r\n    /**\r\n     *  Quest has been started.\r\n     */\r\n    InProgress,\r\n\r\n    /**\r\n     *  Quest items/conditions have been completed.\r\n     */\r\n    Completed,\r\n\r\n    /**\r\n     *  Quest has been finished.\r\n     */\r\n    Finished,\r\n\r\n    /**\r\n     *  Quest has been finished and reward awarded.\r\n     */\r\n    Rewarded,\r\n}","import { Global, PIXI, Scene, Button, SceneManager } from \"..\";\r\nimport { SCENE_HALF_WIDTH, TEXT_STYLE, SCENE_BACKCOLOR, BTN_WIDTH, SCENE_HEIGHT, BTN_HEIGHT, BTN_STYLE } from '../constants';\r\n\r\n/**\r\n *   Main options GUI.\r\n */\r\nexport class OptionsScene extends Scene {\r\n\r\n    private currentMusicTrack: number = 0; \r\n    \r\n\r\n    /**\r\n     *   Creates a new scene instance.\r\n     */\r\n    constructor(scm:SceneManager) {\r\n        super(scm, \"Options\");\r\n        this.BackGroundColor = SCENE_BACKCOLOR;\r\n        this.setup();\r\n    }\r\n\r\n    public onActivate =()=>{\r\n        var btnOptions = this.sceneManager.MasterHudOverlay.children.find((obj, idx)=> obj.name == \"BTN_OPTIONS\");\r\n        btnOptions!.visible = false;\r\n    }\r\n    public onDeactivate =()=>{\r\n        var btnOptions = this.sceneManager.MasterHudOverlay.children.find((obj, idx)=> obj.name == \"BTN_OPTIONS\");\r\n        btnOptions!.visible = true;\r\n    }\r\n    private setup = () => {\r\n        var title = new PIXI.Text(\"Options\", TEXT_STYLE);\r\n        this.addChild(title);\r\n        title.anchor.set(0.5);\r\n        title.x = SCENE_HALF_WIDTH;\r\n        title.y = 20;\r\n\r\n        let OFFSET = BTN_WIDTH / 3;\r\n        let y = SCENE_HEIGHT - BTN_HEIGHT - OFFSET;\r\n\r\n        //--------------------\r\n        //  back to game\r\n        //--------------------\r\n        var btnBack = new Button(\"assets/gui-atlas.json@gui_button1.png\", OFFSET, y, BTN_WIDTH, BTN_HEIGHT);\r\n        btnBack.text = new PIXI.Text(\"Back to game\", BTN_STYLE);\r\n        btnBack.onClick = () => {\r\n            //this.resetSounds();\r\n            this.sceneManager.ActivatePreviousScene();\r\n        };\r\n        this.addChild(btnBack);\r\n    }\r\n}","import { Scene } from \"../_engine/Scene\";\r\nimport { Button } from \"../_engine/Button\";\r\nimport { snd } from \"../world/SoundMan\";\r\nimport { SceneManager, SCENE_HALF_WIDTH, SCENE_HALF_HEIGHT, SCENE_HEIGHT, BTN_WIDTH, SCENE_WIDTH, BTN_HEIGHT, BTN_STYLE, TextureLoader } from '..';\r\n\r\nexport class CutScene extends Scene {\r\n    private callout: PIXI.Sprite;\r\n    private textMessage: PIXI.Text;\r\n    private backSprite: PIXI.Sprite;\r\n    private deathScene: boolean = false;\r\n    private corpse: PIXI.Sprite;\r\n    private btnContinue: Button;\r\n\r\n    private corpseBlurFilter: PIXI.filters.BlurFilter;\r\n\r\n    constructor(scm: SceneManager) {\r\n        super(scm, \"CutScene\");\r\n        this.BackGroundColor = 0x1099bb;\r\n\r\n        this.corpse = new PIXI.Sprite(TextureLoader.Get(\"assets/objects-atlas.json@hero-dead.png\"));\r\n        this.corpse.anchor.set(0.5);\r\n        this.corpse.pivot.set(0.5);\r\n        this.corpse.position.set(SCENE_HALF_WIDTH, SCENE_HALF_HEIGHT);\r\n        this.addChild(this.corpse);\r\n\r\n        this.corpseBlurFilter = new PIXI.filters.BlurFilter();\r\n        this.corpse.filters = [this.corpseBlurFilter];\r\n\r\n\r\n        this.callout = new PIXI.Sprite(TextureLoader.Get(\"assets/gui-atlas.json@rect.png\"));\r\n        this.callout.anchor.set(0.5);\r\n        this.callout.position.set(SCENE_HALF_WIDTH, SCENE_HEIGHT / 5);\r\n        this.addChild(this.callout);\r\n\r\n        this.textMessage = new PIXI.Text(\"\");\r\n        this.textMessage.anchor.set(0.5);\r\n        this.textMessage.position.set(0, 0);\r\n        this.callout.addChild(this.textMessage);\r\n\r\n        //--------------------------------\r\n        //  btn for next level\r\n        //--------------------------------\r\n        this.btnContinue = new Button(  \"assets/gui-atlas.json@gui_button1.png\",\r\n                                        (SCENE_WIDTH - BTN_WIDTH) / 2,\r\n                                        this.callout.height + BTN_HEIGHT,\r\n                                        BTN_WIDTH, \r\n                                        BTN_HEIGHT);\r\n        this.btnContinue.text = new PIXI.Text(\"Continue\", BTN_STYLE);\r\n        this.btnContinue.onClick = () => {            \r\n            this.sceneManager.ActivateScene(\"Loader\");\r\n        };\r\n        this.addChild(this.btnContinue);\r\n    }\r\n\r\n    public onActivate = () => {\r\n        this.btnContinue.visible = !this.deathScene;\r\n        this.callout.visible = !this.deathScene;\r\n        this.corpse.visible = this.deathScene;\r\n        this.corpse.scale.set(0.1);\r\n        this.btnContinue.text.text = this.deathScene ? \"Retry\" : \"Continue\";\r\n\r\n        if (this.deathScene) {\r\n            var deathTrackId = snd.getTrack(\"Carrousel\");\r\n            snd.playTrack(deathTrackId);\r\n        }\r\n    }\r\n\r\n    public onUpdate(dt: number) {\r\n        if (this.deathScene) {\r\n            if (this.corpse.scale.x < 2.5) {\r\n                this.corpse.rotation += 0.03;\r\n                var scale = this.corpse.scale.x + 0.01;\r\n                this.corpse.scale.set(scale);\r\n            } else {\r\n                //  death msg & retry btn\r\n                this.deathScene = false;\r\n                this.textMessage.text = this.deathMessages[0 | (Math.random() * this.deathMessages.length)];\r\n                this.callout.visible = true;\r\n                this.btnContinue.visible = true;\r\n            }\r\n        } else {\r\n            this.corpse.rotation += 0.005;           \r\n        }\r\n\r\n        var blr = Math.max(5, this.corpseBlurFilter.blur + 0.00004);\r\n        this.corpseBlurFilter.blur = blr;\r\n    }\r\n\r\n    /**\r\n     * If true the player death scene is played.\r\n     */\r\n    public get DeathScene() {\r\n        return this.deathScene;\r\n    }\r\n    public set DeathScene(value: boolean) {\r\n        this.deathScene = value;\r\n        if (this.deathScene) {\r\n            this.corpseBlurFilter.blur = 0;\r\n            var clm = new PIXI.filters.ColorMatrixFilter();\r\n            clm.sepia();\r\n            this.backSprite.filters = [clm];\r\n        } else {\r\n            this.backSprite.filters = null;\r\n        }\r\n    }\r\n\r\n\r\n    public SetBackGround(texture: PIXI.RenderTexture, scale) {\r\n        if (!this.backSprite) {\r\n            this.backSprite = new PIXI.Sprite(texture);\r\n            this.addChildAt(this.backSprite, 0);\r\n        } else {\r\n            this.backSprite.texture = texture;\r\n        }\r\n        this.backSprite.scale.set(1 / scale.x, 1 / scale.y);  //  rescale to fit full scene\r\n    }\r\n\r\n    public SetText(text: string, style?: PIXI.TextStyleOptions) {\r\n        this.textMessage.text = text;\r\n        if (style) {\r\n            this.textMessage.style = new PIXI.TextStyle(style);\r\n        }\r\n    }\r\n\r\n    private deathMessages: string[] = [\r\n        \"Life sucks and you just died!\",\r\n        \"You decided to check the\\nafterlife. Guess what?\\n\\nYou are dead!\",\r\n        \"Owned!\\nMore luck next time.\",\r\n        \"You have died!\\nRest in peace.\",\r\n        \"Your quest has failed.\\nMay you find more peace\\nin that world than\\nyou found in this one.\",\r\n        \"Here's a picture of\\nyour corpse.\\n\\nNot pretty!\",\r\n        \"Yep, you're dead.\\nMaybe you should consider\\nplaying a Barbie game!\",\r\n        \"Died...\"\r\n    ];\r\n}","import { StatType } from './enums';\r\n\r\nexport var eventEmitter = new PIXI.utils.EventEmitter();\r\nexport var MOVE_TOPIC = \"MOVE\";\r\nexport var BURN_TOPIC = \"BURN\";\r\nexport var STATCHANGE_TOPIC = \"STATCHANGE\";\r\nexport var DAMAGE_TOPIC = \"DAMAGE\";\r\n\r\n//  action signaling topics\r\nexport var GROUND_SHAKE = \"SHAKE\";\r\n\r\nexport interface IStatChangeEvent {\r\n    Type: StatType;\r\n    OldValue: number;\r\n    NewValue: number;\r\n    Stats: Array<number>;\r\n}\r\n\r\nexport interface IDpsChangeEvent {\r\n    OldValue: number;\r\n    Amount: number;\r\n}\r\n\r\nexport interface IBurnChangeEvent {\r\n    wasBurning: boolean;\r\n    isBurning: boolean;\r\n}","import {Howl} from \"howler\";\r\n\r\nexport class SoundMan {\r\n    private backgroundSnd: Howl;\r\n    private walkSnd: Howl;\r\n    private jumpSnd1: Howl;\r\n    private jumpSnd2: Howl;\r\n    private burnSnd: Howl;\r\n    private coinSnd: Howl;\r\n    private gemSnd: Howl;\r\n    private hurtSnd: Howl;\r\n    private winSnd: Howl;\r\n    private atkMag1: Howl;\r\n    private hitMag1: Howl;\r\n    private jumpAtk: Howl;\r\n    private woosh: Howl;\r\n    private squish: Howl;\r\n    private pain: Howl;\r\n    private jmpContact: Howl;\r\n    \r\n    private fxDemoSnd: Howl;\r\n\r\n    private questItemSnd: Howl;\r\n\r\n    private musicTrackNames: Array<string> = [\r\n        'assets/audio/Two-Finger-Johnny.mp3',\r\n        'assets/audio/Bumbling-Burglars_Looping.mp3',\r\n        'assets/audio/Bama-Country.mp3',\r\n        'assets/audio/Beachfront-Celebration.mp3',\r\n        'assets/audio/Easy-Jam.mp3',\r\n        'assets/audio/Whiskey-on-the-Mississippi.mp3',\r\n        'assets/audio/ZigZag.mp3',\r\n        'assets/audio/Carrousel.mp3',\r\n        'assets/audio/Disco-Break.mp3'\r\n    ];\r\n    private musicTracks: Array<Howl> = [];\r\n    private currentTrack: number = 0;\r\n\r\n    constructor() {\r\n        for (var i = 0, len = this.musicTrackNames.length; i < len; i++) {\r\n            var trackName = this.musicTrackNames[i];\r\n            this.musicTracks.push(new Howl({\r\n                src: [trackName],\r\n                autoplay: false,\r\n                loop: true,\r\n                volume: 0.6\r\n            }));\r\n        }\r\n\r\n        this.walkSnd = new Howl({\r\n            src: ['assets/audio/effects/step.mp3'],\r\n            preload: true,\r\n            autoplay: false,\r\n            loop: true,\r\n            volume: 1,\r\n        });\r\n        this.jumpSnd1 = new Howl({\r\n            src: ['assets/audio/effects/jump1.mp3'],\r\n            preload: true,\r\n            autoplay: false,\r\n            loop: false,\r\n            volume: 1\r\n        });\r\n        this.jumpSnd2 = new Howl({\r\n            src: ['assets/audio/effects/jump2.mp3'],\r\n            preload: true,\r\n            autoplay: false,\r\n            loop: false,\r\n            volume: 1\r\n        });\r\n        this.burnSnd = new Howl({\r\n            src: ['assets/audio/effects/burn.mp3'],\r\n            preload: true,\r\n            autoplay: false,\r\n            loop: true,\r\n            volume: 1\r\n        });\r\n        this.hurtSnd = new Howl({\r\n            src: ['assets/audio/effects/hurt.mp3'],\r\n            preload: true,\r\n            autoplay: false,\r\n            loop: false,\r\n            volume: 1\r\n        });\r\n        this.coinSnd = new Howl({\r\n            src: ['assets/audio/effects/coin.mp3'],\r\n            preload: true,\r\n            autoplay: false,\r\n            loop: false,\r\n            volume: 1\r\n        });\r\n        this.gemSnd = new Howl({\r\n            src: ['assets/audio/effects/gem.mp3'],\r\n            preload: true,\r\n            autoplay: false,\r\n            loop: false,\r\n            volume: 1\r\n        });\r\n        this.questItemSnd = new Howl({\r\n            src: ['assets/audio/effects/quest-item.mp3'],\r\n            autoplay: false,\r\n            loop: false,\r\n            volume: 1\r\n        });\r\n        this.winSnd = new Howl({\r\n            src: ['assets/audio/effects/win.mp3'],\r\n            autoplay: false,\r\n            loop: false,\r\n            volume: 1\r\n        });\r\n        this.atkMag1 = new Howl({\r\n            src: ['assets/audio/effects/atk-mag01.mp3'],\r\n            autoplay: false,\r\n            loop: false,\r\n            volume: 1,\r\n        });\r\n        this.hitMag1 = new Howl({\r\n            src: ['assets/audio/effects/hit-mag01.mp3'],\r\n            autoplay: false,\r\n            loop: false,\r\n            volume: 1\r\n        });\r\n        this.jumpAtk = new Howl({\r\n            src: ['assets/audio/effects/jump-atk01.mp3'],\r\n            autoplay: false,\r\n            loop: false,\r\n            volume: 1\r\n        });\r\n        this.pain = new Howl({\r\n            src: ['assets/audio/effects/pain01.mp3'],\r\n            autoplay: false,\r\n            loop: false,\r\n            volume: 1\r\n        });\r\n\r\n        this.jmpContact = new Howl({\r\n            src:['assets/audio/effects/jmp-contact.mp3'],\r\n            autoplay: false,\r\n            loop: false,\r\n            volume: 1\r\n        });\r\n\r\n        this.woosh = new Howl({\r\n            src: ['assets/audio/effects/woosh.mp3'],\r\n            autoplay: false,\r\n            loop: false,\r\n            volume: 1\r\n        });\r\n        this.squish = new Howl({\r\n            src: ['assets/audio/effects/mob-squish.mp3'],\r\n            autoplay: false,\r\n            loop: false,\r\n            volume: 1\r\n        });\r\n\r\n        this.fxDemoSnd = new Howl({\r\n            src: ['assets/audio/effects/fx-demo.mp3'],\r\n            autoplay: false,\r\n            loop: false,\r\n            volume: 1\r\n        });\r\n    }\r\n\r\n    private previousMusicVolume = 0.6;\r\n    private previousFxVolume = 1;\r\n\r\n    private musicVolume = 0.6;\r\n    private fxVolume = 1;\r\n\r\n    public get MusicVolume() { return this.musicVolume; }\r\n    public set MusicVolume(value: number) {\r\n        this.musicVolume = value;\r\n        if (this.backgroundSnd && this.backgroundSnd.playing()) {\r\n            this.backgroundSnd.volume(this.musicVolume);\r\n        }\r\n    }\r\n\r\n    public get FxVolume() { return this.fxVolume; }\r\n    public set FxVolume(value: number) {\r\n        this.fxVolume = value;\r\n    }\r\n\r\n\r\n    public get IsFxOn() { return this.fxVolume > 0.0; }\r\n    public set IsFxOn(value: boolean) {\r\n        if (!value) {\r\n            this.previousFxVolume = this.fxVolume;\r\n            this.FxVolume = 0;\r\n        } else {\r\n            this.FxVolume = this.previousFxVolume;\r\n        }\r\n    }\r\n\r\n    public get IsMusicOn() { return this.musicVolume > 0.0; }\r\n    public set IsMusicOn(value: boolean) {\r\n        if (!value) {\r\n            this.previousMusicVolume = this.musicVolume;\r\n            this.MusicVolume = 0;\r\n        } else {\r\n            this.MusicVolume = this.previousMusicVolume;\r\n        }\r\n    }\r\n\r\n    public get CurrentTrackId() {\r\n        return this.currentTrack;\r\n    }\r\n\r\n\r\n    public get fxDemo() {\r\n        return this.fxDemoSnd;\r\n    }\r\n\r\n    public jumpAttack() {\r\n        this.walkSnd.pause();\r\n        this.jumpAtk.loop(false);\r\n        this.jumpAtk.play();\r\n        this.jumpAtk.volume(this.fxVolume);\r\n    }\r\n\r\n    public jump() {\r\n        this.walkSnd.pause();\r\n        this.jumpSnd1.play();\r\n        this.jumpSnd1.volume(this.fxVolume);\r\n    }\r\n    public idle() {\r\n        this.walkSnd.pause();\r\n    }\r\n    public walk(isRunning?: boolean) {\r\n        this.walkSnd.rate(isRunning ? 2.0 : 1.2);\r\n        if (!this.walkSnd.playing()) {\r\n            this.walkSnd.volume(this.fxVolume);\r\n            this.walkSnd.play();\r\n        }\r\n    }\r\n    public atkMagic1() {\r\n        this.atkMag1.volume(this.fxVolume);\r\n        this.atkMag1.play();\r\n    }\r\n    public hitMagic1() {\r\n        this.hitMag1.volume(this.fxVolume);\r\n        this.hitMag1.play();\r\n    }\r\n    public hitPain() {\r\n        this.pain.volume(this.fxVolume);\r\n        this.pain.play();\r\n    }\r\n\r\n    public mobSquish() {\r\n        this.squish.volume(this.fxVolume);\r\n        this.squish.play();\r\n    }\r\n\r\n    public bulletHitWall() {\r\n        this.woosh.volume(this.fxVolume);\r\n        this.woosh.play();\r\n    }\r\n\r\n    public coin() {\r\n        this.coinSnd.volume(this.fxVolume);\r\n        this.coinSnd.play();\r\n    }\r\n\r\n    public gem() {\r\n        this.gemSnd.volume(this.fxVolume);\r\n        this.gemSnd.play();\r\n    }\r\n\r\n    public hurt() {\r\n        this.hurtSnd.volume(this.fxVolume);\r\n        this.hurtSnd.play();\r\n    }\r\n\r\n    public jumpContact() {\r\n        this.jmpContact.volume(this.fxVolume);\r\n        this.jmpContact.play();\r\n    }\r\n    public questItem() {\r\n        this.questItemSnd.volume(this.fxVolume);\r\n        this.questItemSnd.play();\r\n    }\r\n\r\n    public win() {\r\n        if (this.backgroundSnd && this.backgroundSnd.playing()) {\r\n            this.backgroundSnd.fade(1, 0, 500);\r\n        }\r\n        this.hurtSnd.stop();\r\n        this.walkSnd.stop();\r\n        this.jumpSnd1.stop();\r\n        this.jumpSnd2.stop();\r\n        this.burnSnd.stop();\r\n\r\n        this.winSnd.volume(this.fxVolume);\r\n        this.winSnd.play();\r\n    }\r\n\r\n    public burn() {\r\n        if (!this.burnSnd.playing()) {\r\n            this.burnSnd.volume(this.fxVolume);\r\n            this.burnSnd.play();\r\n        }\r\n        this.hurt();\r\n    }\r\n    public burnStop() {\r\n        //this.burnSnd.stop();\r\n        this.burnSnd.fade(1, 0, 200);\r\n        setTimeout(() => this.burnSnd.stop(), 200);\r\n    }\r\n\r\n    public getTrack(name: string) {\r\n        for (var i = 0, len = this.musicTrackNames.length; i < len; i++) {\r\n            if (this.musicTrackNames[i].indexOf(name) >= 0) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    public stopTrack() {\r\n        if (this.backgroundSnd !== undefined) {\r\n            this.backgroundSnd.stop();\r\n        }\r\n    }\r\n\r\n    public playTrack(trackId: number) {\r\n        if (this.backgroundSnd === undefined) {\r\n            this.backgroundSnd = this.musicTracks[trackId];\r\n            console.log(\"playTrack \" + trackId, this.backgroundSnd);\r\n        }\r\n\r\n        if (this.backgroundSnd !== this.musicTracks[trackId]) {\r\n            this.backgroundSnd.stop();\r\n            this.backgroundSnd = this.musicTracks[trackId];\r\n            this.backgroundSnd.volume(this.musicVolume);\r\n            this.backgroundSnd.play();\r\n        } else {\r\n            if (!this.backgroundSnd.playing()) {\r\n                this.backgroundSnd.volume(this.musicVolume);\r\n                this.backgroundSnd.play();\r\n            }\r\n        }\r\n        this.currentTrack = trackId;\r\n    }\r\n}\r\n\r\nexport var snd = new SoundMan();","import { Dictionary } from \"./Dictionary\";\r\nimport * as PIXI from 'pixi.js';\r\nimport { TextureLoader } from './TextureLoader';\r\n\r\nexport class AnimatedSprite extends PIXI.Sprite {\r\n    constructor() {\r\n        super();\r\n        this.pivot.set(0.5);\r\n        this.anchor.set(0.5);\r\n    }\r\n    \r\n    private animations = new Dictionary<AnimationSequence>();\r\n    protected currentSequence: AnimationSequence | null = null;\r\n\r\n    public addAnimations(...sequences: Array<AnimationSequence>):void {\r\n        sequences.forEach((seq: AnimationSequence, idx:number) => {\r\n            this.animations.set(seq.sequenceName, seq);\r\n\r\n            //  if no clip exists create it from first animation sequence\r\n            if (!this.texture.valid && idx === 0) {\r\n                this.texture = seq.spriteSheet;\r\n                this.texture.frame = seq.frames[0];\r\n            }\r\n        });\r\n    }\r\n\r\n    public clearAnimations() {\r\n        this.stop();\r\n        this.currentSequence = null;\r\n        this.animations.clear();\r\n    }\r\n\r\n    /**\r\n     *  Plays the animation sequence by name\r\n     */\r\n    public play = (name: string, fps?: number, loop = true) :void => {\r\n        if (!this.currentSequence || this.currentSequence.sequenceName !== name) {\r\n            this.resetAnimation();\r\n            this.currentSequence = this.animations.get(name);\r\n            this.texture = this.currentSequence.spriteSheet;\r\n            this.texture.frame = this.currentSequence.frames[0];            \r\n            this.isPlaying = true;\r\n        }\r\n        this.fps = fps || this.fps;\r\n        this.isLooping = loop;\r\n    }\r\n\r\n    private accumulator: number = 0;\r\n    private isPlaying: boolean = false;\r\n    private isLooping: boolean = false;\r\n    private frameIndex: number = 0;\r\n    private currentFps: number = 8;\r\n    private onCompleteCallBack!: (seq:AnimationSequence) => void;\r\n\r\n    public onUpdate (dt: number) { \r\n        if (this.isPlaying && this.texture.valid && this.currentSequence) {\r\n            this.accumulator += dt;\r\n            let secForFrame = 1000 / this.fps;\r\n            if (this.accumulator > secForFrame) {\r\n                this.accumulator -= secForFrame;\r\n                this.texture.frame = this.currentSequence.frames[++this.frameIndex];\r\n                if (this.frameIndex == this.currentSequence.frames.length-1) {\r\n                    this.frameIndex = 0;\r\n\r\n                    //  end the animation if not looping\r\n                    if (!this.isLooping) {\r\n                        this.isPlaying = false;\r\n                        if (this.onCompleteCallBack) {\r\n                            this.onCompleteCallBack(this.currentSequence);\r\n                        }\r\n                    }\r\n                }                \r\n            }\r\n        }\r\n    }\r\n\r\n    public set onComplete(cb: (seq: AnimationSequence) => void) {\r\n        this.onCompleteCallBack = cb;\r\n    }\r\n    public get onComplete(): (seq: AnimationSequence) => void {\r\n        return this.onCompleteCallBack;\r\n    }\r\n\r\n    public stop():void {\r\n        this.isPlaying = false;\r\n    }\r\n    public get fps():number {\r\n        return this.currentFps;\r\n    }\r\n    public set fps(fps: number) {\r\n        this.currentFps = fps;\r\n        if (fps < 2) debugger;\r\n    }    \r\n    public set loop(isLooping: boolean) {\r\n        this.isLooping = isLooping;\r\n    }\r\n    public get loop(): boolean {\r\n        return this.isLooping;\r\n    }\r\n    \r\n    protected resetAnimation():void {\r\n        this.stop();\r\n        this.currentSequence = null;\r\n        this.accumulator = 0;\r\n        this.frameIndex = -1;\r\n    }\r\n    \r\n}\r\n\r\n/*\r\n *   Creates textures for all individual frames of the sequence from the given texture atlas.\r\n */\r\nexport class AnimationSequence  {\r\n    public spriteSheet: PIXI.Texture;\r\n    public frames: PIXI.Rectangle[] = [];\r\n\r\n    constructor(public sequenceName: string, spriteSheetName:string, frames: Array<number> = [], frameWidth : number, frameHeight : number) {\r\n        //let tempTexure : PIXI.Texture = PIXI.utils.TextureCache[spriteSheetName];\r\n        let tempTexure = TextureLoader.Get(spriteSheetName);\r\n        let isAtlas = TextureLoader.IsAtlas(tempTexure);\r\n        \r\n        this.spriteSheet = new PIXI.Texture(tempTexure.baseTexture);\r\n        var xFrames = isAtlas ? Math.floor(tempTexure.frame.width / frameWidth) : Math.floor(this.spriteSheet.width / frameWidth);\r\n        \r\n        frames.forEach((frame:number) => {\r\n            let y = Math.floor(frame / xFrames);\r\n            let x = frame % xFrames;\r\n            let rect : PIXI.Rectangle = null;\r\n            if(isAtlas){\r\n                rect = new PIXI.Rectangle(tempTexure.frame.x +  x * frameWidth, tempTexure.frame.y + y * frameHeight, frameWidth, frameHeight);\r\n            }\r\n            else{                \r\n                rect = new PIXI.Rectangle(x * frameWidth, y * frameHeight, frameWidth, frameHeight);\r\n            }\r\n            this.frames.push(rect);\r\n        });\r\n    }\r\n    \r\n    public get frameCount(): number {\r\n        return this.frames.length;\r\n    }\r\n}","import * as Global from \"../global\";\r\nimport * as p2 from \"p2\";\r\nimport { Parallax, AnimatedSprite, AnimationSequence  } from \"..\";\r\nimport { COL_GRP_PLAYER, COL_GRP_GROUND, COL_GRP_NPC, COL_GRP_SCENE, COL_GRP_BULLET } from \"./CollisionGroups\";\r\nimport { SpawnPoint } from '../mobs/SpawnPoint';\r\nimport { Mob } from '../mobs/Mob';\r\nimport { IRootObject, ILevel, ILevelDefinition, IMapEntity, IMobEntity, ISpawnPoint, IDisplayObjectDefinition, IInteractionType, IBodyDefinition } from './LevelInterfaces';\r\nimport { getEntityDefinition } from './LevelHelper';\r\nimport { SCENE_HEIGHT, SCENE_WIDTH } from '../constants';\r\nimport { Dictionary, TextureLoader } from '../_engine';\r\n\r\ndeclare type Fn = (definition: IDisplayObjectDefinition) => PIXI.DisplayObject;\r\n\r\nexport class LevelLoader {\r\n    \r\n    private gameLevels: IRootObject;\r\n    private static factoryList = new Dictionary<Fn>();\r\n\r\n    constructor(gameLevels: IRootObject) {\r\n        this.gameLevels = gameLevels;\r\n    }\r\n\r\n    /**\r\n     * Registers custom factory function for creating display objects.\r\n     * @param name the entity name used in level definition\r\n     * @param factory factory function returning a display object based on the given definition\r\n     */\r\n    public static registerFactory(name:string, factory:Fn){\r\n        this.factoryList.set(name, factory);\r\n    }\r\n\r\n    /**\r\n     * Loads the level.\r\n     * @param name\r\n     * @param container\r\n     */\r\n    public buildLevel(id: number): ILevel {\r\n\r\n        //  find the level by its id\r\n        var levelDefinition: ILevelDefinition = undefined;\r\n        for (var i = 0; i < this.gameLevels.levels.length; i++) {\r\n            if (this.gameLevels.levels[i].id === id) {\r\n                levelDefinition = this.gameLevels.levels[i];\r\n                break;\r\n            }\r\n        }\r\n\r\n        //  create level objects\r\n        var result: ILevel;\r\n        if (levelDefinition) {\r\n            result = this.createLevel(levelDefinition);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private createLevel(level: ILevelDefinition): ILevel {\r\n        var result: ILevel = {\r\n            parallax: [],\r\n            entities: [],\r\n            start: [],\r\n            audioTrack: level.audioTrack,\r\n            templates: [],\r\n            spawnPoints: []\r\n        };\r\n\r\n        //--------------------------------------\r\n        //  create parallax objects\r\n        //--------------------------------------            \r\n        var vps = new PIXI.Point(SCENE_WIDTH, SCENE_HEIGHT);\r\n        level.parallax.forEach((iplx) => {\r\n            var parallax = new Parallax(vps, iplx.parallaxFactor, iplx.textures, iplx.scale);\r\n            parallax.y = iplx.y;\r\n            result.parallax.push(parallax);\r\n        });\r\n\r\n        //--------------------------------------\r\n        //  merge global with level templates\r\n        //--------------------------------------\r\n        var templates = Global.LevelDefinitions.templates.concat(level.map.templates);\r\n        result.templates = templates;\r\n\r\n        //--------------------------------------\r\n        //  create display/physics object pairs\r\n        //--------------------------------------\r\n        level.map.entities.forEach((entity: IMapEntity, idx, arr) => {\r\n            let p2body = LevelLoader.createEntity(templates, entity);            \r\n            result.entities.push(p2body);\r\n        });\r\n\r\n        //--------------------------------------\r\n        //  create NPC's\r\n        //--------------------------------------\r\n        level.map.NPC = level.map.NPC || [];\r\n        level.map.NPC.forEach((npc: IMobEntity, idx, arr) => {\r\n            if (npc.type && npc.type === \"spawn_point\") {\r\n                let sp = <any>npc as ISpawnPoint;\r\n                let entity = sp.entity;\r\n                result.spawnPoints.push(new SpawnPoint(sp.name, sp.xy[0], sp.xy[1], sp.area, sp.maxMobCount, sp.respawnSeconds, entity));\r\n            } else {\r\n                let p2body = LevelLoader.createMob(templates, npc);                \r\n                result.entities.push(p2body);\r\n            }\r\n        });\r\n        result.start = level.map.start;\r\n        return result;\r\n    }\r\n\r\n    public static createEntity(templates: Array<any>, entity: IMapEntity): p2.Body {\r\n        let defs = getEntityDefinition(templates, entity);\r\n\r\n        //  display object\r\n        let dispObj: PIXI.DisplayObject = LevelLoader.buildDisplayObject(defs.doDef);\r\n        dispObj.name = entity.name || entity.template;\r\n        (dispObj as any).templateName = defs.templateName;\r\n\r\n        //  body\r\n        var p2body: p2.Body;\r\n        if (defs.bdDef) {\r\n            p2body = LevelLoader.buildPhysicsObject(defs.bdDef, dispObj);\r\n            p2body.shapes.every((s: p2.Shape) => {\r\n                if (defs.bdDef.collisionType === \"ground\") {\r\n                    s.collisionGroup = COL_GRP_GROUND;\r\n                    s.collisionMask = COL_GRP_PLAYER | COL_GRP_NPC | COL_GRP_SCENE | COL_GRP_BULLET;\r\n                } else {\r\n                    s.collisionGroup = COL_GRP_SCENE;\r\n                    s.collisionMask = COL_GRP_PLAYER | COL_GRP_NPC | COL_GRP_SCENE | COL_GRP_GROUND;\r\n                }\r\n                return true;\r\n            });\r\n            (p2body as any).DisplayObject = dispObj;\r\n\r\n            //  trigger\r\n            if (defs.trigger) {\r\n                (p2body as any).Trigger = defs.trigger;\r\n            }\r\n        } else {\r\n            p2body = new p2.Body();\r\n            (p2body as any).DisplayObject = dispObj;\r\n        }\r\n        return p2body;\r\n    }\r\n\r\n    public static createMob(templates: Array<any>, entity: IMobEntity): p2.Body {\r\n        let defs = getEntityDefinition(templates, entity);\r\n\r\n        //  display object\r\n        let mobDispObj: Mob = LevelLoader.buildDisplayObject(defs.doDef) as Mob;\r\n        mobDispObj.name = entity.name || entity.template;\r\n        (mobDispObj as any).templateName = defs.templateName;\r\n\r\n        // attributes and AI\r\n        mobDispObj.attributes = entity.attributes || defs.doDef.attributes || [];\r\n        mobDispObj.createAI(entity.ai || \"basic_static\");\r\n        mobDispObj.atkTexture = entity.attack || defs.doDef.attack;\r\n\r\n        //  body        \r\n        defs.bdDef.material = defs.bdDef.material || \"mob_default\";\r\n        var p2body: p2.Body = LevelLoader.buildPhysicsObject(defs.bdDef, mobDispObj);\r\n        p2body.shapes.every((s: p2.Shape) => {\r\n            s.collisionGroup = COL_GRP_NPC;\r\n            s.collisionMask = COL_GRP_PLAYER | COL_GRP_GROUND | COL_GRP_SCENE;\r\n            return true;\r\n        });\r\n        (p2body as any).DisplayObject = mobDispObj;\r\n\r\n        //  trigger\r\n        if (defs.trigger) {\r\n            (p2body as any).Trigger = defs.trigger;\r\n        }\r\n\r\n        return p2body;\r\n    }\r\n\r\n    /**\r\n     * Creates a display object from the definition.\r\n     * @param definition\r\n     */\r\n    private static buildDisplayObject(definition: IDisplayObjectDefinition): PIXI.DisplayObject {\r\n        var dispObj: PIXI.DisplayObject;\r\n        definition = {...{anchor: 0.5, pivot: 0.5, scale:[1,1]}, ...definition};\r\n        switch (definition.typeName) {\r\n            case \"Mob\":\r\n                let mob = new Mob(definition.texture as string);\r\n                //  if animations are defined in the json replace the built-in mob animations\r\n                if (definition.sequences) {\r\n                    mob.clearAnimations();\r\n                    definition.sequences.forEach((seq) => {\r\n                        var textureName = seq.texture || definition.texture;\r\n                        var aseq = new AnimationSequence(seq.name, textureName as string, seq.frames, seq.framesize[0], seq.framesize[1]);\r\n                        mob.addAnimations(aseq);\r\n                    });\r\n                    mob.play(definition.sequences[0].name);\r\n                }\r\n                if (definition.fps) {\r\n                    mob.fps = definition.fps;\r\n                }                \r\n                (mob as any).typeName = \"Mob\";\r\n                dispObj = mob;\r\n                break;\r\n\r\n            case \"Sensor\":\r\n                dispObj = new PIXI.DisplayObject();\r\n                (dispObj as any).typeName = \"Sensor\";\r\n                break;\r\n\r\n            case \"AnimatedSprite\":\r\n                var aspr = new AnimatedSprite();\r\n                definition.sequences.forEach((seq, idx, arr) => {\r\n                    var aseq = new AnimationSequence(seq.name, seq.texture, seq.frames, seq.framesize[0], seq.framesize[1]);\r\n                    aspr.addAnimations(aseq);\r\n                });\r\n                aspr.play(definition.sequences[0].name, definition.fps);\r\n                (aspr as any).typeName = \"AnimatedSprite\";\r\n                dispObj = aspr;\r\n                break;\r\n\r\n            case \"Sprite\":\r\n                var sprTexture = TextureLoader.Get(definition.texture as string);\r\n                var spr = new PIXI.Sprite(sprTexture);\r\n                (spr as any).typeName = \"Sprite\";\r\n                dispObj = spr;\r\n                break;\r\n\r\n            default:\r\n                var factory = this.factoryList.get(definition.typeName);\r\n                if(factory)\r\n                    dispObj = factory(definition);\r\n                else\r\n                    throw \"Factory not found for object name: \" + definition.typeName;\r\n                break;            \r\n        }\r\n        (dispObj).scale.set(definition.scale[0], definition.scale[1] * -1); //  the worldContainer has -y scale so we must flip it up again \r\n        if((dispObj as any).anchor)(dispObj as any).anchor.set(definition.anchor);\r\n        dispObj.pivot.set(definition.pivot);\r\n\r\n        if (definition.visible !== undefined) {\r\n            dispObj.visible = definition.visible;\r\n        }\r\n        dispObj.rotation = definition.rotation || 0;\r\n        if (definition.xy) {\r\n            dispObj.position.set(definition.xy[0], definition.xy[1]);\r\n        }        \r\n        if (definition.interactionType) {\r\n            (dispObj as IInteractionType).interactionType = definition.interactionType;\r\n        }\r\n        if (definition.drop) {\r\n            (dispObj as IInteractionType).drop = definition.drop;\r\n        }\r\n        if (definition.tint) {\r\n            (dispObj as any).tint = parseInt(definition.tint, 16);\r\n        }\r\n        return dispObj;\r\n    }\r\n\r\n    /**\r\n     * Creates a physics body and shape from the definition.\r\n     * @param definition\r\n     * @param dispObj the display object to retrieve the defaults from.\r\n     * @param preventSensor if true a non sensor body will be created (this is to support mobs\r\n     *                      that must have normal bodies but also an interactionType.\r\n     */\r\n    private static buildPhysicsObject(definition: IBodyDefinition, dispObj: PIXI.DisplayObject, preventSensor: boolean = false): p2.Body {\r\n        var body: p2.Body;\r\n        let w = 0, h = 0;\r\n        if (definition) {\r\n            var options: p2.BodyOptions = {\r\n                mass: definition.mass,\r\n                position: definition.xy ? definition.xy : [dispObj.x, dispObj.y],\r\n                angle: definition.angle || dispObj.rotation,\r\n                fixedRotation: definition.fixedRotation || false,\r\n                angularDamping: definition.angularDamping || 0.1,\r\n                damping: definition.damping || 0.1,\r\n            } as p2.BodyOptions;\r\n            \r\n            body = new p2.Body(options);\r\n            body.type = definition.type || p2.Body.KINEMATIC; /* DYNAMIC = 1, DYNAMIC = 1, STATIC = 2 */\r\n            var dispObjAsAny: any = dispObj as any;\r\n            var shape: p2.Shape;\r\n            switch (definition.shape) {\r\n                case \"Circle\":\r\n                    let radius = 32;\r\n                    if (definition.size) {\r\n                        if (definition.size.constructor === Array) {\r\n                            radius = definition.size[0];\r\n                        } else {\r\n                            radius = definition.size as number;\r\n                        }\r\n                    } else {\r\n                        radius = dispObjAsAny.width;\r\n                    }\r\n                    shape = new p2.Circle({ radius: radius });\r\n                    break;\r\n\r\n                case \"Platform\":\r\n                    if (definition.size) {\r\n                        w = definition.size[0];\r\n                        h = definition.size[1];\r\n                    } else {\r\n                        w = Math.abs(dispObjAsAny.width);\r\n                        h = Math.abs(dispObjAsAny.height);\r\n                    }\r\n                    shape = new p2.Box({\r\n                        width: w,\r\n                        height: h,\r\n                    });\r\n\r\n                    //  the position is centered but we need it to be left top aligned\r\n                    body.position[0] = body.position[0] + w / 2;\r\n                    body.position[1] = body.position[1] - h / 2;\r\n                    break;\r\n\r\n                case \"Box\":\r\n                    //  get the size\r\n                    if (definition.size) {\r\n                        w = definition.size[0];\r\n                        h = definition.size[1];\r\n                    } else {\r\n                        if (dispObjAsAny.width) {\r\n                            w = Math.abs(dispObjAsAny.width);\r\n                            h = Math.abs(dispObjAsAny.height);\r\n                        } else {\r\n                            //  TODO: check this - seems not to get correct bounds\r\n                            w = dispObj.scale.x * dispObj.getLocalBounds().width;\r\n                            h = dispObj.scale.y * dispObj.getLocalBounds().height;\r\n                        }\r\n                    }\r\n                    shape = new p2.Box({\r\n                        width: w,\r\n                        height: h,\r\n                    });\r\n                    break;\r\n                //  TODO: implement other shapes if needed\r\n            }\r\n\r\n            if (definition.material) {\r\n                (shape as any).materialName = definition.material;\r\n            }\r\n\r\n            if (!preventSensor && !!(dispObj as IInteractionType).interactionType) {\r\n                shape.sensor = true;\r\n                body.type = p2.Body.STATIC;\r\n                body.collisionResponse = false;\r\n                body.setDensity(0.0); //   this is to prevent body impacts on player collide (makes no sense as it is a sensor, bug maybe?)\r\n                console.log(\"created collectible sensor\", shape);\r\n            } else if ((dispObj as any).typeName === \"Sensor\") {\r\n                shape.sensor = true;\r\n                body.type = p2.Body.STATIC;\r\n                body.collisionResponse = false;\r\n                body.setDensity(0.0);\r\n            }\r\n\r\n            body.addShape(shape);\r\n        }\r\n        return body;\r\n    }\r\n}","import * as pixi from 'pixi.js';\r\nexport var PIXI = pixi;\r\n\r\nimport * as g from \"./global\";\r\nexport var Global = g;\r\n\r\nexport * from \"./_engine\";\r\nexport * from \"./constants\";","export class Dictionary<T> {\r\n    private _values: { [key: string]: T; } = {};\r\n    private _keys: string[] = [];\r\n\r\n    public get(key: string): T {\r\n        return this._values[key];        \r\n    }\r\n\r\n    public contains(key: string): boolean {\r\n        return key in this._values;\r\n    }\r\n\r\n    public remove(key: string) {\r\n        var index = this._keys.indexOf(key, 0);\r\n        this._keys.splice(index, 1);\r\n        delete this._values[key];\r\n    }\r\n\r\n    public set(key: string, value: T) {\r\n        if (!(key in this._values)) {\r\n            this._keys.push(key);\r\n        }\r\n        this._values[key] = value;\r\n    }\r\n\r\n    public get keys(): string[] {\r\n        return this._keys;\r\n    }\r\n\r\n    public getAll(): { [key: string]: T; } {\r\n        return this._values;\r\n    }\r\n\r\n    public getSet(key: string, valueGetter: () => T): T;\r\n    public getSet(key: string, value: T): T;\r\n    public getSet(key: string, valueOrvalueGetter: any): T {\r\n        if (!this.contains(key)) {\r\n            this.set(key, typeof valueOrvalueGetter == 'function' ? valueOrvalueGetter() : valueOrvalueGetter);\r\n        }\r\n        return this.get(key);\r\n    }\r\n\r\n    public clear() {\r\n        this._keys = [];\r\n        this._values = {};\r\n    }\r\n}\r\n","export const COL_GRP_PLAYER = 1;\r\nexport const COL_GRP_NPC = 2;\r\nexport const COL_GRP_SCENE = 4;\r\nexport const COL_GRP_BULLET = 8;\r\nexport const COL_GRP_GROUND = 16;"],"sourceRoot":""}